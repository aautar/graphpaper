<!DOCTYPE html>
<html>

<head>
    <title>GraphPaper</title>
    <script src="../dist/graphpaper.js" type="text/javascript"></script>

    <style type="text/css">
        * { margin:0; padding:0; font-family:LatoRegular; font-size:14px; font-weight:normal; }
        html, body { width:100%; height:100%; }
        body { background:#fff; }
        ul, li { list-style:none; }
        path { fill: none; }

        /* border, margin, and padding is not currently handled and will screw up transformations */
        #paper { border:0px solid #f00; width:1000px; height:1000px; overflow:hidden; position:relative; transform-origin:0 0; }
        
        .obj { display:flex; align-items:center; justify-content:center; position:absolute; width:44px; height:44px; background:#fff; border:1px solid #0094ff; border-radius:4px; }
        .translateHandle { cursor:move; display:block; width:12px; height:12px; background:#0094ff; border-radius:12px; }
        .resizeHandle { cursor:nwse-resize; display:block; position:absolute; bottom:3px; right:3px; width:12px; height:12px; background:url(resize-handle.svg) 0 0 no-repeat; } 
        .connectorAnchor { cursor:pointer; display:block; position:absolute; top:0px; right:-18px; width:12px; height:12px; background:#fff; border:2px solid rgb(0, 109, 201); border-radius:4px; }
    </style>

</head>


<body>
    
    <div id="paper">

        <div id="obj1" class="obj">
            <div id="translateHandle1" class="translateHandle"></div>
            <div id="translateHandle1b" class="translateHandle" style="margin-left:-45px;"></div>
            <div id="resizeHandle1"  class="resizeHandle"></div>
            <div id="connectorAnchor1" class="connectorAnchor"></div>
        </div>

        <div id="obj2" class="obj">
            <div id="translateHandle2" class="translateHandle"></div>
            <div id="resizeHandle2" class="resizeHandle"></div>
            <div id="connectorAnchor2" class="connectorAnchor"></div>
        </div>        


        <div id="obj3" class="obj">
            <div id="translateHandle3" class="translateHandle"></div>
            <div id="resizeHandle3" class="resizeHandle"></div>
            <div id="connectorAnchor3" class="connectorAnchor"></div>
        </div>        

    </div>


    <script type="text/javascript">
	
        const canvas = new GraphPaper.Canvas(
            document.getElementById('paper'), 
            window,
            new Worker('../dist/connector-routing-worker.js')
        );

        canvas.initInteractionHandlers();
        canvas.initTransformationHandlers();

        canvas.setConnectorFactory(function(_anchorStart, _anchorEnd, _containerDomElement) {
            const c = new GraphPaper.Connector(_anchorStart, _anchorEnd, _containerDomElement, '#006dc9', '4px');
            c.on("connector-click", function(e) {
                console.log(e);
            });

            return c;
        });

        const obj1 = new GraphPaper.CanvasObject(
            'obj1', 
            0, 
            0, 
            44, 
            44, 
            canvas,
            document.getElementById('obj1'), 
            [document.getElementById('translateHandle1'), document.getElementById('translateHandle1b')],
            [document.getElementById('resizeHandle1')]
        );

        obj1.addInteractableConnectorAnchor(document.getElementById('connectorAnchor1'));

        const obj2 = new GraphPaper.CanvasObject(
            'obj2', 
            0, 
            0, 
            44, 
            44, 
            canvas,
            document.getElementById('obj2'), 
            [document.getElementById('translateHandle2')],
            [document.getElementById('resizeHandle2')]
        );

        obj2.addInteractableConnectorAnchor(document.getElementById('connectorAnchor2'));
        obj2.translate(100, 100);

        const obj3 = new GraphPaper.CanvasObject(
            'obj3', 
            0, 
            0, 
            44, 
            44, 
            canvas,
            document.getElementById('obj3'), 
            [document.getElementById('translateHandle3')],
            [document.getElementById('resizeHandle3')]
        );

        obj3.addInteractableConnectorAnchor(document.getElementById('connectorAnchor3'));        
        obj3.translate(200,200);

        canvas.addObject(obj1);
        canvas.addObject(obj2);
        canvas.addObject(obj3);

        obj3.suspendTranslateInteractions();
        obj3.resumeTranslateInteractions();

        //canvas.removeObject(obj2.getId());

        //canvas.translate(400, 200);
        //canvas.scale(0.4, true);     
        //canvas.translate(400, 200);
        
        canvas.applyTransform();

        /*canvas.on('click', (e) => {
            obj1.translate(e.targetPoint.getX(), e.targetPoint.getY());
        });*/

    </script>

</body>

</html>