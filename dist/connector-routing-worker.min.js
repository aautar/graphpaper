"use strict";var _slicedToArray=function(){function a(c,d){var e=[],f=!0,g=!1,h=void 0;try{for(var l,k=c[Symbol.iterator]();!(f=(l=k.next()).done)&&(e.push(l.value),!(d&&e.length===d));f=!0);}catch(m){g=!0,h=m}finally{try{!f&&k["return"]&&k["return"]()}finally{if(g)throw h}}return e}return function(c,d){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return a(c,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(){"use strict";function a(m,n){this.getX=function(){return m},this.getY=function(){return n},this.isEqual=function(o){return m===o.getX()&&n===o.getY()},this.getCartesianPoint=function(o,p){return new a(m-0.5*o,-n+0.5*p)},this.toString=function(){return m+" "+n}}function c(m,n){this.getType=function(){return m},this.getIntersectionPoint=function(){return n}}function d(m,n){var o=this;this.getStartPoint=function(){return m},this.getEndPoint=function(){return n},this.isEqual=function(p){return o.getStartPoint().isEqual(p.getStartPoint())&&o.getEndPoint().isEqual(p.getEndPoint())},this.getLength=function(){return Math.sqrt(Math.pow(n.getX()-m.getX(),2)+Math.pow(n.getY()-m.getY(),2))},this.computeIntersectionType=function(p){var q=m.getX(),r=m.getY(),s=n.getX(),t=n.getY(),u=p.getStartPoint().getX(),v=p.getStartPoint().getY(),w=p.getEndPoint().getX(),x=p.getEndPoint().getY(),y=(x-v)*(s-q)-(w-u)*(t-r),z=(w-u)*(r-v)-(x-v)*(q-u),A=(s-q)*(r-v)-(t-r)*(q-u);if(0==y)return 0==y&&0==z&&0==A?h.COINCIDENT:h.PARALLEL;var B=z/y,C=A/y;return 1<B||0>B||1<C||0>C?h.LINE:h.LINESEG},this.computeIntersection=function(p){var q=m.getX(),r=m.getY(),s=n.getX(),t=n.getY(),u=p.getStartPoint().getX(),v=p.getStartPoint().getY(),w=p.getEndPoint().getX(),x=p.getEndPoint().getY(),y=(x-v)*(s-q)-(w-u)*(t-r),z=(w-u)*(r-v)-(x-v)*(q-u),A=(s-q)*(r-v)-(t-r)*(q-u);if(0==y)return 0==y&&0==z&&0==A?new c(h.COINCIDENT,null):new c(h.PARALLEL,null);var B=z/y,C=A/y,D=m.getX()+B*(n.getX()-m.getX()),E=m.getY()+B*(n.getY()-m.getY());return 1<B||0>B||1<C||0>C?new c(h.LINE,new a(D,E)):new c(h.LINESEG,new a(D,E))}}function e(m){var n=this,o=[];this.push=function(q){var r=!1;return(o.forEach(function(s){q.isEqual(s)&&(r=!0)}),!r)&&(o.push(q),!0)},this.findPointClosestTo=function(q){var r=null,s=Number.MAX_SAFE_INTEGER;return o.forEach(function(t){var u=new d(q,t);u.getLength()<s&&(r=t,s=u.getLength())}),r},this.findDistanceToPointClosestTo=function(q){var r=Number.MAX_SAFE_INTEGER;return o.forEach(function(s){var t=new d(q,s);t.getLength()<r&&(r=t.getLength())}),r},this.findPointsCloseTo=function(q,r){var s=new e;return o.forEach(function(t){var u=new d(q,t);u.getLength()<=r&&s.push(t)}),s},this.toArray=function(){return o},this.toFloat64Array=function(){for(var q=new Float64Array(2*o.length),r=0;r<o.length;r++)q[0+2*r]=o[r].getX(),q[1+2*r]=o[r].getY();return q};this.count=function(){return o.length},m&&Array.isArray(m)?m.forEach(n.push):m&&"[object Float64Array]"===Object.prototype.toString.call(m)&&function p(q){o.length=0;for(var r=0;r<q.length;r+=2)o.push(new a(q[r],q[r+1]))}(m)}function f(m){var n=this,o=[];this.push=function(q){var r=!1;return(o.forEach(function(s){q.isEqual(s)&&(r=!0)}),!r)&&(o.push(q),!0)},this.toArray=function(){return o},this.count=function(){return o.length},this.toFloat64Array=function(){for(var q=new Float64Array(4*o.length),r=0;r<o.length;r++)q[0+4*r]=o[r].getStartPoint().getX(),q[1+4*r]=o[r].getStartPoint().getY(),q[2+4*r]=o[r].getEndPoint().getX(),q[3+4*r]=o[r].getEndPoint().getY();return q};m&&Array.isArray(m)?m.forEach(n.push):m&&"[object Float64Array]"===Object.prototype.toString.call(m)&&function p(q){o.length=0;for(var r=0;r<q.length;r+=4)o.push(new d(new a(q[r],q[r+1]),new a(q[r+2],q[r+3])))}(m)}function g(m,n){var o=this,p=new Map,q=function(u){for(var x,v=n.toArray(),w=0;w<v.length;w++)if(x=v[w].computeIntersectionType(u),x===h.LINESEG)return!0;return!1},s=function(u){var v=Number.MAX_SAFE_INTEGER,w=null,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var A,z=u.entries()[Symbol.iterator]();!(_iteratorNormalCompletion=(A=z.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(A.value,2),x=_step$value[0],y=_step$value[1];y<v&&(w=x,v=y)}}catch(B){_didIteratorError=!0,_iteratorError=B}finally{try{!_iteratorNormalCompletion&&z.return&&z.return()}finally{if(_didIteratorError)throw _iteratorError}}return null===w?null:{cost:v,point:w}},t=function(u,v,w,x){var z=new Map,y=p.get(w);y=y.filter(function(B){for(var C=0;C<v.length;C++)if(B.isEqual(v[C]))return!1;return!0}),y.forEach(function(B){var C=new d(w,B).getLength()+u,D=new d(B,x).getLength();z.set(B,C+D)});var A=s(z);return null===A?null:A};this.findPointClosestTo=function(u){var v=null,w=Number.MAX_SAFE_INTEGER;return p.forEach(function(x,y){var z=new d(u,y);z.getLength()<w&&(v=y,w=z.getLength())}),v},this.findVisiblePointClosestTo=function(u){var v=null,w=Number.MAX_SAFE_INTEGER;return p.forEach(function(x,y){var z=new d(u,y);!q(z)&&z.getLength()<w&&(v=y,w=z.getLength())}),v},this.computeRoute=function(u,v){var y=o.findVisiblePointClosestTo(u);if(null===y)return new e;for(var A,w=0,z=[y],x=y;(A=t(w,z,x,v),null!==A)&&!(w+=new d(x,A.point).getLength(),z.push(A.point),x=A.point,1>new d(x,v).getLength()););return new e(z)},function r(){for(var u=m.toArray(),v=0;v<u.length;v++)p.set(u[v],[]);for(var w=0;w<u.length;w++)for(var y,x=w+1;x<u.length;x++)if(y=new d(u[w],u[x]),!q(y)){var z=p.get(u[w]);z.push(u[x]),p.set(u[w],z);var A=p.get(u[x]);A.push(u[w]),p.set(u[x],A)}}()}var h=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"}),k=function(m){return"L"+m.getX()+" "+m.getY()},l=function(m,n,o){var p=m.anchor_start_centroid.split(" "),q=m.anchor_end_centroid.split(" "),r=new a(p[0],p[1]),s=new a(q[0],q[1]),t=n.findDistanceToPointClosestTo(r),u=n.findPointsCloseTo(r,t).findPointClosestTo(s),v=n.findPointsCloseTo(s,t).findPointClosestTo(r),w=o.computeRoute(u,v),x=w.toArray(),y=[];x.forEach(function(B){y.push(k(B))}),y.push(k(s));var z=r.getX()+" "+r.getY(),A="M"+z+y.join(" ");return A};onmessage=function onmessage(m){var n=m.data.gridSize,o=m.data.connectorDescriptors,p=m.data.routingPoints,q=new Float64Array(p),r=new e(q),s=m.data.boundaryLines,t=new Float64Array(s),u=new f(t),v=m.data.anchorPoints,w=new Float64Array(v),x=new e(w),y=new g(r,u);o.forEach(function(z){z.svgPath=l(z,x,y)}),postMessage({connectorDescriptors:o})}})();