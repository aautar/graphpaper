{"version":3,"file":"connector-routing-worker.min.js","sources":["../../src/Point.js","../../src/LineIntersection.js","../../src/Line.js","../../src/PointSet.js","../../src/LineSet.js","../../src/PointVisibilityMap.js","../../src/SvgPathBuilder.js","../../src/Workers/ConnectorRoutingWorker.js"],"sourcesContent":["/**\r\n * \r\n * @param {Number} _x\r\n * @param {Number} _y\r\n */\r\nfunction Point(_x, _y) {\r\n    this.__x = _x;\r\n    this.__y = _y;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getX = function() {\r\n    return this.__x;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getY = function() {\r\n    return this.__y;\r\n};\r\n\r\n/**\r\n * @param {Point} _otherPoint\r\n * @returns {Boolean}\r\n */\r\nPoint.prototype.isEqual = function(_otherPoint) {\r\n    if(this.__x === _otherPoint.getX() && this.__y === _otherPoint.getY()) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */\r\nPoint.prototype.getCartesianPoint = function(_canvasWidth, _canvasHeight) {\r\n    return new Point(\r\n        this.__x - (_canvasWidth * 0.5),\r\n        -this.__y + (_canvasHeight * 0.5)\r\n    );\r\n};\r\n\r\n/**\r\n * @returns {String}\r\n */\r\nPoint.prototype.toString = function() {\r\n    return this.__x + \" \" + this.__y;\r\n};\r\n\r\n/**\r\n * @returns {Number[]}\r\n */\r\nPoint.prototype.toArray = function() {\r\n    return [this.__x, this.__y];\r\n};\r\n\r\n/**\r\n * @param {Number[]} _arr\r\n * @returns {Point}\r\n */\r\nPoint.fromArray = function(_arr) {\r\n    return new Point(_arr[0], _arr[1]);\r\n};\r\n\r\nexport { Point };\r\n","import  {Point} from './Point';\r\n\r\nconst LINE_INTERSECTION_TYPE = Object.freeze({\r\n\tPARALLEL: \"parallel\",\t\t// no intersection, lines are parallel\r\n    COINCIDENT: \"coincident\",\t// no intersection, lines are coincident\r\n\tLINE: \"line\",\t\t\t\t// the lines intersect, but the intersection point is beyond the bounds of the line segments\r\n\tLINESEG: \"lineseg\",\t\t\t// the lines intersect, and the intersection point is within the bounds of the line segments\r\n});\r\n\r\n/**\r\n * \r\n * @param {LINE_INTERSECTION_TYPE} _type \r\n * @param {Point} _intersectionPoint \r\n */\r\nfunction LineIntersection(_type, _intersectionPoint) {\r\n\r\n    /**\r\n     * @returns {LINE_INTERSECTION_TYPE}\r\n     */\r\n    this.getType = function() {\r\n        return _type;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point|null}\r\n     */\r\n    this.getIntersectionPoint = function() {\r\n        return _intersectionPoint;\r\n    };\r\n};\r\n\r\nexport {LINE_INTERSECTION_TYPE, LineIntersection};\r\n","import  {Point} from './Point';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {Point} _startPoint\r\n * @param {Point} _endPoint\r\n */\r\nfunction Line(_startPoint, _endPoint) {   \r\n\r\n    if(typeof _startPoint === 'undefined' || _startPoint === null) {\r\n        throw \"Line missing _startPoint\";\r\n    }\r\n\r\n    if(typeof _endPoint === 'undefined' || _endPoint === null) {\r\n        throw \"Line missing _endPoint\";\r\n    }\r\n\r\n    this.__startPoint = _startPoint;\r\n    this.__endPoint = _endPoint;\r\n};\r\n\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getStartPoint = function() {\r\n    return this.__startPoint;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getEndPoint = function() {\r\n    return this.__endPoint;\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {Boolean}\r\n */\r\nLine.prototype.isEqual = function(_otherLine) {\r\n    if(this.getStartPoint().isEqual(_otherLine.getStartPoint()) && this.getEndPoint().isEqual(_otherLine.getEndPoint())) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getLength = function() {\r\n    return Math.sqrt(\r\n        Math.pow(this.__endPoint.getX() - this.__startPoint.getX(), 2) + Math.pow(this.__endPoint.getY() - this.__startPoint.getY(), 2)\r\n    );\r\n};\r\n\r\n/**\r\n * Calculate unit length direction vector\r\n * \r\n * @returns {Point}\r\n */\r\nLine.prototype.getDirection = function() {\r\n    const dx = this.__endPoint.getX() - this.__startPoint.getX();\r\n    const dy = this.__endPoint.getY() - this.__startPoint.getY();\r\n\r\n    const len = Math.sqrt(dx*dx + dy*dy);\r\n\r\n    return new Point(       \r\n        dx / len,\r\n        dy / len\r\n    );    \r\n};\r\n\r\n/**\r\n * Create a Line shorted at the start and end by the specified amounts\r\n * \r\n * @returns {Line}\r\n */\r\nLine.prototype.createShortenedLine = function(startReduceByPx, endReduceByPx) {\r\n    const dx = this.__endPoint.getX() - this.__startPoint.getX();\r\n    const dy = this.__endPoint.getY() - this.__startPoint.getY();    \r\n    const dir = this.getDirection();\r\n\r\n    return new Line(\r\n        new Point(\r\n            this.__startPoint.getX() + (startReduceByPx * dir.getX()), \r\n            this.__startPoint.getY() + (startReduceByPx * dir.getY())\r\n        ),\r\n        new Point(\r\n            (this.__startPoint.getX() + dx) - (endReduceByPx * dir.getX()), \r\n            (this.__startPoint.getY() + dy) - (endReduceByPx * dir.getY())\r\n        )\r\n    );\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_TYPE}\r\n */\r\nLine.prototype.computeIntersectionType = function(_otherLine) {\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return LINE_INTERSECTION_TYPE.COINCIDENT;\r\n        else\r\n            return LINE_INTERSECTION_TYPE.PARALLEL;\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return LINE_INTERSECTION_TYPE.LINE;\r\n    } else {\r\n        return LINE_INTERSECTION_TYPE.LINESEG;\r\n    }\r\n};\r\n    \r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_RESULT}\r\n */\r\nLine.prototype.computeIntersection = function(_otherLine) {\r\n\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT, null);\r\n        else\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL, null);\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n\r\n    const xIntersect = this.__startPoint.getX() + paramA*(this.__endPoint.getX()-this.__startPoint.getX());\r\n    const yIntersect = this.__startPoint.getY() + paramA*(this.__endPoint.getY()-this.__startPoint.getY());\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINE, new Point(xIntersect, yIntersect));\r\n    } else {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG, new Point(xIntersect, yIntersect));\r\n    }\r\n};\r\n\r\nexport { Line };\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Point objects\r\n * \r\n * @param {Point[]|Float64Array|undefined} _pointsInput\r\n */\r\nfunction PointSet(_pointsInput) {\r\n\r\n    const self = this;\r\n\r\n    /**\r\n     * @type {Point[]}\r\n     */\r\n    const points = [];\r\n\r\n    /**\r\n     * @param {Point} _newPoint\r\n     */\r\n    this.push = function(_newPoint) {\r\n        for(let i=0; i<points.length; i++) {\r\n            if(_newPoint.isEqual(points[i])) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        points.push(_newPoint);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @param {PointSet} _ps\r\n     */\r\n    this.pushPointSet = function(_ps) {\r\n        const possibleNewPoints = _ps.toArray();\r\n        for(let i=0; i<possibleNewPoints.length; i++) {\r\n            self.push(possibleNewPoints[i]);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {Point}\r\n     */\r\n    this.findPointClosestTo = function(_point) {\r\n        var resultPoint = null;\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                resultPoint = _pt;\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return resultPoint;        \r\n    };\r\n\r\n    this.findDistanceToPointClosestTo = function(_point) {\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return currentMinLength;        \r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {PointSet}\r\n     */\r\n    this.findPointsCloseTo = function(_point, _radius) {\r\n        const resultSet = new PointSet();\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() <= _radius) {\r\n                resultSet.push(_pt);\r\n            }\r\n        });\r\n        \r\n        return resultSet;        \r\n    };    \r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.toArray = function() {\r\n        return points;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n\r\n        const result = new Float64Array(points.length * 2);\r\n        for(let i=0; i<points.length; i++) {\r\n            result[0 + (i*2)] = points[i].getX();\r\n            result[1 + (i*2)] = points[i].getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n    \r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        points.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=2) {\r\n            points.push(\r\n                new Point(_float64Array[i], _float64Array[i+1])\r\n            );\r\n        }\r\n    };    \r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return points.length;\r\n    };\r\n\r\n    if(_pointsInput && Array.isArray(_pointsInput)) {\r\n        _pointsInput.forEach(self.push);\r\n    } else if(_pointsInput && Object.prototype.toString.call(_pointsInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_pointsInput);\r\n    } else { }    \r\n\r\n};\r\n\r\nexport { PointSet };\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Line objects\r\n * \r\n * @param {Line[]|Float64Array|undefined} _linesInput\r\n */\r\nfunction LineSet(_linesInput) {\r\n\r\n    const self = this;\r\n    \r\n    /**\r\n     * @type {Line[]}\r\n     */\r\n    const lines = [];    \r\n\r\n    /**\r\n     * @param {Line} _newLine\r\n     */\r\n    this.push = function(_newLine) {\r\n        var alreadyInLinesArray = false;\r\n        lines.forEach(function(_existingLine) {\r\n            if(_newLine.isEqual(_existingLine)) {\r\n                alreadyInLinesArray = true;\r\n            }\r\n        });        \r\n\r\n        if(alreadyInLinesArray) {\r\n            return false;\r\n        }\r\n\r\n        lines.push(_newLine);\r\n        return true;\r\n    };\r\n  \r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.toArray = function() {\r\n        return lines;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return lines.length;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n        const result = new Float64Array(lines.length * 4);\r\n        for(let i=0; i<lines.length; i++) {\r\n            result[0 + (i*4)] = lines[i].getStartPoint().getX();\r\n            result[1 + (i*4)] = lines[i].getStartPoint().getY();\r\n            result[2 + (i*4)] = lines[i].getEndPoint().getX();\r\n            result[3 + (i*4)] = lines[i].getEndPoint().getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        lines.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=4) {\r\n            lines.push(\r\n                new Line(\r\n                    new Point(_float64Array[i], _float64Array[i+1]),\r\n                    new Point(_float64Array[i+2], _float64Array[i+3])\r\n                )\r\n            );\r\n        }\r\n    };\r\n\r\n    if(_linesInput && Array.isArray(_linesInput)) {\r\n        _linesInput.forEach(self.push);\r\n    } else if(_linesInput && Object.prototype.toString.call(_linesInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_linesInput);\r\n    } else { }    \r\n};\r\n\r\nexport { LineSet };\r\n","import {Point} from './Point';\r\nimport {Line} from './Line';\r\nimport {PointSet} from './PointSet';\r\nimport {LineSet} from './LineSet';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {PointSet} _freePoints\r\n * @param {LineSet} _boundaryLines\r\n */\r\nfunction PointVisibilityMap(_freePoints, _boundaryLines) {\r\n\r\n    const self = this;\r\n\r\n    const boundaryLinesArr = _boundaryLines.toArray();\r\n    const freePointsArr = _freePoints.toArray();\r\n    const pointToVisibleSet = new Array(_freePoints.count()); // index represents entry in freePointsArr\r\n\r\n    /**\r\n     * @param {Line} _theLine\r\n     * @returns {Boolean}\r\n     */\r\n    const doesLineIntersectAnyBoundaryLines = function(_theLine) {\r\n\r\n        for(let b=0; b<boundaryLinesArr.length; b++) {\r\n            const intersectionType = boundaryLinesArr[b].computeIntersectionType(_theLine);\r\n            if(intersectionType === LINE_INTERSECTION_TYPE.LINESEG) {\r\n                return true;\r\n            }\r\n        };\r\n\r\n        return false;\r\n    };\r\n\r\n    const computePointsVisibility = function() {\r\n        for(let i=0; i<freePointsArr.length; i++) {\r\n            pointToVisibleSet[i] = [];   \r\n        }\r\n\r\n        for(let i=0; i<freePointsArr.length; i++) {            \r\n            for(let j=i+1; j<freePointsArr.length; j++) {\r\n\r\n                // line representing line-of-sight between the 2 points\r\n                const ijLine = new Line(freePointsArr[i], freePointsArr[j]);\r\n\r\n                if(!doesLineIntersectAnyBoundaryLines(ijLine)) {\r\n                    pointToVisibleSet[i].push(freePointsArr[j]);\r\n                    pointToVisibleSet[j].push(freePointsArr[i]);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const getVisiblePointsFrom = function(_currentPoint) {\r\n        for(let i=0; i<freePointsArr.length; i++) {\r\n\r\n            if(freePointsArr[i].isEqual(_currentPoint)) {\r\n                const visiblePoints = pointToVisibleSet[i];\r\n                return visiblePoints;\r\n            }            \r\n        }\r\n\r\n        return [];\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _currentRouteLength \r\n     * @param {Point[]} _pointsInRoute \r\n     * @param {Point} _currentPoint \r\n     * @param {Point} _endPoint \r\n     * @returns {Object|null}\r\n     */\r\n    const routeToEndpoint = function(_currentRouteLength, _pointsInRoute, _currentPoint, _endPoint) {\r\n\r\n        var visiblePoints = getVisiblePointsFrom(_currentPoint);       \r\n        var curMinCost = Number.MAX_SAFE_INTEGER;\r\n        var visiblePointWithMinCost = null;\r\n\r\n        visiblePoints.forEach(function(_vp) {\r\n            // ignore point if it's already in the route\r\n            for(let i=0; i<_pointsInRoute.length; i++) {\r\n                if(_vp.isEqual(_pointsInRoute[i])) {\r\n                    return; // point already in route, try another\r\n                }\r\n            }\r\n\r\n            // g(n) = length/cost of _startPoint to _vp + _currentRouteLength\r\n            const gn = (new Line(_currentPoint, _vp)).getLength() + _currentRouteLength;\r\n\r\n            // h(n) = length/cost of _vp to _endPoint\r\n            const hn = (new Line(_vp, _endPoint)).getLength();\r\n\r\n            // see if this is the new min\r\n            if((gn + hn) < curMinCost) {\r\n                curMinCost = gn + hn;\r\n                visiblePointWithMinCost = _vp;\r\n            }\r\n        });\r\n\r\n        if(curMinCost === Number.MAX_SAFE_INTEGER) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            \"cost\": curMinCost,\r\n            \"point\": visiblePointWithMinCost\r\n        };\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Array} _pointsInRoute \r\n     */\r\n    const optimizeRoute = function(_pointsInRoute) {\r\n\r\n        let ptrA = 0;\r\n\r\n        while(true) {\r\n\r\n            if(ptrA+2 >= _pointsInRoute.length) {\r\n                break;\r\n            }            \r\n\r\n            const ln = new Line(_pointsInRoute[ptrA], _pointsInRoute[ptrA + 2]);\r\n\r\n            if(!doesLineIntersectAnyBoundaryLines(ln)) {\r\n                _pointsInRoute.splice(ptrA + 1, 1);\r\n            } else {\r\n                ptrA++;\r\n            }\r\n\r\n        }\r\n\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _point\r\n     * @returns {Point|null}\r\n     */\r\n    this.findPointClosestTo = function(_point) {\r\n        var resultPoint = null;\r\n        var currentMaxLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        freePointsArr.forEach(function(_ptKey) {\r\n            const lineOfSight = new Line(_point, _ptKey);\r\n            if(lineOfSight.getLength() < currentMaxLength) {\r\n                resultPoint = _ptKey;\r\n                currentMaxLength = lineOfSight.getLength();\r\n            }\r\n        });\r\n        \r\n        return resultPoint;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _point\r\n     * @returns {Point|null}\r\n     */\r\n    this.findVisiblePointClosestTo = function(_point) {\r\n\r\n        var resultPoint = null;\r\n        var currentMaxLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        freePointsArr.forEach(function(_freePt) {\r\n\r\n            const lineOfSight = new Line(_point, _freePt);\r\n            const lineOfSightLength = lineOfSight.getLength();\r\n\r\n            if(lineOfSightLength < currentMaxLength && !doesLineIntersectAnyBoundaryLines(lineOfSight)) {\r\n                resultPoint = _freePt;\r\n                currentMaxLength = lineOfSightLength;\r\n            };\r\n\r\n        });\r\n        \r\n        return resultPoint;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _startPoint\r\n     * @param {Point} _endPoint\r\n     * \r\n     * @return {PointSet}\r\n     */\r\n    this.computeRoute = function(_startPoint, _endPoint) {\r\n\r\n        // if no valid startpoint or endpoint, we can't route\r\n        if(_startPoint === null || _endPoint === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        // find closest visible point \r\n        const firstRoutingPoint = self.findVisiblePointClosestTo(_startPoint);\r\n        if(firstRoutingPoint === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        var currentRouteLen = 0;\r\n        const pointsInRoute = [firstRoutingPoint];\r\n        var currentPoint = firstRoutingPoint;\r\n        while(true) {\r\n            const routeSegment = routeToEndpoint(currentRouteLen, pointsInRoute, currentPoint, _endPoint);\r\n            if(routeSegment === null) {\r\n\r\n                // Is there unobstructed line to endpoint? \r\n                // If not, failed to find route\r\n                const lastSegmentToEndpoint = new Line(pointsInRoute[pointsInRoute.length-1], _endPoint);\r\n                if(doesLineIntersectAnyBoundaryLines(lastSegmentToEndpoint)) {\r\n                    return new PointSet();\r\n                }\r\n\r\n                break;\r\n            }\r\n\r\n            currentRouteLen += (new Line(currentPoint, routeSegment.point)).getLength();\r\n            pointsInRoute.push(routeSegment.point);\r\n            currentPoint = routeSegment.point;\r\n\r\n            if((new Line(currentPoint, _endPoint).getLength()) < 1.0) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        optimizeRoute(pointsInRoute);\r\n\r\n        return new PointSet(pointsInRoute);\r\n\r\n    };\r\n\r\n    computePointsVisibility();\r\n};\r\n    \r\nexport { PointVisibilityMap };\r\n","import { Line } from \"./Line\";\r\n\r\nconst SvgPathBuilder = {\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _pt \r\n     * @returns {String}\r\n     */\r\n    pointToLineTo: function(_pt, _ptIndex) {\r\n        if(_ptIndex === 0) {\r\n            return \"M\" + _pt.getX() + \" \" + _pt.getY();\r\n        }\r\n\r\n        return \"L\" + _pt.getX() + \" \" + _pt.getY();\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _points \r\n     * @param {Number} _curvaturePx \r\n     * @returns {Point[]}\r\n     */\r\n    pointTripletToTesselatedCurvePoints(_points, _curvaturePx) {\r\n        if(_points.length !== 3) {\r\n            throw new Error(\"_points must be array of exactly 3 points\");\r\n        }\r\n\r\n        const controlPoint = _points[1];\r\n\r\n        const lineA = new Line(_points[0], _points[1]);\r\n        const lineB = new Line(_points[1], _points[2]);\r\n\r\n        const lineAShortened = lineA.createShortenedLine(0, _curvaturePx * 0.5);\r\n        const lineBShortened = lineB.createShortenedLine(_curvaturePx * 0.5, 0);\r\n\r\n        return [\r\n            lineAShortened.getStartPoint(),\r\n            lineAShortened.getEndPoint(),\r\n            lineBShortened.getStartPoint(),\r\n            lineBShortened.getEndPoint(),\r\n        ];\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _points\r\n     * @param {Number} _curvaturePx\r\n     * @returns {String}\r\n     */\r\n    pointsToPath: function(_points, _curvaturePx) {\r\n        _curvaturePx = _curvaturePx || 0.0;\r\n\r\n        const svgPathParts = [];\r\n\r\n        if(_curvaturePx > 0.0) {\r\n\r\n            let ptIdx = 0;\r\n\r\n            while(_points.length >= 3) {\r\n                const ptA = _points.shift();\r\n                const ptB = _points.shift();\r\n                const ptC = _points.shift();\r\n\r\n                const newPts = SvgPathBuilder.pointTripletToTesselatedCurvePoints(\r\n                    [\r\n                        ptA,\r\n                        ptB,\r\n                        ptC,\r\n                    ],\r\n                    _curvaturePx\r\n                );                \r\n\r\n                _points.unshift(newPts[3]);\r\n                _points.unshift(newPts[2]);\r\n\r\n                for(let j=0; j<newPts.length-2; j++) {\r\n                    svgPathParts.push(SvgPathBuilder.pointToLineTo(newPts[j], ptIdx++));\r\n                }\r\n            }\r\n\r\n            while(_points.length > 0) {\r\n                const pt = _points.shift();\r\n                svgPathParts.push(SvgPathBuilder.pointToLineTo(pt, ptIdx++));\r\n            }\r\n\r\n        } else {\r\n            for(let i=0; i<_points.length; i++) {\r\n                const p = _points[i];\r\n                svgPathParts.push(SvgPathBuilder.pointToLineTo(p, i));\r\n            }\r\n        }\r\n\r\n        return svgPathParts.join(\" \");        \r\n    },\r\n\r\n};\r\n\r\nexport { SvgPathBuilder };\r\n","import {Point} from '../Point';\r\nimport {PointSet} from '../PointSet';\r\nimport {LineSet} from '../LineSet';\r\nimport {PointVisibilityMap} from '../PointVisibilityMap';\r\nimport {SvgPathBuilder} from '../SvgPathBuilder';\r\nimport {Line} from '../Line';\r\n\r\n/**\r\n * \r\n * @param {Object} _connectorDescriptor\r\n * @param {PointSet} _routingPointsAroundAnchorSet\r\n * @param {PointVisibilityMap} _pointVisibilityMap \r\n * \r\n * @returns {Object}\r\n */\r\nconst computeConnectorPath = function(_connectorDescriptor, _routingPointsAroundAnchorSet, _pointVisibilityMap) {\r\n    const anchorStartCentroid = Point.fromArray(_connectorDescriptor.anchor_start_centroid_arr);\r\n    const anchorEndCentroid = Point.fromArray(_connectorDescriptor.anchor_end_centroid_arr);\r\n    const markerStartSize = _connectorDescriptor.marker_start_size;\r\n    const markerEndSize = _connectorDescriptor.marker_end_size;\r\n    const curvaturePx = _connectorDescriptor.curvature_px;\r\n\r\n    const anchorPointMinDist = _routingPointsAroundAnchorSet.findDistanceToPointClosestTo(anchorStartCentroid);\r\n\r\n    // Find adjustedStart, adjustedEnd .. anchor points closest to the desired start point and end point\r\n    // Note that when desired start or end are closed off within a boundary, values will be null\r\n    const adjustedStart = _routingPointsAroundAnchorSet\r\n        .findPointsCloseTo(anchorStartCentroid, anchorPointMinDist) // get all points within radius\r\n        .findPointClosestTo(anchorEndCentroid); // for all points within radius, get the once closest to the endpoint\r\n\r\n    const adjustedEnd = _routingPointsAroundAnchorSet\r\n        .findPointsCloseTo(anchorEndCentroid, anchorPointMinDist)\r\n        .findPointClosestTo(anchorStartCentroid);\r\n\r\n    const routingPoints = _pointVisibilityMap.computeRoute(adjustedStart, adjustedEnd);\r\n    const routingPointsArray = routingPoints.toArray();\r\n    let pathStartPoint = anchorStartCentroid;\r\n    let pathEndPoint = anchorEndCentroid;\r\n\r\n    // Adjust path start point to account for marker\r\n    if(markerStartSize > 0.0 && routingPointsArray.length >= 1) {\r\n        let firstLeg = (new Line(routingPointsArray[0], anchorStartCentroid)).createShortenedLine(0, markerStartSize);\r\n        pathStartPoint = firstLeg.getEndPoint();\r\n    }\r\n\r\n    // Adjust path end point to account for marker\r\n    if(markerEndSize > 0.0 && routingPointsArray.length >= 1) {\r\n        let lastLeg = (new Line(routingPointsArray[routingPointsArray.length-1], anchorEndCentroid)).createShortenedLine(0, markerEndSize);\r\n        pathEndPoint = lastLeg.getEndPoint();\r\n    }\r\n\r\n    // Put together all points for path\r\n    const allPointsForPath = [pathStartPoint, ...routingPointsArray, pathEndPoint];\r\n\r\n    return {\r\n        \"svgPath\": SvgPathBuilder.pointsToPath(allPointsForPath, curvaturePx),\r\n        \"pointsInPath\": allPointsForPath,\r\n    }\r\n};\r\n\r\nconst convertArrayBufferToFloat64Array = function(_ab) {\r\n    return new Float64Array(_ab);\r\n};\r\n\r\nonmessage = function(_msg) {\r\n\r\n    const metrics = {};\r\n    metrics.overallTime = null;\r\n    const overallTimeT1 = new Date();\r\n\r\n    const gridSize = _msg.data.gridSize;\r\n\r\n    const connectorDescriptors = _msg.data.connectorDescriptors;\r\n\r\n    const msgDecodeTimeT1 = new Date();\r\n    const routingPointsSet = new PointSet(convertArrayBufferToFloat64Array(_msg.data.routingPoints));\r\n    const boundaryLinesSet = new LineSet(convertArrayBufferToFloat64Array(_msg.data.boundaryLines));    \r\n    const routingPointsAroundAnchorSet = new PointSet(convertArrayBufferToFloat64Array(_msg.data.routingPointsAroundAnchor));    \r\n    metrics.msgDecodeTime = (new Date()) - msgDecodeTimeT1;\r\n    \r\n    const pointVisibilityMapCreationTimeT1 = new Date();\r\n    const currentPointVisiblityMap = new PointVisibilityMap(\r\n        routingPointsSet,\r\n        boundaryLinesSet\r\n    );\r\n    metrics.pointVisibilityMapCreationTime = (new Date()) - pointVisibilityMapCreationTimeT1;\r\n\r\n    connectorDescriptors.forEach(function(_cd) {\r\n        const pathData = computeConnectorPath(_cd, routingPointsAroundAnchorSet, currentPointVisiblityMap);\r\n\r\n        const pointsInPathPointSet = new PointSet(pathData.pointsInPath);\r\n\r\n        _cd.svgPath = pathData.svgPath;\r\n        _cd.pointsInPath = pointsInPathPointSet.toFloat64Array().buffer;\r\n    });\r\n    \r\n    metrics.numRoutingPoints = routingPointsSet.count();\r\n    metrics.numBoundaryLines = boundaryLinesSet.count();\r\n    metrics.overallTime = (new Date()) - overallTimeT1;\r\n\r\n    postMessage(\r\n        {\r\n            \"connectorDescriptors\": connectorDescriptors,\r\n            \"metrics\": metrics\r\n        }\r\n    );\r\n\r\n};\r\n"],"names":["Point","_x","_y","__x","__y","prototype","getX","getY","isEqual","_otherPoint","getCartesianPoint","_canvasWidth","_canvasHeight","toString","toArray","fromArray","_arr","LINE_INTERSECTION_TYPE","Object","freeze","PARALLEL","COINCIDENT","LINE","LINESEG","LineIntersection","_type","_intersectionPoint","getType","getIntersectionPoint","Line","_startPoint","_endPoint","__startPoint","__endPoint","getStartPoint","getEndPoint","_otherLine","getLength","Math","sqrt","pow","getDirection","dx","dy","len","createShortenedLine","startReduceByPx","endReduceByPx","dir","computeIntersectionType","thisLineStartPointX","thisLineStartPointY","thisLineEndPointX","thisLineEndPointY","otherLineStartPointX","otherLineStartPointY","otherLineEndPointX","otherLineEndPointY","paramDenom","paramANumer","paramBNumer","paramA","paramB","computeIntersection","xIntersect","yIntersect","PointSet","_pointsInput","self","points","push","_newPoint","i","length","pushPointSet","_ps","possibleNewPoints","findPointClosestTo","_point","resultPoint","currentMinLength","Number","MAX_SAFE_INTEGER","forEach","_pt","lineToPt","findDistanceToPointClosestTo","findPointsCloseTo","_radius","resultSet","toFloat64Array","result","Float64Array","fromFloat64Array","_float64Array","count","Array","isArray","call","LineSet","_linesInput","lines","_newLine","alreadyInLinesArray","_existingLine","PointVisibilityMap","_freePoints","_boundaryLines","boundaryLinesArr","freePointsArr","pointToVisibleSet","doesLineIntersectAnyBoundaryLines","_theLine","intersectionType","b","computePointsVisibility","ijLine","j","getVisiblePointsFrom","_currentPoint","visiblePoints","routeToEndpoint","_currentRouteLength","_pointsInRoute","curMinCost","visiblePointWithMinCost","_vp","gn","hn","optimizeRoute","ptrA","ln","splice","currentMaxLength","_ptKey","lineOfSight","findVisiblePointClosestTo","_freePt","lineOfSightLength","computeRoute","firstRoutingPoint","routeSegment","currentRouteLen","pointsInRoute","currentPoint","lastSegmentToEndpoint","point","SvgPathBuilder","pointToLineTo","_ptIndex","pointTripletToTesselatedCurvePoints","_points","_curvaturePx","Error","controlPoint","lineA","lineB","lineAShortened","lineBShortened","pointsToPath","svgPathParts","ptIdx","ptA","shift","ptB","ptC","newPts","unshift","pt","p","join","computeConnectorPath","_connectorDescriptor","_routingPointsAroundAnchorSet","_pointVisibilityMap","anchorStartCentroid","anchor_start_centroid_arr","anchorEndCentroid","anchor_end_centroid_arr","markerStartSize","marker_start_size","markerEndSize","marker_end_size","curvaturePx","curvature_px","anchorPointMinDist","adjustedStart","adjustedEnd","routingPoints","routingPointsArray","pathStartPoint","pathEndPoint","firstLeg","lastLeg","allPointsForPath","convertArrayBufferToFloat64Array","_ab","onmessage","_msg","metrics","overallTime","overallTimeT1","Date","gridSize","data","connectorDescriptors","msgDecodeTimeT1","routingPointsSet","boundaryLinesSet","boundaryLines","routingPointsAroundAnchorSet","routingPointsAroundAnchor","msgDecodeTime","pointVisibilityMapCreationTimeT1","currentPointVisiblityMap","pointVisibilityMapCreationTime","_cd","pathData","pointsInPathPointSet","pointsInPath","svgPath","buffer","numRoutingPoints","numBoundaryLines","postMessage"],"mappings":"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"}