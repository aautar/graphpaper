!function(t){"use strict";function e(t,e){this.getWidth=function(){return t},this.getHeight=function(){return e}}function n(t,e,n,i){this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return i},this.checkIntersect=function(a){return i<a.getTop()?!1:e>a.getBottom()?!1:n<a.getLeft()?!1:t>a.getRight()?!1:!0},this.checkIsWithin=function(a){return i>a.getBottom()||e<a.getTop()||n>a.getRight()||t<a.getLeft()?!1:!0}}function i(t,e){this.getX=function(){return t},this.getY=function(){return e}}function a(t,e){var a=this,r=12;this.getGridSize=function(){return r};var o=[];this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;var c={lastTouchX:null,lastTouchY:null,lastTouchTime:null},u=function(t){var e=Math.round(t/a.getGridSize())*a.getGridSize();return Math.max(0,e-1)};this.snapObjectToGrid=function(t){var e=u(t.getX()),n=u(t.getY());t.setX(e),t.setY(n)},this.getObjectsAroundPoint=function(t,e){var i=[],a=new n(t,e,t+1,e+1);return o.forEach(function(t){!t.getIsDeleted()&&a.checkIntersect(t.getBoundingRectange())&&i.push(t)}),i},this.calcBoundingBox=function(){var t=null,e=null,i=null,a=null;return o.forEach(function(n){var r=parseInt(n.getX()),o=parseInt(n.getY()),c=r+parseInt(n.getWidth()),u=o+parseInt(n.getHeight());(null===e||e>r)&&(e=r),(null===t||t>o)&&(t=o),(null===i||u>i)&&(i=u),(null===a||c>a)&&(a=c)}),new n(e,t,a,i)},this.getAllObjects=function(){return o},this.publishSiblingObjectChange=function(t,e){o.forEach(function(n){n.handleSiblingObjectChange(t,e)})},this.getObjectById=function(t){var e=null;return o.forEach(function(n){null===e&&n.id===t&&(e=n)}),e},this.addObject=function(t){t.setCanvas(a),o.push(t)};var g=function(t,n){var r=a.getObjectsAroundPoint(t,n);0===r.length&&e("dbl-click",new i(t,n))};this.initInteractionHandlers=function(n,i){t.addEventListener("dblclick",function(t){g(t.pageX,t.pageY)}),t.addEventListener("click",function(n){n.target===t?e("click",{canvasObjectClicked:!1}):e("click",{canvasObjectClicked:!0})}),t.addEventListener("touchend",function(t){if(t.originalEvent.changedTouches.length<=0)return!1;var e=!1,a=t.originalEvent.changedTouches[0].pageX,r=t.originalEvent.changedTouches[0].pageY,o=(new Date).getTime();if(null!==c.lastTouchTime){var u=c.lastTouchTime,s=o-u,l=c.lastTouchX,h=c.lastTouchY,d=Math.sqrt(Math.pow(a-l,2)+Math.pow(r-h,2));s>n||d>i||(e=!0,g(a,r),c.lastTouchTime=null,c.lastTouchX=null,c.lastTouchY=null)}e||(c.lastTouchTime=o,c.lastTouchX=a,c.lastTouchY=r)})};var s=function(t,e){var n=a.getObjectById(a.objectIdBeingDragged);n.touchInternalContactPt&&(t-=n.touchInternalContactPt.getX(),e-=n.touchInternalContactPt.getY());var i=u(t+n.getTranslateHandleOffsetX()),r=u(e+n.getTranslateHandleOffsetY());a.objectDragX=i,a.objectDragY=r,n.translate(i,r)},l=function(t,n){var i=a.getObjectById(a.objectIdBeingDragged),r=u(t+i.getTranslateHandleOffsetX()),o=u(n+i.getTranslateHandleOffsetY()),c=a.objectDragStartX,g=a.objectDragStartY;c==r&&g==o||(i.translate(r,o),e("object-translated",i))};this.initTransformationHandlers=function(){t.addEventListener("touchmove",function(t){null!==a.objectIdBeingDragged&&(s(t.touches[0].pageX,t.touches[0].pageY),t.preventDefault(),t.stopPropagation())}),t.addEventListener("mousemove",function(t){if(null!==a.objectIdBeingDragged)return s(t.pageX,t.pageY),!1;if(null!==a.objectIdBeingResized){var n=u(t.pageX),i=u(t.pageY),r=a.getObjectById(a.objectIdBeingResized),o=r.getY(),c=r.getX(),g=n-c+1,l=i-o+1;return r.resize(g,l),e("object-resized",r),!1}}),t.addEventListener("touchend",function(){if(null!==a.objectIdBeingDragged){var t=a.getObjectById(a.objectIdBeingDragged);t.touchInternalContactPt=null,a.objectIdBeingDragged=null,a.objectIdBeingResized=null}}),t.addEventListener("mouseup",function(t){1===t.which&&(null!==a.objectIdBeingDragged&&l(t.pageX,t.pageY),null!==a.objectIdBeingResized,a.objectIdBeingDragged=null,a.objectIdBeingResized=null)})}}function r(t,e,i,a,r,o,c){var u=this;this.id=t,this.x=e,this.y=i,this.width=a,this.height=r,this.domElement=o,this.isDeleted=!1,this.touchInternalContactPt=null,this.getTranslateHandleOffsetX=function(){return-(c.offsetLeft+.5*c.offsetWidth)},this.getTranslateHandleOffsetY=function(){return-(c.offsetTop+.5*c.offsetHeight)};var g=null;this.setCanvas=function(t){g=t},this.getId=function(){return u.id},this.getX=function(){return u.x},this.setX=function(t){u.x=t},this.getY=function(){return u.y},this.setY=function(t){u.y=t},this.translate=function(t,e){u.x=t,u.y=e,u.domElement.style.left=parseInt(u.x)+"px",u.domElement.style.top=parseInt(u.y)+"px"},this.getWidth=function(){return u.width},this.getHeight=function(){return u.height},this.resize=function(t,e){u.width=t,u.height=e,u.domElement.style.width=parseInt(u.width)+"px",u.domElement.style.height=parseInt(u.height)+"px"},this.getIsDeleted=function(){return u.isDeleted},this.getDomElement=function(){return u.domElement},this.getTouchInternalContactPt=function(){return u.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var t=parseInt(u.x),e=parseInt(u.y),i=t+parseInt(u.width),a=e+parseInt(u.height);return new n(t,e,i,a)},c.addEventListener("touchstart",function(t){if(null!==g){g.touchInternalContactPt={x:t.touches[0].pageX-u.getX(),y:t.touches[0].pageY-u.getY()};var e=t.pageX,n=t.pageY;g.objectIdBeingDragged=u.getId(),g.objectDragX=e,g.objectDragY=n,g.objectDragStartX=e,g.objectDragStartY=n}}),c.addEventListener("mousedown",function(t){if(null!==g){var e=t.pageX,n=t.pageY;g.objectIdBeingDragged=u.getId(),g.objectDragX=e,g.objectDragY=n,g.objectDragStartX=e,g.objectDragStartY=n}})}t.Dimensions=e,t.Rectangle=n,t.Point=i,t.Object=r,t.Canvas=a}(this.GraphPaper=this.GraphPaper||{});