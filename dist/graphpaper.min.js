var GraphPaper=function(t){"use strict";function o(P,S){this.__x=P,this.__y=S}function g(P,S){this.getType=function(){return P},this.getIntersectionPoint=function(){return S}}function s(P,S){if("undefined"==typeof P||null===P)throw"Line missing _startPoint";if("undefined"==typeof S||null===S)throw"Line missing _endPoint";this.__startPoint=P,this.__endPoint=S}function a(P,S,L,O){this.getLeft=function(){return P},this.getTop=function(){return S},this.getRight=function(){return L},this.getBottom=function(){return O},this.getPoints=function(){return[new o(P,S),new o(L,S),new o(L,O),new o(P,O)]},this.getLines=function(){return[new s(new o(P,S),new o(L,S)),new s(new o(L,S),new o(L,O)),new s(new o(L,O),new o(P,O)),new s(new o(P,O),new o(P,S))]},this.getPointsScaledToGrid=function(X){const Y=new o(P+0.5*(L-P),S+0.5*(O-S)),v=(L-Y.getX()+X)/(L-Y.getX()),R=(O-Y.getY()+X)/(O-Y.getY()),w=[new o((P-Y.getX())*v+Y.getX(),(S-Y.getY())*R+Y.getY()),new o((L-Y.getX())*v+Y.getX(),(S-Y.getY())*R+Y.getY()),new o((L-Y.getX())*v+Y.getX(),(O-Y.getY())*R+Y.getY()),new o((P-Y.getX())*v+Y.getX(),(O-Y.getY())*R+Y.getY())];return w},this.checkIntersect=function(X){return!(O<X.getTop())&&!(S>X.getBottom())&&!(L<X.getLeft())&&!(P>X.getRight())},this.checkIsPointWithin=function(X){return X.getX()>=P&&X.getX()<=L&&X.getY()>=S&&X.getY()<=O},this.checkIsWithin=function(X){return O<=X.getBottom()&&S>=X.getTop()&&L<=X.getRight()&&P>=X.getLeft()}}function h(P){const S=this,L=[];this.push=function(X){for(let Y=0;Y<L.length;Y++)if(X.isEqual(L[Y]))return!1;return L.push(X),!0},this.pushPointSet=function(X){const Y=X.toArray();for(let v=0;v<Y.length;v++)S.push(Y[v])},this.findPointClosestTo=function(X){var Y=null,v=Number.MAX_SAFE_INTEGER;return L.forEach(function(R){const w=new s(X,R);w.getLength()<v&&(Y=R,v=w.getLength())}),Y},this.findDistanceToPointClosestTo=function(X){var Y=Number.MAX_SAFE_INTEGER;return L.forEach(function(v){const R=new s(X,v);R.getLength()<Y&&(Y=R.getLength())}),Y},this.findPointsCloseTo=function(X,Y){const v=new h;return L.forEach(function(R){const w=new s(X,R);w.getLength()<=Y&&v.push(R)}),v},this.toArray=function(){return L},this.toFloat64Array=function(){const X=new Float64Array(2*L.length);for(let Y=0;Y<L.length;Y++)X[0+2*Y]=L[Y].getX(),X[1+2*Y]=L[Y].getY();return X};this.count=function(){return L.length},P&&Array.isArray(P)?P.forEach(S.push):P&&"[object Float64Array]"===Object.prototype.toString.call(P)&&function(X){L.length=0;for(let Y=0;Y<X.length;Y+=2)L.push(new o(X[Y],X[Y+1]))}(P)}function l(P){const S=this,L=[];this.push=function(X){var Y=!1;return(L.forEach(function(v){X.isEqual(v)&&(Y=!0)}),!Y)&&(L.push(X),!0)},this.toArray=function(){return L},this.count=function(){return L.length},this.toFloat64Array=function(){const X=new Float64Array(4*L.length);for(let Y=0;Y<L.length;Y++)X[0+4*Y]=L[Y].getStartPoint().getX(),X[1+4*Y]=L[Y].getStartPoint().getY(),X[2+4*Y]=L[Y].getEndPoint().getX(),X[3+4*Y]=L[Y].getEndPoint().getY();return X};P&&Array.isArray(P)?P.forEach(S.push):P&&"[object Float64Array]"===Object.prototype.toString.call(P)&&function(X){L.length=0;for(let Y=0;Y<X.length;Y+=4)L.push(new s(new o(X[Y],X[Y+1]),new o(X[Y+2],X[Y+3])))}(P)}function u(P,S,L){const O=this;this.getId=function(){return P},this.getX=function(){return O.getCentroid().getX()},this.getY=function(){return O.getCentroid().getY()},this.getWidth=function(){const X=S.getBoundingClientRect();return X.right-X.left},this.getHeight=function(){const X=S.getBoundingClientRect();return X.bottom-X.top},this.getCentroid=function(){const X=S.getBoundingClientRect(),Y=L.getPageOffset();return new o(X.left+Y.getX()+0.5*O.getWidth(),X.top+Y.getY()+0.5*O.getHeight())},this.getRoutingPoints=function(X){const Y=O.getCentroid(),v=0.5*O.getWidth(),R=0.5*O.getHeight();return[new o(Y.getX()+v+X,Y.getY()),new o(Y.getX()-v-X,Y.getY()),new o(Y.getX(),Y.getY()+R+X),new o(Y.getX(),Y.getY()-R-X)]},this.getBoundingRectange=function(){const X=O.getCentroid(),Y=0.5*O.getWidth(),v=0.5*O.getHeight();return new a(X.getX()-Y,X.getY()-v,X.getX()+Y,X.getY()+v)}}function f(P,S,L,O,X){const Y=this;"undefined"==typeof O&&(O="#000"),"undefined"==typeof X&&(X="2px");const v=window.document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d","M0 0 L0 0"),v.style.stroke=O,v.style.strokeWidth=X;this.appendPathToContainerDomElement=function(){L.appendChild(v)},this.refresh=function(w){v.setAttribute("d",w)},this.getId=function(){const w=[P.getId(),S.getId()].sort();return w.join(":")},this.getAnchorStart=function(){return P},this.getAnchorEnd=function(){return S},this.removePathElement=function(){v.remove()},this.getDescriptor=function(){return{id:Y.getId(),anchor_start_centroid:P.getCentroid().toString(),anchor_end_centroid:S.getCentroid().toString()}}}function E(P,S,L){this.getSize=function(){return P},this.getStyle=function(){return L},this.getSvgImageTile=function(){return L===m.LINE?"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+P+"\" height=\""+P+"\"><rect width=\""+P+"\" height=\"1\" x=\"0\" y=\""+(P-1)+"\" style=\"fill:"+S+"\" /><rect width=\"1\" height=\""+P+"\" x=\""+(P-1)+"\" y=\"0\" style=\"fill:"+S+"\" /></svg>":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+P+"\" height=\""+P+"\"><rect width=\"1\" height=\"1\" x=\""+(P-1)+"\" y=\""+(P-1)+"\" style=\"fill:"+S+"\" /></svg>"}}function I(P){const S=this,L=[];this.getId=function(){return P},this.getObjectIndex=function(O){return S.getObjectIndexById(O.getId())},this.getObjectIndexById=function(O){for(let X=0;X<L.length;X++)if(L[X].getId()===O)return X;return null},this.addObject=function(O){return null===S.getObjectIndex(O)&&(L.push(O),!0)},this.getObjects=function(){return L},this.getObjectIds=function(){const O=[];return L.forEach(function(X){O.push(X.getId())}),O},this.removeObjectById=function(O){const X=S.getObjectIndexById(O);return null!==X&&(L.splice(X,1),!0)},this.removeAllObjects=function(){L.length=0}}o.prototype.getX=function(){return this.__x},o.prototype.getY=function(){return this.__y},o.prototype.isEqual=function(P){return this.__x===P.getX()&&this.__y===P.getY()},o.prototype.getCartesianPoint=function(P,S){return new o(this.__x-0.5*P,-this.__y+0.5*S)},o.prototype.toString=function(){return this.__x+" "+this.__y};const _=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"});s.prototype.getStartPoint=function(){return this.__startPoint},s.prototype.getEndPoint=function(){return this.__endPoint},s.prototype.isEqual=function(P){return this.getStartPoint().isEqual(P.getStartPoint())&&this.getEndPoint().isEqual(P.getEndPoint())},s.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},s.prototype.computeIntersectionType=function(P){const S=this.__startPoint.getX(),L=this.__startPoint.getY(),O=this.__endPoint.getX(),X=this.__endPoint.getY(),Y=P.getStartPoint().getX(),v=P.getStartPoint().getY(),R=P.getEndPoint().getX(),w=P.getEndPoint().getY(),B=(w-v)*(O-S)-(R-Y)*(X-L),D=(R-Y)*(L-v)-(w-v)*(S-Y),N=(O-S)*(L-v)-(X-L)*(S-Y);if(0==B)return 0==B&&0==D&&0==N?_.COINCIDENT:_.PARALLEL;const G=D/B,F=N/B;return 1<G||0>G||1<F||0>F?_.LINE:_.LINESEG},s.prototype.computeIntersection=function(P){const S=this.__startPoint.getX(),L=this.__startPoint.getY(),O=this.__endPoint.getX(),X=this.__endPoint.getY(),Y=P.getStartPoint().getX(),v=P.getStartPoint().getY(),R=P.getEndPoint().getX(),w=P.getEndPoint().getY(),B=(w-v)*(O-S)-(R-Y)*(X-L),D=(R-Y)*(L-v)-(w-v)*(S-Y),N=(O-S)*(L-v)-(X-L)*(S-Y);if(0==B)return 0==B&&0==D&&0==N?new g(_.COINCIDENT,null):new g(_.PARALLEL,null);const G=D/B,F=N/B,z=this.__startPoint.getX()+G*(this.__endPoint.getX()-this.__startPoint.getX()),W=this.__startPoint.getY()+G*(this.__endPoint.getY()-this.__startPoint.getY());return 1<G||0>G||1<F||0>F?new g(_.LINE,new o(z,W)):new g(_.LINESEG,new o(z,W))};const m={LINE:"line",DOT:"dot"};return t.Dimensions=function(P,S){this.getWidth=function(){return P},this.getHeight=function(){return S}},t.Rectangle=a,t.Point=o,t.LINE_INTERSECTION_TYPE=_,t.LineIntersection=g,t.Line=s,t.CanvasObject=function(P,S,L,O,X,Y,v,R,w){const B=this,N=[];var G=1e3,F=null;const z={TRANSLATE_START:"obj-translate-start",TRANSLATE:"obj-translate",RESIZE_START:"obj-resize-start",RESIZE:"obj-resize"},W=new Map;this.x=parseInt(S),this.y=parseInt(L),this.width=parseInt(O),this.height=parseInt(X),this.isDeleted=!1,this.addNonInteractableConnectorAnchor=function(V){const Z=new u(P+`-${G}`,V,Y);return N.push(Z),G++,Z},this.addInteractableConnectorAnchor=function(V){const Z=new u(P+`-${G}`,V,Y);return V.addEventListener("click",function(){Y.addConnectionAnchorToSelectionStack(Z)}),N.push(Z),G++,Z},this.getConnectorAnchorRoutingPoints=function(V){const Z=[];return N.forEach(function(K){const U=K.getRoutingPoints(V);U.forEach(function(Q){Z.push(Q)})}),Z},this.getConnectorAnchors=function(){return N},this.hasConnectorAnchor=function(V){const Z=B.getConnectorAnchors();for(let K=0;K<Z.length;K++)if(Z[K]===V)return!0;return!1},this.getTranslateHandleOffset=function(){return F?new o(-(F.offsetLeft+0.5*F.offsetWidth),-(F.offsetTop+0.5*F.offsetHeight)):null},this.getId=function(){return P},this.getX=function(){return B.x},this.setX=function(V){B.x=V},this.getY=function(){return B.y},this.setY=function(V){B.y=V},this.translate=function(V,Z){B.x=V,B.y=Z,v.style.left=parseInt(B.x)+"px",v.style.top=parseInt(B.y)+"px";const K=W.get(z.TRANSLATE)||[];K.forEach(function(U){U({obj:B,x:V,y:Z})})},this.getWidth=function(){return B.width},this.getHeight=function(){return B.height},this.resize=function(V,Z){B.width=V,B.height=Z,v.style.width=parseInt(B.width)+"px",v.style.height=parseInt(B.height)+"px";const K=W.get(z.RESIZE)||[];K.forEach(function(U){U({obj:B,width:V,height:Z})})},this.getIsDeleted=function(){return B.isDeleted},this.getDomElement=function(){return v},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){const V=parseInt(B.x),Z=parseInt(B.y),K=V+parseInt(B.width),U=Z+parseInt(B.height);return new a(V,Z,K,U)},this.getBoundingPoints=function(){const V=new o(B.getX(),B.getY()),Z=new o(B.getX()+B.getWidth(),B.getY()),K=new o(B.getX(),B.getY()+B.getWidth()),U=new o(B.getX()+B.getWidth(),B.getY()+B.getWidth());return[V,Z,K,U]},this.on=function(V,Z){const K=W.get(V)||[];K.push(Z),W.set(V,K)},this.off=function(V,Z){const K=eventHandlers.get(V)||[];for(let U=0;U<K.length;U++)if(K[U]===Z){K.splice(U,1);break}eventHandlers.set(V,K)},this.suspendTranslateInteractions=function(){M()},this.resumeTranslateInteractions=function(){q()};const k=function(V){F=V.target;const Z=W.get(z.TRANSLATE_START)||[];Z.forEach(function(K){K({obj:B,x:V.touches[0].pageX,y:V.touches[0].pageY,isTouch:!0})})},H=function(V){F=V.target;const Z=W.get(z.TRANSLATE_START)||[];Z.forEach(function(K){K({obj:B,x:V.pageX,y:V.pageY,isTouch:!1})})},M=function(){R.forEach(V=>{V.removeEventListener("touchstart",k),V.removeEventListener("mousedown",H)})},q=function(){R.forEach(V=>{V.addEventListener("touchstart",k),V.addEventListener("mousedown",H)})};q(),function(){w.forEach(V=>{V.addEventListener("mousedown",function(Z){if(Z.which===1){const K=W.get(z.RESIZE_START)||[];K.forEach(function(U){U({obj:B,x:Z.pageX,y:Z.pageY,isTouch:!1})})}})})}()},t.Canvas=function(P,S,L){const O=this,X={DBLCLICK:"dblclick",CLICK:"click",OBJECT_ADDED:"object-added",OBJECT_REMOVED:"object-removed",OBJECT_RESIZED:"object-resized",OBJECT_TRANSLATED:"object-translated"},Y=S.document.createElementNS("http://www.w3.org/2000/svg","svg");Y.style.width="100%",Y.style.height="100%";const v=P.appendChild(Y);var R=null,w="transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out",B=0,D=0,N=0,G=0,F=1,z=1,W=[];const H=[],M=[];var q=null,J=null,V=0,Z=0,K=0,U=0,Q={lastTouchX:null,lastTouchY:null,lastTouchTime:null};const $=[],ee=new Map,te=new Map;this.getCurrentPointVisibilityMap=function(){return null},this.setGrid=function(pe){R=pe,P.style.background="url('data:image/svg+xml;base64,"+S.btoa(R.getSvgImageTile())+"') repeat"},this.getGrid=function(){return R},this.getGridSize=function(){return R.getSize()};const ne=function(pe){te.clear();const Ee=[],Te=[];return pe.forEach(be=>{const Ae=be.getConnectorAnchors();Ae.forEach(Ie=>{const Ce=Ie.getRoutingPoints(O.getGridSize());Ce.forEach(me=>{Ee.push({routingPoint:me,parentAnchor:Ie})}),te.set(Ie.getId(),Ce.length)})}),Ee.forEach(be=>{let Ae=!1;for(let Ie=0;Ie<pe.length;Ie++){const Ce=pe[Ie],me=Ce.getBoundingRectange();if(me.checkIsPointWithin(be.routingPoint)){Ae=!0;const Pe=te.get(be.parentAnchor.getId())||0;te.set(be.parentAnchor.getId(),Pe-1)}}Ae||Te.push(be.routingPoint)}),Te},oe=function(){const pe=new h;return H.forEach(function(Ee){const Te=Ee.getBoundingRectange().getPointsScaledToGrid(O.getGridSize());Te.forEach(be=>{pe.push(be)})}),pe},ge=function(){const pe=new h,Ee=ne(H);return Ee.forEach(Te=>{pe.push(Te)}),pe},ie=function(){const pe=[];return H.forEach(function(Ee){const Te=Ee.getBoundingRectange().getLines();Te.forEach(Ae=>{pe.push(Ae)});const be=Ee.getConnectorAnchors();be.forEach(function(Ae){const Ie=Ae.getBoundingRectange().getLines();Ie.forEach(Ce=>{pe.push(Ce)})})}),new l(pe)},re=function(){const pe=[];M.forEach(function(me){pe.push(me.getDescriptor())});const Ee=ge(),Te=oe(),be=new h;be.pushPointSet(Ee),be.pushPointSet(Te);const Ae=Ee.toFloat64Array(),Ie=be.toFloat64Array(),Ce=ie().toFloat64Array();L.postMessage({gridSize:O.getGridSize(),connectorDescriptors:pe,routingPoints:Ie.buffer,boundaryLines:Ce.buffer,routingPointsAroundAnchor:Ae.buffer},[Ie.buffer,Ce.buffer,Ae.buffer])};L.onmessage=function(pe){const Ee=pe.data.connectorDescriptors,Te=function(be){for(let Ae=0;Ae<Ee.length;Ae++)if(Ee[Ae].id===be)return Ee[Ae];return null};M.forEach(function(be){const Ae=Te(be.getId());Ae&&be.refresh(Ae.svgPath)})};var se=function(pe,Ee,Te){return new f(pe,Ee,Te)};this.setConnectorFactory=function(pe){se=pe},this.getTransitionCss=function(){return w},this.setTransitionCss=function(pe){w=pe,P.style.transition=w},this.getTransformOriginX=function(){return B},this.getTransformOriginY=function(){return D},this.getScaleFactor=function(){return F},this.getTranslateX=function(){return N},this.getTranslateY=function(){return G},this.setTransformOrigin=function(pe,Ee){B=pe,D=Ee,P.style.transformOrigin=`${B}px ${D}px`},this.scale=function(pe,Ee){if(Ee=Ee||!1,Ee){const Te=O.getGridSize()*pe,be=Math.round(Te);pe=be/O.getGridSize()}return F=pe,z=1/F,W.push(`scale3d(${F},${F},${F})`),O},this.translate=function(pe,Ee){return N=pe,G=Ee,W.push(`translate3d(${N}px,${G}px,0)`),O},this.applyTransform=function(){P.style.transform=W.join(" "),W.length=0},this.resetTransform=function(){F=1,z=1,N=0,G=0,P.style.transform="none"},this.getPageOffset=function(){return new o(window.pageXOffset,window.pageYOffset)},this.snapToGrid=function(pe){var Ee=Math.round(pe/O.getGridSize())*O.getGridSize();return Math.max(0,Ee-1)},this.getOffsetLeft=function(){return P.offsetLeft},this.getOffsetTop=function(){return P.offsetTop},this.getWidth=function(){return P.offsetWidth},this.getHeight=function(){return P.offsetHeight},this.getObjectsAroundPoint=function(pe,Ee){var Te=[],be=new a(pe,Ee,pe+1,Ee+1);return H.forEach(function(Ae){!Ae.getIsDeleted()&&be.checkIntersect(Ae.getBoundingRectange())&&Te.push(Ae)}),Te},this.calcBoundingBox=function(){var pe=null,Ee=null,Te=null,be=null;return H.forEach(function(Ae){var me=parseInt(Ae.getX()),Pe=parseInt(Ae.getY()),je=me+parseInt(Ae.getWidth()),ye=Pe+parseInt(Ae.getHeight());(null==Ee||me<Ee)&&(Ee=me),(null==pe||Pe<pe)&&(pe=Pe),(null==Te||ye>Te)&&(Te=ye),(null==be||je>be)&&(be=je)}),new a(Ee,pe,be,Te)},this.getAllObjects=function(){return H},this.publishSiblingObjectChange=function(pe,Ee){H.forEach(function(Te){Te.handleSiblingObjectChange(pe,Ee)})},this.getObjectById=function(pe){var Ee=null;return H.forEach(function(Te){null==Ee&&Te.getId()===pe&&(Ee=Te)}),Ee},this.addObject=function(pe){pe.on("obj-resize-start",ae),pe.on("obj-resize",function(Ee){fe(X.OBJECT_RESIZED,{object:Ee.obj}),re()}),pe.on("obj-translate-start",he),pe.on("obj-translate",function(Ee){fe(X.OBJECT_TRANSLATED,{object:Ee.obj}),re()}),H.push(pe),re(),fe(X.OBJECT_ADDED,{object:pe})},this.removeObject=function(pe){for(let Ee=0;Ee<H.length;Ee++)if(H[Ee].getId()===pe)return H.splice(Ee,1),re(),fe(X.OBJECT_REMOVED,{object:H[Ee]}),!0;return!1},this.getConnector=function(pe){for(let Ee=0;Ee<M.length;Ee++)if(M[Ee].getId()===pe)return M[Ee];return null},this.getConnectorsBetweenObjects=function(pe,Ee){const Te=[];return M.forEach(be=>{const Ae=be.getAnchorStart(),Ie=be.getAnchorEnd();pe.hasConnectorAnchor(Ae)&&Ee.hasConnectorAnchor(Ie)&&Te.push(be),pe.hasConnectorAnchor(Ie)&&Ee.hasConnectorAnchor(Ae)&&Te.push(be)}),Te},this.getConnectorsConnectedToObject=function(pe){const Ee=[];return M.forEach(Te=>{const be=Te.getAnchorStart(),Ae=Te.getAnchorEnd();(pe.hasConnectorAnchor(be)||pe.hasConnectorAnchor(Ae))&&Ee.push(Te)}),Ee},this.removeAllConnectors=function(){M.forEach(function(pe){pe.removePathElement()}),M.splice(0,M.length)},this.removeConnector=function(pe){for(let Ee=0;Ee<M.length;Ee++)if(M[Ee]===pe)return pe.removePathElement(),M.splice(Ee,1),!0;return!1},this.makeNewConnectorFromAnchors=function(pe,Ee){const Te=se(pe,Ee,v),be=O.getConnector(Te.getId());return null===be?(M.push(Te),Te.appendPathToContainerDomElement(),re(),Te):be},this.findBestConnectorAnchorsToConnectObjects=function(pe,Ee,Te){const be=Ae=>{const Ie=Ae.objectA.getConnectorAnchors(),Ce=Ae.objectB.getConnectorAnchors();var me=0,Pe=0,je=Number.MAX_VALUE;for(let ye=0;ye<Ie.length;ye++){const Se=te.get(Ie[ye].getId())||0;if(0!==Se)for(let Le=0;Le<Ce.length;Le++){const Oe=Ie[ye].getCentroid(),Xe=Ce[Le].getCentroid(),Ye=Math.sqrt(Math.pow(Xe.getX()-Oe.getX(),2)+Math.pow(Xe.getY()-Oe.getY(),2)),ve=te.get(Ce[Le].getId())||0;Ye<je&&0<ve&&(me=ye,Pe=Le,je=Ye)}}Ae.cb({objectAAnchorIndex:me,objectAAnchor:Ie[me],objectBAnchorIndex:Pe,objectBAnchor:Ce[Pe]})};setTimeout(function(){be({objectA:pe,objectB:Ee,cb:Te})},10)},this.addConnectionAnchorToSelectionStack=function(pe){$.push(pe),2===$.length&&(O.makeNewConnectorFromAnchors($[0],$[1]),$.length=0)};const de=function(pe,Ee){const Te=O.getObjectsAroundPoint(pe,Ee),be={targetPoint:new o(pe,Ee),objectsAroundPoint:Te};fe(X.DBLCLICK,be)};this.initInteractionHandlers=function(pe,Ee){P.addEventListener("dblclick",function(Te){de(Te.pageX,Te.pageY)}),P.addEventListener("click",function(Te){let be=!1;Te.target!==P&&(be=!0);const Ae={targetPoint:new o(Te.pageX,Te.pageY),canvasObjectClicked:be};fe(X.CLICK,Ae)}),P.addEventListener("touchend",function(Te){if(0>=Te.changedTouches.length)return!1;var be=!1,Ae=Te.changedTouches[0].pageX,Ie=Te.changedTouches[0].pageY,Ce=new Date().getTime();if(null!==Q.lastTouchTime){var me=Q.lastTouchTime,je=Q.lastTouchX,ye=Q.lastTouchY,Se=Math.sqrt(Math.pow(Ae-je,2)+Math.pow(Ie-ye,2));Ce-me<=pe&&Se<=Ee&&(be=!0,de(Ae,Ie),Q.lastTouchTime=null,Q.lastTouchX=null,Q.lastTouchY=null)}be||(Q.lastTouchTime=Ce,Q.lastTouchX=Ae,Q.lastTouchY=Ie)})};const ae=function(pe){J=pe.obj.getId()},he=function(pe){q=pe.obj.getId(),V=pe.x,Z=pe.y,K=pe.x,U=pe.y},ce=function(pe,Ee){const Te=O.getObjectById(q),be=Te.getTranslateHandleOffset(),Ae=O.snapToGrid(pe+be.getX()),Ie=O.snapToGrid(Ee+be.getY());V=Ae,Z=Ie,Te.translate(Ae,Ie)},le=function(pe,Ee){const Te=O.getObjectById(q),be=Te.getTranslateHandleOffset(),Ae=O.snapToGrid(pe+be.getX()),Ie=O.snapToGrid(Ee+be.getY()),Ce=K,me=U;if(Ce==Ae&&me==Ie);else Te.translate(Ae,Ie)},ue=function(pe,Ee){const Te=O.getObjectById(J),be=O.snapToGrid(pe),Ae=O.snapToGrid(Ee),Ie=Te.getY(),Ce=Te.getX();Te.resize(be-Ce+1,Ae-Ie+1)};this.initTransformationHandlers=function(){P.addEventListener("touchmove",function(pe){null!==q&&(ce(pe.touches[0].pageX*z,pe.touches[0].pageY*z),pe.preventDefault())}),P.addEventListener("mousemove",function(pe){null!==q&&ce(pe.pageX*z,pe.pageY*z),null!==J&&ue(pe.pageX*z,pe.pageY*z)}),P.addEventListener("touchend",function(){if(null!==q){O.getObjectById(q);q=null,J=null}}),P.addEventListener("mouseup",function(pe){1===pe.which&&(null!==q&&le(pe.pageX*z,pe.pageY*z),q=null,J=null)}),P.addEventListener("mousedown",function(pe){(null!==q||null!==J)&&(pe.preventDefault(),pe.stopPropagation())})};const fe=function(pe,Ee){const Te=ee.get(pe)||[];for(let be=0;be<Te.length;be++){const Ae=Te[be];Ae(Ee)}};this.off=function(pe,Ee){const Te=ee.get(pe)||[];for(let be=0;be<Te.length;be++)if(Te[be]===Ee){Te.splice(be,1);break}ee.set(pe,Te)},this.on=function(pe,Ee){const Te=ee.get(pe)||[];Te.push(Ee),ee.set(pe,Te)},O.setGrid(new E(12,"#424242",m.DOT)),O.resetTransform(),O.setTransformOrigin(0,0),O.setTransitionCss(w)},t.Cluster=I,t.BoxClusterDetector=function(P){const S=this,L=function(Y,v){for(let R=0;R<v.length;R++)if(v[R].getId()===Y.getId())return R;return-1},O=function(Y,v){for(let R=0;R<Y.length;R++){const w=L(Y[R],v);-1!==w&&v.splice(w,1)}return v},X=function(Y){var v=0,R=null;return Y.forEach(function(w,B){w>v&&(v=w,R=B)}),R};this.areObjectsClose=function(Y,v){const R=new a(Y.x-P,Y.y-P,Y.x+Y.width+P,Y.y+Y.height+P),w=new a(v.x-P,v.y-P,v.x+v.width+P,v.y+v.height+P);return R.checkIntersect(w)},this.getAllObjectsCloseTo=function(Y,v){const R=[];for(let w=0;w<v.length;w++)Y.getId()!==v[w].getId()&&S.areObjectsClose(Y,v[w])&&R.push(v[w]);return R},this.getClusterObjectsFromSeed=function(Y,v,R){const w=S.getAllObjectsCloseTo(Y,v);return 0===w.length?[]:void(O(w.concat([Y]),v),w.forEach(function(B){R.push(B),S.getClusterObjectsFromSeed(B,v,R)}))},this.findIntersectingClustersForObjects=function(Y,v){const R=new Map;return v.forEach(function(w){const B=w.getObjects();for(let D=0;D<B.length;D++)for(let N=0;N<Y.length;N++)if(B[D].getId()===Y[N].getId())if(R.has(w)){const G=R.get(w);R.set(w,G+1)}else R.set(w,1)}),R},this.removeObjectFromClusters=function(Y,v){v.forEach(function(R){R.removeObjectById(Y.getId())})},this.computeClusters=function(Y,v,R){const w=v.map(function(N){return N}),B=Y.map(function(N){return N});for(;0<B.length;){const N=B.pop(),G=[N];if(S.getClusterObjectsFromSeed(N,B,G),1<G.length){const F=S.findIntersectingClustersForObjects(G,w);if(0===F.size){const z=new I(R());G.forEach(function(W){z.addObject(W)}),w.push(z)}else{const z=X(F);z.removeAllObjects(),G.forEach(function(W){S.removeObjectFromClusters(W,w),z.addObject(W)})}O(G,B)}else S.removeObjectFromClusters(N,w)}const D=w.filter(function(N){return!!(2<=N.getObjects().length)});return D}},t.Connector=f,t.ConnectorAnchor=u,t.PointVisibilityMap=function(P,S){const L=this,O=S.toArray(),X=new Map,Y=function(B){for(let D=0;D<O.length;D++){const N=O[D].computeIntersectionType(B);if(N===_.LINESEG)return!0}return!1},R=function(B){var D=Number.MAX_SAFE_INTEGER,N=null;for(var[G,F]of B.entries())F<D&&(N=G,D=F);return null===N?null:{cost:D,point:N}},w=function(B,D,N,G){const F=new Map;var z=X.get(N);z=z.filter(function(k){for(let H=0;H<D.length;H++)if(k.isEqual(D[H]))return!1;return!0}),z.forEach(function(k){const H=new s(N,k).getLength()+B,M=new s(k,G).getLength();F.set(k,H+M)});const W=R(F);return null===W?null:W};this.findPointClosestTo=function(B){var D=null,N=Number.MAX_SAFE_INTEGER;return X.forEach(function(G,F){const z=new s(B,F);z.getLength()<N&&(D=F,N=z.getLength())}),D},this.findVisiblePointClosestTo=function(B){var D=null,N=Number.MAX_SAFE_INTEGER;return X.forEach(function(G,F){const z=new s(B,F);!Y(z)&&z.getLength()<N&&(D=F,N=z.getLength())}),D},this.computeRoute=function(B,D){if(null===B||null===D)return new h;const N=L.findVisiblePointClosestTo(B);if(null===N)return new h;var G=0;const F=[N];for(var z=N;;){const W=w(G,F,z,D);if(null===W){const k=new s(F[F.length-1],D);if(Y(k))return new h;break}if(G+=new s(z,W.point).getLength(),F.push(W.point),z=W.point,1>new s(z,D).getLength())break}return new h(F)},function(){const B=P.toArray();for(let D=0;D<B.length;D++)X.set(B[D],[]);for(let D=0;D<B.length;D++)for(let N=D+1;N<B.length;N++){const G=new s(B[D],B[N]);if(!Y(G)){const F=X.get(B[D]);F.push(B[N]),X.set(B[D],F);const z=X.get(B[N]);z.push(B[D]),X.set(B[N],z)}}}()},t.GRID_STYLE=m,t.Grid=E,t}({});