!function(t){"use strict";function e(t,e){this.getWidth=function(){return t},this.getHeight=function(){return e}}function n(t,e,n,i){this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return i},this.checkIntersect=function(c){return i<c.getTop()?!1:e>c.getBottom()?!1:n<c.getLeft()?!1:t>c.getRight()?!1:!0},this.checkIsWithin=function(c){return i>c.getBottom()||e<c.getTop()||n>c.getRight()||t<c.getLeft()?!1:!0}}function i(t,e){this.getX=function(){return t},this.getY=function(){return e}}function c(t,e,i,c,a,s){var r=this;this.id=t,this.x=e,this.y=i,this.width=c,this.height=a,this.domElement=s,this.isDeleted=!1,this.touchInternalContactPt=null,this.getId=function(){return r.id},this.getX=function(){return r.x},this.setX=function(t){r.x=t},this.getY=function(){return r.y},this.setY=function(t){r.y=t},this.translate=function(t,e){r.x=t,r.y=e},this.getWidth=function(){return r.width},this.getHeight=function(){return r.height},this.resize=function(t,e){r.width=t,r.height=e},this.getIsDeleted=function(){return r.isDeleted},this.getDomElement=function(){return r.domElement},this.getTouchInternalContactPt=function(){return r.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var t=parseInt(r.x),e=parseInt(r.y),i=t+parseInt(r.width),c=e+parseInt(r.height);return new n(t,e,i,c)}}function a(t,e){var i=this,c=12;this.getGridSize=function(){return c};this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;this.snapObjectToGrid=function(t){var e=i.snap(t.getX()),n=i.snap(t.getY());t.setX(e),t.setY(n)},this.getObjectsAroundPoint=function(t,e){var c=[],a=new n(t,e,t+1,e+1);return i.canvasObjects.forEach(function(t){!t.getIsDeleted()&&a.checkIntersect(t.getBoundingRectange())&&c.push(t)}),c},this.calcBoundingBox=function(){var t=null,e=null,c=null,a=null;return i.canvasObjects.forEach(function(n){var i=parseInt(n.getX()),s=parseInt(n.getY()),r=i+parseInt(n.getWidth()),o=s+parseInt(n.getHeight());(null===e||e>i)&&(e=i),(null===t||t>s)&&(t=s),(null===c||o>c)&&(c=o),(null===a||r>a)&&(a=r)}),new n(e,t,a,c)},this.getAllObjects=function(){return i.canvasObjects},this.getObjectById=function(t){var e=null;return i.canvasObjects.forEach(function(n){null===e&&n.id===t&&(e=n)}),e},this.addObject=function(t){i.canvasObjects.push(t)};this.initInteractionHandlers=function(n,c){t.addEventListener("dblclick",function(t){i.dblClickTapHandler(t.pageX,t.pageY)}),t.addEventListener("click",function(n){n.target===t?e("click",{canvasObjectClicked:!1}):e("click",{canvasObjectClicked:!0})}),t.addEventListener("touchend",function(t){if(t.originalEvent.changedTouches.length<=0)return!1;var e=!1,a=t.originalEvent.changedTouches[0].pageX,s=t.originalEvent.changedTouches[0].pageY,r=(new Date).getTime();if(null!==i.dblTapDetectVars.lastTouchTime){var o=i.dblTapDetectVars.lastTouchTime,u=r-o,h=i.dblTapDetectVars.lastTouchX,l=i.dblTapDetectVars.lastTouchY,g=Math.sqrt(Math.pow(a-h,2)+Math.pow(s-l,2));u>n||g>c||(e=!0,i.dblClickTapHandler(a,s),i.dblTapDetectVars.lastTouchTime=null,i.dblTapDetectVars.lastTouchX=null,i.dblTapDetectVars.lastTouchY=null)}e||(i.dblTapDetectVars.lastTouchTime=r,i.dblTapDetectVars.lastTouchX=a,i.dblTapDetectVars.lastTouchY=s)})};this.initTransformationHandlers=function(){t.addEventListener("touchmove",function(t){null!==i.objectIdBeingDragged&&(i.handleMove(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY),t.preventDefault(),t.stopPropagation())}),t.addEventListener("mousemove",function(t){if(null!==i.objectIdBeingDragged)return i.handleMove(t.pageX,t.pageY),!1;if(null!==i.objectIdBeingResized){var n=i.snap(t.pageX),c=i.snap(t.pageY),a=i.getObjectById(i.objectIdBeingResized),s=a.getX(),r=a.getY(),o=n-r+1,u=c-s+1;return a.resize(o,u),e("object-resized",a),!1}}),t.addEventListener("touchend",function(){if(null!==i.objectIdBeingDragged){var t=i.getObjectById(i.objectIdBeingDragged);t.touchInternalContactPt=null,i.objectIdBeingDragged=null,i.objectIdBeingResized=null}}),t.addEventListener("mouseup",function(t){1===t.which&&(null!==i.objectIdBeingDragged&&i.handleMoveEnd(t.pageX,t.pageY),null!==i.objectIdBeingResized,i.objectIdBeingDragged=null,i.objectIdBeingResized=null)})}}t.Dimensions=e,t.Rectangle=n,t.Point=i,t.Object=c,t.Canvas=a}(this.GraphPaper=this.GraphPaper||{});