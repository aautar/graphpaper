'use strict';(function(a){'use strict';function d(o,p,q,r){this.getLeft=function(){return o},this.getTop=function(){return p},this.getRight=function(){return q},this.getBottom=function(){return r},this.checkIntersect=function(s){return!(r<s.getTop())&&!(p>s.getBottom())&&!(q<s.getLeft())&&!(o>s.getRight())},this.checkIsWithin=function(s){return r<=s.getBottom()&&p>=s.getTop()&&q<=s.getRight()&&o>=s.getLeft()}}function f(o,p){this.getX=function(){return o},this.getY=function(){return p}}function g(o,p){this.getParentObject=function(){return p},this.getObjectId=function(){return p.getId()},this.getX=function(){return p.getX()+o.offsetLeft+0.5*o.clientWidth},this.getY=function(){return p.getY()+o.offsetTop+0.5*o.clientHeight},this.getDomElement=function(){return o}}function h(o,p,q,r,s){var t=this;'undefined'==typeof r&&(r='#000'),'undefined'==typeof s&&(s='2px');var u=document.createElementNS('http://www.w3.org/2000/svg','path');u.setAttribute('d','M0,0 L0,0'),u.style.stroke=r,u.style.strokeWidth=s;this.appendPathToContainerDomElement=function(){q.appendChild(u)},this.refresh=function(){var w=o.getX()+','+o.getY(),z=p.getX()+','+p.getY();u.setAttribute('d','M'+w+' L'+z)},this.getId=function(){var w=[o.getObjectId(),p.getObjectId()].sort();return w.join(':')},t.refresh()}function m(o){var p=this,q=[];this.getId=function(){return o},this.getObjectIndex=function(r){return p.getObjectIndexById(r.getId())},this.getObjectIndexById=function(r){for(var s=0;s<q.length;s++)if(q[s].getId()===r)return s;return null},this.addObject=function(r){return!(null!==p.getObjectIndex(r))&&(q.push(r),!0)},this.getObjects=function(){return q},this.getObjectIds=function(){var r=[];return q.forEach(function(s){r.push(s.getId())}),r},this.removeObjectById=function(r){var s=p.getObjectIndexById(r);return null!==s&&(q.splice(s,1),!0)},this.removeAllObjects=function(){q.length=0}}a.Dimensions=function(o,p){this.getWidth=function(){return o},this.getHeight=function(){return p}},a.Rectangle=d,a.Point=f,a.CanvasObject=function(o,p,q,r,s,t,u,v,w){var z=this,A=[];this.id=o,this.x=p,this.y=q,this.width=r,this.height=s,this.domElement=u,this.isDeleted=!1,this.touchInternalContactPt=null,this.addConnectorAnchor=function(C){var D=new g(C,z);C.addEventListener('click',function(){t.addConnectionAnchorToSelectionStack(D)}),A.push(D)},this.getTranslateHandleOffsetX=function(){return-(v.offsetLeft+0.5*v.offsetWidth)},this.getTranslateHandleOffsetY=function(){return-(v.offsetTop+0.5*v.offsetHeight)},this.getId=function(){return z.id},this.getX=function(){return z.x},this.setX=function(C){z.x=C},this.getY=function(){return z.y},this.setY=function(C){z.y=C},this.translate=function(C,D){z.x=C,z.y=D,z.domElement.style.left=parseInt(z.x)+'px',z.domElement.style.top=parseInt(z.y)+'px'},this.getWidth=function(){return z.width},this.getHeight=function(){return z.height},this.resize=function(C,D){z.width=C,z.height=D,z.domElement.style.width=parseInt(z.width)+'px',z.domElement.style.height=parseInt(z.height)+'px'},this.getIsDeleted=function(){return z.isDeleted},this.getDomElement=function(){return z.domElement},this.getTouchInternalContactPt=function(){return z.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var C=parseInt(z.x),D=parseInt(z.y),E=C+parseInt(z.width),F=D+parseInt(z.height);return new d(C,D,E,F)};var B=function(D){D.touches&&(z.touchInternalContactPt=new f(D.touches[0].pageX-z.getX(),D.touches[0].pageY-z.getY()));var E=D.pageX,F=D.pageY;t.objectIdBeingDragged=z.getId(),t.objectDragX=E,t.objectDragY=F,t.objectDragStartX=E,t.objectDragStartY=F};v.addEventListener('touchstart',function(C){B(C)}),v.addEventListener('mousedown',function(C){B(C)}),w.addEventListener('mousedown',function(C){1!==C.which||(t.objectIdBeingResized=z.getId())})},a.Canvas=function(o,p,q){var r=this,t=q.document.createElementNS('http://www.w3.org/2000/svg','svg');t.style.width='100%',t.style.height='100%';var u=o.appendChild(t);this.getGridSize=function(){return 12};var w=[],z=[];this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;var A={lastTouchX:null,lastTouchY:null,lastTouchTime:null},B=1,C=1,D=[],E=function(){z.forEach(function(K){K.refresh()})},F=function(K,L,M){return new h(K,L,M)};this.setConnectorFactory=function(J){F=J},this.setScaleFactor=function(J){return B=J,C=1/B,o.style.transform='scale3d('+B+','+B+','+B+')',B},this.getScaleFactor=function(){return B},this.snapToGrid=function(J){var K=Math.round(J/r.getGridSize())*r.getGridSize();return Math.max(0,K-1)},this.getOffsetLeft=function(){return o.offsetLeft},this.getOffsetTop=function(){return o.offsetTop},this.getObjectsAroundPoint=function(J,K){var L=[],M=new d(J,K,J+1,K+1);return w.forEach(function(N){!N.getIsDeleted()&&M.checkIntersect(N.getBoundingRectange())&&L.push(N)}),L},this.calcBoundingBox=function(){var J=null,K=null,L=null,M=null;return w.forEach(function(N){var Q=parseInt(N.getX()),R=parseInt(N.getY()),S=Q+parseInt(N.getWidth()),T=R+parseInt(N.getHeight());(null==K||Q<K)&&(K=Q),(null==J||R<J)&&(J=R),(null==L||T>L)&&(L=T),(null==M||S>M)&&(M=S)}),new d(K,J,M,L)},this.getAllObjects=function(){return w},this.publishSiblingObjectChange=function(J,K){w.forEach(function(L){L.handleSiblingObjectChange(J,K)})},this.getObjectById=function(J){var K=null;return w.forEach(function(L){null==K&&L.getId()===J&&(K=L)}),K},this.addObject=function(J){w.push(J)},this.getConnector=function(J){for(var K=0;K<z.length;K++)if(z[K].getId()===J)return z[K];return null},this.addConnectionAnchorToSelectionStack=function(J){if(D.push(J),2===D.length){var K=F(D[0],D[1],u),L=r.getConnector(K.getId());D.length=0,null===L&&(z.push(K),K.appendPathToContainerDomElement())}};var G=function(K,L){var M=r.getObjectsAroundPoint(K,L);0===M.length&&p('dbl-click',new f(K,L))};this.initInteractionHandlers=function(J,K){o.addEventListener('dblclick',function(L){G(L.pageX,L.pageY)}),o.addEventListener('click',function(L){L.target===o?p('click',{canvasObjectClicked:!1}):p('click',{canvasObjectClicked:!0})}),o.addEventListener('touchend',function(L){if(0>=L.originalEvent.changedTouches.length)return!1;var M=!1,N=L.originalEvent.changedTouches[0].pageX,O=L.originalEvent.changedTouches[0].pageY,P=new Date().getTime();if(null!==A.lastTouchTime){var Q=A.lastTouchTime,S=A.lastTouchX,T=A.lastTouchY,U=Math.sqrt(Math.pow(N-S,2)+Math.pow(O-T,2));P-Q<=J&&U<=K&&(M=!0,G(N,O),A.lastTouchTime=null,A.lastTouchX=null,A.lastTouchY=null)}M||(A.lastTouchTime=P,A.lastTouchX=N,A.lastTouchY=O)})};var H=function(K,L){var M=r.getObjectById(r.objectIdBeingDragged);M.touchInternalContactPt&&(K-=M.touchInternalContactPt.getX(),L-=M.touchInternalContactPt.getY());var N=r.snapToGrid(K+M.getTranslateHandleOffsetX()),O=r.snapToGrid(L+M.getTranslateHandleOffsetY());r.objectDragX=N,r.objectDragY=O,M.translate(N,O),E()},I=function(K,L){var M=r.getObjectById(r.objectIdBeingDragged),N=r.snapToGrid(K+M.getTranslateHandleOffsetX()),O=r.snapToGrid(L+M.getTranslateHandleOffsetY()),P=r.objectDragStartX,Q=r.objectDragStartY;P==N&&Q==O||(M.translate(N,O),p('object-translated',M))};this.initTransformationHandlers=function(){o.addEventListener('touchmove',function(J){null!==r.objectIdBeingDragged&&H(J.touches[0].pageX*C,J.touches[0].pageY*C)}),o.addEventListener('mousemove',function(J){if(null!==r.objectIdBeingDragged&&H(J.pageX*C,J.pageY*C),null!==r.objectIdBeingResized){var K=r.snapToGrid(J.pageX*C),L=r.snapToGrid(J.pageY*C),M=r.getObjectById(r.objectIdBeingResized),N=M.getY(),O=M.getX();M.resize(K-O+1,L-N+1),E(),p('object-resized',M)}}),o.addEventListener('touchend',function(){if(null!==r.objectIdBeingDragged){var K=r.getObjectById(r.objectIdBeingDragged);K.touchInternalContactPt=null,r.objectIdBeingDragged=null,r.objectIdBeingResized=null}}),o.addEventListener('mouseup',function(J){1===J.which&&(null!==r.objectIdBeingDragged&&I(J.pageX*C,J.pageY*C),null!==r.objectIdBeingResized,r.objectIdBeingDragged=null,r.objectIdBeingResized=null)}),o.addEventListener('mousedown',function(J){(null!==r.objectIdBeingDragged||null!==r.objectIdBeingResized)&&(J.preventDefault(),J.stopPropagation())})}},a.Cluster=m,a.BoxClusterDetector=function(o){var p=this,q=function(v,w){for(var z=0;z<w.length;z++)if(w[z].getId()===v.getId())return z;return-1},r=function(v,w){for(var A,z=0;z<v.length;z++)A=q(v[z],w),-1!==A&&w.splice(A,1);return w},s=function(v){var w=0,z=null;return v.forEach(function(A,B){A>w&&(w=A,z=B)}),z};this.areObjectsClose=function(u,v){var w=new d(u.x-o,u.y-o,u.x+u.width+o,u.y+u.height+o),z=new d(v.x-o,v.y-o,v.x+v.width+o,v.y+v.height+o);return w.checkIntersect(z)},this.getAllObjectsCloseTo=function(u,v){for(var w=[],z=0;z<v.length;z++)u.getId()!==v[z].getId()&&p.areObjectsClose(u,v[z])&&w.push(v[z]);return w},this.getClusterObjectsFromSeed=function(u,v,w){var z=p.getAllObjectsCloseTo(u,v);return 0===z.length?[]:void(r(z.concat([u]),v),z.forEach(function(A){w.push(A),p.getClusterObjectsFromSeed(A,v,w)}))},this.findIntersectingClustersForObjects=function(u,v){var w=new Map;return v.forEach(function(z){for(var A=z.getObjects(),B=0;B<A.length;B++)for(var C=0;C<u.length;C++)if(A[B].getId()===u[C].getId())if(w.has(z)){var D=w.get(z);w.set(z,D+1)}else w.set(z,1)}),w},this.removeObjectFromClusters=function(u,v){v.forEach(function(w){w.removeObjectById(u.getId())})},this.computeClusters=function(u,v,w){for(var z=v.map(function(F){return F}),A=u.map(function(F){return F});0<A.length;){var B=A.pop(),C=[B];if(p.getClusterObjectsFromSeed(B,A,C),1<C.length){var D=p.findIntersectingClustersForObjects(C,z);0===D.size?function(){var F=new m(w());C.forEach(function(G){F.addObject(G)}),z.push(F)}():function(){var F=s(D);F.removeAllObjects(),C.forEach(function(G){p.removeObjectFromClusters(G,z),F.addObject(G)})}(),r(C,A)}else p.removeObjectFromClusters(B,z)}var E=z.filter(function(F){return!!(2<=F.getObjects().length)});return E}},a.Connector=h,a.ConnectorAnchor=g})(this.GraphPaper=this.GraphPaper||{});