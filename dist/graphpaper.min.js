var GraphPaper = (function (exports) {
    'use strict';

    var MatrixMath={mat4Multiply:function mat4Multiply(a,b){for(var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=0;4>d;d++)for(var e,f=0;4>f;f++){e=0;for(var g=0;4>g;g++)e+=a[g+4*d]*b[f+4*g];c[f+4*d]=e;}return c},vecMat4Multiply:function vecMat4Multiply(a,b){for(var c=[0,0,0,0],d=0;4>d;d++)c[d]=a[0]*b[4*d+0]+a[1]*b[4*d+1]+a[2]*b[4*d+2]+a[3]*b[4*d+3];return c}};

    function Point(a,b){this.__x=a,this.__y=b;}Point.prototype.getX=function(){return this.__x},Point.prototype.getY=function(){return this.__y},Point.prototype.isEqual=function(a){return !(this.__x!==a.getX()||this.__y!==a.getY())},Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)},Point.prototype.toString=function(){return this.__x+" "+this.__y},Point.prototype.toArray=function(){return [this.__x,this.__y]},Point.fromArray=function(a){return new Point(a[0],a[1])};

    var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"});function LineIntersection(a,b){this.__type=a,this.__intersectionPoint=b;}LineIntersection.prototype.getType=function(){return this.__type},LineIntersection.prototype.getIntersectionPoint=function(){return this.__intersectionPoint};

    function Line(a,b){if("undefined"==typeof a||null===a)throw "Line missing _startPoint";if("undefined"==typeof b||null===b)throw "Line missing _endPoint";this.__startPoint=a,this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint},Line.prototype.getEndPoint=function(){return this.__endPoint},Line.prototype.isEqual=function(a){return !!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))},Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},Line.prototype.getMinX=function(){return Math.min(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMaxX=function(){return Math.max(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMinY=function(){return Math.min(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getMaxY=function(){return Math.max(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getDirection=function(){var a=this.__endPoint.getX()-this.__startPoint.getX(),b=this.__endPoint.getY()-this.__startPoint.getY(),c=Math.sqrt(a*a+b*b);return new Point(a/c,b/c)},Line.prototype.createShortenedLine=function(a,b){var c=this.__endPoint.getX()-this.__startPoint.getX(),d=this.__endPoint.getY()-this.__startPoint.getY(),e=this.getDirection();return new Line(new Point(this.__startPoint.getX()+a*e.getX(),this.__startPoint.getY()+a*e.getY()),new Point(this.__startPoint.getX()+c-b*e.getX(),this.__startPoint.getY()+d-b*e.getY()))},Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG},Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};

    var SvgPathBuilder={pointToLineTo:function pointToLineTo(a,b){return 0===b?"M"+a.getX()+" "+a.getY():"L"+a.getX()+" "+a.getY()},pointTripletToTesselatedCurvePoints:function pointTripletToTesselatedCurvePoints(a,b){if(3!==a.length)throw new Error("_points must be array of exactly 3 points");var c=a[1],d=new Line(a[0],a[1]),e=new Line(a[1],a[2]),f=d.createShortenedLine(0,.5*b),g=e.createShortenedLine(.5*b,0);return [f.getStartPoint(),f.getEndPoint(),g.getStartPoint(),g.getEndPoint()]},pointsToPath:function pointsToPath(a,b){b=b||0;var c=[],d=0;if(0<b){for(;3<=a.length;){var e=a.shift(),f=a.shift(),g=a.shift(),h=SvgPathBuilder.pointTripletToTesselatedCurvePoints([e,f,g],b);a.unshift(h[3]),a.unshift(h[2]);for(var k=0;k<h.length-2;k++)c.push(SvgPathBuilder.pointToLineTo(h[k],d++));}for(;0<a.length;){var j=a.shift();c.push(SvgPathBuilder.pointToLineTo(j,d++));}}else for(var l,m=0;m<a.length;m++)l=a[m],c.push(SvgPathBuilder.pointToLineTo(l,m));return c.join(" ")}};

    function Dimensions(a,b){this.getWidth=function(){return a},this.getHeight=function(){return b};}

    function Rectangle(a,b,c,d){this.__left=a,this.__top=b,this.__right=c,this.__bottom=d;}Rectangle.prototype.getLeft=function(){return this.__left},Rectangle.prototype.getTop=function(){return this.__top},Rectangle.prototype.getRight=function(){return this.__right},Rectangle.prototype.getBottom=function(){return this.__bottom},Rectangle.prototype.getWidth=function(){return this.__right-this.__left},Rectangle.prototype.getHeight=function(){return this.__bottom-this.__top},Rectangle.prototype.getPoints=function(){return [new Point(this.__left,this.__top),new Point(this.__right,this.__top),new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)]},Rectangle.prototype.getLines=function(){return [new Line(new Point(this.__left,this.__top),new Point(this.__right,this.__top)),new Line(new Point(this.__right,this.__top),new Point(this.__right,this.__bottom)),new Line(new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)),new Line(new Point(this.__left,this.__bottom),new Point(this.__left,this.__top))]},Rectangle.prototype.getUniformlyResizedCopy=function(a){return new Rectangle(this.__left-a,this.__top-a,this.__right+a,this.__bottom+a)},Rectangle.prototype.getPointsScaledToGrid=function(a){var b=new Point(this.__left+.5*(this.__right-this.__left),this.__top+.5*(this.__bottom-this.__top)),c=(this.__right-b.getX()+a)/(this.__right-b.getX()),d=(this.__bottom-b.getY()+a)/(this.__bottom-b.getY()),e=[new Point((this.__left-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY()),new Point((this.__left-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY())];return e},Rectangle.prototype.checkIntersect=function(a){return !(this.__bottom<a.getTop())&&!(this.__top>a.getBottom())&&!(this.__right<a.getLeft())&&!(this.__left>a.getRight())},Rectangle.prototype.checkIsPointWithin=function(a){return !!(a.getX()>=this.__left&&a.getX()<=this.__right&&a.getY()>=this.__top&&a.getY()<=this.__bottom)},Rectangle.prototype.checkIsWithin=function(a){return !!(this.__bottom<=a.getBottom()&&this.__top>=a.getTop()&&this.__right<=a.getRight()&&this.__left>=a.getLeft())};

    var EntityEvent=Object.freeze({TRANSLATE_START:"obj-translate-start",TRANSLATE:"obj-translate",RESIZE_START:"obj-resize-start",RESIZE:"obj-resize"});

    var EntityTranslationMode=Object.freeze({FROM_HANDLE_CENTER:"from-handle-center",FROM_HANDLE_SELECTION_START:"from-handle-selection-start"});

    function _slicedToArray(arr, i) {
      return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
    }
    function _toConsumableArray(arr) {
      return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
    }
    function _arrayWithoutHoles(arr) {
      if (Array.isArray(arr)) return _arrayLikeToArray(arr);
    }
    function _arrayWithHoles(arr) {
      if (Array.isArray(arr)) return arr;
    }
    function _iterableToArray(iter) {
      if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
    }
    function _iterableToArrayLimit(arr, i) {
      var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];
      if (_i == null) return;
      var _arr = [];
      var _n = true;
      var _d = false;
      var _s, _e;
      try {
        for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {
          _arr.push(_s.value);
          if (i && _arr.length === i) break;
        }
      } catch (err) {
        _d = true;
        _e = err;
      } finally {
        try {
          if (!_n && _i["return"] != null) _i["return"]();
        } finally {
          if (_d) throw _e;
        }
      }
      return _arr;
    }
    function _unsupportedIterableToArray(o, minLen) {
      if (!o) return;
      if (typeof o === "string") return _arrayLikeToArray(o, minLen);
      var n = Object.prototype.toString.call(o).slice(8, -1);
      if (n === "Object" && o.constructor) n = o.constructor.name;
      if (n === "Map" || n === "Set") return Array.from(o);
      if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
    }
    function _arrayLikeToArray(arr, len) {
      if (len == null || len > arr.length) len = arr.length;
      for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
      return arr2;
    }
    function _nonIterableSpread() {
      throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }
    function _nonIterableRest() {
      throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }
    function _createForOfIteratorHelper(o, allowArrayLike) {
      var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
      if (!it) {
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          var F = function () {};
          return {
            s: F,
            n: function () {
              if (i >= o.length) return {
                done: true
              };
              return {
                done: false,
                value: o[i++]
              };
            },
            e: function (e) {
              throw e;
            },
            f: F
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      var normalCompletion = true,
        didErr = false,
        err;
      return {
        s: function () {
          it = it.call(o);
        },
        n: function () {
          var step = it.next();
          normalCompletion = step.done;
          return step;
        },
        e: function (e) {
          didErr = true;
          err = e;
        },
        f: function () {
          try {
            if (!normalCompletion && it.return != null) it.return();
          } finally {
            if (didErr) throw err;
          }
        }
      };
    }

    function PointSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.pushPointSet=function(a){for(var c=a.toArray(),d=0;d<c.length;d++)b.push(c[d]);},this.findPointClosestTo=function(a){var b=null,d=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<d&&(b=c,d=e.getLength());}),b},this.findDistanceToPointClosestTo=function(a){var b=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var d=new Line(a,c);d.getLength()<b&&(b=d.getLength());}),b},this.findPointsCloseTo=function(a,b){var d=new PointSet;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<=b&&d.push(c);}),d},this.toArray=function(){return c},this.toFloat64Array=function(){for(var a=new Float64Array(2*c.length),b=0;b<c.length;b++)a[0+2*b]=c[b].getX(),a[1+2*b]=c[b].getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=2)c.push(new Point(a[b],a[b+1]));};this.count=function(){return c.length},a&&Array.isArray(a)?a.forEach(b.push):a&&"[object Float64Array]"===Object.prototype.toString.call(a)&&d(a);}

    var AccessibleRoutingPointsFinder={find:function find(a,b,c){var d=new Map,e=[],f=new PointSet;return a.forEach(function(a){var b=a.connectorAnchors;b.forEach(function(a){{var c=new PointSet(a.routingPointsFloat64Arr).toArray();c.forEach(function(b){e.push({routingPoint:b,parentAnchorId:a.id});}),d.set(a.id,c.length);}});}),e.forEach(function(a){for(var c=!1,e=0;e<b.length;e++){var g=b[e],h=new Rectangle(g.x,g.y,g.x+g.width,g.y+g.height);if(h.checkIsPointWithin(a.routingPoint)){c=!0;var j=d.get(a.parentAnchorId)||0;d.set(a.parentAnchorId,Math.max(0,j-1));}}c||f.push(a.routingPoint);}),{connectorAnchorToNumValidRoutingPoints:d,accessibleRoutingPoints:f}}};

    function ConnectorAnchor(a,b,c,d,e){var f=this,g=["top","left","bottom","right"];d=d||c.getGridSize(),e=e||c.getGridSize();var h=function getDimensions(){var a=c.transformDomRectToPageSpaceRect(b.getBoundingClientRect());return new Point(a.getWidth(),a.getHeight())},i=function routingPointDirectionToPoint(a,b,c,f){return "top"===a?new Point(b.getX(),b.getY()-f-e):"bottom"===a?new Point(b.getX(),b.getY()+f+e):"left"===a?new Point(b.getX()-c-d,b.getY()):"right"===a?new Point(b.getX()+c+d,b.getY()):null};this.setPossibleRoutingPointDirections=function(a){g=a;},this.getId=function(){return a},this.getX=function(){return f.getCentroid().getX()},this.getY=function(){return f.getCentroid().getY()},this.getWidth=function(){var a=c.transformDomRectToPageSpaceRect(b.getBoundingClientRect());return a.getWidth()},this.getHeight=function(){var a=c.transformDomRectToPageSpaceRect(b.getBoundingClientRect());return a.getHeight()},this.getCentroid=function(){var a=c.getSheetOffset(),d=c.transformDomRectToPageSpaceRect(b.getBoundingClientRect()),e=.5*d.getWidth(),f=.5*d.getHeight();return new Point(d.getLeft()+e-a.getX(),d.getTop()+f-a.getY())},this.getRoutingPoints=function(){var a=h(),b=f.getCentroid(),c=.5*a.getX(),d=.5*a.getY(),e=[];return g.forEach(function(a){e.push(i(a,b,c,d));}),e},this.getBoundingRectange=function(){var a=h(),b=f.getCentroid(),c=.5*a.getX(),d=.5*a.getY();return new Rectangle(b.getX()-c,b.getY()-d,b.getX()+c,b.getY()+d)};}

    var ClosestPairFinder={findClosestPairBetweenObjects:function findClosestPairBetweenObjects(a,b,c){for(var e=a.getConnectorAnchors(),f=b.getConnectorAnchors(),g=0,h=0,i=Number.MAX_VALUE,j=0;j<e.length;j++){var k=e[j].getCentroid(),l=c.get(e[j].getId())||0;if(0!==l)for(var r=0;r<f.length;r++){var m=f[r].getCentroid(),n=Math.sqrt(Math.pow(m.getX()-k.getX(),2)+Math.pow(m.getY()-k.getY(),2)),o=c.get(f[r].getId())||0;n<i&&0<o&&(g=j,h=r,i=n);}}if(i===Number.MAX_VALUE)for(var s,t=0;t<e.length;t++){s=e[t].getCentroid();for(var u=0;u<f.length;u++){var p=f[u].getCentroid(),q=Math.sqrt(Math.pow(p.getX()-s.getX(),2)+Math.pow(p.getY()-s.getY(),2));q<i&&(g=t,h=u,i=q);}}return {objectAAnchorIndex:g,objectAAnchor:e[g],objectBAnchorIndex:h,objectBAnchor:f[h]}}};

    var BestToConnectEntitiesFinder=function BestToConnectEntitiesFinder(){this.findBestTimeout=null,this.searchInputs=[],this.currentSheetEntities=[],this.currentGridSize=11,this.findBufferTime=6.94,this.metrics={batchSize:null,searchFuncExecutionTime:null};};BestToConnectEntitiesFinder.prototype.getSearchFuncExecutionTime=function(){return this.metrics.searchFuncExecutionTime},BestToConnectEntitiesFinder.prototype.getSearchFuncBatchSize=function(){return this.metrics.batchSize},BestToConnectEntitiesFinder.prototype.alreadyInSearchInputs=function(a,b,c){for(var d=0;d<this.searchInputs.length;d++)if(this.searchInputs[d].entityA===a&&this.searchInputs[d].entityB===b&&this.searchInputs[d].cb.toString()===c.toString())return !0;return !1},BestToConnectEntitiesFinder.prototype.clearSearchInputs=function(){this.searchInputs.length=0;},BestToConnectEntitiesFinder.prototype.search=function(){var a=new Date,b=this.searchInputs.length,c=this.currentGridSize,d=[];this.currentSheetEntities.forEach(function(a){d[a.getId()]=a.getDescriptor(c);});for(var e=Object.values(d),f=0;f<this.searchInputs.length;f++){var g=AccessibleRoutingPointsFinder.find([d[this.searchInputs[f].entityA.getId()],d[this.searchInputs[f].entityB.getId()]],e,c),h=ClosestPairFinder.findClosestPairBetweenObjects(this.searchInputs[f].entityA,this.searchInputs[f].entityB,g.connectorAnchorToNumValidRoutingPoints);this.searchInputs[f].cb(h);}this.metrics.batchSize=b,this.metrics.searchFuncExecutionTime=new Date-a;},BestToConnectEntitiesFinder.prototype.findBest=function(a,b,c,d,e){var f=this;this.currentSheetEntities=d,this.currentGridSize=e,this.alreadyInSearchInputs(a,b,c)||this.searchInputs.push({entityA:a,entityB:b,cb:c}),this.findBestTimeout&&(clearTimeout(this.findBestTimeout),this.findBestTimeout=null);var g=function searchFunc(){f.search(f.searchInputs),f.findBestTimeout=null,f.searchInputs=[];};this.findBestTimeout=setTimeout(g,this.findBufferTime);};

    var SheetEvent=Object.freeze({DBLCLICK:"dblclick",CLICK:"click",CLUSTER_CREATED:"cluster-created",CLUSTER_DELETED:"cluster-deleted",CLUSTER_UPDATED:"cluster-updated",CONNECTOR_UPDATED:"connector-updated",ENTITY_ADDED:"entity-added",ENTITY_REMOVED:"entity-removed",ENTITY_RESIZED:"entity-resized",ENTITY_TRANSLATED:"entity-translated",ENTITY_OVERLAP_DETECTED:"entity-overlap-detected",MULTIPLE_ENTITY_SELECTION_STARTED:"multiple-object-selection-started",MULTIPLE_ENTITIES_SELECTED:"multiple-objects-selected"});

    var DebugMetricsPanel=function DebugMetricsPanel(a){var b=null,c=!1,d=function objectHtmlDumpDepthFirst(a,b,c){"undefined"==typeof c&&(c=""),a instanceof Object&&Object.keys(a).forEach(function(e){if(a[e]instanceof Object)d(a[e],b,e);else {var f="";0<c.length&&(f=c+".");var g=`${f}${e}`;b.push(`<p class="metric">${g} = ${a[e]}</p>`);}});};this.init=function(){b=a.document.createElement("div"),b.classList.add("graphpaper-debug-panel"),b.style.display="none",b.style.position="fixed",b.style.right="0px",b.style.top="0px",b.style.width="500px",b.style.height="200px",b.style.color="#fff",b.style.padding="15px",b.style.backgroundColor="rgba(0,0,0,0.75)",b.style.zIndex=9999,a.document.body.appendChild(b);},this.show=function(){c=!0,b.style.display="block";},this.hide=function(){c=!1,b.style.display="none";},this.refresh=function(a){if(!1!==c){var e=[];d(a,e),b.innerHTML=e.join("");}};};

    function DoubleTapDetector(a,b){var c={lastTouchX:null,lastTouchY:null,lastTouchTime:null},d=a||300,e=b||24;this.processTap=function(a,b,f){if(0===a.changedTouches.length)return {doubleTapDetected:!1,touchX:null,touchY:null};var g=MatrixMath.vecMat4Multiply([a.changedTouches[0].pageX-b.getX(),a.changedTouches[0].pageY-b.getY(),0,1],f),h=!1,i=g[0],j=g[1],k=new Date().getTime();if(null!==c.lastTouchTime){var l=c.lastTouchTime,m=k-l,n=c.lastTouchX,o=c.lastTouchY,p=Math.sqrt(Math.pow(i-n,2)+Math.pow(j-o,2));m<=d&&p<=e&&(c.lastTouchTime=null,c.lastTouchX=null,c.lastTouchY=null,h=!0);}return h||(c.lastTouchTime=k,c.lastTouchX=i,c.lastTouchY=j),{doubleTapDetected:h,touchX:i,touchY:j}};}

    var ConnectorEvent=Object.freeze({CLICK:"connector-click",MOUSE_ENTER:"connector-mouse-enter",MOUSE_LEAVE:"connector-mouse-leave"});

    var ConnectorRoutingAlgorithm=Object.freeze({STRAIGHT_LINE:0,STRAIGHT_LINE_BETWEEN_ANCHORS:1,STRAIGHT_LINE_BETWEEN_ANCHORS_AVOID_SELF_INTERSECTION:2,ASTAR:3,ASTAR_WITH_ROUTE_OPTIMIZATION:4,ASTAR_THETA_WITH_ROUTE_OPTIMIZATION:5});

    function Connector(a,b,c,d,e){var f=this,g=new Map,h=0,i=0,j="#000",k="2px";"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION);var l=null,m=window.document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d","M0 0 L0 0"),m.style.stroke=j,m.style.strokeWidth=k;var n=window.document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M0 0 L0 0"),n.style.stroke="transparent",n.style.strokeWidth=k,n.addEventListener("click",function(a){f.dispatchEvent(ConnectorEvent.CLICK,{connector:f,clickedAtX:a.pageX,clickedAtY:a.pageY});}),n.addEventListener("mouseenter",function(a){f.dispatchEvent(ConnectorEvent.MOUSE_ENTER,{connector:f,pointerAtX:a.pageX,pointerAtY:a.pageY});}),n.addEventListener("mouseleave",function(a){f.dispatchEvent(ConnectorEvent.MOUSE_LEAVE,{connector:f});}),this.appendPathToContainerDomElement=function(){c.appendChild(m),c.appendChild(n);},this.setMarkerStart=function(a,b){m.setAttribute(`marker-start`,`url(${a})`),h=b;},this.unsetMarkerStart=function(){m.removeAttribute(`marker-start`),h=0;},this.setMarkerEnd=function(a,b){m.setAttribute(`marker-end`,`url(${a})`),i=b;},this.unsetMarkerEnd=function(){m.removeAttribute(`marker-end`),i=0;},this.getPathPoints=function(){return l},this.getPathLines=function(){if(null===l||2>l.length)return [];for(var a=[],b=0;b<l.length-1;b++)a.push(new Line(l[b],l[b+1]));return a},this.getLength=function(){for(var a=0,b=f.getPathLines(),c=0;c<b.length;c++)a+=b[c].getLength();return a},this.getMidpoint=function(){for(var a=f.getLength(),b=f.getPathLines(),c=0,d=null,e=0;e<b.length;e++){d=b[e];var k=b[e].getLength();if(c+=k,c>=a/2)break}var g=c-d.getLength(),h=a/2-g,j=h/d.getLength();return new Point(d.getStartPoint().getX()+j*(d.getEndPoint().getX()-d.getStartPoint().getX()),d.getStartPoint().getY()+j*(d.getEndPoint().getY()-d.getStartPoint().getY()))},this.getMidpointDirection=function(){for(var a=f.getLength(),b=f.getPathLines(),c=0,d=null,e=0;e<b.length;e++){d=b[e];var g=b[e].getLength();if(c+=g,c>=a/2)break}return null===d?b[0].getDirection():d.getDirection()},this.refresh=function(a){m.setAttribute("d",a),n.setAttribute("d",a);},this.updatePathPoints=function(a){l=a;},this.getId=function(){var c=[a.getId(),b.getId()].sort();return c.join(":")},this.getAnchorStart=function(){return a},this.getAnchorEnd=function(){return b},this.removePathElement=function(){m.remove(),n.remove();},this.removeDefaultStyles=function(){f.setInlineStyleOnPathElement("stroke",""),f.setInlineStyleOnPathElement("strokeWidth",""),f.setInlineStyleOnInteractionElement("stroke",""),f.setInlineStyleOnInteractionElement("strokeWidth","");},this.setInlineStyleOnPathElement=function(a,b){m.style[a]=b;},this.addStyleClassesToPathElement=function(a){a.forEach(function(a){m.classList.add(a);});},this.removeStyleClassesFromPathElement=function(a){a.forEach(function(a){m.classList.remove(a);});},this.setInlineStyleOnInteractionElement=function(a,b){n.style[a]=b;},this.addStyleClassesToInteractionElement=function(a){a.forEach(function(a){n.classList.add(a);});},this.removeStyleClassesFromInteractionElement=function(a){a.forEach(function(a){n.classList.remove(a);});},this.getDescriptor=function(){return {id:f.getId(),anchor_start_centroid_arr:a.getCentroid().toArray(),anchor_end_centroid_arr:b.getCentroid().toArray(),marker_start_size:h,marker_end_size:i,curvature_px:d,routing_algorithm:e}},this.on=function(a,b){var c=g.get(a)||[];c.push(b),g.set(a,c);},this.off=function(a,b){for(var c=g.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}g.set(a,c);},this.dispatchEvent=function(a,b){var c=g.get(a)||[];c.forEach(function(a){a(b);});};}

    var GRID_STYLE={LINE:"line",DOT:"dot"};function Grid(a,b,c){this.getSize=function(){return a},this.getStyle=function(){return c},this.getSvgImageTile=function(){return c===GRID_STYLE.LINE?`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${a}"><rect width="${a}" height="1" x="0" y="${a-1}" style="fill:${b}" /><rect width="1" height="${a}" x="${a-1}" y="0" style="fill:${b}" /></svg>`:`<svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${a}"><rect width="1" height="1" x="${a-1}" y="${a-1}" style="fill:${b}" /></svg>`};}

    var ClusterDetectionWorkerJsString="(function () {\n    'use strict';\n\n    function Point(a,b){this.__x=a,this.__y=b;}Point.prototype.getX=function(){return this.__x},Point.prototype.getY=function(){return this.__y},Point.prototype.isEqual=function(a){return !(this.__x!==a.getX()||this.__y!==a.getY())},Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)},Point.prototype.toString=function(){return this.__x+\" \"+this.__y},Point.prototype.toArray=function(){return [this.__x,this.__y]},Point.fromArray=function(a){return new Point(a[0],a[1])};\n\n    var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:\"parallel\",COINCIDENT:\"coincident\",LINE:\"line\",LINESEG:\"lineseg\"});function LineIntersection(a,b){this.__type=a,this.__intersectionPoint=b;}LineIntersection.prototype.getType=function(){return this.__type},LineIntersection.prototype.getIntersectionPoint=function(){return this.__intersectionPoint};\n\n    function Line(a,b){if(\"undefined\"==typeof a||null===a)throw \"Line missing _startPoint\";if(\"undefined\"==typeof b||null===b)throw \"Line missing _endPoint\";this.__startPoint=a,this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint},Line.prototype.getEndPoint=function(){return this.__endPoint},Line.prototype.isEqual=function(a){return !!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))},Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},Line.prototype.getMinX=function(){return Math.min(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMaxX=function(){return Math.max(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMinY=function(){return Math.min(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getMaxY=function(){return Math.max(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getDirection=function(){var a=this.__endPoint.getX()-this.__startPoint.getX(),b=this.__endPoint.getY()-this.__startPoint.getY(),c=Math.sqrt(a*a+b*b);return new Point(a/c,b/c)},Line.prototype.createShortenedLine=function(a,b){var c=this.__endPoint.getX()-this.__startPoint.getX(),d=this.__endPoint.getY()-this.__startPoint.getY(),e=this.getDirection();return new Line(new Point(this.__startPoint.getX()+a*e.getX(),this.__startPoint.getY()+a*e.getY()),new Point(this.__startPoint.getX()+c-b*e.getX(),this.__startPoint.getY()+d-b*e.getY()))},Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG},Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};\n\n    function Rectangle(a,b,c,d){this.__left=a,this.__top=b,this.__right=c,this.__bottom=d;}Rectangle.prototype.getLeft=function(){return this.__left},Rectangle.prototype.getTop=function(){return this.__top},Rectangle.prototype.getRight=function(){return this.__right},Rectangle.prototype.getBottom=function(){return this.__bottom},Rectangle.prototype.getWidth=function(){return this.__right-this.__left},Rectangle.prototype.getHeight=function(){return this.__bottom-this.__top},Rectangle.prototype.getPoints=function(){return [new Point(this.__left,this.__top),new Point(this.__right,this.__top),new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)]},Rectangle.prototype.getLines=function(){return [new Line(new Point(this.__left,this.__top),new Point(this.__right,this.__top)),new Line(new Point(this.__right,this.__top),new Point(this.__right,this.__bottom)),new Line(new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)),new Line(new Point(this.__left,this.__bottom),new Point(this.__left,this.__top))]},Rectangle.prototype.getUniformlyResizedCopy=function(a){return new Rectangle(this.__left-a,this.__top-a,this.__right+a,this.__bottom+a)},Rectangle.prototype.getPointsScaledToGrid=function(a){var b=new Point(this.__left+.5*(this.__right-this.__left),this.__top+.5*(this.__bottom-this.__top)),c=(this.__right-b.getX()+a)/(this.__right-b.getX()),d=(this.__bottom-b.getY()+a)/(this.__bottom-b.getY()),e=[new Point((this.__left-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY()),new Point((this.__left-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY())];return e},Rectangle.prototype.checkIntersect=function(a){return !(this.__bottom<a.getTop())&&!(this.__top>a.getBottom())&&!(this.__right<a.getLeft())&&!(this.__left>a.getRight())},Rectangle.prototype.checkIsPointWithin=function(a){return !!(a.getX()>=this.__left&&a.getX()<=this.__right&&a.getY()>=this.__top&&a.getY()<=this.__bottom)},Rectangle.prototype.checkIsWithin=function(a){return !!(this.__bottom<=a.getBottom()&&this.__top>=a.getTop()&&this.__right<=a.getRight()&&this.__left>=a.getLeft())};\n\n    function DescriptorCollection(a){var b=this,c=[];this.getId=function(){return a},this.getDescriptorIndex=function(a){return b.getDescriptorIndexById(a.id)},this.getDescriptorIndexById=function(a){for(var b=0;b<c.length;b++)if(c[b].id===a)return b;return null},this.addDescriptor=function(a){return !(null!==b.getDescriptorIndex(a))&&(c.push(a),!0)},this.getDescriptors=function(){return c},this.getIds=function(){var a=[];return c.forEach(function(b){a.push(b.id);}),a},this.removeById=function(a){var d=b.getDescriptorIndexById(a);return null!==d&&(c.splice(d,1),!0)},this.removeAll=function(){c.length=0;};}\n\n    function Cluster(a){var b=new DescriptorCollection(a);this.getId=function(){return a},this.getEntityIndex=function(a){return b.getDescriptorIndex(a)},this.getEntityIndexById=function(a){return b.getDescriptorIndexById(a)},this.addEntity=function(a){return b.addDescriptor(a)},this.getEntities=function(){return b.getDescriptors()},this.getEntityIds=function(){return b.getIds()},this.removeEntityById=function(a){return b.removeById(a)},this.removeAllEntities=function(){return b.removeAll()},this.hasEntities=function(a){for(var c=!0,d=0;d<a.length;d++)if(null===b.getDescriptorIndexById(a[d])){c=!1;break}return c},this.toJSON=function(){return {id:a,entities:b.getDescriptors()}};}Cluster.fromJSON=function(a){var b=new Cluster(a.id);return a.entities.forEach(function(a){b.addEntity(a);}),b};\n\n    function BoxClusterDetector(a){var b=this,c=function getEntityIndexFromArray(a,b){for(var c=0;c<b.length;c++)if(b[c].id===a.id)return c;return -1},d=function removeEntitiesFromArray(a,b){for(var d,e=0;e<a.length;e++)d=c(a[e],b),-1!==d&&b.splice(d,1);return b},e=function getClusterWithMostEntitiesFromClusterMap(a){var b=0,c=null;return a.forEach(function(a,d,e){a>b&&(b=a,c=d);}),c},f=function computeDiffBetweenArrays(a,b){var c=[],d=[];return b.forEach(function(b){-1===a.indexOf(b)&&d.push(b);}),a.forEach(function(a){-1===b.indexOf(a)&&c.push(a);}),{onlyInA:c,onlyInB:d}};this.areEntitiesClose=function(b,c){var d=new Rectangle(b.x-a,b.y-a,b.x+b.width+a,b.y+b.height+a),e=new Rectangle(c.x-a,c.y-a,c.x+c.width+a,c.y+c.height+a);return d.checkIntersect(e)},this.getAllEntitiesCloseTo=function(a,c){for(var d=[],e=0;e<c.length;e++)a.id!==c[e].id&&b.areEntitiesClose(a,c[e])&&d.push(c[e]);return d},this.getClusterEntitiesFromSeed=function(a,c,e){var f=b.getAllEntitiesCloseTo(a,c);return 0===f.length?[]:void(d(f.concat([a]),c),f.forEach(function(a){e.push(a),b.getClusterEntitiesFromSeed(a,c,e);}))},this.findIntersectingClustersForEntities=function(a,b){var c=new Map;return b.forEach(function(b){for(var d=b.getEntities(),e=0;e<d.length;e++)for(var f=0;f<a.length;f++)if(d[e].id===a[f].id)if(c.has(b)){var g=c.get(b);c.set(b,g+1);}else c.set(b,1);}),c},this.removeEntityFromClusters=function(a,b){var c=[];return b.forEach(function(b){var d=b.removeEntityById(a.id);d&&c.push(b.getId());}),c},this.mapToClustersWithOldEntitiesRemoved=function(a,b){var c=b.map(function(b){for(var c=b.getEntityIds(),d=0;d<c.length;d++)-1===a.indexOf(c[d])&&b.removeEntityById(c[d]);return b});return c},this.computeClusters=function(a,c,g){for(var h=new Set,i=new Set,j=new Set,k=new Map,l=new Map,m=a.map(function(a){return a}),n=a.map(function(a){return a.id}),o=b.mapToClustersWithOldEntitiesRemoved(n,c),p=function _loop(){var a=m.pop(),c=[a];if(b.getClusterEntitiesFromSeed(a,m,c),1<c.length){var t=b.findIntersectingClustersForEntities(c,o);if(0===t.size){var j=g(),n=new Cluster(j);c.forEach(function(a){n.addEntity(a);}),o.push(n),h.add(j);}else {var p=e(t),q=p.getEntityIds();if(p.removeAllEntities(),c.forEach(function(a){var c=b.removeEntityFromClusters(a,o);c.forEach(function(a){i.add(a);}),p.addEntity(a);}),p.getEntityIds().length===q.length&&p.hasEntities(q));else {i.add(p.getId());var r=p.getEntityIds(),s=f(q,r);l.set(p.getId(),s.onlyInA),k.set(p.getId(),s.onlyInB);}}d(c,m);}else {var u=b.removeEntityFromClusters(a,o);u.forEach(function(b){i.add(b);var c=l.get(b);c?c.push(a.id):l.set(b,[a.id]),\"undefined\"==typeof k.get(b)&&k.set(b,[]);});}};0<m.length;)p();var q=o.filter(function(a){return !!(2>a.getEntities().length)});q.forEach(function(a){i.delete(a.getId()),k.delete(a.getId()),l.delete(a.getId()),j.add(a.getId());}),h.forEach(function(a){i.delete(a),k.delete(a),l.delete(a);});var r=o.filter(function(a){return !!(2<=a.getEntities().length)});return {clusters:r,newClusterIds:h,updatedClusterIds:i,deletedClusterIds:j,updatedClusterToRemovedEntitites:l,updatedClusterToAddedEntitites:k}};}\n\n    var UUID={v4:function v4(){return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c=\"x\"==a?b:8|3&b;return c.toString(16)})}};\n\n    function EntityOverlapFinder(){var b=function addOverlapMapEntries(a,b,c){if(a.has(b)){var d=a.get(b);d.push(c);}else a.set(b,[c]);if(a.has(c)){var e=a.get(c);e.push(b);}else a.set(c,[b]);};this.findOverlappingEntities=function(a){for(var c=new Map,d=0;d<a.length;d++)for(var e=a[d],f=new Rectangle(e.x,e.y,e.x+e.width,e.y+e.height),g=d+1;g<a.length;g++){var h=a[g],k=new Rectangle(h.x,h.y,h.x+h.width,h.y+h.height),l=f.checkIntersect(k);l&&b(c,e.id,h.id);}return c};}\n\n    var workerData={requestQueue:[],knownClusters:[]},clustersToTransferrableMap=function clustersToTransferrableMap(a){for(var b=new Map,c=0;c<a.length;c++)b.set(a[c].getId(),a[c].toJSON());return b},processRequestQueue=function processRequestQueue(){if(0!==workerData.requestQueue.length){var a={overallTime:null},b=workerData.requestQueue.pop();workerData.requestQueue.length=0;var c=b.entityDescriptors,d=new BoxClusterDetector(12);if(null!==b.knownClustersOverwrite){var h=function toClusterArray(a){var b=[];return a.forEach(function(a){b.push(Cluster.fromJSON(a));}),b};workerData.knownClusters=h(b.knownClustersOverwrite);}var e=new Date,f=d.computeClusters(c,workerData.knownClusters,UUID.v4);a.computeClustersTime=new Date-e;var g=new EntityOverlapFinder().findOverlappingEntities(c);postMessage({metrics:a,clusters:clustersToTransferrableMap(f.clusters),newClusterIds:f.newClusterIds,updatedClusterIds:f.updatedClusterIds,deletedClusterIds:f.deletedClusterIds,updatedClusterToRemovedEntitites:f.updatedClusterToRemovedEntitites,updatedClusterToAddedEntitites:f.updatedClusterToAddedEntitites,overlappingEntities:g}),workerData.knownClusters=f.clusters;}};setInterval(processRequestQueue,50),onmessage=function onmessage(a){workerData.requestQueue.push(a.data);};\n\n}());\n";

    var ConnectorRoutingWorkerJsString="(function () {\n  'use strict';\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n  }\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n  }\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n  }\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n  function _iterableToArray(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n  }\n  function _iterableToArrayLimit(arr, i) {\n    var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n    if (_i == null) return;\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _s, _e;\n    try {\n      for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n    return arr2;\n  }\n  function _nonIterableSpread() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  function _nonIterableRest() {\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  function _createForOfIteratorHelper(o, allowArrayLike) {\n    var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n    if (!it) {\n      if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n        if (it) o = it;\n        var i = 0;\n        var F = function () {};\n        return {\n          s: F,\n          n: function () {\n            if (i >= o.length) return {\n              done: true\n            };\n            return {\n              done: false,\n              value: o[i++]\n            };\n          },\n          e: function (e) {\n            throw e;\n          },\n          f: F\n        };\n      }\n      throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n    var normalCompletion = true,\n      didErr = false,\n      err;\n    return {\n      s: function () {\n        it = it.call(o);\n      },\n      n: function () {\n        var step = it.next();\n        normalCompletion = step.done;\n        return step;\n      },\n      e: function (e) {\n        didErr = true;\n        err = e;\n      },\n      f: function () {\n        try {\n          if (!normalCompletion && it.return != null) it.return();\n        } finally {\n          if (didErr) throw err;\n        }\n      }\n    };\n  }\n\n  function Point(a,b){this.__x=a,this.__y=b;}Point.prototype.getX=function(){return this.__x},Point.prototype.getY=function(){return this.__y},Point.prototype.isEqual=function(a){return !(this.__x!==a.getX()||this.__y!==a.getY())},Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)},Point.prototype.toString=function(){return this.__x+\" \"+this.__y},Point.prototype.toArray=function(){return [this.__x,this.__y]},Point.fromArray=function(a){return new Point(a[0],a[1])};\n\n  var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:\"parallel\",COINCIDENT:\"coincident\",LINE:\"line\",LINESEG:\"lineseg\"});function LineIntersection(a,b){this.__type=a,this.__intersectionPoint=b;}LineIntersection.prototype.getType=function(){return this.__type},LineIntersection.prototype.getIntersectionPoint=function(){return this.__intersectionPoint};\n\n  function Line(a,b){if(\"undefined\"==typeof a||null===a)throw \"Line missing _startPoint\";if(\"undefined\"==typeof b||null===b)throw \"Line missing _endPoint\";this.__startPoint=a,this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint},Line.prototype.getEndPoint=function(){return this.__endPoint},Line.prototype.isEqual=function(a){return !!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))},Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},Line.prototype.getMinX=function(){return Math.min(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMaxX=function(){return Math.max(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMinY=function(){return Math.min(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getMaxY=function(){return Math.max(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getDirection=function(){var a=this.__endPoint.getX()-this.__startPoint.getX(),b=this.__endPoint.getY()-this.__startPoint.getY(),c=Math.sqrt(a*a+b*b);return new Point(a/c,b/c)},Line.prototype.createShortenedLine=function(a,b){var c=this.__endPoint.getX()-this.__startPoint.getX(),d=this.__endPoint.getY()-this.__startPoint.getY(),e=this.getDirection();return new Line(new Point(this.__startPoint.getX()+a*e.getX(),this.__startPoint.getY()+a*e.getY()),new Point(this.__startPoint.getX()+c-b*e.getX(),this.__startPoint.getY()+d-b*e.getY()))},Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG},Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};\n\n  function PointSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.pushPointSet=function(a){for(var c=a.toArray(),d=0;d<c.length;d++)b.push(c[d]);},this.findPointClosestTo=function(a){var b=null,d=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<d&&(b=c,d=e.getLength());}),b},this.findDistanceToPointClosestTo=function(a){var b=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var d=new Line(a,c);d.getLength()<b&&(b=d.getLength());}),b},this.findPointsCloseTo=function(a,b){var d=new PointSet;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<=b&&d.push(c);}),d},this.toArray=function(){return c},this.toFloat64Array=function(){for(var a=new Float64Array(2*c.length),b=0;b<c.length;b++)a[0+2*b]=c[b].getX(),a[1+2*b]=c[b].getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=2)c.push(new Point(a[b],a[b+1]));};this.count=function(){return c.length},a&&Array.isArray(a)?a.forEach(b.push):a&&\"[object Float64Array]\"===Object.prototype.toString.call(a)&&d(a);}\n\n  function Rectangle(a,b,c,d){this.__left=a,this.__top=b,this.__right=c,this.__bottom=d;}Rectangle.prototype.getLeft=function(){return this.__left},Rectangle.prototype.getTop=function(){return this.__top},Rectangle.prototype.getRight=function(){return this.__right},Rectangle.prototype.getBottom=function(){return this.__bottom},Rectangle.prototype.getWidth=function(){return this.__right-this.__left},Rectangle.prototype.getHeight=function(){return this.__bottom-this.__top},Rectangle.prototype.getPoints=function(){return [new Point(this.__left,this.__top),new Point(this.__right,this.__top),new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)]},Rectangle.prototype.getLines=function(){return [new Line(new Point(this.__left,this.__top),new Point(this.__right,this.__top)),new Line(new Point(this.__right,this.__top),new Point(this.__right,this.__bottom)),new Line(new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)),new Line(new Point(this.__left,this.__bottom),new Point(this.__left,this.__top))]},Rectangle.prototype.getUniformlyResizedCopy=function(a){return new Rectangle(this.__left-a,this.__top-a,this.__right+a,this.__bottom+a)},Rectangle.prototype.getPointsScaledToGrid=function(a){var b=new Point(this.__left+.5*(this.__right-this.__left),this.__top+.5*(this.__bottom-this.__top)),c=(this.__right-b.getX()+a)/(this.__right-b.getX()),d=(this.__bottom-b.getY()+a)/(this.__bottom-b.getY()),e=[new Point((this.__left-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY()),new Point((this.__left-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY())];return e},Rectangle.prototype.checkIntersect=function(a){return !(this.__bottom<a.getTop())&&!(this.__top>a.getBottom())&&!(this.__right<a.getLeft())&&!(this.__left>a.getRight())},Rectangle.prototype.checkIsPointWithin=function(a){return !!(a.getX()>=this.__left&&a.getX()<=this.__right&&a.getY()>=this.__top&&a.getY()<=this.__bottom)},Rectangle.prototype.checkIsWithin=function(a){return !!(this.__bottom<=a.getBottom()&&this.__top>=a.getTop()&&this.__right<=a.getRight()&&this.__left>=a.getLeft())};\n\n  var AccessibleRoutingPointsFinder={find:function find(a,b,c){var d=new Map,e=[],f=new PointSet;return a.forEach(function(a){var b=a.connectorAnchors;b.forEach(function(a){{var c=new PointSet(a.routingPointsFloat64Arr).toArray();c.forEach(function(b){e.push({routingPoint:b,parentAnchorId:a.id});}),d.set(a.id,c.length);}});}),e.forEach(function(a){for(var c=!1,e=0;e<b.length;e++){var g=b[e],h=new Rectangle(g.x,g.y,g.x+g.width,g.y+g.height);if(h.checkIsPointWithin(a.routingPoint)){c=!0;var j=d.get(a.parentAnchorId)||0;d.set(a.parentAnchorId,Math.max(0,j-1));}}c||f.push(a.routingPoint);}),{connectorAnchorToNumValidRoutingPoints:d,accessibleRoutingPoints:f}}};\n\n  function LineSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.toArray=function(){return c},this.count=function(){return c.length},this.toFloat64Array=function(){for(var a=new Float64Array(4*c.length),b=0;b<c.length;b++)a[0+4*b]=c[b].getStartPoint().getX(),a[1+4*b]=c[b].getStartPoint().getY(),a[2+4*b]=c[b].getEndPoint().getX(),a[3+4*b]=c[b].getEndPoint().getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=4)c.push(new Line(new Point(a[b],a[b+1]),new Point(a[b+2],a[b+3])));};a&&Array.isArray(a)?a.forEach(b.push):a&&\"[object Float64Array]\"===Object.prototype.toString.call(a)&&d(a);}\n\n  var PointVisibilityMapRouteOptimizer={optimize:function optimize(a,b){for(var c=0,d=a.length-1;!(1>=d-c&&(c++,d=a.length-1,c>=a.length-2));)b(a[c],a[d])?(a.splice(c+1,d-c-1),d=a.length-1):d--;}};\n\n  function Vec2(a,b){this.__x=a,this.__y=b;}Vec2.prototype=Object.create(Point.prototype,{}),Vec2.prototype.normalize=function(){var a=Math.sqrt(this.__x*this.__x+this.__y*this.__y);return 0===a?this:(this.__x/=a,this.__y/=a,this)},Vec2.prototype.dot=function(a){return this.__x*a.getX()+this.__y*a.getY()};\n\n  var ConnectorRoutingAlgorithm=Object.freeze({STRAIGHT_LINE:0,STRAIGHT_LINE_BETWEEN_ANCHORS:1,STRAIGHT_LINE_BETWEEN_ANCHORS_AVOID_SELF_INTERSECTION:2,ASTAR:3,ASTAR_WITH_ROUTE_OPTIMIZATION:4,ASTAR_THETA_WITH_ROUTE_OPTIMIZATION:5});\n\n  var EntityDescriptorParser={extractBoundaryLines:function extractBoundaryLines(a){var b=new LineSet;if(a.isRoutingAroundBoundingRectAllowed){var c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});}var e=a.connectorAnchors;return e.forEach(function(a){var c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});}),b}};\n\n  var PointInfo={point:null,visiblePoints:null};function PointVisibilityMap(){var a=this,b=new Map,c=new Map,d=new Map,e=0,f=0,g=function doesLineIntersectAnyBoundaryLines(a){var b,e=_createForOfIteratorHelper(c);try{for(e.s();!(b=e.n()).done;){var f=_slicedToArray(b.value,2),g=f[0],h=f[1],j=d.get(g);if(!(a.getMinX()>j.outerBoundingRect.maxX)&&!(a.getMaxX()<j.outerBoundingRect.minX)&&!(a.getMinY()>j.outerBoundingRect.maxY)&&!(a.getMaxY()<j.outerBoundingRect.minY))for(var k,l=h.toArray(),m=0;m<l.length;m++)if(k=l[m].computeIntersectionType(a),k===LINE_INTERSECTION_TYPE.LINESEG)return !0}}catch(a){e.e(a);}finally{e.f();}return !1},h=function computePointsVisibilityForPoint(a){a.visiblePoints.points.length=0;var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),h=f[0],i=f[1],j=_createForOfIteratorHelper(i);try{for(j.s();!(e=j.n()).done;){var k=_slicedToArray(e.value,2),l=k[0],m=k[1],n=new Line(a.point,l);0<n.getLength()&&!g(n)&&a.visiblePoints.points.push(l);}}catch(a){j.e(a);}finally{j.f();}}}catch(a){d.e(a);}finally{d.f();}a.visiblePoints.isValid=!0;},i=function arePointsVisibleToEachOther(a,b){for(var c=n(a),d=j(c),e=0;e<d.length;e++)if(d[e].isEqual(b))return !0;return !1},j=function getVisiblePointsRelativeTo(a){return a.visiblePoints.isValid||h(a),a.visiblePoints.points},k=function isPointInArray(a,b){for(var c=0;c<b.length;c++)if(a.isEqual(b[c]))return !0;return !1},l=function routeToEndpoint(a,b,c,d,e,f,g){for(var h,l=c.point,m=j(c),n=Number.MAX_SAFE_INTEGER,o=null,p=new Vec2(e.getX()-l.getX(),e.getY()-l.getY()).normalize(),q=0;q<m.length;q++)if(h=m[q],!k(h,b)){var r=new Line(l,h).getLength(),s=r+a,t=new Line(h,e).getLength(),u=0;if(g===ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION){var v=new Vec2(h.getX()-l.getX(),h.getY()-l.getY()).normalize();u=p.dot(v)*r,e.getX()>l.getX()&&h.getX()>e.getX()&&(u=0),e.getX()<l.getX()&&h.getX()<e.getX()&&(u=0),e.getY()>l.getY()&&h.getY()>e.getY()&&(u=0),e.getY()<l.getY()&&h.getY()<e.getY()&&(u=0);}s+t-u<n&&(n=s+t-u,o=h);}return n===Number.MAX_SAFE_INTEGER?null:{cost:n,point:o}},m=function hasEntityMutated(a,b){return !(a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height)},n=function fetchPointInfoForPoint(a){var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),g=f[0],h=f[1],i=_createForOfIteratorHelper(h);try{for(i.s();!(e=i.n()).done;){var j=_slicedToArray(e.value,2),k=j[0],l=j[1];if(k===a)return o(k,l)}}catch(a){i.e(a);}finally{i.f();}}}catch(a){d.e(a);}finally{d.f();}return null},o=function buildPointInfo(a,b){var c=Object.create(PointInfo);return c.point=a,c.visiblePoints=b,c},p=function buildEmptyRoutingPointToVisibleSetMap(a,b,c,d){for(var e=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),f=AccessibleRoutingPointsFinder.find([a],b,c),g=f.accessibleRoutingPoints.toArray(),h=new Map,i=0;i<g.length;i++)h.set(g[i],{isValid:!1,points:[]});var k=e.getPointsScaledToGrid(c*d);return k.forEach(function(a){h.set(a,{isValid:!1,points:[]});}),h},r=function doesRoutingAlgorithmRequireOptimization(a){return !(a!==ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION&&a!==ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION)};this.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors=function(a,g,h){\"undefined\"==typeof h&&(h=1),e=0,f=0;for(var j,k=[],l=[],n=[],o=0;o<a.length;o++){j=a[o].id,k.push(j);var q=c.get(j),r=d.get(j);if(q&&!m(r,a[o])){f+=q.count();continue}var z=EntityDescriptorParser.extractBoundaryLines(a[o]);c.set(j,z),f+=z.count();}for(var A=0;A<a.length;A++){var s=a[A].id,t=d.get(s);!t||m(t,a[A]);var B=p(a[A],a,g,h);b.set(s,B),d.set(s,a[A]),l.push(s),e+=B.size;}var u,v=_createForOfIteratorHelper(d);try{for(v.s();!(u=v.n()).done;){var w=_slicedToArray(u.value,2),x=w[0],y=w[1];k.includes(x)||(l.push(x),n.push(x));}}catch(a){v.e(a);}finally{v.f();}return n.forEach(function(a){d.delete(a),c.delete(a),b.delete(a);}),l.length},this.getCurrentNumRoutingPoints=function(){return e},this.getCurrentNumBoundaryLines=function(){return f},this.findVisiblePointInfoClosestTo=function(a){var c,d=null,e=Number.MAX_SAFE_INTEGER,f=_createForOfIteratorHelper(b);try{for(f.s();!(c=f.n()).done;){var h,i=_slicedToArray(c.value,2),j=i[0],k=i[1],l=_createForOfIteratorHelper(k);try{for(l.s();!(h=l.n()).done;){var m=_slicedToArray(h.value,2),n=m[0],p=m[1],q=new Line(a,n),r=q.getLength();r<e&&!g(q)&&(d=o(n,p),e=r);;}}catch(a){l.e(a);}finally{l.f();}}}catch(a){f.e(a);}finally{f.f();}return d},this.computeRoute=function(b,c,d){if(null===b||null===c)return new PointSet;var e=a.findVisiblePointInfoClosestTo(b);if(null===e)return new PointSet;for(var f,h=new Vec2(c.getX()-b.getX(),c.getY()-b.getY()).normalize(),j=[e.point],k=0,m=e;!0;){if(f=l(k,j,m,b,c,h,d),null===f){var o=new Line(j[j.length-1],c);if(g(o))return new PointSet;break}if(k+=new Line(m.point,f.point).getLength(),j.push(f.point),m=n(f.point),1>new Line(m.point,c).getLength())break}return r(d)&&PointVisibilityMapRouteOptimizer.optimize(j,i),new PointSet(j)};}\n\n  var SvgPathBuilder={pointToLineTo:function pointToLineTo(a,b){return 0===b?\"M\"+a.getX()+\" \"+a.getY():\"L\"+a.getX()+\" \"+a.getY()},pointTripletToTesselatedCurvePoints:function pointTripletToTesselatedCurvePoints(a,b){if(3!==a.length)throw new Error(\"_points must be array of exactly 3 points\");var c=a[1],d=new Line(a[0],a[1]),e=new Line(a[1],a[2]),f=d.createShortenedLine(0,.5*b),g=e.createShortenedLine(.5*b,0);return [f.getStartPoint(),f.getEndPoint(),g.getStartPoint(),g.getEndPoint()]},pointsToPath:function pointsToPath(a,b){b=b||0;var c=[],d=0;if(0<b){for(;3<=a.length;){var e=a.shift(),f=a.shift(),g=a.shift(),h=SvgPathBuilder.pointTripletToTesselatedCurvePoints([e,f,g],b);a.unshift(h[3]),a.unshift(h[2]);for(var k=0;k<h.length-2;k++)c.push(SvgPathBuilder.pointToLineTo(h[k],d++));}for(;0<a.length;){var j=a.shift();c.push(SvgPathBuilder.pointToLineTo(j,d++));}}else for(var l,m=0;m<a.length;m++)l=a[m],c.push(SvgPathBuilder.pointToLineTo(l,m));return c.join(\" \")}};\n\n  var workerData={pointVisibilityMap:new PointVisibilityMap,requestQueue:[]},computeConnectorPath=function computeConnectorPath(a,b,c){var d=Point.fromArray(a.anchor_start_centroid_arr),e=Point.fromArray(a.anchor_end_centroid_arr),f=a.marker_start_size,g=a.marker_end_size,h=a.curvature_px,i=a.routing_algorithm,j=b.findDistanceToPointClosestTo(d),k=b.findDistanceToPointClosestTo(e),l=b.findPointsCloseTo(d,j).findPointClosestTo(e),m=b.findPointsCloseTo(e,k).findPointClosestTo(d),n=new PointSet;if(i==ConnectorRoutingAlgorithm.STRAIGHT_LINE_BETWEEN_ANCHORS)n=new PointSet([l,m]);else if(i===ConnectorRoutingAlgorithm.ASTAR||i===ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION||i===ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION)n=c.computeRoute(l,m,i);else throw \"Invalid routing algorithm\";var o=n.toArray(),p=d,q=e;if(0<f&&1<=o.length){var s=new Line(o[0],d).createShortenedLine(0,f);p=s.getEndPoint();}if(0<g&&1<=o.length){var t=new Line(o[o.length-1],e).createShortenedLine(0,g);q=t.getEndPoint();}var r=[p].concat(_toConsumableArray(o),[q]);return {svgPath:SvgPathBuilder.pointsToPath(r,h),pointsInPath:r}},getConnectorRoutingPointsAroundAnchor=function getConnectorRoutingPointsAroundAnchor(a,b){var c=AccessibleRoutingPointsFinder.find(a,a,b);return c.accessibleRoutingPoints},processRequestQueue=function processRequestQueue(){if(0!==workerData.requestQueue.length){var a=workerData.requestQueue.pop();workerData.requestQueue.length=0;var b={overallTime:null},c=new Date,d=a.gridSize,e=a.connectorDescriptors,f=a.entityDescriptors,g=a.boundingExtentRoutingPointScaleFactor,h=new Date,i=getConnectorRoutingPointsAroundAnchor(f,d);b.msgDecodeTime=new Date-h;var j=new Date;workerData.pointVisibilityMap.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors(f,d,g),b.pointVisibilityMapCreationTime=new Date-j;var k=new Date;e.forEach(function(a){var b=computeConnectorPath(a,i,workerData.pointVisibilityMap),c=new PointSet(b.pointsInPath);a.svgPath=b.svgPath,a.pointsInPath=c.toFloat64Array().buffer;}),b.allPathsComputationTime=new Date-k,b.numRoutingPoints=workerData.pointVisibilityMap.getCurrentNumRoutingPoints(),b.numBoundaryLines=workerData.pointVisibilityMap.getCurrentNumBoundaryLines(),b.overallTime=new Date-c,postMessage({connectorDescriptors:e,metrics:b});}};setInterval(processRequestQueue,6),onmessage=function onmessage(a){workerData.requestQueue.push(a.data);};\n\n}());\n";

    function DescriptorCollection(a){var b=this,c=[];this.getId=function(){return a},this.getDescriptorIndex=function(a){return b.getDescriptorIndexById(a.id)},this.getDescriptorIndexById=function(a){for(var b=0;b<c.length;b++)if(c[b].id===a)return b;return null},this.addDescriptor=function(a){return !(null!==b.getDescriptorIndex(a))&&(c.push(a),!0)},this.getDescriptors=function(){return c},this.getIds=function(){var a=[];return c.forEach(function(b){a.push(b.id);}),a},this.removeById=function(a){var d=b.getDescriptorIndexById(a);return null!==d&&(c.splice(d,1),!0)},this.removeAll=function(){c.length=0;};}

    function Cluster(a){var b=new DescriptorCollection(a);this.getId=function(){return a},this.getEntityIndex=function(a){return b.getDescriptorIndex(a)},this.getEntityIndexById=function(a){return b.getDescriptorIndexById(a)},this.addEntity=function(a){return b.addDescriptor(a)},this.getEntities=function(){return b.getDescriptors()},this.getEntityIds=function(){return b.getIds()},this.removeEntityById=function(a){return b.removeById(a)},this.removeAllEntities=function(){return b.removeAll()},this.hasEntities=function(a){for(var c=!0,d=0;d<a.length;d++)if(null===b.getDescriptorIndexById(a[d])){c=!1;break}return c},this.toJSON=function(){return {id:a,entities:b.getDescriptors()}};}Cluster.fromJSON=function(a){var b=new Cluster(a.id);return a.entities.forEach(function(a){b.addEntity(a);}),b};

    var Originator=Object.freeze({PROGRAM:0,USER:1,PROGRAM_VIA_PARENT_ENTITY:2,USER_VIA_PARENT_ENTITY:3});

    function DragContext(a,b,c){var d=0,e=0,f=new Point(b.getX()-c.getX(),b.getY()-c.getY());this.getEntity=function(){return a},this.getPointerDragStartPosition=function(){return b},this.getEntityDragStartPosition=function(){return c},this.setCurrentDragPosition=function(a,b){d=a,e=b;},this.getCurrentDragPosition=function(){return new Point(d,e)},this.getPointerOffsetFromEntityPosition=function(){return f};}

    function ResizeContext(a,b){this.getEntity=function(){return a},this.getResizeCursor=function(){return b};}

    function Sheet(a,b){var c=this,d=b.document.createElementNS("http://www.w3.org/2000/svg","svg");d.style.width="100%",d.style.height="100%";var e=a.appendChild(d),f=null,g=null,h="transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out",i=0,j=0,k=0,l=0,m=0,n=0,o=1,p=1,q=1,r=[],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=6.94,w=[],x=[],y=null,z=null,A=null,B=new DebugMetricsPanel(b),C={connectorRoutingWorker:{executionTime:null,numRoutingPoints:null,numBoundaryLines:null,msgDecodeTime:null,pointVisibilityMapCreationTime:null,allPathsComputationTime:null},clusterDetectionWorker:{computeClustersTime:null},refreshAllConnectorsInternal:{executionTime:null},findBestConnectorAnchorsToConnectEntities:{batchSize:null,searchFuncExecutionTime:null},connectorsRefreshTime:null},D=750,E=null,F=0,G=0,H=0,I=0,J=!1,K=[],L=!1,M=null,N=null,O=null,P=null,Q=new Map,R=null,S=null,T=!1,U=new BestToConnectEntitiesFinder,V=null,W=URL.createObjectURL(new Blob([ClusterDetectionWorkerJsString])),X=null;this.initClusterDetectionWorker=function(){X=new Worker(W),X.onmessage=function(a){var b=a.data;b.newClusterIds.forEach(function(a){oa(SheetEvent.CLUSTER_CREATED,{cluster:Cluster.fromJSON(b.clusters.get(a))});}),b.updatedClusterIds.forEach(function(a){var c={cluster:Cluster.fromJSON(b.clusters.get(a)),entitiesAdded:b.updatedClusterToAddedEntitites.get(a),entitiesRemoved:b.updatedClusterToRemovedEntitites.get(a)};oa(SheetEvent.CLUSTER_UPDATED,c);}),b.deletedClusterIds.forEach(function(a){oa(SheetEvent.CLUSTER_DELETED,{clusterId:a});});var c,d=_createForOfIteratorHelper(b.overlappingEntities);try{for(d.s();!(c=d.n()).done;){var e=_slicedToArray(c.value,2),f=e[0],g=e[1];oa(SheetEvent.ENTITY_OVERLAP_DETECTED,{entityId:f,overlappingEntityIds:g});}}catch(a){d.e(a);}finally{d.f();}C.clusterDetectionWorker.computeClustersTime=b.metrics.computeClustersTime,V=null;};},this.overwriteClusterDetectorKnownClusters=function(a){var b=[];a.forEach(function(a){b.push(a.toJSON());}),V=b;},this.updateClusterDetectorKnownCluster=function(a){null===V&&(V=[]);for(var b=!1,c=0;c<V.length;c++)if(V[c].id===a.getId()){b=!0,V[c]=a.toJSON();break}b||V.push(a.toJSON());},this.deleteClusterDetectorKnownCluster=function(a){if(null===V)return !1;for(var b=!1,c=0;c<V.length;c++)if(V[c].id===a.getId()){b=!0,V.splice(c,1);break}return b};var Y=URL.createObjectURL(new Blob([ConnectorRoutingWorkerJsString])),Z=null;this.initConnectorRoutingWorker=function(){Z=new Worker(Y),Z.onmessage=function(a){var b=new Date,c=a.data.connectorDescriptors,d=[],e=function getConnectorDescriptorById(a){for(var b=0;b<c.length;b++)if(c[b].id===a)return c[b];return null},f=function renderInternal(){d.forEach(function(a){a();}),T=!1;};x.forEach(function(a){var b=e(a.getId());if(b){var c=new PointSet(new Float64Array(b.pointsInPath));a.updatePathPoints(c.toArray()),d.push(function(){a.refresh(b.svgPath);}),oa(SheetEvent.CONNECTOR_UPDATED,{connector:a});}}),T&&cancelAnimationFrame(f),T=!0,requestAnimationFrame(f),C.connectorsRefreshTime=new Date-b,C.connectorRoutingWorker.executionTime=a.data.metrics.overallTime,C.connectorRoutingWorker.numBoundaryLines=a.data.metrics.numBoundaryLines,C.connectorRoutingWorker.numRoutingPoints=a.data.metrics.numRoutingPoints,C.connectorRoutingWorker.msgDecodeTime=a.data.metrics.msgDecodeTime,C.connectorRoutingWorker.pointVisibilityMapCreationTime=a.data.metrics.pointVisibilityMapCreationTime,C.connectorRoutingWorker.allPathsComputationTime=a.data.metrics.allPathsComputationTime,B.refresh(C);};},this.setGrid=function(c){g=c,a.style.backgroundImage="url('data:image/svg+xml;base64,"+b.btoa(g.getSvgImageTile())+"')",a.style.backgroundRepeat="repeat",a.style.backgroundColor="#fff";},this.getGrid=function(){return g},this.getGridSize=function(){return g.getSize()},this.setBoundingExtentRoutingPointScaleFactor=function(a){q=a;};var $=function lockDomMetrics(){M=a.offsetLeft,N=a.offsetTop,O=b.pageXOffset,P=b.pageYOffset,L=!0;},_=function unlockDomMetrics(){L=!1;};this.hasDomMetricsLock=function(){return L};var aa=function refreshAllClustersInternal(){if(null!==X){$();var a=c.getGridSize(),b=[];w.filter(function(a){return a.isAllowedWithinCluster()}).forEach(function(c){b.push(c.getDescriptor(a));});var d={gridSize:a,entityDescriptors:b,knownClustersOverwrite:V};X.postMessage(d,[]),_();}},ba=function refreshAllConnectorsInternal(){if(null!==Z){$();var a=new Date,b=[];x.forEach(function(a){b.push(a.getDescriptor());});var d=[];w.forEach(function(a){d.push(a.getDescriptor(c.getGridSize()));}),Z.postMessage({gridSize:c.getGridSize(),connectorDescriptors:b,entityDescriptors:d,boundingExtentRoutingPointScaleFactor:q},[]),C.refreshAllConnectorsInternal.executionTime=new Date-a,_();}};this.setConnectorRefreshBufferTime=function(a){u=a;},this.refreshAllConnectors=function(){if(null!==R){var a=new Date-R;if(a<u)return}R=new Date,S=setTimeout(function(){S=null,R=null,ba();},u);};var ca=function makeNewConnector(a,b,c){return new Connector(a,b,c)};this.setConnectorFactory=function(a){ca=a;},this.getTransitionCss=function(){return h},this.setTransitionCss=function(b){h=b,a.style.transition=h;},this.getTransformOriginX=function(){return i},this.getTransformOriginY=function(){return j},this.getScaleFactor=function(){return o},this.getTranslateX=function(){return m},this.getTranslateY=function(){return n},this.setTransformOrigin=function(b,c){i=b,j=c,a.style.transformOrigin=`${i}px ${j}px`;},this.scale=function(a,b){if(b=b||!1,b){var d=c.getGridSize()*a,e=Math.round(d);a=e/c.getGridSize();}o=a,p=1/o;var f=[o,0,0,0,0,o,0,0,0,0,o,1,0,0,0,1];return t=MatrixMath.mat4Multiply(t,f),r.push([p,0,0,0,0,p,0,0,0,0,p,1,0,0,0,1]),c},this.translate=function(a,b){m=a,n=b;var d=[1,0,0,0,0,1,0,0,0,0,1,0,m,n,0,1];return t=MatrixMath.mat4Multiply(t,d),r.push([1,0,0,-m,0,1,0,-n,0,0,1,0,0,0,0,1]),c},this.applyTransform=function(){a.style.transform=c.getTransformMatrixCss(),s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(var b=0;b<r.length;b++)s=MatrixMath.mat4Multiply(s,r[b]);},this.getTransformMatrix=function(){return t},this.getTransformMatrixCss=function(){var a=t.join(",");return `matrix3d(${a})`},this.transformDomRectToPageSpaceRect=function(a){var b=c.getPageOffset(),d=c.getSheetOffset(),e=a.left-d.getX()+b.getX(),f=a.top-d.getY()+b.getY(),g=a.right-d.getX()+b.getX(),h=a.bottom-d.getY()+b.getY(),i=MatrixMath.vecMat4Multiply([e,f,0,1],s),j=MatrixMath.vecMat4Multiply([g,h,0,1],s);return new Rectangle(i[0]+d.getX(),i[1]+d.getY(),j[0]+d.getX(),j[1]+d.getY())},this.resetTransform=function(){o=1,p=1,m=0,n=0,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.length=0,a.style.transform="none";},this.getPageOffset=function(){return c.hasDomMetricsLock()?new Point(O,P):new Point(b.pageXOffset,b.pageYOffset)},this.transformPointFromPageSpaceToSheetSpace=function(a){var b=c.getSheetOffset(),d=MatrixMath.vecMat4Multiply([a.getX()-b.getX(),a.getY()-b.getY(),0,1],s);return new Point(d[0],d[1])},this.snapToGrid=function(a){var b=Math.round(a/c.getGridSize())*c.getGridSize();return Math.max(0,b-1)},this.getSheetOffset=function(){return c.hasDomMetricsLock()?new Point(M,N):new Point(a.offsetLeft,a.offsetTop)},this.getOffsetLeft=function(){return a.offsetLeft},this.getOffsetTop=function(){return a.offsetTop},this.getWidth=function(){return a.offsetWidth},this.getHeight=function(){return a.offsetHeight},this.resize=function(b,c){a.style.width=`${b}px`,a.style.height=`${c}px`;},this.calcBoundingRectForEntities=function(a){var b=null,c=null,d=null,e=null;return a.forEach(function(a,f,g){var h=a.getBoundingRectange(),i=h.getLeft(),j=h.getTop(),k=h.getRight(),l=h.getBottom();(null===c||i<c)&&(c=i),(null===b||j<b)&&(b=j),(null===d||l>d)&&(d=l),(null===e||k>e)&&(e=k);}),(null===b||null===c||null===d||null===e)&&(b=0,c=0,d=0,e=0),new Rectangle(c,b,e,d)},this.calcBoundingBox=function(){return 0===w.length?new Rectangle(0,0,c.getWidth(),c.getHeight()):c.calcBoundingRectForEntities(w)},this.getEntitiesAroundPoint=function(a,b,c){c=c||1;var d=[],e=new Rectangle(a-c,b-c,a+c,b+c);return w.forEach(function(a){e.checkIntersect(a.getBoundingRectange())&&d.push(a);}),d},this.getEntitiesWithinRect=function(a){var b=[];return w.forEach(function(c){c.getBoundingRectange().checkIsWithin(a)&&b.push(c);}),b},this.getAllEntities=function(){return w},this.publishSiblingObjectChange=function(a,b){w.forEach(function(c){c.handleSiblingObjectChange(a,b);});},this.getEntityById=function(a){var b=null;return w.forEach(function(c,d,e){null===b&&c.getId()===a&&(b=c);}),b},this.addEntity=function(a){a.on(EntityEvent.RESIZE_START,ha),a.on(EntityEvent.RESIZE,function(a){oa(SheetEvent.ENTITY_RESIZED,{entity:a.obj,originator:a.originator}),c.refreshAllConnectors(),aa();}),a.on(EntityEvent.TRANSLATE_START,ea),a.on(EntityEvent.TRANSLATE,function(a){oa(SheetEvent.ENTITY_TRANSLATED,{object:a.obj,withinGroupTransformation:a.withinGroupTransformation,originator:a.originator}),a.withinGroupTransformation||(c.refreshAllConnectors(),aa());}),w.push(a),c.refreshAllConnectors(),aa(),oa(SheetEvent.ENTITY_ADDED,{object:a});},this.removeEntity=function(a){for(var b=0;b<w.length;b++)if(w[b].getId()===a)return w.splice(b,1),c.refreshAllConnectors(),aa(),oa(SheetEvent.ENTITY_REMOVED,{object:w[b]}),!0;return !1},this.getConnector=function(a){for(var b=0;b<x.length;b++)if(x[b].getId()===a)return x[b];return null},this.getAllConnectors=function(){return x},this.getConnectorsBetweenEntities=function(a,b){var c=[];return x.forEach(function(d){var e=d.getAnchorStart(),f=d.getAnchorEnd();a.hasConnectorAnchor(e)&&b.hasConnectorAnchor(f)&&c.push(d),a.hasConnectorAnchor(f)&&b.hasConnectorAnchor(e)&&c.push(d);}),c},this.getConnectorsBetweenAnchors=function(a,b){var c=[];return x.forEach(function(d){var e=d.getAnchorStart(),f=d.getAnchorEnd();e===a&&f===b&&c.push(d),e===b&&f===a&&c.push(d);}),c},this.getConnectorsInEntitySet=function(a){for(var b=[],d=0;d<a.length;d++)for(var e,f=d+1;f<a.length;f++)e=c.getConnectorsBetweenEntities(a[d],a[f]),b.push.apply(b,_toConsumableArray(e));return b},this.getEntitiesConnectedViaConnector=function(a){var b=[],d=c.getAllEntities();return x.forEach(function(c){if(c.getId()===a){var e=c.getAnchorStart(),f=c.getAnchorEnd();d.forEach(function(a){(a.hasConnectorAnchor(e)||a.hasConnectorAnchor(f))&&b.push(a);});}}),b},this.getConnectorsConnectedToEntity=function(a){var b=[];return x.forEach(function(c){var d=c.getAnchorStart(),e=c.getAnchorEnd();(a.hasConnectorAnchor(d)||a.hasConnectorAnchor(e))&&b.push(c);}),b},this.getEntityWithConnectorAnchor=function(a){for(var b,d=c.getAllEntities(),e=0;e<d.length;e++){b=d[e].getConnectorAnchors();for(var f=0;f<b.length;f++)if(b[f].getId()===a)return d[e]}return null},this.removeAllConnectors=function(){x.forEach(function(a){a.removePathElement();}),x.splice(0,x.length);},this.removeConnector=function(a){for(var b=0;b<x.length;b++)if(x[b]===a)return a.removePathElement(),x.splice(b,1),!0;return !1},this.makeNewConnectorFromAnchors=function(a,b){var d=ca(a,b,e),f=c.getConnector(d.getId());return null===f?(x.push(d),d.appendPathToContainerDomElement(),c.refreshAllConnectors(),d):f},this.findBestConnectorAnchorsToConnectEntities=function(a,b,d){U.findBest(a,b,d,w,c.getGridSize()),C.findBestConnectorAnchorsToConnectEntities.batchSize=U.getSearchFuncBatchSize(),C.findBestConnectorAnchorsToConnectEntities.searchFuncExecutionTime=U.getSearchFuncExecutionTime();},this.addConnectionAnchorToSelectionStack=function(a){K.push(a),2===K.length&&(c.makeNewConnectorFromAnchors(K[0],K[1]),K.length=0);};var da=function dblClickTapHandler(a,b){var d=c.getEntitiesAroundPoint(a,b),e={targetPoint:new Point(a,b),objectsAroundPoint:d,entitiesAroundPoint:d};oa(SheetEvent.DBLCLICK,e);};this.initDebugMetricsPanel=function(){B.init(),B.show();},this.initInteractionHandlers=function(b,d){A=new DoubleTapDetector(b,d),a.addEventListener("dblclick",function(a){var b=MatrixMath.vecMat4Multiply([a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop(),0,1],s);da(b[0],b[1]);}),a.addEventListener("click",function(b){var d=!1;b.target!==a&&(d=!0);var e=MatrixMath.vecMat4Multiply([b.pageX-c.getOffsetLeft(),b.pageY-c.getOffsetTop(),0,1],s),f={targetPoint:new Point(e[0],e[1]),entityClicked:d,canvasObjectClicked:d};oa(SheetEvent.CLICK,f);}),a.addEventListener("touchend",function(a){var b=A.processTap(a,new Point(c.getOffsetLeft(),c.getOffsetTop()),s);b.doubleTapDetected&&da(b.touchX,b.touchY);});};var ea=function handleMoveStart(a){var b=c.transformPointFromPageSpaceToSheetSpace(new Point(a.x,a.y)),d=new Point(a.obj.getX(),a.obj.getY());z=new DragContext(a.obj,b,d),z.setCurrentDragPosition(b.getX(),b.getY());},fa=function handleMove(a,b){var d=z.getEntity(),e=d.getTranslateHandleOffset();if(d.getTranslationMode()===EntityTranslationMode.FROM_HANDLE_CENTER){var f=c.snapToGrid(a+e.getX()),g=c.snapToGrid(b+e.getY());d.translate(f,g,!1,Originator.USER),z.setCurrentDragPosition(f,g);}else if(d.getTranslationMode()===EntityTranslationMode.FROM_HANDLE_SELECTION_START){var h=z.getPointerDragStartPosition(),i=a-h.getX(),j=b-h.getY(),k=z.getPointerOffsetFromEntityPosition();d.translate(c.snapToGrid(h.getX()+i-k.getX()),c.snapToGrid(h.getY()+j-k.getY()),!1,Originator.USER),z.setCurrentDragPosition(a,b);}else throw "Invalid Entity translation mode"},ga=function handleMoveEnd(a,b){var d=z.getEntity();if(d.getTranslationMode()===EntityTranslationMode.FROM_HANDLE_CENTER){var e=d.getTranslateHandleOffset(),f=c.snapToGrid(a+e.getX()),g=c.snapToGrid(b+e.getY());d.translate(f,g,!1,Originator.USER);}else if(d.getTranslationMode()===EntityTranslationMode.FROM_HANDLE_SELECTION_START)z=null;else throw "Invalid Entity translation mode"},ha=function handleResizeStart(b){y=new ResizeContext(b.obj,b.resizeCursor),a.style.cursor=y.getResizeCursor();},ia=function handleResize(a,b){var d=y.getEntity(),e=c.snapToGrid(a),f=c.snapToGrid(b),g=d.getY(),h=d.getX(),i=e-h+1,j=f-g+1;d.resize(i,j,Originator.USER);},ja=function handleResizeEnd(){y=null,a.style.cursor="";},ka=function handleMultiEntitySelectionStart(a,b,c){if(J)return !1;if(c!==d)return !1;if(null!==z)return !1;if(null!==y)return !1;var e=MatrixMath.vecMat4Multiply([a,b,0,1],s);return F=e[0],G=e[1],H=e[0],I=e[1],J=!0,f.style.left=`${F}px`,f.style.top=`${G}px`,f.style.width=`0px`,f.style.height=`0px`,f.style.display="block",oa(SheetEvent.MULTIPLE_ENTITY_SELECTION_STARTED,{x:e[0],y:e[1]}),!0},la=function handleMultiEntitySelectionEnd(){J=!1;var a=new Rectangle(Math.min(F,H),Math.min(G,I),Math.max(F,H),Math.max(G,I)),b=c.getEntitiesWithinRect(a).filter(function(a){return a.isAllowedWithinMultiEntitySelection()}),d=c.calcBoundingRectForEntities(b);f.style.left=`${d.getLeft()}px`,f.style.top=`${d.getTop()}px`,f.style.width=`${d.getWidth()}px`,f.style.height=`${d.getHeight()}px`,f.style.display="none",oa(SheetEvent.MULTIPLE_ENTITIES_SELECTED,{selectedObjects:b,selectedEntities:b,boundingRect:d});},ma=function updateSelectionBoxEndPoint(a,b){var c=MatrixMath.vecMat4Multiply([a,b,0,1],s);H=c[0],I=c[1];var d=H-F,e=I-G;0<=d?f.style.width=`${d}px`:(f.style.left=`${c[0]}px`,f.style.width=`${Math.abs(d)}px`),0<=e?f.style.height=`${e}px`:(f.style.top=`${c[1]}px`,f.style.height=`${Math.abs(e)}px`);},na=function createSelectionBoxElement(c){var d=b.document.createElement("div");return d.classList.add("ia-selection-box"),d.style.display="none",d.style.position="absolute",d.style.left="0px",d.style.top="0px","undefined"==typeof c||0===c.length?(d.style.border="1px solid rgb(158, 158, 158)",d.style.background="rgba(153, 153, 153, 0.5)"):c.forEach(function(a){d.classList.add(a);}),a.appendChild(d)};this.initMultiEntitySelectionHandler=function(b){f=na(b);var d=function handleTouchSelectionStart(a){var b=ka(a.touches[0].pageX-c.getOffsetLeft(),a.touches[0].pageY-c.getOffsetTop(),a.target);};a.addEventListener("mousedown",function(a){if(1===a.which){var b=ka(a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop(),a.target);b&&a.preventDefault();}}),a.addEventListener("touchstart",function(a){E=setInterval(function(){d(a);},D);}),a.addEventListener("touchend",function(a){clearInterval(E);}),a.addEventListener("touchmove",function(a){clearInterval(E);});},this.initTransformationHandlers=function(){a.addEventListener("touchstart",function(a){k=a.touches[0].pageX-c.getOffsetLeft(),l=a.touches[0].pageY-c.getOffsetTop();}),a.addEventListener("touchmove",function(a){if(null!==z){var b=MatrixMath.vecMat4Multiply([a.touches[0].pageX-c.getOffsetLeft(),a.touches[0].pageY-c.getOffsetTop(),0,1],s);fa(b[0],b[1]),a.preventDefault();}if(null!==y){var d=MatrixMath.vecMat4Multiply([a.touches[0].pageX-c.getOffsetLeft(),a.touches[0].pageY-c.getOffsetTop(),0,1],s);ia(d[0],d[1]),a.preventDefault();}J&&(ma(a.touches[0].pageX-c.getOffsetLeft(),a.touches[0].pageY-c.getOffsetTop()),a.preventDefault()),k=a.touches[0].pageX-c.getOffsetLeft(),l=a.touches[0].pageY-c.getOffsetTop();}),a.addEventListener("mousemove",function(a){if(null!==z){var b=MatrixMath.vecMat4Multiply([a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop(),0,1],s);fa(b[0],b[1]);}if(null!==y){var d=MatrixMath.vecMat4Multiply([a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop(),0,1],s);ia(d[0],d[1]);}J&&ma(a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop());}),a.addEventListener("touchend",function(a){null!==z&&(z=null),null!==y&&ja(),J&&la();}),a.addEventListener("mouseup",function(a){if(1===a.which){if(null!==z){var b=MatrixMath.vecMat4Multiply([a.pageX-c.getOffsetLeft(),a.pageY-c.getOffsetTop(),0,1],s);ga(b[0],b[1]);}null!==y&&ja(),J&&la(),z=null,y=null;}}),a.addEventListener("mousedown",function(a){(null!==z||null!==y)&&(a.preventDefault(),a.stopPropagation());});};var oa=function emitEvent(a,b){for(var c,d=Q.get(a)||[],e=0;e<d.length;e++)c=d[e],c(b);};this.off=function(a,b){for(var c=Q.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}Q.set(a,c);},this.on=function(a,b){var c=Q.get(a)||[];c.push(b),Q.set(a,c);},c.setGrid(new Grid(12,"#424242",GRID_STYLE.DOT)),c.resetTransform(),c.setTransformOrigin(0,0),c.setTransitionCss(h);}

    function Entity(a,b,c,d,e,f,g,h,i){var j=this,k=1,l=[],m=1e3,n=null,p=new Map,q=null,r=null,s=null,t=null,u=!1,v={},w=!0,z=!0,A=EntityTranslationMode.FROM_HANDLE_CENTER,B=!0;this.addNonInteractableConnectorAnchor=function(b,c,d){var e=new ConnectorAnchor(a+`-${m}`,b,f,c,d);return l.push(e),m++,e},this.addInteractableConnectorAnchor=function(b,c,d){var g=new ConnectorAnchor(a+`-${m}`,b,f,c,d);return b.addEventListener("click",function(a){f.addConnectionAnchorToSelectionStack(g);}),l.push(g),m++,g},this.getConnectorAnchorRoutingPoints=function(){var a=[];return l.forEach(function(b){var c=b.getRoutingPoints();c.forEach(function(b){a.push(b);});}),a},this.getConnectorAnchors=function(){return l},this.hasConnectorAnchor=function(a){for(var b=j.getConnectorAnchors(),c=0;c<b.length;c++)if(b[c]===a)return !0;return !1},this.getTranslateHandleOffset=function(){return n?n===g?new Point(.5*-n.offsetWidth,.5*-n.offsetHeight):new Point(-(n.offsetLeft+.5*n.offsetWidth),-(n.offsetTop+.5*n.offsetHeight)):null},this.getId=function(){return a},this.getX=function(){return q},this.getY=function(){return r},this.getPositionOnPage=function(){var a=g.ownerDocument.defaultView,b=g.getBoundingClientRect();return new Point(b.left+a.scrollX,b.top+a.scrollY)},this.renderImmediate=function(){g.style.left=v.left?v.left:q+"px",g.style.top=v.top?v.top:r+"px",g.style.width=v.width?v.width:s+"px",g.style.height=v.height?v.height:t+"px",u=!1;},this.render=function(){u&&cancelAnimationFrame(j.renderImmediate),u=!0,requestAnimationFrame(j.renderImmediate);},this.overwriteRenderStyle=function(a,b){v[a]=b;},this.setAllowedWithinMultiEntitySelection=function(a){w=a;},this.isAllowedWithinMultiEntitySelection=function(){return w},this.setAllowedWithinCluster=function(a){z=a;},this.isAllowedWithinCluster=function(){return z},this.setTranslationMode=function(a){A=a;},this.getTranslationMode=function(){return A},this.translate=function(a,b,c,d){if(a!==q||b!==r){var e=d?d:Originator.PROGRAM;q=a,r=b,j.render();var f=p.get(EntityEvent.TRANSLATE)||[];f.forEach(function(d){d({obj:j,x:a,y:b,withinGroupTransformation:!!c,originator:e});});}},this.getWidth=function(){return s},this.getHeight=function(){return t},this.resize=function(a,b,c){s=a,t=b,j.render();var d=p.get(EntityEvent.RESIZE)||[];d.forEach(function(d){d({obj:j,width:a,height:b,originator:c?c:Originator.PROGRAM});});},this.getDomElement=function(){return g},this.handleSiblingObjectChange=function(a,b){},this.getBoundingRectange=function(){var a=q,b=r,c=a+s,d=b+t;return new Rectangle(a,b,c,d)},this.getBoundingRectangeInPageSpace=function(){var a=j.getPositionOnPage(),b=a.getX(),c=a.getY(),d=b+s,e=c+t;return new Rectangle(b,c,d,e)},this.computePageToEntitySpaceTransformedRectangle=function(a){var b=j.getBoundingRectangeInPageSpace(),c=new GraphPaper.Rectangle(a.getLeft()-b.getLeft(),a.getTop()-b.getTop(),a.getRight()-b.getRight(),a.getBottom()-b.getBottom());return c},this.getBoundingPoints=function(){var a=new Point(j.getX(),j.getY()),b=new Point(j.getX()+j.getWidth(),j.getY()),c=new Point(j.getX(),j.getY()+j.getWidth()),d=new Point(j.getX()+j.getWidth(),j.getY()+j.getWidth());return [a,b,c,d]},this.setRoutingAroundBoundingRect=function(a){B=a;},this.isRoutingAroundBoundingRectAllowed=function(){return B},this.getDescriptor=function(){for(var a=j.getX(),b=j.getY(),c=j.getX()+j.getWidth(),d=j.getY()+j.getHeight(),e=[],f=0;f<l.length;f++){var g=l[f].getBoundingRectange(),h=new PointSet(l[f].getRoutingPoints());e.push({id:l[f].getId(),x:g.getLeft(),y:g.getTop(),width:g.getWidth(),height:g.getHeight(),routingPointsFloat64Arr:h.toFloat64Array()}),g.getLeft()<a&&(a=g.getLeft()),g.getTop()<b&&(b=g.getTop()),g.getLeft()+g.getWidth()>c&&(c=g.getLeft()+g.getWidth()),g.getTop()+g.getHeight()>d&&(d=g.getTop()+g.getHeight());}return {id:j.getId(),x:j.getX(),y:j.getY(),width:j.getWidth(),height:j.getHeight(),connectorAnchors:e,isRoutingAroundBoundingRectAllowed:j.isRoutingAroundBoundingRectAllowed(),outerBoundingRect:{minX:a,minY:b,maxX:c,maxY:d}}},this.on=function(a,b){var c=p.get(a)||[];c.push(b),p.set(a,c);},this.off=function(a,b){for(var c=p.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}p.set(a,c);},this.suspendTranslateInteractions=function(){E();},this.resumeTranslateInteractions=function(){F();};var C=function translateTouchStartHandler(a){n=a.target;var b=p.get(EntityEvent.TRANSLATE_START)||[];b.forEach(function(b){b({obj:j,x:a.touches[0].pageX,y:a.touches[0].pageY,isTouch:!0,originator:Originator.USER});});},D=function translateMouseDownHandler(a){n=a.target;var b=p.get(EntityEvent.TRANSLATE_START)||[];b.forEach(function(b){b({obj:j,x:a.pageX,y:a.pageY,isTouch:!1,originator:Originator.USER});});},E=function unbindTranslateHandleElements(){h.forEach(function(a){a.removeEventListener("touchstart",C),a.removeEventListener("mousedown",D);});},F=function bindTranslateHandleElements(){h.forEach(function(a){a.addEventListener("touchstart",C),a.addEventListener("mousedown",D);});},G=function resizeMouseDownHandler(a,b,c){if(a.which===k){var d=p.get(EntityEvent.RESIZE_START)||[];d.forEach(function(b){b({obj:j,x:a.pageX,y:a.pageY,resizeCursor:c,isTouch:!1,originator:Originator.USER});});}},H=function resizeTouchStartHandler(a,b,c){var d=p.get(EntityEvent.RESIZE_START)||[];d.forEach(function(b){b({obj:j,x:a.touches[0].pageX,y:a.touches[0].pageY,resizeCursor:c,isTouch:!0,originator:Originator.USER});});},I=function bindResizeHandleElements(){i.forEach(function(a){var b=window.getComputedStyle(a).cursor;a.addEventListener("touchstart",function(c){H(c,a,b);}),a.addEventListener("mousedown",function(c){G(c,a,b);});});};F(),I(),j.translate(b,c,!1,Originator.PROGRAM),j.resize(d,e,Originator.PROGRAM);}

    function BoxClusterDetector(a){var b=this,c=function getEntityIndexFromArray(a,b){for(var c=0;c<b.length;c++)if(b[c].id===a.id)return c;return -1},d=function removeEntitiesFromArray(a,b){for(var d,e=0;e<a.length;e++)d=c(a[e],b),-1!==d&&b.splice(d,1);return b},e=function getClusterWithMostEntitiesFromClusterMap(a){var b=0,c=null;return a.forEach(function(a,d,e){a>b&&(b=a,c=d);}),c},f=function computeDiffBetweenArrays(a,b){var c=[],d=[];return b.forEach(function(b){-1===a.indexOf(b)&&d.push(b);}),a.forEach(function(a){-1===b.indexOf(a)&&c.push(a);}),{onlyInA:c,onlyInB:d}};this.areEntitiesClose=function(b,c){var d=new Rectangle(b.x-a,b.y-a,b.x+b.width+a,b.y+b.height+a),e=new Rectangle(c.x-a,c.y-a,c.x+c.width+a,c.y+c.height+a);return d.checkIntersect(e)},this.getAllEntitiesCloseTo=function(a,c){for(var d=[],e=0;e<c.length;e++)a.id!==c[e].id&&b.areEntitiesClose(a,c[e])&&d.push(c[e]);return d},this.getClusterEntitiesFromSeed=function(a,c,e){var f=b.getAllEntitiesCloseTo(a,c);return 0===f.length?[]:void(d(f.concat([a]),c),f.forEach(function(a){e.push(a),b.getClusterEntitiesFromSeed(a,c,e);}))},this.findIntersectingClustersForEntities=function(a,b){var c=new Map;return b.forEach(function(b){for(var d=b.getEntities(),e=0;e<d.length;e++)for(var f=0;f<a.length;f++)if(d[e].id===a[f].id)if(c.has(b)){var g=c.get(b);c.set(b,g+1);}else c.set(b,1);}),c},this.removeEntityFromClusters=function(a,b){var c=[];return b.forEach(function(b){var d=b.removeEntityById(a.id);d&&c.push(b.getId());}),c},this.mapToClustersWithOldEntitiesRemoved=function(a,b){var c=b.map(function(b){for(var c=b.getEntityIds(),d=0;d<c.length;d++)-1===a.indexOf(c[d])&&b.removeEntityById(c[d]);return b});return c},this.computeClusters=function(a,c,g){for(var h=new Set,i=new Set,j=new Set,k=new Map,l=new Map,m=a.map(function(a){return a}),n=a.map(function(a){return a.id}),o=b.mapToClustersWithOldEntitiesRemoved(n,c),p=function _loop(){var a=m.pop(),c=[a];if(b.getClusterEntitiesFromSeed(a,m,c),1<c.length){var t=b.findIntersectingClustersForEntities(c,o);if(0===t.size){var j=g(),n=new Cluster(j);c.forEach(function(a){n.addEntity(a);}),o.push(n),h.add(j);}else {var p=e(t),q=p.getEntityIds();if(p.removeAllEntities(),c.forEach(function(a){var c=b.removeEntityFromClusters(a,o);c.forEach(function(a){i.add(a);}),p.addEntity(a);}),p.getEntityIds().length===q.length&&p.hasEntities(q));else {i.add(p.getId());var r=p.getEntityIds(),s=f(q,r);l.set(p.getId(),s.onlyInA),k.set(p.getId(),s.onlyInB);}}d(c,m);}else {var u=b.removeEntityFromClusters(a,o);u.forEach(function(b){i.add(b);var c=l.get(b);c?c.push(a.id):l.set(b,[a.id]),"undefined"==typeof k.get(b)&&k.set(b,[]);});}};0<m.length;)p();var q=o.filter(function(a){return !!(2>a.getEntities().length)});q.forEach(function(a){i.delete(a.getId()),k.delete(a.getId()),l.delete(a.getId()),j.add(a.getId());}),h.forEach(function(a){i.delete(a),k.delete(a),l.delete(a);});var r=o.filter(function(a){return !!(2<=a.getEntities().length)});return {clusters:r,newClusterIds:h,updatedClusterIds:i,deletedClusterIds:j,updatedClusterToRemovedEntitites:l,updatedClusterToAddedEntitites:k}};}

    var PointVisibilityMapRouteOptimizer={optimize:function optimize(a,b){for(var c=0,d=a.length-1;!(1>=d-c&&(c++,d=a.length-1,c>=a.length-2));)b(a[c],a[d])?(a.splice(c+1,d-c-1),d=a.length-1):d--;}};

    function Vec2(a,b){this.__x=a,this.__y=b;}Vec2.prototype=Object.create(Point.prototype,{}),Vec2.prototype.normalize=function(){var a=Math.sqrt(this.__x*this.__x+this.__y*this.__y);return 0===a?this:(this.__x/=a,this.__y/=a,this)},Vec2.prototype.dot=function(a){return this.__x*a.getX()+this.__y*a.getY()};

    function LineSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.toArray=function(){return c},this.count=function(){return c.length},this.toFloat64Array=function(){for(var a=new Float64Array(4*c.length),b=0;b<c.length;b++)a[0+4*b]=c[b].getStartPoint().getX(),a[1+4*b]=c[b].getStartPoint().getY(),a[2+4*b]=c[b].getEndPoint().getX(),a[3+4*b]=c[b].getEndPoint().getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=4)c.push(new Line(new Point(a[b],a[b+1]),new Point(a[b+2],a[b+3])));};a&&Array.isArray(a)?a.forEach(b.push):a&&"[object Float64Array]"===Object.prototype.toString.call(a)&&d(a);}

    var EntityDescriptorParser={extractBoundaryLines:function extractBoundaryLines(a){var b=new LineSet;if(a.isRoutingAroundBoundingRectAllowed){var c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});}var e=a.connectorAnchors;return e.forEach(function(a){var c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});}),b}};

    var PointInfo={point:null,visiblePoints:null};function PointVisibilityMap(){var a=this,b=new Map,c=new Map,d=new Map,e=0,f=0,g=function doesLineIntersectAnyBoundaryLines(a){var b,e=_createForOfIteratorHelper(c);try{for(e.s();!(b=e.n()).done;){var f=_slicedToArray(b.value,2),g=f[0],h=f[1],j=d.get(g);if(!(a.getMinX()>j.outerBoundingRect.maxX)&&!(a.getMaxX()<j.outerBoundingRect.minX)&&!(a.getMinY()>j.outerBoundingRect.maxY)&&!(a.getMaxY()<j.outerBoundingRect.minY))for(var k,l=h.toArray(),m=0;m<l.length;m++)if(k=l[m].computeIntersectionType(a),k===LINE_INTERSECTION_TYPE.LINESEG)return !0}}catch(a){e.e(a);}finally{e.f();}return !1},h=function computePointsVisibilityForPoint(a){a.visiblePoints.points.length=0;var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),h=f[0],i=f[1],j=_createForOfIteratorHelper(i);try{for(j.s();!(e=j.n()).done;){var k=_slicedToArray(e.value,2),l=k[0],m=k[1],n=new Line(a.point,l);0<n.getLength()&&!g(n)&&a.visiblePoints.points.push(l);}}catch(a){j.e(a);}finally{j.f();}}}catch(a){d.e(a);}finally{d.f();}a.visiblePoints.isValid=!0;},i=function arePointsVisibleToEachOther(a,b){for(var c=n(a),d=j(c),e=0;e<d.length;e++)if(d[e].isEqual(b))return !0;return !1},j=function getVisiblePointsRelativeTo(a){return a.visiblePoints.isValid||h(a),a.visiblePoints.points},k=function isPointInArray(a,b){for(var c=0;c<b.length;c++)if(a.isEqual(b[c]))return !0;return !1},l=function routeToEndpoint(a,b,c,d,e,f,g){for(var h,l=c.point,m=j(c),n=Number.MAX_SAFE_INTEGER,o=null,p=new Vec2(e.getX()-l.getX(),e.getY()-l.getY()).normalize(),q=0;q<m.length;q++)if(h=m[q],!k(h,b)){var r=new Line(l,h).getLength(),s=r+a,t=new Line(h,e).getLength(),u=0;if(g===ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION){var v=new Vec2(h.getX()-l.getX(),h.getY()-l.getY()).normalize();u=p.dot(v)*r,e.getX()>l.getX()&&h.getX()>e.getX()&&(u=0),e.getX()<l.getX()&&h.getX()<e.getX()&&(u=0),e.getY()>l.getY()&&h.getY()>e.getY()&&(u=0),e.getY()<l.getY()&&h.getY()<e.getY()&&(u=0);}s+t-u<n&&(n=s+t-u,o=h);}return n===Number.MAX_SAFE_INTEGER?null:{cost:n,point:o}},m=function hasEntityMutated(a,b){return !(a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height)},n=function fetchPointInfoForPoint(a){var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),g=f[0],h=f[1],i=_createForOfIteratorHelper(h);try{for(i.s();!(e=i.n()).done;){var j=_slicedToArray(e.value,2),k=j[0],l=j[1];if(k===a)return o(k,l)}}catch(a){i.e(a);}finally{i.f();}}}catch(a){d.e(a);}finally{d.f();}return null},o=function buildPointInfo(a,b){var c=Object.create(PointInfo);return c.point=a,c.visiblePoints=b,c},p=function buildEmptyRoutingPointToVisibleSetMap(a,b,c,d){for(var e=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),f=AccessibleRoutingPointsFinder.find([a],b,c),g=f.accessibleRoutingPoints.toArray(),h=new Map,i=0;i<g.length;i++)h.set(g[i],{isValid:!1,points:[]});var k=e.getPointsScaledToGrid(c*d);return k.forEach(function(a){h.set(a,{isValid:!1,points:[]});}),h},r=function doesRoutingAlgorithmRequireOptimization(a){return !(a!==ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION&&a!==ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION)};this.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors=function(a,g,h){"undefined"==typeof h&&(h=1),e=0,f=0;for(var j,k=[],l=[],n=[],o=0;o<a.length;o++){j=a[o].id,k.push(j);var q=c.get(j),r=d.get(j);if(q&&!m(r,a[o])){f+=q.count();continue}var z=EntityDescriptorParser.extractBoundaryLines(a[o]);c.set(j,z),f+=z.count();}for(var A=0;A<a.length;A++){var s=a[A].id,t=d.get(s);!t||m(t,a[A]);var B=p(a[A],a,g,h);b.set(s,B),d.set(s,a[A]),l.push(s),e+=B.size;}var u,v=_createForOfIteratorHelper(d);try{for(v.s();!(u=v.n()).done;){var w=_slicedToArray(u.value,2),x=w[0],y=w[1];k.includes(x)||(l.push(x),n.push(x));}}catch(a){v.e(a);}finally{v.f();}return n.forEach(function(a){d.delete(a),c.delete(a),b.delete(a);}),l.length},this.getCurrentNumRoutingPoints=function(){return e},this.getCurrentNumBoundaryLines=function(){return f},this.findVisiblePointInfoClosestTo=function(a){var c,d=null,e=Number.MAX_SAFE_INTEGER,f=_createForOfIteratorHelper(b);try{for(f.s();!(c=f.n()).done;){var h,i=_slicedToArray(c.value,2),j=i[0],k=i[1],l=_createForOfIteratorHelper(k);try{for(l.s();!(h=l.n()).done;){var m=_slicedToArray(h.value,2),n=m[0],p=m[1],q=new Line(a,n),r=q.getLength();r<e&&!g(q)&&(d=o(n,p),e=r);;}}catch(a){l.e(a);}finally{l.f();}}}catch(a){f.e(a);}finally{f.f();}return d},this.computeRoute=function(b,c,d){if(null===b||null===c)return new PointSet;var e=a.findVisiblePointInfoClosestTo(b);if(null===e)return new PointSet;for(var f,h=new Vec2(c.getX()-b.getX(),c.getY()-b.getY()).normalize(),j=[e.point],k=0,m=e;!0;){if(f=l(k,j,m,b,c,h,d),null===f){var o=new Line(j[j.length-1],c);if(g(o))return new PointSet;break}if(k+=new Line(m.point,f.point).getLength(),j.push(f.point),m=n(f.point),1>new Line(m.point,c).getLength())break}return r(d)&&PointVisibilityMapRouteOptimizer.optimize(j,i),new PointSet(j)};}

    function GroupEncapsulationEntity(a,b,c,d){var e=this,f=[];Entity.call(this,a,0,0,0,0,b,c,[c],[]);var g=this.translate;e.setAllowedWithinMultiEntitySelection(!1),e.setAllowedWithinCluster(!1);var h=function calculateBoundingRect(){var a=b.calcBoundingRectForEntities(f);return 0===a.getWidth()||0===a.getHeight()?a:(d&&(a=a.getUniformlyResizedCopy(d)),a)},i=function clearEncapsulatedEntities(){f.length=0;};this.translate=function(a,c,d){var h=a-e.getX(),i=c-e.getY(),j=d===Originator.USER?Originator.USER_VIA_PARENT_ENTITY:Originator.PROGRAM_VIA_PARENT_ENTITY;f.forEach(function(a){a.translate(b.snapToGrid(a.getX()+h),b.snapToGrid(a.getY()+i),!0,j);}),g(a,c,!1,d);},this.setEncapsulatedEntities=function(a){i(),f.push.apply(f,_toConsumableArray(a));var b=h();g(b.getLeft(),b.getTop(),!1,Originator.PROGRAM),e.resize(b.getWidth(),b.getHeight());},this.getEncapsulatedEntities=function(){return f},this.getBoundingRect=function(){return h()};}GroupEncapsulationEntity.prototype=Object.create(Entity.prototype),GroupEncapsulationEntity.prototype.constructor=GroupEncapsulationEntity;

    exports.BoxClusterDetector = BoxClusterDetector;
    exports.Cluster = Cluster;
    exports.Connector = Connector;
    exports.ConnectorAnchor = ConnectorAnchor;
    exports.ConnectorEvent = ConnectorEvent;
    exports.ConnectorRoutingAlgorithm = ConnectorRoutingAlgorithm;
    exports.Dimensions = Dimensions;
    exports.Entity = Entity;
    exports.EntityEvent = EntityEvent;
    exports.EntityTranslationMode = EntityTranslationMode;
    exports.GRID_STYLE = GRID_STYLE;
    exports.Grid = Grid;
    exports.GroupEncapsulationEntity = GroupEncapsulationEntity;
    exports.LINE_INTERSECTION_TYPE = LINE_INTERSECTION_TYPE;
    exports.Line = Line;
    exports.LineIntersection = LineIntersection;
    exports.MatrixMath = MatrixMath;
    exports.Originator = Originator;
    exports.Point = Point;
    exports.PointVisibilityMap = PointVisibilityMap;
    exports.Rectangle = Rectangle;
    exports.Sheet = Sheet;
    exports.SheetEvent = SheetEvent;
    exports.SvgPathBuilder = SvgPathBuilder;

    return exports;

}({}));
//# sourceMappingURL=graphpaper.min.js.map
