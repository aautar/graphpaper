var GraphPaper=function(t){"use strict";function o(L,S){this.__x=L,this.__y=S}function g(L,S){this.getType=function(){return L},this.getIntersectionPoint=function(){return S}}function s(L,S){if("undefined"==typeof L||null===L)throw"Line missing _startPoint";if("undefined"==typeof S||null===S)throw"Line missing _endPoint";this.__startPoint=L,this.__endPoint=S}function a(L,S,X,O){this.getLeft=function(){return L},this.getTop=function(){return S},this.getRight=function(){return X},this.getBottom=function(){return O},this.getPoints=function(){return[new o(L,S),new o(X,S),new o(X,O),new o(L,O)]},this.getLines=function(){return[new s(new o(L,S),new o(X,S)),new s(new o(X,S),new o(X,O)),new s(new o(X,O),new o(L,O)),new s(new o(L,O),new o(L,S))]},this.getPointsScaledToGrid=function(Y){const v=new o(L+0.5*(X-L),S+0.5*(O-S)),R=(X-v.getX()+Y)/(X-v.getX()),w=(O-v.getY()+Y)/(O-v.getY()),B=[new o((L-v.getX())*R+v.getX(),(S-v.getY())*w+v.getY()),new o((X-v.getX())*R+v.getX(),(S-v.getY())*w+v.getY()),new o((X-v.getX())*R+v.getX(),(O-v.getY())*w+v.getY()),new o((L-v.getX())*R+v.getX(),(O-v.getY())*w+v.getY())];return B},this.checkIntersect=function(Y){return!(O<Y.getTop())&&!(S>Y.getBottom())&&!(X<Y.getLeft())&&!(L>Y.getRight())},this.checkIsPointWithin=function(Y){return Y.getX()>=L&&Y.getX()<=X&&Y.getY()>=S&&Y.getY()<=O},this.checkIsWithin=function(Y){return O<=Y.getBottom()&&S>=Y.getTop()&&X<=Y.getRight()&&L>=Y.getLeft()}}function h(L){const S=this,X=[];this.push=function(Y){for(let v=0;v<X.length;v++)if(Y.isEqual(X[v]))return!1;return X.push(Y),!0},this.pushPointSet=function(Y){const v=Y.toArray();for(let R=0;R<v.length;R++)S.push(v[R])},this.findPointClosestTo=function(Y){var v=null,R=Number.MAX_SAFE_INTEGER;return X.forEach(function(w){const B=new s(Y,w);B.getLength()<R&&(v=w,R=B.getLength())}),v},this.findDistanceToPointClosestTo=function(Y){var v=Number.MAX_SAFE_INTEGER;return X.forEach(function(R){const w=new s(Y,R);w.getLength()<v&&(v=w.getLength())}),v},this.findPointsCloseTo=function(Y,v){const R=new h;return X.forEach(function(w){const B=new s(Y,w);B.getLength()<=v&&R.push(w)}),R},this.toArray=function(){return X},this.toFloat64Array=function(){const Y=new Float64Array(2*X.length);for(let v=0;v<X.length;v++)Y[0+2*v]=X[v].getX(),Y[1+2*v]=X[v].getY();return Y};this.count=function(){return X.length},L&&Array.isArray(L)?L.forEach(S.push):L&&"[object Float64Array]"===Object.prototype.toString.call(L)&&function(Y){X.length=0;for(let v=0;v<Y.length;v+=2)X.push(new o(Y[v],Y[v+1]))}(L)}function l(L){const S=this,X=[];this.push=function(Y){var v=!1;return(X.forEach(function(R){Y.isEqual(R)&&(v=!0)}),!v)&&(X.push(Y),!0)},this.toArray=function(){return X},this.count=function(){return X.length},this.toFloat64Array=function(){const Y=new Float64Array(4*X.length);for(let v=0;v<X.length;v++)Y[0+4*v]=X[v].getStartPoint().getX(),Y[1+4*v]=X[v].getStartPoint().getY(),Y[2+4*v]=X[v].getEndPoint().getX(),Y[3+4*v]=X[v].getEndPoint().getY();return Y};L&&Array.isArray(L)?L.forEach(S.push):L&&"[object Float64Array]"===Object.prototype.toString.call(L)&&function(Y){X.length=0;for(let v=0;v<Y.length;v+=4)X.push(new s(new o(Y[v],Y[v+1]),new o(Y[v+2],Y[v+3])))}(L)}function u(L,S,X){const O=this;this.getId=function(){return L},this.getX=function(){return O.getCentroid().getX()},this.getY=function(){return O.getCentroid().getY()},this.getWidth=function(){const Y=S.getBoundingClientRect();return Y.right-Y.left},this.getHeight=function(){const Y=S.getBoundingClientRect();return Y.bottom-Y.top},this.getCentroid=function(){const Y=S.getBoundingClientRect(),v=X.getPageOffset();return new o(Y.left+v.getX()+0.5*O.getWidth(),Y.top+v.getY()+0.5*O.getHeight())},this.getRoutingPoints=function(Y){const v=O.getCentroid(),R=0.5*O.getWidth(),w=0.5*O.getHeight();return[new o(v.getX()+R+Y,v.getY()),new o(v.getX()-R-Y,v.getY()),new o(v.getX(),v.getY()+w+Y),new o(v.getX(),v.getY()-w-Y)]},this.getBoundingRectange=function(){const Y=O.getCentroid(),v=0.5*O.getWidth(),R=0.5*O.getHeight();return new a(Y.getX()-v,Y.getY()-R,Y.getX()+v,Y.getY()+R)}}function f(L,S,X,O,Y){const v=this,R=new Map,w={CLICK:"connector-click"};"undefined"==typeof O&&(O="#000"),"undefined"==typeof Y&&(Y="2px");const B=window.document.createElementNS("http://www.w3.org/2000/svg","path");B.setAttribute("d","M0 0 L0 0"),B.style.stroke=O,B.style.strokeWidth=Y,B.addEventListener("click",function(M){const N=R.get(w.CLICK)||[];N.forEach(function(G){G({connector:v,clickedAtX:M.pageX,clickedAtY:M.pageY})})});this.appendPathToContainerDomElement=function(){X.appendChild(B)},this.refresh=function(M){B.setAttribute("d",M)},this.getId=function(){const M=[L.getId(),S.getId()].sort();return M.join(":")},this.getAnchorStart=function(){return L},this.getAnchorEnd=function(){return S},this.removePathElement=function(){B.remove()},this.addClassToDomElement=function(M){B.classList.add(M)},this.removeClassFromDomElement=function(M){B.classList.remove(M)},this.getDescriptor=function(){return{id:v.getId(),anchor_start_centroid:L.getCentroid().toString(),anchor_end_centroid:S.getCentroid().toString()}},this.on=function(M,N){const G=R.get(M)||[];G.push(N),R.set(M,G)},this.off=function(M,N){const G=eventHandlers.get(M)||[];for(let F=0;F<G.length;F++)if(G[F]===N){G.splice(F,1);break}eventHandlers.set(M,G)}}function E(L,S,X){this.getSize=function(){return L},this.getStyle=function(){return X},this.getSvgImageTile=function(){return X===P.LINE?"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+L+"\" height=\""+L+"\"><rect width=\""+L+"\" height=\"1\" x=\"0\" y=\""+(L-1)+"\" style=\"fill:"+S+"\" /><rect width=\"1\" height=\""+L+"\" x=\""+(L-1)+"\" y=\"0\" style=\"fill:"+S+"\" /></svg>":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+L+"\" height=\""+L+"\"><rect width=\"1\" height=\"1\" x=\""+(L-1)+"\" y=\""+(L-1)+"\" style=\"fill:"+S+"\" /></svg>"}}function C(L){const S=this,X=[];this.getId=function(){return L},this.getObjectIndex=function(O){return S.getObjectIndexById(O.getId())},this.getObjectIndexById=function(O){for(let Y=0;Y<X.length;Y++)if(X[Y].getId()===O)return Y;return null},this.addObject=function(O){return null===S.getObjectIndex(O)&&(X.push(O),!0)},this.getObjects=function(){return X},this.getObjectIds=function(){const O=[];return X.forEach(function(Y){O.push(Y.getId())}),O},this.removeObjectById=function(O){const Y=S.getObjectIndexById(O);return null!==Y&&(X.splice(Y,1),!0)},this.removeAllObjects=function(){X.length=0}}const m={mat4Multiply:function(L,S){const X=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let Y=0;4>Y;Y++)for(let v=0;4>v;v++){var O=0;for(let R=0;4>R;R++)O+=L[R+4*Y]*S[v+4*R];X[v+4*Y]=O}return X},vecMat4Multiply:function(L,S){const X=[0,0,0,0];for(let O=0;4>O;O++)X[O]=L[0]*S[4*O+0]+L[1]*S[4*O+1]+L[2]*S[4*O+2]+L[3]*S[4*O+3];return X}};o.prototype.getX=function(){return this.__x},o.prototype.getY=function(){return this.__y},o.prototype.isEqual=function(L){return this.__x===L.getX()&&this.__y===L.getY()},o.prototype.getCartesianPoint=function(L,S){return new o(this.__x-0.5*L,-this.__y+0.5*S)},o.prototype.toString=function(){return this.__x+" "+this.__y};const _=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"});s.prototype.getStartPoint=function(){return this.__startPoint},s.prototype.getEndPoint=function(){return this.__endPoint},s.prototype.isEqual=function(L){return this.getStartPoint().isEqual(L.getStartPoint())&&this.getEndPoint().isEqual(L.getEndPoint())},s.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},s.prototype.computeIntersectionType=function(L){const S=this.__startPoint.getX(),X=this.__startPoint.getY(),O=this.__endPoint.getX(),Y=this.__endPoint.getY(),v=L.getStartPoint().getX(),R=L.getStartPoint().getY(),w=L.getEndPoint().getX(),B=L.getEndPoint().getY(),D=(B-R)*(O-S)-(w-v)*(Y-X),M=(w-v)*(X-R)-(B-R)*(S-v),N=(O-S)*(X-R)-(Y-X)*(S-v);if(0==D)return 0==D&&0==M&&0==N?_.COINCIDENT:_.PARALLEL;const G=M/D,F=N/D;return 1<G||0>G||1<F||0>F?_.LINE:_.LINESEG},s.prototype.computeIntersection=function(L){const S=this.__startPoint.getX(),X=this.__startPoint.getY(),O=this.__endPoint.getX(),Y=this.__endPoint.getY(),v=L.getStartPoint().getX(),R=L.getStartPoint().getY(),w=L.getEndPoint().getX(),B=L.getEndPoint().getY(),D=(B-R)*(O-S)-(w-v)*(Y-X),M=(w-v)*(X-R)-(B-R)*(S-v),N=(O-S)*(X-R)-(Y-X)*(S-v);if(0==D)return 0==D&&0==M&&0==N?new g(_.COINCIDENT,null):new g(_.PARALLEL,null);const G=M/D,F=N/D,z=this.__startPoint.getX()+G*(this.__endPoint.getX()-this.__startPoint.getX()),W=this.__startPoint.getY()+G*(this.__endPoint.getY()-this.__startPoint.getY());return 1<G||0>G||1<F||0>F?new g(_.LINE,new o(z,W)):new g(_.LINESEG,new o(z,W))};const P={LINE:"line",DOT:"dot"};return t.MatrixMath=m,t.Dimensions=function(L,S){this.getWidth=function(){return L},this.getHeight=function(){return S}},t.Rectangle=a,t.Point=o,t.LINE_INTERSECTION_TYPE=_,t.LineIntersection=g,t.Line=s,t.CanvasObject=function(L,S,X,O,Y,v,R,w,B){const D=this,N=[];var G=1e3,F=null;const W={TRANSLATE_START:"obj-translate-start",TRANSLATE:"obj-translate",RESIZE_START:"obj-resize-start",RESIZE:"obj-resize"},H=new Map;this.x=parseInt(S),this.y=parseInt(X),this.width=parseInt(O),this.height=parseInt(Y),this.isDeleted=!1,this.addNonInteractableConnectorAnchor=function($){const ee=new u(L+`-${G}`,$,v);return N.push(ee),G++,ee},this.addInteractableConnectorAnchor=function($){const ee=new u(L+`-${G}`,$,v);return $.addEventListener("click",function(){v.addConnectionAnchorToSelectionStack(ee)}),N.push(ee),G++,ee},this.getConnectorAnchorRoutingPoints=function($){const ee=[];return N.forEach(function(te){const ne=te.getRoutingPoints($);ne.forEach(function(oe){ee.push(oe)})}),ee},this.getConnectorAnchors=function(){return N},this.hasConnectorAnchor=function($){const ee=D.getConnectorAnchors();for(let te=0;te<ee.length;te++)if(ee[te]===$)return!0;return!1},this.getTranslateHandleOffset=function(){return F?new o(-(F.offsetLeft+0.5*F.offsetWidth),-(F.offsetTop+0.5*F.offsetHeight)):null},this.getId=function(){return L},this.getX=function(){return D.x},this.setX=function($){D.x=$},this.getY=function(){return D.y},this.setY=function($){D.y=$},this.translate=function($,ee){D.x=$,D.y=ee,R.style.left=parseInt(D.x)+"px",R.style.top=parseInt(D.y)+"px";const te=H.get(W.TRANSLATE)||[];te.forEach(function(ne){ne({obj:D,x:$,y:ee})})},this.getWidth=function(){return D.width},this.getHeight=function(){return D.height},this.resize=function($,ee,te){D.width=$,D.height=ee,te?te(R):(R.style.width=parseInt(D.width)+"px",R.style.height=parseInt(D.height)+"px");const ne=H.get(W.RESIZE)||[];ne.forEach(function(oe){oe({obj:D,width:$,height:ee})})},this.getIsDeleted=function(){return D.isDeleted},this.getDomElement=function(){return R},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){const $=parseInt(D.x),ee=parseInt(D.y),te=$+parseInt(D.width),ne=ee+parseInt(D.height);return new a($,ee,te,ne)},this.getBoundingPoints=function(){const $=new o(D.getX(),D.getY()),ee=new o(D.getX()+D.getWidth(),D.getY()),te=new o(D.getX(),D.getY()+D.getWidth()),ne=new o(D.getX()+D.getWidth(),D.getY()+D.getWidth());return[$,ee,te,ne]},this.on=function($,ee){const te=H.get($)||[];te.push(ee),H.set($,te)},this.off=function($,ee){const te=eventHandlers.get($)||[];for(let ne=0;ne<te.length;ne++)if(te[ne]===ee){te.splice(ne,1);break}eventHandlers.set($,te)},this.suspendTranslateInteractions=function(){V()},this.resumeTranslateInteractions=function(){Z()};const q=function($){F=$.target;const ee=H.get(W.TRANSLATE_START)||[];ee.forEach(function(te){te({obj:D,x:$.touches[0].pageX,y:$.touches[0].pageY,isTouch:!0})})},J=function($){F=$.target;const ee=H.get(W.TRANSLATE_START)||[];ee.forEach(function(te){te({obj:D,x:$.pageX,y:$.pageY,isTouch:!1})})},V=function(){w.forEach($=>{$.removeEventListener("touchstart",q),$.removeEventListener("mousedown",J)})},Z=function(){w.forEach($=>{$.addEventListener("touchstart",q),$.addEventListener("mousedown",J)})},K=function($){if($.which===1){$.target;const ee=H.get(W.RESIZE_START)||[];ee.forEach(function(te){te({obj:D,x:$.pageX,y:$.pageY,isTouch:!1})})}},U=function($){$.target;const ee=H.get(W.RESIZE_START)||[];ee.forEach(function(te){te({obj:D,x:$.touches[0].pageX,y:$.touches[0].pageY,isTouch:!0})})};Z(),function(){B.forEach($=>{$.addEventListener("touchstart",U),$.addEventListener("mousedown",K)})}()},t.Canvas=function(L,S,X){const O=this,Y={DBLCLICK:"dblclick",CLICK:"click",OBJECT_ADDED:"object-added",OBJECT_REMOVED:"object-removed",OBJECT_RESIZED:"object-resized",OBJECT_TRANSLATED:"object-translated"},v=S.document.createElementNS("http://www.w3.org/2000/svg","svg");v.style.width="100%",v.style.height="100%";const R=L.appendChild(v);var w=null,B="transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out",D=0,M=0,N=0,G=0,F=1,z=1;const W=[];var H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const V=[],Z=[];var K=null,U=null,Q=0,$=0,ee=0,te=0,ne={lastTouchX:null,lastTouchY:null,lastTouchTime:null};const oe=[],ge=new Map,ie=new Map;this.getCurrentPointVisibilityMap=function(){return null},this.setGrid=function(Ce){w=Ce,L.style.backgroundImage="url('data:image/svg+xml;base64,"+S.btoa(w.getSvgImageTile())+"')",L.style.backgroundRepeat="repeat",L.style.backgroundColor="#fff"},this.getGrid=function(){return w},this.getGridSize=function(){return w.getSize()};const re=function(Ce){ie.clear();const be=[],Ie=[];return Ce.forEach(ye=>{const me=ye.getConnectorAnchors();me.forEach(je=>{const Pe=je.getRoutingPoints(O.getGridSize());Pe.forEach(Le=>{be.push({routingPoint:Le,parentAnchor:je})}),ie.set(je.getId(),Pe.length)})}),be.forEach(ye=>{let me=!1;for(let je=0;je<Ce.length;je++){const Pe=Ce[je],Le=Pe.getBoundingRectange();if(Le.checkIsPointWithin(ye.routingPoint)){me=!0;const Se=ie.get(ye.parentAnchor.getId())||0;ie.set(ye.parentAnchor.getId(),Se-1)}}me||Ie.push(ye.routingPoint)}),Ie},se=function(){const Ce=new h;return V.forEach(function(be){const Ie=be.getBoundingRectange().getPointsScaledToGrid(O.getGridSize());Ie.forEach(ye=>{Ce.push(ye)})}),Ce},de=function(){const Ce=new h,be=re(V);return be.forEach(Ie=>{Ce.push(Ie)}),Ce},ae=function(){const Ce=[];return V.forEach(function(be){const Ie=be.getBoundingRectange().getLines();Ie.forEach(me=>{Ce.push(me)});const ye=be.getConnectorAnchors();ye.forEach(function(me){const je=me.getBoundingRectange().getLines();je.forEach(Pe=>{Ce.push(Pe)})})}),new l(Ce)},ce=function(){const Ce=[];Z.forEach(function(Le){Ce.push(Le.getDescriptor())});const be=de(),Ie=se(),ye=new h;ye.pushPointSet(be),ye.pushPointSet(Ie);const me=be.toFloat64Array(),je=ye.toFloat64Array(),Pe=ae().toFloat64Array();X.postMessage({gridSize:O.getGridSize(),connectorDescriptors:Ce,routingPoints:je.buffer,boundaryLines:Pe.buffer,routingPointsAroundAnchor:me.buffer},[je.buffer,Pe.buffer,me.buffer])};X.onmessage=function(Ce){const be=Ce.data.connectorDescriptors,Ie=function(ye){for(let me=0;me<be.length;me++)if(be[me].id===ye)return be[me];return null};Z.forEach(function(ye){const me=Ie(ye.getId());me&&ye.refresh(me.svgPath)})};var he=function(Ce,be,Ie){return new f(Ce,be,Ie)};this.setConnectorFactory=function(Ce){he=Ce},this.getTransitionCss=function(){return B},this.setTransitionCss=function(Ce){B=Ce,L.style.transition=B},this.getTransformOriginX=function(){return D},this.getTransformOriginY=function(){return M},this.getScaleFactor=function(){return F},this.getTranslateX=function(){return N},this.getTranslateY=function(){return G},this.setTransformOrigin=function(Ce,be){D=Ce,M=be,L.style.transformOrigin=`${D}px ${M}px`},this.scale=function(Ce,be){if(be=be||!1,be){const ye=O.getGridSize()*Ce,me=Math.round(ye);Ce=me/O.getGridSize()}F=Ce,z=1/F;const Ie=[F,0,0,0,0,F,0,0,0,0,F,1,0,0,0,1];return q=m.mat4Multiply(q,Ie),W.push([z,0,0,0,0,z,0,0,0,0,z,1,0,0,0,1]),O},this.translate=function(Ce,be){N=Ce,G=be;const Ie=[1,0,0,0,0,1,0,0,0,0,1,0,N,G,0,1];return q=m.mat4Multiply(q,Ie),W.push([1,0,0,-N,0,1,0,-G,0,0,1,0,0,0,0,1]),O},this.applyTransform=function(){const Ce=q.join(",");L.style.transform=`matrix3d(${Ce})`,H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let be=0;be<W.length;be++)H=m.mat4Multiply(H,W[be])},this.resetTransform=function(){F=1,z=1,N=0,G=0,q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],W.length=0,L.style.transform="none"},this.getPageOffset=function(){return new o(window.pageXOffset,window.pageYOffset)},this.snapToGrid=function(Ce){var be=Math.round(Ce/O.getGridSize())*O.getGridSize();return Math.max(0,be-1)},this.getOffsetLeft=function(){return L.offsetLeft},this.getOffsetTop=function(){return L.offsetTop},this.getWidth=function(){return L.offsetWidth},this.getHeight=function(){return L.offsetHeight},this.getObjectsAroundPoint=function(Ce,be){var Ie=[],ye=new a(Ce,be,Ce+1,be+1);return V.forEach(function(me){!me.getIsDeleted()&&ye.checkIntersect(me.getBoundingRectange())&&Ie.push(me)}),Ie},this.calcBoundingBox=function(){var Ce=null,be=null,Ie=null,ye=null;return V.forEach(function(me){var Le=parseInt(me.getX()),Se=parseInt(me.getY()),Xe=Le+parseInt(me.getWidth()),Oe=Se+parseInt(me.getHeight());(null==be||Le<be)&&(be=Le),(null==Ce||Se<Ce)&&(Ce=Se),(null==Ie||Oe>Ie)&&(Ie=Oe),(null==ye||Xe>ye)&&(ye=Xe)}),new a(be,Ce,ye,Ie)},this.getAllObjects=function(){return V},this.publishSiblingObjectChange=function(Ce,be){V.forEach(function(Ie){Ie.handleSiblingObjectChange(Ce,be)})},this.getObjectById=function(Ce){var be=null;return V.forEach(function(Ie){null==be&&Ie.getId()===Ce&&(be=Ie)}),be},this.addObject=function(Ce){Ce.on("obj-resize-start",ue),Ce.on("obj-resize",function(be){Ae(Y.OBJECT_RESIZED,{object:be.obj}),ce()}),Ce.on("obj-translate-start",fe),Ce.on("obj-translate",function(be){Ae(Y.OBJECT_TRANSLATED,{object:be.obj}),ce()}),V.push(Ce),ce(),Ae(Y.OBJECT_ADDED,{object:Ce})},this.removeObject=function(Ce){for(let be=0;be<V.length;be++)if(V[be].getId()===Ce)return V.splice(be,1),ce(),Ae(Y.OBJECT_REMOVED,{object:V[be]}),!0;return!1},this.getConnector=function(Ce){for(let be=0;be<Z.length;be++)if(Z[be].getId()===Ce)return Z[be];return null},this.getAllConnectors=function(){return Z},this.getConnectorsBetweenObjects=function(Ce,be){const Ie=[];return Z.forEach(ye=>{const me=ye.getAnchorStart(),je=ye.getAnchorEnd();Ce.hasConnectorAnchor(me)&&be.hasConnectorAnchor(je)&&Ie.push(ye),Ce.hasConnectorAnchor(je)&&be.hasConnectorAnchor(me)&&Ie.push(ye)}),Ie},this.getObjectsConnectedViaConnector=function(Ce){const be=[],Ie=O.getAllObjects();return Z.forEach(ye=>{if(ye.getId()===Ce){const me=ye.getAnchorStart(),je=ye.getAnchorEnd();Ie.forEach(Pe=>{(Pe.hasConnectorAnchor(me)||Pe.hasConnectorAnchor(je))&&be.push(Pe)})}}),be},this.getConnectorsConnectedToObject=function(Ce){const be=[];return Z.forEach(Ie=>{const ye=Ie.getAnchorStart(),me=Ie.getAnchorEnd();(Ce.hasConnectorAnchor(ye)||Ce.hasConnectorAnchor(me))&&be.push(Ie)}),be},this.removeAllConnectors=function(){Z.forEach(function(Ce){Ce.removePathElement()}),Z.splice(0,Z.length)},this.removeConnector=function(Ce){for(let be=0;be<Z.length;be++)if(Z[be]===Ce)return Ce.removePathElement(),Z.splice(be,1),!0;return!1},this.makeNewConnectorFromAnchors=function(Ce,be){const Ie=he(Ce,be,R),ye=O.getConnector(Ie.getId());return null===ye?(Z.push(Ie),Ie.appendPathToContainerDomElement(),ce(),Ie):ye},this.findBestConnectorAnchorsToConnectObjects=function(Ce,be,Ie){const ye=me=>{const je=me.objectA.getConnectorAnchors(),Pe=me.objectB.getConnectorAnchors();var Le=0,Se=0,Xe=Number.MAX_VALUE;for(let Oe=0;Oe<je.length;Oe++){const Ye=ie.get(je[Oe].getId())||0;if(0!==Ye)for(let ve=0;ve<Pe.length;ve++){const Re=je[Oe].getCentroid(),xe=Pe[ve].getCentroid(),we=Math.sqrt(Math.pow(xe.getX()-Re.getX(),2)+Math.pow(xe.getY()-Re.getY(),2)),Be=ie.get(Pe[ve].getId())||0;we<Xe&&0<Be&&(Le=Oe,Se=ve,Xe=we)}}me.cb({objectAAnchorIndex:Le,objectAAnchor:je[Le],objectBAnchorIndex:Se,objectBAnchor:Pe[Se]})};setTimeout(function(){ye({objectA:Ce,objectB:be,cb:Ie})},10)},this.addConnectionAnchorToSelectionStack=function(Ce){oe.push(Ce),2===oe.length&&(O.makeNewConnectorFromAnchors(oe[0],oe[1]),oe.length=0)};const le=function(Ce,be){const Ie=O.getObjectsAroundPoint(Ce,be),ye={targetPoint:new o(Ce,be),objectsAroundPoint:Ie};Ae(Y.DBLCLICK,ye)};this.initInteractionHandlers=function(Ce,be){L.addEventListener("dblclick",function(Ie){const ye=m.vecMat4Multiply([Ie.pageX,Ie.pageY,0,1],H);le(ye[0],ye[1])}),L.addEventListener("click",function(Ie){let ye=!1;Ie.target!==L&&(ye=!0);const me=m.vecMat4Multiply([Ie.pageX,Ie.pageY,0,1],H),je={targetPoint:new o(me[0],me[1]),canvasObjectClicked:ye};Ae(Y.CLICK,je)}),L.addEventListener("touchend",function(Ie){if(0>=Ie.changedTouches.length)return!1;var ye=!1;const me=m.vecMat4Multiply([Ie.changedTouches[0].pageX,Ie.changedTouches[0].pageY,0,1],H);var je=me[0],Pe=me[1],Le=new Date().getTime();if(null!==ne.lastTouchTime){var Se=ne.lastTouchTime,Oe=ne.lastTouchX,Ye=ne.lastTouchY,ve=Math.sqrt(Math.pow(je-Oe,2)+Math.pow(Pe-Ye,2));Le-Se<=Ce&&ve<=be&&(ye=!0,le(je,Pe),ne.lastTouchTime=null,ne.lastTouchX=null,ne.lastTouchY=null)}ye||(ne.lastTouchTime=Le,ne.lastTouchX=je,ne.lastTouchY=Pe)})};const ue=function(Ce){U=Ce.obj.getId()},fe=function(Ce){K=Ce.obj.getId(),Q=Ce.x,$=Ce.y,ee=Ce.x,te=Ce.y},pe=function(Ce,be){const Ie=O.getObjectById(K),ye=Ie.getTranslateHandleOffset(),me=O.snapToGrid(Ce+ye.getX()),je=O.snapToGrid(be+ye.getY());Q=me,$=je,Ie.translate(me,je)},Ee=function(Ce,be){const Ie=O.getObjectById(K),ye=Ie.getTranslateHandleOffset(),me=O.snapToGrid(Ce+ye.getX()),je=O.snapToGrid(be+ye.getY()),Pe=ee,Le=te;Pe==me&&Le==je||Ie.translate(me,je)},Te=function(Ce,be){const Ie=O.getObjectById(U),ye=O.snapToGrid(Ce),me=O.snapToGrid(be),je=Ie.getY(),Pe=Ie.getX();Ie.resize(ye-Pe+1,me-je+1)};this.initTransformationHandlers=function(){L.addEventListener("touchmove",function(Ce){if(null!==K){const be=m.vecMat4Multiply([Ce.touches[0].pageX,Ce.touches[0].pageY,0,1],H);pe(be[0],be[1]),Ce.preventDefault()}if(null!==U){const be=m.vecMat4Multiply([Ce.touches[0].pageX,Ce.touches[0].pageY,0,1],H);Te(be[0],be[1]),Ce.preventDefault()}}),L.addEventListener("mousemove",function(Ce){if(null!==K){const be=m.vecMat4Multiply([Ce.pageX,Ce.pageY,0,1],H);pe(be[0],be[1])}if(null!==U){const be=m.vecMat4Multiply([Ce.pageX,Ce.pageY,0,1],H);Te(be[0],be[1])}}),L.addEventListener("touchend",function(){null!==K&&(K=null),null!==U&&(U=null)}),L.addEventListener("mouseup",function(Ce){if(1===Ce.which){if(null!==K){const be=m.vecMat4Multiply([Ce.pageX,Ce.pageY,0,1],H);Ee(be[0],be[1])}K=null,U=null}}),L.addEventListener("mousedown",function(Ce){(null!==K||null!==U)&&(Ce.preventDefault(),Ce.stopPropagation())})};const Ae=function(Ce,be){const Ie=ge.get(Ce)||[];for(let ye=0;ye<Ie.length;ye++){const me=Ie[ye];me(be)}};this.off=function(Ce,be){const Ie=ge.get(Ce)||[];for(let ye=0;ye<Ie.length;ye++)if(Ie[ye]===be){Ie.splice(ye,1);break}ge.set(Ce,Ie)},this.on=function(Ce,be){const Ie=ge.get(Ce)||[];Ie.push(be),ge.set(Ce,Ie)},O.setGrid(new E(12,"#424242",P.DOT)),O.resetTransform(),O.setTransformOrigin(0,0),O.setTransitionCss(B)},t.Cluster=C,t.BoxClusterDetector=function(L){const S=this,X=function(v,R){for(let w=0;w<R.length;w++)if(R[w].getId()===v.getId())return w;return-1},O=function(v,R){for(let w=0;w<v.length;w++){const B=X(v[w],R);-1!==B&&R.splice(B,1)}return R},Y=function(v){var R=0,w=null;return v.forEach(function(B,D){B>R&&(R=B,w=D)}),w};this.areObjectsClose=function(v,R){const w=new a(v.x-L,v.y-L,v.x+v.width+L,v.y+v.height+L),B=new a(R.x-L,R.y-L,R.x+R.width+L,R.y+R.height+L);return w.checkIntersect(B)},this.getAllObjectsCloseTo=function(v,R){const w=[];for(let B=0;B<R.length;B++)v.getId()!==R[B].getId()&&S.areObjectsClose(v,R[B])&&w.push(R[B]);return w},this.getClusterObjectsFromSeed=function(v,R,w){const B=S.getAllObjectsCloseTo(v,R);return 0===B.length?[]:void(O(B.concat([v]),R),B.forEach(function(D){w.push(D),S.getClusterObjectsFromSeed(D,R,w)}))},this.findIntersectingClustersForObjects=function(v,R){const w=new Map;return R.forEach(function(B){const D=B.getObjects();for(let M=0;M<D.length;M++)for(let N=0;N<v.length;N++)if(D[M].getId()===v[N].getId())if(w.has(B)){const G=w.get(B);w.set(B,G+1)}else w.set(B,1)}),w},this.removeObjectFromClusters=function(v,R){R.forEach(function(w){w.removeObjectById(v.getId())})},this.computeClusters=function(v,R,w){const B=R.map(function(N){return N}),D=v.map(function(N){return N});for(;0<D.length;){const N=D.pop(),G=[N];if(S.getClusterObjectsFromSeed(N,D,G),1<G.length){const F=S.findIntersectingClustersForObjects(G,B);if(0===F.size){const z=new C(w());G.forEach(function(W){z.addObject(W)}),B.push(z)}else{const z=Y(F);z.removeAllObjects(),G.forEach(function(W){S.removeObjectFromClusters(W,B),z.addObject(W)})}O(G,D)}else S.removeObjectFromClusters(N,B)}const M=B.filter(function(N){return!!(2<=N.getObjects().length)});return M}},t.Connector=f,t.ConnectorAnchor=u,t.PointVisibilityMap=function(L,S){const X=this,O=S.toArray(),Y=new Map,v=function(D){for(let M=0;M<O.length;M++){const N=O[M].computeIntersectionType(D);if(N===_.LINESEG)return!0}return!1},w=function(D){var M=Number.MAX_SAFE_INTEGER,N=null;for(var[G,F]of D.entries())F<M&&(N=G,M=F);return null===N?null:{cost:M,point:N}},B=function(D,M,N,G){const F=new Map;var z=Y.get(N);z=z.filter(function(H){for(let q=0;q<M.length;q++)if(H.isEqual(M[q]))return!1;return!0}),z.forEach(function(H){const q=new s(N,H).getLength()+D,J=new s(H,G).getLength();F.set(H,q+J)});const W=w(F);return null===W?null:W};this.findPointClosestTo=function(D){var M=null,N=Number.MAX_SAFE_INTEGER;return Y.forEach(function(G,F){const z=new s(D,F);z.getLength()<N&&(M=F,N=z.getLength())}),M},this.findVisiblePointClosestTo=function(D){var M=null,N=Number.MAX_SAFE_INTEGER;return Y.forEach(function(G,F){const z=new s(D,F);!v(z)&&z.getLength()<N&&(M=F,N=z.getLength())}),M},this.computeRoute=function(D,M){if(null===D||null===M)return new h;const N=X.findVisiblePointClosestTo(D);if(null===N)return new h;var G=0;const F=[N];for(var z=N;;){const W=B(G,F,z,M);if(null===W){const H=new s(F[F.length-1],M);if(v(H))return new h;break}if(G+=new s(z,W.point).getLength(),F.push(W.point),z=W.point,1>new s(z,M).getLength())break}return new h(F)},function(){const D=L.toArray();for(let M=0;M<D.length;M++)Y.set(D[M],[]);for(let M=0;M<D.length;M++)for(let N=M+1;N<D.length;N++){const G=new s(D[M],D[N]);if(!v(G)){const F=Y.get(D[M]);F.push(D[N]),Y.set(D[M],F);const z=Y.get(D[N]);z.push(D[M]),Y.set(D[N],z)}}}()},t.GRID_STYLE=P,t.Grid=E,t}({});