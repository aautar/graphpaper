"use strict";(function(a){"use strict";function c(l,m,n,o){this.getLeft=function(){return l},this.getTop=function(){return m},this.getRight=function(){return n},this.getBottom=function(){return o},this.checkIntersect=function(p){return!(o<p.getTop())&&!(m>p.getBottom())&&!(n<p.getLeft())&&!(l>p.getRight())},this.checkIsWithin=function(p){return o<=p.getBottom()&&m>=p.getTop()&&n<=p.getRight()&&l>=p.getLeft()}}function d(l,m){this.getX=function(){return l},this.getY=function(){return m}}function h(l){var m=this,n=[];this.getId=function(){return l},this.getObjectIndex=function(o){return m.getObjectIndexById(o.getId())},this.getObjectIndexById=function(o){for(var p=0;p<n.length;p++)if(n[p].getId()===o)return p;return null},this.addObject=function(o){return!(null!==m.getObjectIndex(o))&&(n.push(o),!0)},this.getObjects=function(){return n},this.getObjectIds=function(){var o=[];return n.forEach(function(p){o.push(p.getId())}),o},this.removeObjectById=function(o){var p=m.getObjectIndexById(o);return null!==p&&(n.splice(p,1),!0)},this.removeAllObjects=function(){n.length=0}}a.Dimensions=function(l,m){this.getWidth=function(){return l},this.getHeight=function(){return m}},a.Rectangle=c,a.Point=d,a.CanvasObject=function(l,m,n,o,p,q,r,s,t){var u=this;this.id=l,this.x=m,this.y=n,this.width=o,this.height=p,this.domElement=r,this.isDeleted=!1,this.touchInternalContactPt=null,this.getTranslateHandleOffsetX=function(){return-(s.offsetLeft+0.5*s.offsetWidth)},this.getTranslateHandleOffsetY=function(){return-(s.offsetTop+0.5*s.offsetHeight)},this.getId=function(){return u.id},this.getX=function(){return u.x},this.setX=function(w){u.x=w},this.getY=function(){return u.y},this.setY=function(w){u.y=w},this.translate=function(w,z){u.x=w,u.y=z,u.domElement.style.left=parseInt(u.x)+"px",u.domElement.style.top=parseInt(u.y)+"px"},this.getWidth=function(){return u.width},this.getHeight=function(){return u.height},this.resize=function(w,z){u.width=w,u.height=z,u.domElement.style.width=parseInt(u.width)+"px",u.domElement.style.height=parseInt(u.height)+"px"},this.getIsDeleted=function(){return u.isDeleted},this.getDomElement=function(){return u.domElement},this.getTouchInternalContactPt=function(){return u.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var w=parseInt(u.x),z=parseInt(u.y),A=w+parseInt(u.width),B=z+parseInt(u.height);return new c(w,z,A,B)};var v=function(z){z.touches&&(u.touchInternalContactPt=new d(z.touches[0].pageX-u.getX(),z.touches[0].pageY-u.getY()));var A=z.pageX,B=z.pageY;q.objectIdBeingDragged=u.getId(),q.objectDragX=A,q.objectDragY=B,q.objectDragStartX=A,q.objectDragStartY=B};s.addEventListener("touchstart",function(w){v(w)}),s.addEventListener("mousedown",function(w){v(w)}),t.addEventListener("mousedown",function(w){1!==w.which||(q.objectIdBeingResized=u.getId())})},a.Canvas=function(l,m){var n=this;this.getGridSize=function(){return 12};var q=[];this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;var r={lastTouchX:null,lastTouchY:null,lastTouchTime:null},s=1,t=1;this.setScaleFactor=function(z){return s=z,t=1/s,l.style.transform="scale3d("+s+","+s+","+s+")",s},this.getScaleFactor=function(){return s},this.snapToGrid=function(z){var A=Math.round(z/n.getGridSize())*n.getGridSize();return Math.max(0,A-1)},this.getOffsetLeft=function(){return l.offsetLeft},this.getOffsetTop=function(){return l.offsetTop},this.getObjectsAroundPoint=function(z,A){var B=[],C=new c(z,A,z+1,A+1);return q.forEach(function(D){!D.getIsDeleted()&&C.checkIntersect(D.getBoundingRectange())&&B.push(D)}),B},this.calcBoundingBox=function(){var z=null,A=null,B=null,C=null;return q.forEach(function(D){var G=parseInt(D.getX()),H=parseInt(D.getY()),I=G+parseInt(D.getWidth()),J=H+parseInt(D.getHeight());(null==A||G<A)&&(A=G),(null==z||H<z)&&(z=H),(null==B||J>B)&&(B=J),(null==C||I>C)&&(C=I)}),new c(A,z,C,B)},this.getAllObjects=function(){return q},this.publishSiblingObjectChange=function(z,A){q.forEach(function(B){B.handleSiblingObjectChange(z,A)})},this.getObjectById=function(z){var A=null;return q.forEach(function(B){null==A&&B.getId()===z&&(A=B)}),A},this.addObject=function(z){q.push(z)};var u=function(A,B){var C=n.getObjectsAroundPoint(A,B);0===C.length&&m("dbl-click",new d(A,B))};this.initInteractionHandlers=function(z,A){l.addEventListener("dblclick",function(B){u(B.pageX,B.pageY)}),l.addEventListener("click",function(B){B.target===l?m("click",{canvasObjectClicked:!1}):m("click",{canvasObjectClicked:!0})}),l.addEventListener("touchend",function(B){if(0>=B.originalEvent.changedTouches.length)return!1;var C=!1,D=B.originalEvent.changedTouches[0].pageX,E=B.originalEvent.changedTouches[0].pageY,F=new Date().getTime();if(null!==r.lastTouchTime){var G=r.lastTouchTime,I=r.lastTouchX,J=r.lastTouchY,K=Math.sqrt(Math.pow(D-I,2)+Math.pow(E-J,2));F-G<=z&&K<=A&&(C=!0,u(D,E),r.lastTouchTime=null,r.lastTouchX=null,r.lastTouchY=null)}C||(r.lastTouchTime=F,r.lastTouchX=D,r.lastTouchY=E)})};var v=function(A,B){var C=n.getObjectById(n.objectIdBeingDragged);C.touchInternalContactPt&&(A-=C.touchInternalContactPt.getX(),B-=C.touchInternalContactPt.getY());var D=n.snapToGrid(A+C.getTranslateHandleOffsetX()),E=n.snapToGrid(B+C.getTranslateHandleOffsetY());n.objectDragX=D,n.objectDragY=E,C.translate(D,E)},w=function(A,B){var C=n.getObjectById(n.objectIdBeingDragged),D=n.snapToGrid(A+C.getTranslateHandleOffsetX()),E=n.snapToGrid(B+C.getTranslateHandleOffsetY()),F=n.objectDragStartX,G=n.objectDragStartY;F==D&&G==E||(C.translate(D,E),m("object-translated",C))};this.initTransformationHandlers=function(){l.addEventListener("touchmove",function(z){null!==n.objectIdBeingDragged&&v(z.touches[0].pageX*t,z.touches[0].pageY*t)}),l.addEventListener("mousemove",function(z){if(null!==n.objectIdBeingDragged&&v(z.pageX*t,z.pageY*t),null!==n.objectIdBeingResized){var A=n.snapToGrid(z.pageX*t),B=n.snapToGrid(z.pageY*t),C=n.getObjectById(n.objectIdBeingResized),D=C.getY(),E=C.getX();C.resize(A-E+1,B-D+1),m("object-resized",C)}}),l.addEventListener("touchend",function(){if(null!==n.objectIdBeingDragged){var A=n.getObjectById(n.objectIdBeingDragged);A.touchInternalContactPt=null,n.objectIdBeingDragged=null,n.objectIdBeingResized=null}}),l.addEventListener("mouseup",function(z){1===z.which&&(null!==n.objectIdBeingDragged&&w(z.pageX*t,z.pageY*t),null!==n.objectIdBeingResized,n.objectIdBeingDragged=null,n.objectIdBeingResized=null)}),l.addEventListener("mousedown",function(z){(null!==n.objectIdBeingDragged||null!==n.objectIdBeingResized)&&(z.preventDefault(),z.stopPropagation())})}},a.Cluster=h,a.BoxClusterDetector=function(l){var m=this,n=function(s,t){for(var u=0;u<t.length;u++)if(t[u].getId()===s.getId())return u;return-1},o=function(s,t){for(var v,u=0;u<s.length;u++)v=n(s[u],t),t.splice(v,1);return t},p=function(s){var t=0,u=null;return s.forEach(function(v,w){v>t&&(t=v,u=w)}),u};this.areObjectsClose=function(r,s){var t=new c(r.x-l,r.y-l,r.x+r.width+l,r.y+r.height+l),u=new c(s.x-l,s.y-l,s.x+s.width+l,s.y+s.height+l);return t.checkIntersect(u)},this.getAllObjectsCloseTo=function(r,s){for(var t=[],u=0;u<s.length;u++)r.getId()!==s[u].id&&m.areObjectsClose(r,s[u])&&t.push(s[u]);return t},this.getClusterObjectsFromSeed=function(r,s,t){var u=m.getAllObjectsCloseTo(r,s);return 0===u.length?[]:void(o(u.concat([r]),s),u.forEach(function(v){t.push(v),m.getClusterObjectsFromSeed(v,s,t)}))},this.findIntersectingClustersForObjects=function(r,s){var t=new Map;return s.forEach(function(u){for(var v=u.getObjects(),w=0;w<v.length;w++)for(var z=0;z<r.length;z++)if(v[w].getId()===r[z].getId())if(t.has(u)){var A=t.get(u);t.set(u,A+1)}else t.set(u,1)}),t},this.removeObjectFromClusters=function(r,s){s.forEach(function(t){t.removeObjectById(r.getId())})},this.computeClusters=function(r,s,t){for(var u=s.map(function(C){return C}),v=r.map(function(C){return C});0<v.length;){var w=v.pop(),z=[w];if(m.getClusterObjectsFromSeed(w,v,z),1<z.length){var A=m.findIntersectingClustersForObjects(z,u);0===A.size?function(){var C=new h(t());z.forEach(function(D){C.addObject(D)}),u.push(C)}():function(){var C=p(A);C.removeAllObjects(),z.forEach(function(D){m.removeObjectFromClusters(D,u),C.addObject(D)})}(),o(z,v)}else m.removeObjectFromClusters(w,u)}var B=u.filter(function(C){return!!(0<C.getObjects().length)});return B}}})(this.GraphPaper=this.GraphPaper||{});