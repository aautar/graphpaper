!function(t){"use strict";function e(t,e){this.getWidth=function(){return t},this.getHeight=function(){return e}}function n(t,e,n,i){this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return i},this.checkIntersect=function(c){return i<c.getTop()?!1:e>c.getBottom()?!1:n<c.getLeft()?!1:t>c.getRight()?!1:!0},this.checkIsWithin=function(c){return i>c.getBottom()||e<c.getTop()||n>c.getRight()||t<c.getLeft()?!1:!0}}function i(t,e){this.getX=function(){return t},this.getY=function(){return e}}function c(t,e,i,c,o,r){var u=this;this.id=t,this.x=e,this.y=i,this.width=c,this.height=o,this.domElement=r,this.isDeleted=!1,this.touchInternalContactPt=null,this.getId=function(){return u.id},this.getX=function(){return u.x},this.setX=function(t){u.x=t},this.getY=function(){return u.y},this.setY=function(t){u.y=t},this.translate=function(t,e){u.x=t,u.y=e},this.getWidth=function(){return u.width},this.getHeight=function(){return u.height},this.resize=function(t,e){u.width=t,u.height=e},this.getIsDeleted=function(){return u.isDeleted},this.getDomElement=function(){return u.domElement},this.getTouchInternalContactPt=function(){return u.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var t=parseInt(u.x),e=parseInt(u.y),i=t+parseInt(u.width),c=e+parseInt(u.height);return new n(t,e,i,c)}}function o(t,e){var c=this,o=12;this.getGridSize=function(){return o};var r=[];this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;var u={lastTouchX:null,lastTouchY:null,lastTouchTime:null},a=function(t){var e=Math.round(t/c.getGridSize())*c.getGridSize();return Math.max(0,e-1)};this.snapObjectToGrid=function(t){var e=a(t.getX()),n=a(t.getY());t.setX(e),t.setY(n)},this.getObjectsAroundPoint=function(t,e){var i=[],c=new n(t,e,t+1,e+1);return r.forEach(function(t){!t.getIsDeleted()&&c.checkIntersect(t.getBoundingRectange())&&i.push(t)}),i},this.calcBoundingBox=function(){var t=null,e=null,i=null,c=null;return r.forEach(function(n){var o=parseInt(n.getX()),r=parseInt(n.getY()),u=o+parseInt(n.getWidth()),a=r+parseInt(n.getHeight());(null===e||e>o)&&(e=o),(null===t||t>r)&&(t=r),(null===i||a>i)&&(i=a),(null===c||u>c)&&(c=u)}),new n(e,t,c,i)},this.getAllObjects=function(){return r},this.publishSiblingObjectChange=function(t,e){r.forEach(function(n){n.handleSiblingObjectChange(t,e)})},this.getObjectById=function(t){var e=null;return r.forEach(function(n){null===e&&n.id===t&&(e=n)}),e},this.addObject=function(t){r.push(t)};var g=function(t,n){var o=c.getObjectsAroundPoint(t,n);0===o.length&&e("dbl-click",new i(t,n))};this.initInteractionHandlers=function(n,i){t.addEventListener("dblclick",function(t){g(t.pageX,t.pageY)}),t.addEventListener("click",function(n){n.target===t?e("click",{canvasObjectClicked:!1}):e("click",{canvasObjectClicked:!0})}),t.addEventListener("touchend",function(t){if(t.originalEvent.changedTouches.length<=0)return!1;var e=!1,c=t.originalEvent.changedTouches[0].pageX,o=t.originalEvent.changedTouches[0].pageY,r=(new Date).getTime();if(null!==u.lastTouchTime){var a=u.lastTouchTime,h=r-a,s=u.lastTouchX,l=u.lastTouchY,d=Math.sqrt(Math.pow(c-s,2)+Math.pow(o-l,2));h>n||d>i||(e=!0,g(c,o),u.lastTouchTime=null,u.lastTouchX=null,u.lastTouchY=null)}e||(u.lastTouchTime=r,u.lastTouchX=c,u.lastTouchY=o)})};var h=function(t,e){var n=c.getObjectById(c.objectIdBeingDragged);n.touchInternalContactPt&&(t-=n.touchInternalContactPt.getX(),e-=n.touchInternalContactPt.getY());var i=a(t),o=a(e-.5*n.height);c.objectDragX=i,c.objectDragY=o,n.translate(i,o)},s=function(t,n){var i=c.getObjectById(c.objectIdBeingDragged),o=a(t),r=a(n-.5*i.height),u=c.objectDragStartX,g=c.objectDragStartY;u==o&&g==r||(i.translate(o,r),e("object-translated",i))};this.initTransformationHandlers=function(){t.addEventListener("touchmove",function(t){null!==c.objectIdBeingDragged&&(h(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY),t.preventDefault(),t.stopPropagation())}),t.addEventListener("mousemove",function(t){if(null!==c.objectIdBeingDragged)return h(t.pageX,t.pageY),!1;if(null!==c.objectIdBeingResized){var n=a(t.pageX),i=a(t.pageY),o=c.getObjectById(c.objectIdBeingResized),r=o.getY(),u=o.getX(),g=n-u+1,s=i-r+1;return o.resize(g,s),e("object-resized",o),!1}}),t.addEventListener("touchend",function(){if(null!==c.objectIdBeingDragged){var t=c.getObjectById(c.objectIdBeingDragged);t.touchInternalContactPt=null,c.objectIdBeingDragged=null,c.objectIdBeingResized=null}}),t.addEventListener("mouseup",function(t){1===t.which&&(null!==c.objectIdBeingDragged&&s(t.pageX,t.pageY),null!==c.objectIdBeingResized,c.objectIdBeingDragged=null,c.objectIdBeingResized=null)})}}t.Dimensions=e,t.Rectangle=n,t.Point=i,t.Object=c,t.Canvas=o}(this.GraphPaper=this.GraphPaper||{});