"use strict";var _slicedToArray=function(){function a(d,f){var g=[],h=!0,k=!1,l;try{for(var n,m=d[Symbol.iterator]();!(h=(n=m.next()).done)&&(g.push(n.value),!(f&&g.length===f));h=!0);}catch(o){k=!0,l=o}finally{try{!h&&m["return"]&&m["return"]()}finally{if(k)throw l}}return g}return function(d,f){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return a(d,f);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(a){"use strict";function f(w,z){this.getX=function(){return w},this.getY=function(){return z},this.isEqual=function(A){return w===A.getX()&&z===A.getY()},this.getCartesianPoint=function(A,B){return new f(w-0.5*A,-z+0.5*B)},this.toString=function(){return w+" "+z}}function g(w,z){this.getType=function(){return w},this.getIntersectionPoint=function(){return z}}function h(w,z){this.getStartPoint=function(){return w},this.getEndPoint=function(){return z},this.getLength=function(){return Math.sqrt(Math.pow(z.getX()-w.getX(),2)+Math.pow(z.getY()-w.getY(),2))},this.computeIntersectionType=function(A){var B=w.getX(),C=w.getY(),D=z.getX(),E=z.getY(),F=A.getStartPoint().getX(),G=A.getStartPoint().getY(),H=A.getEndPoint().getX(),I=A.getEndPoint().getY(),J=(I-G)*(D-B)-(H-F)*(E-C),K=(H-F)*(C-G)-(I-G)*(B-F),L=(D-B)*(C-G)-(E-C)*(B-F);if(0==J)return 0==J&&0==K&&0==L?u.COINCIDENT:u.PARALLEL;var M=K/J,N=L/J;return 1<M||0>M||1<N||0>N?u.LINE:u.LINESEG},this.computeIntersection=function(A){var B=w.getX(),C=w.getY(),D=z.getX(),E=z.getY(),F=A.getStartPoint().getX(),G=A.getStartPoint().getY(),H=A.getEndPoint().getX(),I=A.getEndPoint().getY(),J=(I-G)*(D-B)-(H-F)*(E-C),K=(H-F)*(C-G)-(I-G)*(B-F),L=(D-B)*(C-G)-(E-C)*(B-F);if(0==J)return 0==J&&0==K&&0==L?new g(u.COINCIDENT,null):new g(u.PARALLEL,null);var M=K/J,N=L/J,O=w.getX()+M*(z.getX()-w.getX()),P=w.getY()+M*(z.getY()-w.getY());return 1<M||0>M||1<N||0>N?new g(u.LINE,new f(O,P)):new g(u.LINESEG,new f(O,P))}}function k(w,z,A,B){this;this.getLeft=function(){return w},this.getTop=function(){return z},this.getRight=function(){return A},this.getBottom=function(){return B},this.getPoints=function(){return[new f(w,z),new f(A,z),new f(A,B),new f(w,B)]},this.getLines=function(){return[new h(new f(w,z),new f(A,z)),new h(new f(A,z),new f(A,B)),new h(new f(A,B),new f(w,B)),new h(new f(w,B),new f(w,z))]},this.getPointsScaledToGrid=function(D){var E=new f(w+0.5*(A-w),z+0.5*(B-z)),F=(A-E.getX()+D)/(A-E.getX()),G=(B-E.getY()+D)/(B-E.getY()),H=[new f((w-E.getX())*F+E.getX(),(z-E.getY())*G+E.getY()),new f((A-E.getX())*F+E.getX(),(z-E.getY())*G+E.getY()),new f((A-E.getX())*F+E.getX(),(B-E.getY())*G+E.getY()),new f((w-E.getX())*F+E.getX(),(B-E.getY())*G+E.getY())];return H},this.checkIntersect=function(D){return!(B<D.getTop())&&!(z>D.getBottom())&&!(A<D.getLeft())&&!(w>D.getRight())},this.checkIsPointWithin=function(D){return D.getX()>=w&&D.getX()<=A&&D.getY()>=z&&D.getY()<=B},this.checkIsWithin=function(D){return B<=D.getBottom()&&z>=D.getTop()&&A<=D.getRight()&&w>=D.getLeft()}}function l(w){var z=this,A=[];this.push=function(B){var C=!1;return(A.forEach(function(D){B.isEqual(D)&&(C=!0)}),!C)&&(A.push(B),!0)},this.findPointClosestTo=function(B){var C=null,D=Number.MAX_SAFE_INTEGER;return A.forEach(function(E){var F=new h(B,E);F.getLength()<D&&(C=E,D=F.getLength())}),C},this.findDistanceToPointClosestTo=function(B){var C=Number.MAX_SAFE_INTEGER;return A.forEach(function(D){var E=new h(B,D);E.getLength()<C&&(C=E.getLength())}),C},this.findPointsCloseTo=function(B,C){var D=new l;return A.forEach(function(E){var F=new h(B,E);F.getLength()<=C&&D.push(E)}),D},this.toArray=function(){return A},this.count=function(){return A.length},w&&Array.isArray(w)&&w.forEach(z.push)}function m(w,z,A){var B=this;this.getParentObject=function(){return z},this.getObjectId=function(){return z.getId()},this.getX=function(){return B.getCentroid().getX()},this.getY=function(){return B.getCentroid().getY()},this.getWidth=function(){return w.clientWidth},this.getHeight=function(){return w.clientHeight},this.getCentroid=function(){var C=w.getBoundingClientRect(),D=A.getPageOffset();return new f(C.left+D.getX()+0.5*w.clientWidth,C.top+D.getY()+0.5*w.clientHeight)},this.getRoutingPoints=function(C){var D=B.getCentroid(),E=0.5*w.clientWidth,F=0.5*w.clientHeight;return[new f(D.getX()+E+C,D.getY()),new f(D.getX()-E-C,D.getY()),new f(D.getX(),D.getY()+F+C),new f(D.getX(),D.getY()-F-C)]},this.getBoundingRectange=function(){var C=B.getCentroid(),D=0.5*w.clientWidth,E=0.5*w.clientHeight;return new k(C.getX()-D,C.getY()-E,C.getX()+D,C.getY()+E)},this.getDomElement=function(){return w}}function n(w,z,A,B,C){this;"undefined"==typeof B&&(B="#000"),"undefined"==typeof C&&(C="2px");var E=function(I){return"L"+I.getX()+" "+I.getY()},F=document.createElementNS("http://www.w3.org/2000/svg","path");F.setAttribute("d","M0 0 L0 0"),F.style.stroke=B,F.style.strokeWidth=C;this.appendPathToContainerDomElement=function(){A.appendChild(F)},this.refresh=function(H,I){var K=w.getCentroid(),L=H.findDistanceToPointClosestTo(K),M=H.findPointsCloseTo(K,L).findPointClosestTo(z.getCentroid()),N=H.findPointsCloseTo(z.getCentroid(),L).findPointClosestTo(K),O=I.computeRoute(M,N),P=O.toArray(),Q=K.getX()+" "+K.getY(),R=[];P.forEach(function(S){R.push(E(S))}),R.push(E(z.getCentroid())),F.setAttribute("d","M"+Q+R.join(" "))},this.getId=function(){var H=[w.getObjectId(),z.getObjectId()].sort();return H.join(":")}}function o(w,z){var A=this,B=new Map,C=function(H){for(var J,I=0;I<z.length;I++)if(J=z[I].computeIntersectionType(H),J===u.LINESEG)return!0;return!1},E=function(H){var I=Number.MAX_SAFE_INTEGER,J=null,K=!0,L=!1,M;try{for(var O,N=H.entries()[Symbol.iterator]();!(K=(O=N.next()).done);K=!0){var P=_slicedToArray(O.value,2),Q=P[0],R=P[1];R<I&&(J=Q,I=R)}}catch(S){L=!0,M=S}finally{try{!K&&N.return&&N.return()}finally{if(L)throw M}}return null===J?null:{cost:I,point:J}},F=function(H,I,J,K){var L=new Map,M=B.get(J);M=M.filter(function(O){for(var P=0;P<I.length;P++)if(O.isEqual(I[P]))return!1;return!0}),M.forEach(function(O){var P=new h(J,O).getLength()+H,Q=new h(O,K).getLength();L.set(O,P+Q)});var N=E(L);return null===N?null:N};this.findPointClosestTo=function(G){var H=null,I=Number.MAX_SAFE_INTEGER;return B.forEach(function(J,K){var L=new h(G,K);L.getLength()<I&&(H=K,I=L.getLength())}),H},this.findVisiblePointClosestTo=function(G){var H=null,I=Number.MAX_SAFE_INTEGER;return B.forEach(function(J,K){var L=new h(G,K);!C(L)&&L.getLength()<I&&(H=K,I=L.getLength())}),H},this.computeRoute=function(G,H){var I=A.findVisiblePointClosestTo(G);if(null===I)return new l;for(var M,J=0,K=[I],L=I;(M=F(J,K,L,H),null!==M)&&!(J+=new h(L,M.point).getLength(),K.push(M.point),L=M.point,1>new h(L,H).getLength()););return new l(K)},function(){for(var H=w.toArray(),I=0;I<H.length;I++)B.set(H[I],[]);for(var J=0;J<H.length;J++)for(var L,K=J+1;K<H.length;K++)if(L=new h(H[J],H[K]),!C(L)){var M=B.get(H[J]);M.push(H[K]),B.set(H[J],M);var N=B.get(H[K]);N.push(H[J]),B.set(H[K],N)}}()}function p(w,z,A){this.getSize=function(){return w},this.getStyle=function(){return A},this.getSvgImageTile=function(){return A===v.LINE?"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+w+"\" height=\""+w+"\"><rect width=\"12\" height=\"1\" x=\"0\" y=\"11\" style=\"fill:"+z+"\" /><rect width=\"1\" height=\"12\" x=\"11\" y=\"0\" style=\"fill:"+z+"\" /></svg>":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+w+"\" height=\""+w+"\"><rect width=\"1\" height=\"1\" x=\"11\" y=\"11\" style=\"fill:"+z+"\" /></svg>"}}function s(w){var z=this,A=[];this.getId=function(){return w},this.getObjectIndex=function(B){return z.getObjectIndexById(B.getId())},this.getObjectIndexById=function(B){for(var C=0;C<A.length;C++)if(A[C].getId()===B)return C;return null},this.addObject=function(B){return!(null!==z.getObjectIndex(B))&&(A.push(B),!0)},this.getObjects=function(){return A},this.getObjectIds=function(){var B=[];return A.forEach(function(C){B.push(C.getId())}),B},this.removeObjectById=function(B){var C=z.getObjectIndexById(B);return null!==C&&(A.splice(C,1),!0)},this.removeAllObjects=function(){A.length=0}}var u=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"}),v={LINE:"line",DOT:"dot"};a.Dimensions=function(w,z){this.getWidth=function(){return w},this.getHeight=function(){return z}},a.Rectangle=k,a.Point=f,a.LINE_INTERSECTION_TYPE=u,a.LineIntersection=g,a.Line=h,a.CanvasObject=function(w,z,A,B,C,D,E,F,G){var H=this,I=[];this.id=w,this.x=parseInt(z),this.y=parseInt(A),this.width=parseInt(B),this.height=parseInt(C),this.domElement=E,this.isDeleted=!1,this.addConnectorAnchor=function(L){var M=new m(L,H,D);L.addEventListener("click",function(){D.addConnectionAnchorToSelectionStack(M)}),I.push(M)},this.getConnectorAnchorRoutingPoints=function(L){var M=H.getBoundingRectange(),N=[];return I.forEach(function(O){var P=O.getRoutingPoints(L);P.forEach(function(Q){M.checkIsPointWithin(Q)||N.push(Q)})}),N},this.getConnectorAnchors=function(){return I},this.getTranslateHandleOffsetX=function(){return-(F.offsetLeft+0.5*F.offsetWidth)},this.getTranslateHandleOffsetY=function(){return-(F.offsetTop+0.5*F.offsetHeight)},this.getId=function(){return H.id},this.getX=function(){return H.x},this.setX=function(L){H.x=L},this.getY=function(){return H.y},this.setY=function(L){H.y=L},this.translate=function(L,M){H.x=L,H.y=M,H.domElement.style.left=parseInt(H.x)+"px",H.domElement.style.top=parseInt(H.y)+"px"},this.getWidth=function(){return H.width},this.getHeight=function(){return H.height},this.resize=function(L,M){H.width=L,H.height=M,H.domElement.style.width=parseInt(H.width)+"px",H.domElement.style.height=parseInt(H.height)+"px"},this.getIsDeleted=function(){return H.isDeleted},this.getDomElement=function(){return H.domElement},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var L=parseInt(H.x),M=parseInt(H.y),N=L+parseInt(H.width),O=M+parseInt(H.height);return new k(L,M,N,O)},this.getBoundingPoints=function(){var L=new f(H.getX(),H.getY()),M=new f(H.getX()+H.getWidth(),H.getY()),N=new f(H.getX(),H.getY()+H.getWidth()),O=new f(H.getX()+H.getWidth(),H.getY()+H.getWidth());return[L,M,N,O]};var J=function(){},K=function(){};this.setMoveStartCallback=function(L){J=L},this.setResizeStartCallback=function(L){K=L},F.addEventListener("touchstart",function(L){J(H,L.touches[0].pageX,L.touches[0].pageY,!0)}),F.addEventListener("mousedown",function(L){J(H,L.pageX,L.pageY,!1)}),G.addEventListener("mousedown",function(L){1!==L.which||K(H,L.pageX,L.pageY)})},a.Canvas=function(w,z,A){var B=this,C=A.document.createElementNS("http://www.w3.org/2000/svg","svg");C.style.width="100%",C.style.height="100%";var D=w.appendChild(C),E=null;this.setGrid=function(ca){E=ca,w.style.background="url('data:image/svg+xml;base64,"+A.btoa(E.getSvgImageTile())+"') repeat"},B.setGrid(new p(12,"#424242",v.DOT)),this.getGrid=function(){return E},this.getGridSize=function(){return E.getSize()};this.getCurrentPointVisibilityMap=function(){return null};var H=[],I=[],J=null,K=null,L=0,M=0,N=0,O=0,P={lastTouchX:null,lastTouchY:null,lastTouchTime:null},Q=1,R=1,S=[],T=function(){var da=new l;return H.forEach(function(ea){var fa=ea.getBoundingRectange().getPointsScaledToGrid(B.getGridSize());fa.forEach(function(ga){da.push(ga)})}),H.forEach(function(ea){var fa=ea.getConnectorAnchorRoutingPoints(B.getGridSize());fa.forEach(function(ga){da.push(ga)})}),da},U=function(){var da=new l;return H.forEach(function(ea){var fa=ea.getConnectorAnchorRoutingPoints(B.getGridSize());fa.forEach(function(ga){da.push(ga)})}),da},V=function(){var da=[];return H.forEach(function(ea){var fa=ea.getBoundingRectange().getLines();fa.forEach(function(ha){da.push(ha)});var ga=ea.getConnectorAnchors();ga.forEach(function(ha){var ia=ha.getBoundingRectange().getLines();ia.forEach(function(ja){da.push(ja)})})}),da},W=function(){var da=U(),ea=new o(T(),V());I.forEach(function(fa){fa.refresh(da,ea,B.getGridSize())})},X=function(da,ea,fa){return new n(da,ea,fa)};this.setConnectorFactory=function(ca){X=ca},this.setScaleFactor=function(ca){return Q=ca,R=1/Q,w.style.transform="scale3d("+Q+","+Q+","+Q+")",Q},this.getScaleFactor=function(){return Q},this.getPageOffset=function(){return new f(window.pageXOffset,window.pageYOffset)},this.snapToGrid=function(ca){var da=Math.round(ca/B.getGridSize())*B.getGridSize();return Math.max(0,da-1)},this.getOffsetLeft=function(){return w.offsetLeft},this.getOffsetTop=function(){return w.offsetTop},this.getObjectsAroundPoint=function(ca,da){var ea=[],fa=new k(ca,da,ca+1,da+1);return H.forEach(function(ga){!ga.getIsDeleted()&&fa.checkIntersect(ga.getBoundingRectange())&&ea.push(ga)}),ea},this.calcBoundingBox=function(){var ca=null,da=null,ea=null,fa=null;return H.forEach(function(ga){var ja=parseInt(ga.getX()),ka=parseInt(ga.getY()),la=ja+parseInt(ga.getWidth()),ma=ka+parseInt(ga.getHeight());(null==da||ja<da)&&(da=ja),(null==ca||ka<ca)&&(ca=ka),(null==ea||ma>ea)&&(ea=ma),(null==fa||la>fa)&&(fa=la)}),new k(da,ca,fa,ea)},this.getAllObjects=function(){return H},this.publishSiblingObjectChange=function(ca,da){H.forEach(function(ea){ea.handleSiblingObjectChange(ca,da)})},this.getObjectById=function(ca){var da=null;return H.forEach(function(ea){null==da&&ea.getId()===ca&&(da=ea)}),da},this.addObject=function(ca){ca.setResizeStartCallback(Z),ca.setMoveStartCallback($),H.push(ca),W()},this.getConnector=function(ca){for(var da=0;da<I.length;da++)if(I[da].getId()===ca)return I[da];return null},this.addConnectionAnchorToSelectionStack=function(ca){if(S.push(ca),2===S.length){var da=X(S[0],S[1],D),ea=B.getConnector(da.getId());S.length=0,null===ea&&(I.push(da),da.appendPathToContainerDomElement(),W())}};var Y=function(da,ea){var fa=B.getObjectsAroundPoint(da,ea);0===fa.length&&z("dbl-click",new f(da,ea))};this.initInteractionHandlers=function(ca,da){w.addEventListener("dblclick",function(ea){Y(ea.pageX,ea.pageY)}),w.addEventListener("click",function(ea){ea.target===w?z("click",{canvasObjectClicked:!1}):z("click",{canvasObjectClicked:!0})}),w.addEventListener("touchend",function(ea){if(0>=ea.originalEvent.changedTouches.length)return!1;var fa=!1,ga=ea.originalEvent.changedTouches[0].pageX,ha=ea.originalEvent.changedTouches[0].pageY,ia=new Date().getTime();if(null!==P.lastTouchTime){var ja=P.lastTouchTime,la=P.lastTouchX,ma=P.lastTouchY,na=Math.sqrt(Math.pow(ga-la,2)+Math.pow(ha-ma,2));ia-ja<=ca&&na<=da&&(fa=!0,Y(ga,ha),P.lastTouchTime=null,P.lastTouchX=null,P.lastTouchY=null)}fa||(P.lastTouchTime=ia,P.lastTouchX=ga,P.lastTouchY=ha)})};var Z=function(da){K=da.getId()},$=function(da,ea,fa){J=da.getId(),L=ea,M=fa,N=ea,O=fa},_=function(da,ea){var fa=B.getObjectById(J),ga=B.snapToGrid(da+fa.getTranslateHandleOffsetX()),ha=B.snapToGrid(ea+fa.getTranslateHandleOffsetY());L=ga,M=ha,fa.translate(ga,ha),W()},aa=function(da,ea){var fa=B.getObjectById(J),ga=B.snapToGrid(da+fa.getTranslateHandleOffsetX()),ha=B.snapToGrid(ea+fa.getTranslateHandleOffsetY()),ia=N,ja=O;ia==ga&&ja==ha||(fa.translate(ga,ha),z("object-translated",fa))},ba=function(da,ea){var fa=B.getObjectById(K),ga=B.snapToGrid(da),ha=B.snapToGrid(ea),ia=fa.getY(),ja=fa.getX();fa.resize(ga-ja+1,ha-ia+1),W(),z("object-resized",fa)};this.initTransformationHandlers=function(){w.addEventListener("touchmove",function(ca){null!==J&&_(ca.touches[0].pageX*R,ca.touches[0].pageY*R)}),w.addEventListener("mousemove",function(ca){null!==J&&_(ca.pageX*R,ca.pageY*R),null!==K&&ba(ca.pageX*R,ca.pageY*R)}),w.addEventListener("touchend",function(){if(null!==J){B.getObjectById(J);J=null,K=null}}),w.addEventListener("mouseup",function(ca){1===ca.which&&(null!==J&&aa(ca.pageX*R,ca.pageY*R),null!==K,J=null,K=null)}),w.addEventListener("mousedown",function(ca){(null!==J||null!==K)&&(ca.preventDefault(),ca.stopPropagation())})}},a.Cluster=s,a.BoxClusterDetector=function(w){var z=this,A=function(F,G){for(var H=0;H<G.length;H++)if(G[H].getId()===F.getId())return H;return-1},B=function(F,G){for(var I,H=0;H<F.length;H++)I=A(F[H],G),-1!==I&&G.splice(I,1);return G},C=function(F){var G=0,H=null;return F.forEach(function(I,J){I>G&&(G=I,H=J)}),H};this.areObjectsClose=function(E,F){var G=new k(E.x-w,E.y-w,E.x+E.width+w,E.y+E.height+w),H=new k(F.x-w,F.y-w,F.x+F.width+w,F.y+F.height+w);return G.checkIntersect(H)},this.getAllObjectsCloseTo=function(E,F){for(var G=[],H=0;H<F.length;H++)E.getId()!==F[H].getId()&&z.areObjectsClose(E,F[H])&&G.push(F[H]);return G},this.getClusterObjectsFromSeed=function(E,F,G){var H=z.getAllObjectsCloseTo(E,F);return 0===H.length?[]:void(B(H.concat([E]),F),H.forEach(function(I){G.push(I),z.getClusterObjectsFromSeed(I,F,G)}))},this.findIntersectingClustersForObjects=function(E,F){var G=new Map;return F.forEach(function(H){for(var I=H.getObjects(),J=0;J<I.length;J++)for(var K=0;K<E.length;K++)if(I[J].getId()===E[K].getId())if(G.has(H)){var L=G.get(H);G.set(H,L+1)}else G.set(H,1)}),G},this.removeObjectFromClusters=function(E,F){F.forEach(function(G){G.removeObjectById(E.getId())})},this.computeClusters=function(E,F,G){for(var H=F.map(function(N){return N}),I=E.map(function(N){return N});0<I.length;){var J=I.pop(),K=[J];if(z.getClusterObjectsFromSeed(J,I,K),1<K.length){var L=z.findIntersectingClustersForObjects(K,H);0===L.size?function(){var N=new s(G());K.forEach(function(O){N.addObject(O)}),H.push(N)}():function(){var N=C(L);N.removeAllObjects(),K.forEach(function(O){z.removeObjectFromClusters(O,H),N.addObject(O)})}(),B(K,I)}else z.removeObjectFromClusters(J,H)}var M=H.filter(function(N){return!!(2<=N.getObjects().length)});return M}},a.Connector=n,a.ConnectorAnchor=m,a.PointVisibilityMap=o,a.GRID_STYLE=v,a.Grid=p})(this.GraphPaper=this.GraphPaper||{});