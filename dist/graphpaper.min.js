!function(t){"use strict";function e(t,e){this.getWidth=function(){return t},this.getHeight=function(){return e}}function n(t,e,n,i){this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return i},this.checkIntersect=function(o){return i<o.getTop()?!1:e>o.getBottom()?!1:n<o.getLeft()?!1:t>o.getRight()?!1:!0},this.checkIsWithin=function(o){return i>o.getBottom()||e<o.getTop()||n>o.getRight()||t<o.getLeft()?!1:!0}}function i(t,e){this.getX=function(){return t},this.getY=function(){return e}}function o(t,e){var o=this,r=12;this.getGridSize=function(){return r};var c=[];this.objectIdBeingDragged=null,this.objectIdBeingResized=null,this.objectDragX=0,this.objectDragY=0,this.objectDragStartX=0,this.objectDragStartY=0;var a={lastTouchX:null,lastTouchY:null,lastTouchTime:null},u=1,s=1;this.setScaleFactor=function(e){return u=e,s=1/u,t.style.transform="scale3d("+u+","+u+","+u+")",u},this.getScaleFactor=function(){return u},this.snapToGrid=function(t){var e=Math.round(t/o.getGridSize())*o.getGridSize();return Math.max(0,e-1)},this.getOffsetLeft=function(){return t.offsetLeft},this.getOffsetTop=function(){return t.offsetTop},this.getObjectsAroundPoint=function(t,e){var i=[],o=new n(t,e,t+1,e+1);return c.forEach(function(t){!t.getIsDeleted()&&o.checkIntersect(t.getBoundingRectange())&&i.push(t)}),i},this.calcBoundingBox=function(){var t=null,e=null,i=null,o=null;return c.forEach(function(n){var r=parseInt(n.getX()),c=parseInt(n.getY()),a=r+parseInt(n.getWidth()),u=c+parseInt(n.getHeight());(null===e||e>r)&&(e=r),(null===t||t>c)&&(t=c),(null===i||u>i)&&(i=u),(null===o||a>o)&&(o=a)}),new n(e,t,o,i)},this.getAllObjects=function(){return c},this.publishSiblingObjectChange=function(t,e){c.forEach(function(n){n.handleSiblingObjectChange(t,e)})},this.getObjectById=function(t){var e=null;return c.forEach(function(n){null===e&&n.getId()===t&&(e=n)}),e},this.addObject=function(t){c.push(t)};var g=function(t,n){var r=o.getObjectsAroundPoint(t,n);0===r.length&&e("dbl-click",new i(t,n))};this.initInteractionHandlers=function(n,i){t.addEventListener("dblclick",function(t){g(t.pageX,t.pageY)}),t.addEventListener("click",function(n){n.target===t?e("click",{canvasObjectClicked:!1}):e("click",{canvasObjectClicked:!0})}),t.addEventListener("touchend",function(t){if(t.originalEvent.changedTouches.length<=0)return!1;var e=!1,o=t.originalEvent.changedTouches[0].pageX,r=t.originalEvent.changedTouches[0].pageY,c=(new Date).getTime();if(null!==a.lastTouchTime){var u=a.lastTouchTime,s=c-u,h=a.lastTouchX,l=a.lastTouchY,d=Math.sqrt(Math.pow(o-h,2)+Math.pow(r-l,2));s>n||d>i||(e=!0,g(o,r),a.lastTouchTime=null,a.lastTouchX=null,a.lastTouchY=null)}e||(a.lastTouchTime=c,a.lastTouchX=o,a.lastTouchY=r)})};var h=function(t,e){var n=o.getObjectById(o.objectIdBeingDragged);n.touchInternalContactPt&&(t-=n.touchInternalContactPt.getX(),e-=n.touchInternalContactPt.getY());var i=o.snapToGrid(t+n.getTranslateHandleOffsetX()),r=o.snapToGrid(e+n.getTranslateHandleOffsetY());o.objectDragX=i,o.objectDragY=r,n.translate(i,r)},l=function(t,n){var i=o.getObjectById(o.objectIdBeingDragged),r=o.snapToGrid(t+i.getTranslateHandleOffsetX()),c=o.snapToGrid(n+i.getTranslateHandleOffsetY()),a=o.objectDragStartX,u=o.objectDragStartY;a==r&&u==c||(i.translate(r,c),e("object-translated",i))};this.initTransformationHandlers=function(){t.addEventListener("touchmove",function(t){null!==o.objectIdBeingDragged&&h(t.touches[0].pageX*s,t.touches[0].pageY*s)}),t.addEventListener("mousemove",function(t){if(null!==o.objectIdBeingDragged&&h(t.pageX*s,t.pageY*s),null!==o.objectIdBeingResized){var n=o.snapToGrid(t.pageX*s),i=o.snapToGrid(t.pageY*s),r=o.getObjectById(o.objectIdBeingResized),c=r.getY(),a=r.getX(),u=n-a+1,g=i-c+1;r.resize(u,g),e("object-resized",r)}}),t.addEventListener("touchend",function(){if(null!==o.objectIdBeingDragged){var t=o.getObjectById(o.objectIdBeingDragged);t.touchInternalContactPt=null,o.objectIdBeingDragged=null,o.objectIdBeingResized=null}}),t.addEventListener("mouseup",function(t){1===t.which&&(null!==o.objectIdBeingDragged&&l(t.pageX*s,t.pageY*s),null!==o.objectIdBeingResized,o.objectIdBeingDragged=null,o.objectIdBeingResized=null)}),t.addEventListener("mousedown",function(t){(null!==o.objectIdBeingDragged||null!==o.objectIdBeingResized)&&(t.preventDefault(),t.stopPropagation())})}}function r(t,e,o,r,c,a,u,s,g){var h=this;this.id=t,this.x=e,this.y=o,this.width=r,this.height=c,this.domElement=u,this.isDeleted=!1,this.touchInternalContactPt=null,this.getTranslateHandleOffsetX=function(){return-(s.offsetLeft+.5*s.offsetWidth)},this.getTranslateHandleOffsetY=function(){return-(s.offsetTop+.5*s.offsetHeight)},this.getId=function(){return h.id},this.getX=function(){return h.x},this.setX=function(t){h.x=t},this.getY=function(){return h.y},this.setY=function(t){h.y=t},this.translate=function(t,e){h.x=t,h.y=e,h.domElement.style.left=parseInt(h.x)+"px",h.domElement.style.top=parseInt(h.y)+"px"},this.getWidth=function(){return h.width},this.getHeight=function(){return h.height},this.resize=function(t,e){h.width=t,h.height=e,h.domElement.style.width=parseInt(h.width)+"px",h.domElement.style.height=parseInt(h.height)+"px"},this.getIsDeleted=function(){return h.isDeleted},this.getDomElement=function(){return h.domElement},this.getTouchInternalContactPt=function(){return h.touchInternalContactPt},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){var t=parseInt(h.x),e=parseInt(h.y),i=t+parseInt(h.width),o=e+parseInt(h.height);return new n(t,e,i,o)};var l=function(t){t.touches&&(h.touchInternalContactPt=new i(t.touches[0].pageX-h.getX(),t.touches[0].pageY-h.getY()));var e=t.pageX,n=t.pageY;a.objectIdBeingDragged=h.getId(),a.objectDragX=e,a.objectDragY=n,a.objectDragStartX=e,a.objectDragStartY=n};s.addEventListener("touchstart",function(t){l(t)}),s.addEventListener("mousedown",function(t){l(t)}),g.addEventListener("mousedown",function(t){1===t.which&&(a.objectIdBeingResized=h.getId())})}function c(t){var e=this,n=[];this.getId=function(){return t},this.getObjectIndex=function(t){for(var e=0;e<n.length;e++)if(n[e].getId()===t)return e;return null},this.addObject=function(t){return null!==e.getObjectIndex(t.getId())?!1:(n.push(t),!0)},this.getObjects=function(){return n},this.getObjectIds=function(){var t=[];return n.forEach(function(e){t.push(e.getId())}),t},this.removeObject=function(t){var i=e.getObjectIndex(t);return null===i?!1:(n.splice(i,1),!0)}}t.Dimensions=e,t.Rectangle=n,t.Point=i,t.CanvasObject=r,t.Canvas=o,t.Cluster=c}(this.GraphPaper=this.GraphPaper||{});