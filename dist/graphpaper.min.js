var GraphPaper=function(t){"use strict";function o(m,X){this.__x=m,this.__y=X}function g(m,X){this.getType=function(){return m},this.getIntersectionPoint=function(){return X}}function s(m,X){if("undefined"==typeof m||null===m)throw"Line missing _startPoint";if("undefined"==typeof X||null===X)throw"Line missing _endPoint";this.__startPoint=m,this.__endPoint=X}function a(m,X,O,L){this.getLeft=function(){return m},this.getTop=function(){return X},this.getRight=function(){return O},this.getBottom=function(){return L},this.getPoints=function(){return[new o(m,X),new o(O,X),new o(O,L),new o(m,L)]},this.getLines=function(){return[new s(new o(m,X),new o(O,X)),new s(new o(O,X),new o(O,L)),new s(new o(O,L),new o(m,L)),new s(new o(m,L),new o(m,X))]},this.getPointsScaledToGrid=function(Y){const S=new o(m+0.5*(O-m),X+0.5*(L-X)),v=(O-S.getX()+Y)/(O-S.getX()),w=(L-S.getY()+Y)/(L-S.getY()),B=[new o((m-S.getX())*v+S.getX(),(X-S.getY())*w+S.getY()),new o((O-S.getX())*v+S.getX(),(X-S.getY())*w+S.getY()),new o((O-S.getX())*v+S.getX(),(L-S.getY())*w+S.getY()),new o((m-S.getX())*v+S.getX(),(L-S.getY())*w+S.getY())];return B},this.checkIntersect=function(Y){return!(L<Y.getTop())&&!(X>Y.getBottom())&&!(O<Y.getLeft())&&!(m>Y.getRight())},this.checkIsPointWithin=function(Y){return Y.getX()>=m&&Y.getX()<=O&&Y.getY()>=X&&Y.getY()<=L},this.checkIsWithin=function(Y){return L<=Y.getBottom()&&X>=Y.getTop()&&O<=Y.getRight()&&m>=Y.getLeft()}}function h(m){const X=this,O=[];this.push=function(Y){for(let S=0;S<O.length;S++)if(Y.isEqual(O[S]))return!1;return O.push(Y),!0},this.pushPointSet=function(Y){const S=Y.toArray();for(let v=0;v<S.length;v++)X.push(S[v])},this.findPointClosestTo=function(Y){var S=null,v=Number.MAX_SAFE_INTEGER;return O.forEach(function(w){const B=new s(Y,w);B.getLength()<v&&(S=w,v=B.getLength())}),S},this.findDistanceToPointClosestTo=function(Y){var S=Number.MAX_SAFE_INTEGER;return O.forEach(function(v){const w=new s(Y,v);w.getLength()<S&&(S=w.getLength())}),S},this.findPointsCloseTo=function(Y,S){const v=new h;return O.forEach(function(w){const B=new s(Y,w);B.getLength()<=S&&v.push(w)}),v},this.toArray=function(){return O},this.toFloat64Array=function(){const Y=new Float64Array(2*O.length);for(let S=0;S<O.length;S++)Y[0+2*S]=O[S].getX(),Y[1+2*S]=O[S].getY();return Y};this.count=function(){return O.length},m&&Array.isArray(m)?m.forEach(X.push):m&&"[object Float64Array]"===Object.prototype.toString.call(m)&&function(Y){O.length=0;for(let S=0;S<Y.length;S+=2)O.push(new o(Y[S],Y[S+1]))}(m)}function l(m){const X=this,O=[];this.push=function(Y){var S=!1;return(O.forEach(function(v){Y.isEqual(v)&&(S=!0)}),!S)&&(O.push(Y),!0)},this.toArray=function(){return O},this.count=function(){return O.length},this.toFloat64Array=function(){const Y=new Float64Array(4*O.length);for(let S=0;S<O.length;S++)Y[0+4*S]=O[S].getStartPoint().getX(),Y[1+4*S]=O[S].getStartPoint().getY(),Y[2+4*S]=O[S].getEndPoint().getX(),Y[3+4*S]=O[S].getEndPoint().getY();return Y};m&&Array.isArray(m)?m.forEach(X.push):m&&"[object Float64Array]"===Object.prototype.toString.call(m)&&function(Y){O.length=0;for(let S=0;S<Y.length;S+=4)O.push(new s(new o(Y[S],Y[S+1]),new o(Y[S+2],Y[S+3])))}(m)}function u(m,X,O){const L=this;this.getId=function(){return m},this.getX=function(){return L.getCentroid().getX()},this.getY=function(){return L.getCentroid().getY()},this.getWidth=function(){const Y=X.getBoundingClientRect();return Y.right-Y.left},this.getHeight=function(){const Y=X.getBoundingClientRect();return Y.bottom-Y.top},this.getCentroid=function(){const Y=X.getBoundingClientRect(),S=O.getPageOffset();return new o(Y.left+S.getX()+0.5*L.getWidth(),Y.top+S.getY()+0.5*L.getHeight())},this.getRoutingPoints=function(Y){const S=L.getCentroid(),v=0.5*L.getWidth(),w=0.5*L.getHeight();return[new o(S.getX()+v+Y,S.getY()),new o(S.getX()-v-Y,S.getY()),new o(S.getX(),S.getY()+w+Y),new o(S.getX(),S.getY()-w-Y)]},this.getBoundingRectange=function(){const Y=L.getCentroid(),S=0.5*L.getWidth(),v=0.5*L.getHeight();return new a(Y.getX()-S,Y.getY()-v,Y.getX()+S,Y.getY()+v)}}function f(m,X,O,L,Y){const S=this;"undefined"==typeof L&&(L="#000"),"undefined"==typeof Y&&(Y="2px");const v=window.document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d","M0 0 L0 0"),v.style.stroke=L,v.style.strokeWidth=Y;this.appendPathToContainerDomElement=function(){O.appendChild(v)},this.refresh=function(B){v.setAttribute("d",B)},this.getId=function(){const B=[m.getId(),X.getId()].sort();return B.join(":")},this.getAnchorStart=function(){return m},this.getAnchorEnd=function(){return X},this.removePathElement=function(){v.remove()},this.getDescriptor=function(){return{id:S.getId(),anchor_start_centroid:m.getCentroid().toString(),anchor_end_centroid:X.getCentroid().toString()}}}function E(m,X,O){this.getSize=function(){return m},this.getStyle=function(){return O},this.getSvgImageTile=function(){return O===P.LINE?"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+m+"\" height=\""+m+"\"><rect width=\""+m+"\" height=\"1\" x=\"0\" y=\""+(m-1)+"\" style=\"fill:"+X+"\" /><rect width=\"1\" height=\""+m+"\" x=\""+(m-1)+"\" y=\"0\" style=\"fill:"+X+"\" /></svg>":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+m+"\" height=\""+m+"\"><rect width=\"1\" height=\"1\" x=\""+(m-1)+"\" y=\""+(m-1)+"\" style=\"fill:"+X+"\" /></svg>"}}function I(m){const X=this,O=[];this.getId=function(){return m},this.getObjectIndex=function(L){return X.getObjectIndexById(L.getId())},this.getObjectIndexById=function(L){for(let Y=0;Y<O.length;Y++)if(O[Y].getId()===L)return Y;return null},this.addObject=function(L){return null===X.getObjectIndex(L)&&(O.push(L),!0)},this.getObjects=function(){return O},this.getObjectIds=function(){const L=[];return O.forEach(function(Y){L.push(Y.getId())}),L},this.removeObjectById=function(L){const Y=X.getObjectIndexById(L);return null!==Y&&(O.splice(Y,1),!0)},this.removeAllObjects=function(){O.length=0}}o.prototype.getX=function(){return this.__x},o.prototype.getY=function(){return this.__y},o.prototype.isEqual=function(m){return this.__x===m.getX()&&this.__y===m.getY()},o.prototype.getCartesianPoint=function(m,X){return new o(this.__x-0.5*m,-this.__y+0.5*X)},o.prototype.toString=function(){return this.__x+" "+this.__y};const _=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"});s.prototype.getStartPoint=function(){return this.__startPoint},s.prototype.getEndPoint=function(){return this.__endPoint},s.prototype.isEqual=function(m){return this.getStartPoint().isEqual(m.getStartPoint())&&this.getEndPoint().isEqual(m.getEndPoint())},s.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},s.prototype.computeIntersectionType=function(m){const X=this.__startPoint.getX(),O=this.__startPoint.getY(),L=this.__endPoint.getX(),Y=this.__endPoint.getY(),S=m.getStartPoint().getX(),v=m.getStartPoint().getY(),w=m.getEndPoint().getX(),B=m.getEndPoint().getY(),D=(B-v)*(L-X)-(w-S)*(Y-O),R=(w-S)*(O-v)-(B-v)*(X-S),N=(L-X)*(O-v)-(Y-O)*(X-S);if(0==D)return 0==D&&0==R&&0==N?_.COINCIDENT:_.PARALLEL;const G=R/D,F=N/D;return 1<G||0>G||1<F||0>F?_.LINE:_.LINESEG},s.prototype.computeIntersection=function(m){const X=this.__startPoint.getX(),O=this.__startPoint.getY(),L=this.__endPoint.getX(),Y=this.__endPoint.getY(),S=m.getStartPoint().getX(),v=m.getStartPoint().getY(),w=m.getEndPoint().getX(),B=m.getEndPoint().getY(),D=(B-v)*(L-X)-(w-S)*(Y-O),R=(w-S)*(O-v)-(B-v)*(X-S),N=(L-X)*(O-v)-(Y-O)*(X-S);if(0==D)return 0==D&&0==R&&0==N?new g(_.COINCIDENT,null):new g(_.PARALLEL,null);const G=R/D,F=N/D,k=this.__startPoint.getX()+G*(this.__endPoint.getX()-this.__startPoint.getX()),W=this.__startPoint.getY()+G*(this.__endPoint.getY()-this.__startPoint.getY());return 1<G||0>G||1<F||0>F?new g(_.LINE,new o(k,W)):new g(_.LINESEG,new o(k,W))};const P={LINE:"line",DOT:"dot"};return t.Dimensions=function(m,X){this.getWidth=function(){return m},this.getHeight=function(){return X}},t.Rectangle=a,t.Point=o,t.LINE_INTERSECTION_TYPE=_,t.LineIntersection=g,t.Line=s,t.CanvasObject=function(m,X,O,L,Y,S,v,w,B){const D=this,N=[];var G=1e3,F=null;this.x=parseInt(X),this.y=parseInt(O),this.width=parseInt(L),this.height=parseInt(Y),this.isDeleted=!1,this.addNonInteractableConnectorAnchor=function(M){const q=new u(m+`-${G}`,M,S);return N.push(q),G++,q},this.addInteractableConnectorAnchor=function(M){const q=new u(m+`-${G}`,M,S);return M.addEventListener("click",function(){S.addConnectionAnchorToSelectionStack(q)}),N.push(q),G++,q},this.getConnectorAnchorRoutingPoints=function(M){const q=[];return N.forEach(function(J){const V=J.getRoutingPoints(M);V.forEach(function(K){q.push(K)})}),q},this.getConnectorAnchors=function(){return N},this.hasConnectorAnchor=function(M){const q=D.getConnectorAnchors();for(let J=0;J<q.length;J++)if(q[J]===M)return!0;return!1},this.getTranslateHandleOffset=function(){return F?new o(-(F.offsetLeft+0.5*F.offsetWidth),-(F.offsetTop+0.5*F.offsetHeight)):null},this.getId=function(){return m},this.getX=function(){return D.x},this.setX=function(M){D.x=M},this.getY=function(){return D.y},this.setY=function(M){D.y=M},this.translate=function(M,q){D.x=M,D.y=q,v.style.left=parseInt(D.x)+"px",v.style.top=parseInt(D.y)+"px"},this.getWidth=function(){return D.width},this.getHeight=function(){return D.height},this.resize=function(M,q){D.width=M,D.height=q,v.style.width=parseInt(D.width)+"px",v.style.height=parseInt(D.height)+"px"},this.getIsDeleted=function(){return D.isDeleted},this.getDomElement=function(){return v},this.handleSiblingObjectChange=function(){},this.getBoundingRectange=function(){const M=parseInt(D.x),q=parseInt(D.y),J=M+parseInt(D.width),V=q+parseInt(D.height);return new a(M,q,J,V)},this.getBoundingPoints=function(){const M=new o(D.getX(),D.getY()),q=new o(D.getX()+D.getWidth(),D.getY()),J=new o(D.getX(),D.getY()+D.getWidth()),V=new o(D.getX()+D.getWidth(),D.getY()+D.getWidth());return[M,q,J,V]};var k=function(){},W=function(){};this.setMoveStartCallback=function(M){k=M},this.setResizeStartCallback=function(M){W=M};(function(){w.forEach(M=>{M.addEventListener("touchstart",function(q){F=M,k(D,q.touches[0].pageX,q.touches[0].pageY,!0)}),M.addEventListener("mousedown",function(q){F=M,k(D,q.pageX,q.pageY,!1)})})})(),function(){B.forEach(M=>{M.addEventListener("mousedown",function(q){q.which!==1||W(D,q.pageX,q.pageY)})})}()},t.Canvas=function(m,X,O){const L=this,Y={DBLCLICK:"dblclick",CLICK:"click",OBJECT_ADDED:"object-added",OBJECT_RESIZED:"object-resized",OBJECT_TRANSLATED:"object-translated"},S=X.document.createElementNS("http://www.w3.org/2000/svg","svg");S.style.width="100%",S.style.height="100%";const v=m.appendChild(S);var w=null,B="transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out",D=0,R=0,N=0,G=0,F=1,k=1,W=[];const H=[],M=[];var q=null,J=null,V=0,K=0,Z={lastTouchX:null,lastTouchY:null,lastTouchTime:null};const U=[],Q=new Map,$=new Map;this.getCurrentPointVisibilityMap=function(){return null},this.setGrid=function(ue){w=ue,m.style.background="url('data:image/svg+xml;base64,"+X.btoa(w.getSvgImageTile())+"') repeat"},this.getGrid=function(){return w},this.getGridSize=function(){return w.getSize()};const ee=function(ue){$.clear();const fe=[],pe=[];return ue.forEach(Ee=>{const Ce=Ee.getConnectorAnchors();Ce.forEach(Te=>{const Ie=Te.getRoutingPoints(L.getGridSize());Ie.forEach(be=>{fe.push({routingPoint:be,parentAnchor:Te})}),$.set(Te.getId(),Ie.length)})}),fe.forEach(Ee=>{let Ce=!1;for(let Te=0;Te<ue.length;Te++){const Ie=ue[Te],be=Ie.getBoundingRectange();if(be.checkIsPointWithin(Ee.routingPoint)){Ce=!0;const Ae=$.get(Ee.parentAnchor.getId())||0;$.set(Ee.parentAnchor.getId(),Ae-1)}}Ce||pe.push(Ee.routingPoint)}),pe},te=function(){const ue=new h;return H.forEach(function(fe){const pe=fe.getBoundingRectange().getPointsScaledToGrid(L.getGridSize());pe.forEach(Ee=>{ue.push(Ee)})}),ue},ne=function(){const ue=new h,fe=ee(H);return fe.forEach(pe=>{ue.push(pe)}),ue},oe=function(){const ue=[];return H.forEach(function(fe){const pe=fe.getBoundingRectange().getLines();pe.forEach(Ce=>{ue.push(Ce)});const Ee=fe.getConnectorAnchors();Ee.forEach(function(Ce){const Te=Ce.getBoundingRectange().getLines();Te.forEach(Ie=>{ue.push(Ie)})})}),new l(ue)},ge=function(){const ue=[];M.forEach(function(be){ue.push(be.getDescriptor())});const fe=ne(),pe=te(),Ee=new h;Ee.pushPointSet(fe),Ee.pushPointSet(pe);const Ce=fe.toFloat64Array(),Te=Ee.toFloat64Array(),Ie=oe().toFloat64Array();O.postMessage({gridSize:L.getGridSize(),connectorDescriptors:ue,routingPoints:Te.buffer,boundaryLines:Ie.buffer,routingPointsAroundAnchor:Ce.buffer},[Te.buffer,Ie.buffer,Ce.buffer])};O.onmessage=function(ue){const fe=ue.data.connectorDescriptors,pe=function(Ee){for(let Ce=0;Ce<fe.length;Ce++)if(fe[Ce].id===Ee)return fe[Ce];return null};M.forEach(function(Ee){const Ce=pe(Ee.getId());Ce&&Ee.refresh(Ce.svgPath)})};var ie=function(ue,fe,pe){return new f(ue,fe,pe)};this.setConnectorFactory=function(ue){ie=ue},this.getTransitionCss=function(){return B},this.setTransitionCss=function(ue){B=ue,m.style.transition=B},this.getTransformOriginX=function(){return D},this.getTransformOriginY=function(){return R},this.getScaleFactor=function(){return F},this.getTranslateX=function(){return N},this.getTranslateY=function(){return G},this.setTransformOrigin=function(ue,fe){D=ue,R=fe,m.style.transformOrigin=`${D}px ${R}px`},this.scale=function(ue,fe){if(fe=fe||!1,fe){const pe=L.getGridSize()*ue,Ee=Math.round(pe);ue=Ee/L.getGridSize()}return F=ue,k=1/F,W.push(`scale3d(${F},${F},${F})`),L},this.translate=function(ue,fe){return N=ue,G=fe,W.push(`translate3d(${N}px,${G}px,0)`),L},this.applyTransform=function(){m.style.transform=W.join(" "),W.length=0},this.resetTransform=function(){F=1,k=1,N=0,G=0,m.style.transform="none"},this.getPageOffset=function(){return new o(window.pageXOffset,window.pageYOffset)},this.snapToGrid=function(ue){var fe=Math.round(ue/L.getGridSize())*L.getGridSize();return Math.max(0,fe-1)},this.getOffsetLeft=function(){return m.offsetLeft},this.getOffsetTop=function(){return m.offsetTop},this.getWidth=function(){return m.offsetWidth},this.getHeight=function(){return m.offsetHeight},this.getObjectsAroundPoint=function(ue,fe){var pe=[],Ee=new a(ue,fe,ue+1,fe+1);return H.forEach(function(Ce){!Ce.getIsDeleted()&&Ee.checkIntersect(Ce.getBoundingRectange())&&pe.push(Ce)}),pe},this.calcBoundingBox=function(){var ue=null,fe=null,pe=null,Ee=null;return H.forEach(function(Ce){var be=parseInt(Ce.getX()),Ae=parseInt(Ce.getY()),_e=be+parseInt(Ce.getWidth()),Pe=Ae+parseInt(Ce.getHeight());(null==fe||be<fe)&&(fe=be),(null==ue||Ae<ue)&&(ue=Ae),(null==pe||Pe>pe)&&(pe=Pe),(null==Ee||_e>Ee)&&(Ee=_e)}),new a(fe,ue,Ee,pe)},this.getAllObjects=function(){return H},this.publishSiblingObjectChange=function(ue,fe){H.forEach(function(pe){pe.handleSiblingObjectChange(ue,fe)})},this.getObjectById=function(ue){var fe=null;return H.forEach(function(pe){null==fe&&pe.getId()===ue&&(fe=pe)}),fe},this.addObject=function(ue){ue.setResizeStartCallback(se),ue.setMoveStartCallback(de),H.push(ue),ge(),le(Y.OBJECT_ADDED,{object:ue})},this.getConnector=function(ue){for(let fe=0;fe<M.length;fe++)if(M[fe].getId()===ue)return M[fe];return null},this.getConnectorsBetweenObjects=function(ue,fe){const pe=[];return M.forEach(Ee=>{const Ce=Ee.getAnchorStart(),Te=Ee.getAnchorEnd();ue.hasConnectorAnchor(Ce)&&fe.hasConnectorAnchor(Te)&&pe.push(Ee),ue.hasConnectorAnchor(Te)&&fe.hasConnectorAnchor(Ce)&&pe.push(Ee)}),pe},this.getConnectorsConnectedToObject=function(ue){const fe=[];return M.forEach(pe=>{const Ee=pe.getAnchorStart(),Ce=pe.getAnchorEnd();ue.hasConnectorAnchor(Ee)&&ue.hasConnectorAnchor(Ce)&&fe.push(pe)}),fe},this.removeAllConnectors=function(){M.forEach(function(ue){ue.removePathElement()}),M.splice(0,M.length)},this.removeConnector=function(ue){for(let fe=0;fe<M.length;fe++)if(M[fe]===ue)return M.splice(fe,1),!0;return!1},this.makeNewConnectorFromAnchors=function(ue,fe){const pe=ie(ue,fe,v),Ee=L.getConnector(pe.getId());return null===Ee?(M.push(pe),pe.appendPathToContainerDomElement(),ge(),pe):Ee},this.findBestConnectorAnchorsToConnectObjects=function(ue,fe,pe){const Ee=Ce=>{const Te=Ce.objectA.getConnectorAnchors(),Ie=Ce.objectB.getConnectorAnchors();var be=0,Ae=0,_e=Number.MAX_VALUE;for(let Pe=0;Pe<Te.length;Pe++){const me=$.get(Te[Pe].getId())||0;if(0!==me)for(let ye=0;ye<Ie.length;ye++){const Xe=Te[Pe].getCentroid(),Oe=Ie[ye].getCentroid(),Le=Math.sqrt(Math.pow(Oe.getX()-Xe.getX(),2)+Math.pow(Oe.getY()-Xe.getY(),2)),Ye=$.get(Ie[ye].getId())||0;Le<_e&&0<Ye&&(be=Pe,Ae=ye,_e=Le)}}Ce.cb({objectAAnchorIndex:be,objectAAnchor:Te[be],objectBAnchorIndex:Ae,objectBAnchor:Ie[Ae]})};setTimeout(function(){Ee({objectA:ue,objectB:fe,cb:pe})},10)},this.addConnectionAnchorToSelectionStack=function(ue){U.push(ue),2===U.length&&(L.makeNewConnectorFromAnchors(U[0],U[1]),U.length=0)};const re=function(ue,fe){const pe=L.getObjectsAroundPoint(ue,fe),Ee={targetPoint:new o(ue,fe),objectsAroundPoint:pe};le(Y.DBLCLICK,Ee)};this.initInteractionHandlers=function(ue,fe){m.addEventListener("dblclick",function(pe){re(pe.pageX,pe.pageY)}),m.addEventListener("click",function(pe){let Ee=!1;pe.target!==m&&(Ee=!0);const Ce={targetPoint:new o(pe.pageX,pe.pageY),canvasObjectClicked:Ee};le(Y.CLICK,Ce)}),m.addEventListener("touchend",function(pe){if(0>=pe.changedTouches.length)return!1;var Ee=!1,Ce=pe.changedTouches[0].pageX,Te=pe.changedTouches[0].pageY,Ie=new Date().getTime();if(null!==Z.lastTouchTime){var be=Z.lastTouchTime,_e=Z.lastTouchX,Pe=Z.lastTouchY,me=Math.sqrt(Math.pow(Ce-_e,2)+Math.pow(Te-Pe,2));Ie-be<=ue&&me<=fe&&(Ee=!0,re(Ce,Te),Z.lastTouchTime=null,Z.lastTouchX=null,Z.lastTouchY=null)}Ee||(Z.lastTouchTime=Ie,Z.lastTouchX=Ce,Z.lastTouchY=Te)})};const se=function(ue){J=ue.getId()},de=function(ue,fe,pe){q=ue.getId(),V=fe,K=pe},ae=function(ue,fe){const pe=L.getObjectById(q),Ee=pe.getTranslateHandleOffset(),Ce=L.snapToGrid(ue+Ee.getX()),Te=L.snapToGrid(fe+Ee.getY());pe.translate(Ce,Te),le(Y.OBJECT_TRANSLATED,{object:pe}),ge()},he=function(ue,fe){const pe=L.getObjectById(q),Ee=pe.getTranslateHandleOffset(),Ce=L.snapToGrid(ue+Ee.getX()),Te=L.snapToGrid(fe+Ee.getY()),Ie=V,be=K;if(Ie==Ce&&be==Te);else pe.translate(Ce,Te),le(Y.OBJECT_TRANSLATED,{object:pe})},ce=function(ue,fe){const pe=L.getObjectById(J),Ee=L.snapToGrid(ue),Ce=L.snapToGrid(fe),Te=pe.getY(),Ie=pe.getX();pe.resize(Ee-Ie+1,Ce-Te+1),ge(),le(Y.OBJECT_RESIZED,{object:pe})};this.initTransformationHandlers=function(){m.addEventListener("touchmove",function(ue){null!==q&&(ae(ue.touches[0].pageX*k,ue.touches[0].pageY*k),ue.preventDefault())}),m.addEventListener("mousemove",function(ue){null!==q&&ae(ue.pageX*k,ue.pageY*k),null!==J&&ce(ue.pageX*k,ue.pageY*k)}),m.addEventListener("touchend",function(){if(null!==q){L.getObjectById(q);q=null,J=null}}),m.addEventListener("mouseup",function(ue){1===ue.which&&(null!==q&&he(ue.pageX*k,ue.pageY*k),q=null,J=null)}),m.addEventListener("mousedown",function(ue){(null!==q||null!==J)&&(ue.preventDefault(),ue.stopPropagation())})};const le=function(ue,fe){const pe=Q.get(ue)||[];for(let Ee=0;Ee<pe.length;Ee++){const Ce=pe[Ee];Ce(fe)}};this.off=function(ue,fe){const pe=Q.get(ue)||[];for(let Ee=0;Ee<pe.length;Ee++)if(pe[Ee]===fe){pe.splice(Ee,1);break}Q.set(ue,pe)},this.on=function(ue,fe){const pe=Q.get(ue)||[];pe.push(fe),Q.set(ue,pe)},L.setGrid(new E(12,"#424242",P.DOT)),L.resetTransform(),L.setTransformOrigin(0,0),L.setTransitionCss(B)},t.Cluster=I,t.BoxClusterDetector=function(m){const X=this,O=function(S,v){for(let w=0;w<v.length;w++)if(v[w].getId()===S.getId())return w;return-1},L=function(S,v){for(let w=0;w<S.length;w++){const B=O(S[w],v);-1!==B&&v.splice(B,1)}return v},Y=function(S){var v=0,w=null;return S.forEach(function(B,D){B>v&&(v=B,w=D)}),w};this.areObjectsClose=function(S,v){const w=new a(S.x-m,S.y-m,S.x+S.width+m,S.y+S.height+m),B=new a(v.x-m,v.y-m,v.x+v.width+m,v.y+v.height+m);return w.checkIntersect(B)},this.getAllObjectsCloseTo=function(S,v){const w=[];for(let B=0;B<v.length;B++)S.getId()!==v[B].getId()&&X.areObjectsClose(S,v[B])&&w.push(v[B]);return w},this.getClusterObjectsFromSeed=function(S,v,w){const B=X.getAllObjectsCloseTo(S,v);return 0===B.length?[]:void(L(B.concat([S]),v),B.forEach(function(D){w.push(D),X.getClusterObjectsFromSeed(D,v,w)}))},this.findIntersectingClustersForObjects=function(S,v){const w=new Map;return v.forEach(function(B){const D=B.getObjects();for(let R=0;R<D.length;R++)for(let N=0;N<S.length;N++)if(D[R].getId()===S[N].getId())if(w.has(B)){const G=w.get(B);w.set(B,G+1)}else w.set(B,1)}),w},this.removeObjectFromClusters=function(S,v){v.forEach(function(w){w.removeObjectById(S.getId())})},this.computeClusters=function(S,v,w){const B=v.map(function(N){return N}),D=S.map(function(N){return N});for(;0<D.length;){const N=D.pop(),G=[N];if(X.getClusterObjectsFromSeed(N,D,G),1<G.length){const F=X.findIntersectingClustersForObjects(G,B);if(0===F.size){const k=new I(w());G.forEach(function(W){k.addObject(W)}),B.push(k)}else{const k=Y(F);k.removeAllObjects(),G.forEach(function(W){X.removeObjectFromClusters(W,B),k.addObject(W)})}L(G,D)}else X.removeObjectFromClusters(N,B)}const R=B.filter(function(N){return!!(2<=N.getObjects().length)});return R}},t.Connector=f,t.ConnectorAnchor=u,t.PointVisibilityMap=function(m,X){const O=this,L=X.toArray(),Y=new Map,S=function(D){for(let R=0;R<L.length;R++){const N=L[R].computeIntersectionType(D);if(N===_.LINESEG)return!0}return!1},w=function(D){var R=Number.MAX_SAFE_INTEGER,N=null;for(var[G,F]of D.entries())F<R&&(N=G,R=F);return null===N?null:{cost:R,point:N}},B=function(D,R,N,G){const F=new Map;var k=Y.get(N);k=k.filter(function(z){for(let H=0;H<R.length;H++)if(z.isEqual(R[H]))return!1;return!0}),k.forEach(function(z){const H=new s(N,z).getLength()+D,M=new s(z,G).getLength();F.set(z,H+M)});const W=w(F);return null===W?null:W};this.findPointClosestTo=function(D){var R=null,N=Number.MAX_SAFE_INTEGER;return Y.forEach(function(G,F){const k=new s(D,F);k.getLength()<N&&(R=F,N=k.getLength())}),R},this.findVisiblePointClosestTo=function(D){var R=null,N=Number.MAX_SAFE_INTEGER;return Y.forEach(function(G,F){const k=new s(D,F);!S(k)&&k.getLength()<N&&(R=F,N=k.getLength())}),R},this.computeRoute=function(D,R){if(null===D||null===R)return new h;const N=O.findVisiblePointClosestTo(D);if(null===N)return new h;var G=0;const F=[N];for(var k=N;;){const W=B(G,F,k,R);if(null===W){const z=new s(F[F.length-1],R);if(S(z))return new h;break}if(G+=new s(k,W.point).getLength(),F.push(W.point),k=W.point,1>new s(k,R).getLength())break}return new h(F)},function(){const D=m.toArray();for(let R=0;R<D.length;R++)Y.set(D[R],[]);for(let R=0;R<D.length;R++)for(let N=R+1;N<D.length;N++){const G=new s(D[R],D[N]);if(!S(G)){const F=Y.get(D[R]);F.push(D[N]),Y.set(D[R],F);const k=Y.get(D[N]);k.push(D[R]),Y.set(D[N],k)}}}()},t.GRID_STYLE=P,t.Grid=E,t}({});