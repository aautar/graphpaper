var GraphPaper = (function (exports) {
'use strict';

var MatrixMath={mat4Multiply:function mat4Multiply(a,b){for(var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=0;4>d;d++)for(var e,f=0;4>f;f++){e=0;for(var g=0;4>g;g++)e+=a[g+4*d]*b[f+4*g];c[f+4*d]=e;}return c},vecMat4Multiply:function vecMat4Multiply(a,b){for(var c=[0,0,0,0],d=0;4>d;d++)c[d]=a[0]*b[4*d+0]+a[1]*b[4*d+1]+a[2]*b[4*d+2]+a[3]*b[4*d+3];return c}};

var SvgPathBuilder={pointToLineTo:function pointToLineTo(a){return"L"+a.getX()+" "+a.getY()},pointsToPath:function pointsToPath(a){for(var b,c=a[0],d=[],e=1;e<a.length;e++)b=a[e], d.push(SvgPathBuilder.pointToLineTo(b));var f=c.getX()+" "+c.getY(),g="M"+f+d.join(" ");return g}};

function Dimensions(a,b){this.getWidth=function(){return a}, this.getHeight=function(){return b};}

function Point(a,b){this.__x=a, this.__y=b;}Point.prototype.getX=function(){return this.__x}, Point.prototype.getY=function(){return this.__y}, Point.prototype.isEqual=function(a){return!(this.__x!==a.getX()||this.__y!==a.getY())}, Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)}, Point.prototype.toString=function(){return this.__x+" "+this.__y};

var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:"parallel",COINCIDENT:"coincident",LINE:"line",LINESEG:"lineseg"});function LineIntersection(a,b){this.getType=function(){return a}, this.getIntersectionPoint=function(){return b};}

function Line(a,b){if("undefined"==typeof a||null===a)throw"Line missing _startPoint";if("undefined"==typeof b||null===b)throw"Line missing _endPoint";this.__startPoint=a, this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint}, Line.prototype.getEndPoint=function(){return this.__endPoint}, Line.prototype.isEqual=function(a){return!!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))}, Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))}, Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG}, Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};

function Rectangle(a,b,c,d){this.getLeft=function(){return a}, this.getTop=function(){return b}, this.getRight=function(){return c}, this.getBottom=function(){return d}, this.getPoints=function(){return[new Point(a,b),new Point(c,b),new Point(c,d),new Point(a,d)]}, this.getLines=function(){return[new Line(new Point(a,b),new Point(c,b)),new Line(new Point(c,b),new Point(c,d)),new Line(new Point(c,d),new Point(a,d)),new Line(new Point(a,d),new Point(a,b))]}, this.getPointsScaledToGrid=function(e){var f=new Point(a+.5*(c-a),b+.5*(d-b)),g=(c-f.getX()+e)/(c-f.getX()),h=(d-f.getY()+e)/(d-f.getY()),i=[new Point((a-f.getX())*g+f.getX(),(b-f.getY())*h+f.getY()),new Point((c-f.getX())*g+f.getX(),(b-f.getY())*h+f.getY()),new Point((c-f.getX())*g+f.getX(),(d-f.getY())*h+f.getY()),new Point((a-f.getX())*g+f.getX(),(d-f.getY())*h+f.getY())];return i}, this.checkIntersect=function(e){return!(d<e.getTop())&&!(b>e.getBottom())&&!(c<e.getLeft())&&!(a>e.getRight())}, this.checkIsPointWithin=function(e){return!!(e.getX()>=a&&e.getX()<=c&&e.getY()>=b&&e.getY()<=d)}, this.checkIsWithin=function(e){return!!(d<=e.getBottom()&&b>=e.getTop()&&c<=e.getRight()&&a>=e.getLeft())};}

function PointSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return!1;return c.push(a), !0}, this.pushPointSet=function(a){for(var c=a.toArray(),d=0;d<c.length;d++)b.push(c[d]);}, this.findPointClosestTo=function(a){var b=null,d=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<d&&(b=c, d=e.getLength());}), b}, this.findDistanceToPointClosestTo=function(a){var b=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var d=new Line(a,c);d.getLength()<b&&(b=d.getLength());}), b}, this.findPointsCloseTo=function(a,b){var d=new PointSet;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<=b&&d.push(c);}), d}, this.toArray=function(){return c}, this.toFloat64Array=function(){for(var a=new Float64Array(2*c.length),b=0;b<c.length;b++)a[0+2*b]=c[b].getX(), a[1+2*b]=c[b].getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=2)c.push(new Point(a[b],a[b+1]));};this.count=function(){return c.length}, a&&Array.isArray(a)?a.forEach(b.push):a&&"[object Float64Array]"===Object.prototype.toString.call(a)&&d(a);}

function LineSet(a){var b=this,c=[];this.push=function(a){var b=!1;return(c.forEach(function(c){a.isEqual(c)&&(b=!0);}), !b)&&(c.push(a), !0)}, this.toArray=function(){return c}, this.count=function(){return c.length}, this.toFloat64Array=function(){for(var a=new Float64Array(4*c.length),b=0;b<c.length;b++)a[0+4*b]=c[b].getStartPoint().getX(), a[1+4*b]=c[b].getStartPoint().getY(), a[2+4*b]=c[b].getEndPoint().getX(), a[3+4*b]=c[b].getEndPoint().getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=4)c.push(new Line(new Point(a[b],a[b+1]),new Point(a[b+2],a[b+3])));};a&&Array.isArray(a)?a.forEach(b.push):a&&"[object Float64Array]"===Object.prototype.toString.call(a)&&d(a);}

function ConnectorAnchor(a,b,c){var d=this;this.getId=function(){return a}, this.getX=function(){return d.getCentroid().getX()}, this.getY=function(){return d.getCentroid().getY()}, this.getWidth=function(){var a=b.getBoundingClientRect();return a.right-a.left}, this.getHeight=function(){var a=b.getBoundingClientRect();return a.bottom-a.top}, this.getCentroid=function(){var a=b.getBoundingClientRect(),e=c.getPageOffset();return new Point(a.left+e.getX()+.5*d.getWidth(),a.top+e.getY()+.5*d.getHeight())}, this.getRoutingPoints=function(a){var b=d.getCentroid(),c=.5*d.getWidth(),e=.5*d.getHeight();return[new Point(b.getX()+c+a,b.getY()),new Point(b.getX()-c-a,b.getY()),new Point(b.getX(),b.getY()+e+a),new Point(b.getX(),b.getY()-e-a)]}, this.getBoundingRectange=function(){var a=d.getCentroid(),b=.5*d.getWidth(),c=.5*d.getHeight();return new Rectangle(a.getX()-b,a.getY()-c,a.getX()+b,a.getY()+c)};}

function Connector(a,b,c,d,e){var f=this,g=new Map,h={CLICK:"connector-click"};"undefined"==typeof d&&(d="#000"), "undefined"==typeof e&&(e="2px");var j=null,k=window.document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttribute("d","M0 0 L0 0"), k.style.stroke=d, k.style.strokeWidth=e, k.addEventListener("click",function(a){var b=g.get(h.CLICK)||[];b.forEach(function(b){b({connector:f,clickedAtX:a.pageX,clickedAtY:a.pageY});});});var l=null;this.appendPathToContainerDomElement=function(){l=c.appendChild(k);}, this.getPathPoints=function(){return j}, this.getPathLines=function(){if(null===j||2>j.length)return[];for(var a=[],b=0;b<j.length-1;b++)a.push(new Line(j[b],j[b+1]));return a}, this.refresh=function(a,b){j=b, k.setAttribute("d",a);}, this.getId=function(){var c=[a.getId(),b.getId()].sort();return c.join(":")}, this.getAnchorStart=function(){return a}, this.getAnchorEnd=function(){return b}, this.removePathElement=function(){k.remove();}, this.addClassToDomElement=function(a){k.classList.add(a);}, this.removeClassFromDomElement=function(a){k.classList.remove(a);}, this.getDescriptor=function(){return{id:f.getId(),anchor_start_centroid:a.getCentroid().toString(),anchor_end_centroid:b.getCentroid().toString()}}, this.on=function(a,b){var c=g.get(a)||[];c.push(b), g.set(a,c);}, this.off=function(a,b){for(var c=eventHandlers.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}eventHandlers.set(a,c);};}

function PointVisibilityMap(a,b){var c=this,d=b.toArray(),e=a.toArray(),f=Array(a.count()),g=function doesLineIntersectAnyBoundaryLines(a){for(var c,e=0;e<d.length;e++)if(c=d[e].computeIntersectionType(a), c===LINE_INTERSECTION_TYPE.LINESEG)return!0;return!1},h=function computePointsVisibility(){for(var a=0;a<e.length;a++)f[a]=[];for(var b=0;b<e.length;b++)for(var c,d=b+1;d<e.length;d++)c=new Line(e[b],e[d]), g(c)||(f[b].push(e[d]), f[d].push(e[b]));},i=function getVisiblePointsFrom(a){for(var b=0;b<e.length;b++)if(e[b].isEqual(a)){var c=f[b];return c}return[]},j=function routeToEndpoint(a,b,c,d){var e=i(c),f=Number.MAX_SAFE_INTEGER,g=null;return e.forEach(function(e){for(var k=0;k<b.length;k++)if(e.isEqual(b[k]))return;var h=new Line(c,e).getLength()+a,j=new Line(e,d).getLength();h+j<f&&(f=h+j, g=e);}), f===Number.MAX_SAFE_INTEGER?null:{cost:f,point:g}},k=function optimizeRoute(a){for(var b=0;!0&&!(b+2>=a.length);){var c=new Line(a[b],a[b+2]);g(c)?b++:a.splice(b+1,1);}};this.findPointClosestTo=function(a){var b=null,c=Number.MAX_SAFE_INTEGER;return e.forEach(function(d){var e=new Line(a,d);e.getLength()<c&&(b=d, c=e.getLength());}), b}, this.findVisiblePointClosestTo=function(a){var b=null,c=Number.MAX_SAFE_INTEGER;return e.forEach(function(d){var e=new Line(a,d),f=e.getLength();f<c&&!g(e)&&(b=d, c=f);}), b}, this.computeRoute=function(a,b){if(null===a||null===b)return new PointSet;var d=c.findVisiblePointClosestTo(a);if(null===d)return new PointSet;for(var e,f=0,h=[d],i=d;!0;){if(e=j(f,h,i,b), null===e){var l=new Line(h[h.length-1],b);if(g(l))return new PointSet;break}if(f+=new Line(i,e.point).getLength(), h.push(e.point), i=e.point, 1>new Line(i,b).getLength())break}return k(h), new PointSet(h)}, h();}

var GRID_STYLE={LINE:"line",DOT:"dot"};function Grid(a,b,c){this.getSize=function(){return a}, this.getStyle=function(){return c}, this.getSvgImageTile=function(){return c===GRID_STYLE.LINE?"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+a+"\" height=\""+a+"\"><rect width=\""+a+"\" height=\"1\" x=\"0\" y=\""+(a-1)+"\" style=\"fill:"+b+"\" /><rect width=\"1\" height=\""+a+"\" x=\""+(a-1)+"\" y=\"0\" style=\"fill:"+b+"\" /></svg>":"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+a+"\" height=\""+a+"\"><rect width=\"1\" height=\"1\" x=\""+(a-1)+"\" y=\""+(a-1)+"\" style=\"fill:"+b+"\" /></svg>"};}

function Canvas(a,b,c){var d=this,f={DBLCLICK:"dblclick",CLICK:"click",OBJECT_ADDED:"object-added",OBJECT_REMOVED:"object-removed",OBJECT_RESIZED:"object-resized",OBJECT_TRANSLATED:"object-translated"},g=b.document.createElementNS("http://www.w3.org/2000/svg","svg");g.style.width="100%", g.style.height="100%";var h=a.appendChild(g),i=null,j="transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out",k=0,l=0,m=0,n=0,o=1,p=1,q=[],r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t=null,u=!1,v=[],w=[],x=null,y=null,z=0,A=0,B=0,C=0,D={lastTouchX:null,lastTouchY:null,lastTouchTime:null},E=[],F=new Map,G=new Map;this.getCurrentPointVisibilityMap=function(){return t}, this.setGrid=function(c){i=c, a.style.backgroundImage="url('data:image/svg+xml;base64,"+b.btoa(i.getSvgImageTile())+"')", a.style.backgroundRepeat="repeat", a.style.backgroundColor="#fff";}, this.getGrid=function(){return i}, this.getGridSize=function(){return i.getSize()};var H=function getAccessibleRoutingPointsFromObjectAnchors(a){G.clear();var b=[],c=[];return a.forEach(function(a){var c=a.getConnectorAnchors();c.forEach(function(a){var c=a.getRoutingPoints(d.getGridSize());c.forEach(function(c){b.push({routingPoint:c,parentAnchor:a});}), G.set(a.getId(),c.length);});}), b.forEach(function(b){for(var d=!1,e=0;e<a.length;e++){var f=a[e],g=f.getBoundingRectange();if(g.checkIsPointWithin(b.routingPoint)){d=!0;var h=G.get(b.parentAnchor.getId())||0;G.set(b.parentAnchor.getId(),h-1);}}d||c.push(b.routingPoint);}), c},I=function getObjectExtentRoutingPoints(){var a=new PointSet;return v.forEach(function(b){var c=b.getBoundingRectange().getPointsScaledToGrid(d.getGridSize());c.forEach(function(b){a.push(b);});}), a},J=function getConnectorRoutingPointsAroundAnchor(){var a=new PointSet,b=H(v);return b.forEach(function(b){a.push(b);}), a},K=function getConnectorBoundaryLines(){var a=[];return v.forEach(function(b){var c=b.getBoundingRectange().getLines();c.forEach(function(b){a.push(b);});var d=b.getConnectorAnchors();d.forEach(function(b){var c=b.getBoundingRectange().getLines();c.forEach(function(b){a.push(b);});});}), new LineSet(a)},L=function refreshAllConnectors(){var a=[];w.forEach(function(b){a.push(b.getDescriptor());});var b=J(),e=I(),f=new PointSet;f.pushPointSet(b), f.pushPointSet(e);var g=b.toFloat64Array(),h=f.toFloat64Array(),i=K().toFloat64Array();c.postMessage({gridSize:d.getGridSize(),connectorDescriptors:a,routingPoints:h.buffer,boundaryLines:i.buffer,routingPointsAroundAnchor:g.buffer},[h.buffer,i.buffer,g.buffer]);};c.onmessage=function(a){var b=a.data.connectorDescriptors,c=function getConnectorDescriptorById(a){for(var c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null};w.forEach(function(a){var b=c(a.getId());if(b){var d=new PointSet(new Float64Array(b.pointsInPath));a.refresh(b.svgPath,d.toArray());}});};var M=function makeNewConnector(a,b,c){return new Connector(a,b,c)};this.setConnectorFactory=function(a){M=a;}, this.getTransitionCss=function(){return j}, this.setTransitionCss=function(b){j=b, a.style.transition=j;}, this.getTransformOriginX=function(){return k}, this.getTransformOriginY=function(){return l}, this.getScaleFactor=function(){return o}, this.getTranslateX=function(){return m}, this.getTranslateY=function(){return n}, this.setTransformOrigin=function(b,c){k=b, l=c, a.style.transformOrigin=`${k}px ${l}px`;}, this.scale=function(a,b){if(b=b||!1, b){var c=d.getGridSize()*a,e=Math.round(c);a=e/d.getGridSize();}o=a, p=1/o;var f=[o,0,0,0,0,o,0,0,0,0,o,1,0,0,0,1];return s=MatrixMath.mat4Multiply(s,f), q.push([p,0,0,0,0,p,0,0,0,0,p,1,0,0,0,1]), d}, this.translate=function(a,b){m=a, n=b;var c=[1,0,0,0,0,1,0,0,0,0,1,0,m,n,0,1];return s=MatrixMath.mat4Multiply(s,c), q.push([1,0,0,-m,0,1,0,-n,0,0,1,0,0,0,0,1]), d}, this.applyTransform=function(){var b=s.join(",");a.style.transform=`matrix3d(${b})`, r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(var c=0;c<q.length;c++)r=MatrixMath.mat4Multiply(r,q[c]);}, this.resetTransform=function(){o=1, p=1, m=0, n=0, s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1], r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1], q.length=0, a.style.transform="none";}, this.getPageOffset=function(){return new Point(window.pageXOffset,window.pageYOffset)}, this.snapToGrid=function(a){var b=Math.round(a/d.getGridSize())*d.getGridSize();return Math.max(0,b-1)}, this.getOffsetLeft=function(){return a.offsetLeft}, this.getOffsetTop=function(){return a.offsetTop}, this.getWidth=function(){return a.offsetWidth}, this.getHeight=function(){return a.offsetHeight}, this.getObjectsAroundPoint=function(a,b){var c=[],d=new Rectangle(a,b,a+1,b+1);return v.forEach(function(a){!a.getIsDeleted()&&d.checkIntersect(a.getBoundingRectange())&&c.push(a);}), c}, this.calcBoundingBox=function(){var a=null,b=null,c=null,d=null;return v.forEach(function(e,f,g){var h=parseInt(e.getX()),i=parseInt(e.getY()),j=h+parseInt(e.getWidth()),k=i+parseInt(e.getHeight());(null===b||h<b)&&(b=h), (null===a||i<a)&&(a=i), (null===c||k>c)&&(c=k), (null===d||j>d)&&(d=j);}), new Rectangle(b,a,d,c)}, this.getAllObjects=function(){return v}, this.publishSiblingObjectChange=function(a,b){v.forEach(function(c){c.handleSiblingObjectChange(a,b);});}, this.getObjectById=function(a){var b=null;return v.forEach(function(c,d,e){null===b&&c.getId()===a&&(b=c);}), b}, this.addObject=function(a){a.on("obj-resize-start",O), a.on("obj-resize",function(a){T(f.OBJECT_RESIZED,{object:a.obj}), L();}), a.on("obj-translate-start",P), a.on("obj-translate",function(a){T(f.OBJECT_TRANSLATED,{object:a.obj}), L();}), v.push(a), L(), T(f.OBJECT_ADDED,{object:a});}, this.removeObject=function(a){for(var b=0;b<v.length;b++)if(v[b].getId()===a)return v.splice(b,1), L(), T(f.OBJECT_REMOVED,{object:v[b]}), !0;return!1}, this.getConnector=function(a){for(var b=0;b<w.length;b++)if(w[b].getId()===a)return w[b];return null}, this.getAllConnectors=function(){return w}, this.getConnectorsBetweenObjects=function(a,b){var c=[];return w.forEach(function(d){var e=d.getAnchorStart(),f=d.getAnchorEnd();a.hasConnectorAnchor(e)&&b.hasConnectorAnchor(f)&&c.push(d), a.hasConnectorAnchor(f)&&b.hasConnectorAnchor(e)&&c.push(d);}), c}, this.getObjectsConnectedViaConnector=function(a){var b=[],c=d.getAllObjects();return w.forEach(function(d){if(d.getId()===a){var e=d.getAnchorStart(),f=d.getAnchorEnd();c.forEach(function(a){(a.hasConnectorAnchor(e)||a.hasConnectorAnchor(f))&&b.push(a);});}}), b}, this.getConnectorsConnectedToObject=function(a){var b=[];return w.forEach(function(c){var d=c.getAnchorStart(),e=c.getAnchorEnd();(a.hasConnectorAnchor(d)||a.hasConnectorAnchor(e))&&b.push(c);}), b}, this.getObjectWithConnectorAnchor=function(a){for(var b,c=d.getAllObjects(),e=0;e<c.length;e++){b=c[e].getConnectorAnchors();for(var f=0;f<b.length;f++)if(b[f].getId()===a)return c[e]}return null}, this.removeAllConnectors=function(){w.forEach(function(a){a.removePathElement();}), w.splice(0,w.length);}, this.removeConnector=function(a){for(var b=0;b<w.length;b++)if(w[b]===a)return a.removePathElement(), w.splice(b,1), !0;return!1}, this.makeNewConnectorFromAnchors=function(a,b){var c=M(a,b,h),e=d.getConnector(c.getId());return null===e?(w.push(c), c.appendPathToContainerDomElement(), L(), c):e}, this.findBestConnectorAnchorsToConnectObjects=function(a,b,c){var d=function searchFunc(a){for(var b,c=a.objectA.getConnectorAnchors(),e=a.objectB.getConnectorAnchors(),f=0,g=0,h=Number.MAX_VALUE,i=0;i<c.length;i++)if(b=G.get(c[i].getId())||0, 0!==b)for(var m=0;m<e.length;m++){var j=c[i].getCentroid(),k=e[m].getCentroid(),l=Math.sqrt(Math.pow(k.getX()-j.getX(),2)+Math.pow(k.getY()-j.getY(),2)),d=G.get(e[m].getId())||0;l<h&&0<d&&(f=i, g=m, h=l);}a.cb({objectAAnchorIndex:f,objectAAnchor:c[f],objectBAnchorIndex:g,objectBAnchor:e[g]});};setTimeout(function(){d({objectA:a,objectB:b,cb:c});},10);}, this.addConnectionAnchorToSelectionStack=function(a){E.push(a), 2===E.length&&(d.makeNewConnectorFromAnchors(E[0],E[1]), E.length=0);};var N=function dblClickTapHandler(a,b){var c=d.getObjectsAroundPoint(a,b),e={targetPoint:new Point(a,b),objectsAroundPoint:c};T(f.DBLCLICK,e);};this.initInteractionHandlers=function(b,c){a.addEventListener("dblclick",function(a){var b=MatrixMath.vecMat4Multiply([a.pageX,a.pageY,0,1],r);N(b[0],b[1]);}), a.addEventListener("click",function(b){var c=!1;b.target!==a&&(c=!0);var d=MatrixMath.vecMat4Multiply([b.pageX,b.pageY,0,1],r),e={targetPoint:new Point(d[0],d[1]),canvasObjectClicked:c};T(f.CLICK,e);}), a.addEventListener("touchend",function(a){if(0>=a.changedTouches.length)return!1;var d=!1,e=MatrixMath.vecMat4Multiply([a.changedTouches[0].pageX,a.changedTouches[0].pageY,0,1],r),f=e[0],g=e[1],h=new Date().getTime();if(null!==D.lastTouchTime){var i=D.lastTouchTime,j=h-i,k=D.lastTouchX,l=D.lastTouchY,m=Math.sqrt(Math.pow(f-k,2)+Math.pow(g-l,2));j<=b&&m<=c&&(d=!0, N(f,g), D.lastTouchTime=null, D.lastTouchX=null, D.lastTouchY=null);}d||(D.lastTouchTime=h, D.lastTouchX=f, D.lastTouchY=g);});};var O=function handleResizeStart(a){y=a.obj.getId();},P=function handleMoveStart(a){x=a.obj.getId(), z=a.x, A=a.y, B=a.x, C=a.y;},Q=function handleMove(a,b){var c=d.getObjectById(x),e=c.getTranslateHandleOffset(),f=d.snapToGrid(a+e.getX()),g=d.snapToGrid(b+e.getY());z=f, A=g, c.translate(f,g);},R=function handleMoveEnd(a,b){var c=d.getObjectById(x),e=c.getTranslateHandleOffset(),f=d.snapToGrid(a+e.getX()),g=d.snapToGrid(b+e.getY()),h=B,i=C;h==f&&i==g||c.translate(f,g);},S=function handleResize(a,b){var c=d.getObjectById(y),e=d.snapToGrid(a),f=d.snapToGrid(b),g=c.getY(),h=c.getX(),i=e-h+1,j=f-g+1;c.resize(i,j);};this.initTransformationHandlers=function(){a.addEventListener("touchmove",function(a){if(null!==x){var b=MatrixMath.vecMat4Multiply([a.touches[0].pageX,a.touches[0].pageY,0,1],r);Q(b[0],b[1]), a.preventDefault();}if(null!==y){var c=MatrixMath.vecMat4Multiply([a.touches[0].pageX,a.touches[0].pageY,0,1],r);S(c[0],c[1]), a.preventDefault();}}), a.addEventListener("mousemove",function(a){if(null!==x){var b=MatrixMath.vecMat4Multiply([a.pageX,a.pageY,0,1],r);Q(b[0],b[1]);}if(null!==y){var c=MatrixMath.vecMat4Multiply([a.pageX,a.pageY,0,1],r);S(c[0],c[1]);}}), a.addEventListener("touchend",function(a){null!==x&&(x=null), null!==y&&(y=null);}), a.addEventListener("mouseup",function(a){if(1===a.which){if(null!==x){var b=MatrixMath.vecMat4Multiply([a.pageX,a.pageY,0,1],r);R(b[0],b[1]);}x=null, y=null;}}), a.addEventListener("mousedown",function(a){(null!==x||null!==y)&&(a.preventDefault(), a.stopPropagation());});};var T=function emitEvent(a,b){for(var c,d=F.get(a)||[],e=0;e<d.length;e++)c=d[e], c(b);};this.off=function(a,b){for(var c=F.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}F.set(a,c);}, this.on=function(a,b){var c=F.get(a)||[];c.push(b), F.set(a,c);}, d.setGrid(new Grid(12,"#424242",GRID_STYLE.DOT)), d.resetTransform(), d.setTransformOrigin(0,0), d.setTransitionCss(j);}

function CanvasObject(a,b,c,d,e,f,g,h,i){var j=this,k=1,l=[],m=1e3,n=null,o=null,p={TRANSLATE_START:"obj-translate-start",TRANSLATE:"obj-translate",RESIZE_START:"obj-resize-start",RESIZE:"obj-resize"},q=new Map;this.x=parseInt(b), this.y=parseInt(c), this.width=parseInt(d), this.height=parseInt(e), this.isDeleted=!1, this.addNonInteractableConnectorAnchor=function(b){var c=new ConnectorAnchor(a+`-${m}`,b,f);return l.push(c), m++, c}, this.addInteractableConnectorAnchor=function(b){var c=new ConnectorAnchor(a+`-${m}`,b,f);return b.addEventListener("click",function(a){f.addConnectionAnchorToSelectionStack(c);}), l.push(c), m++, c}, this.getConnectorAnchorRoutingPoints=function(a){var b=[];return l.forEach(function(c){var d=c.getRoutingPoints(a);d.forEach(function(a){b.push(a);});}), b}, this.getConnectorAnchors=function(){return l}, this.hasConnectorAnchor=function(a){for(var b=j.getConnectorAnchors(),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1}, this.getTranslateHandleOffset=function(){return n?new Point(-(n.offsetLeft+.5*n.offsetWidth),-(n.offsetTop+.5*n.offsetHeight)):null}, this.getId=function(){return a}, this.getX=function(){return j.x}, this.setX=function(a){j.x=a;}, this.getY=function(){return j.y}, this.setY=function(a){j.y=a;}, this.translate=function(a,b){j.x=a, j.y=b, g.style.left=parseInt(j.x)+"px", g.style.top=parseInt(j.y)+"px";var c=q.get(p.TRANSLATE)||[];c.forEach(function(c){c({obj:j,x:a,y:b});});}, this.getWidth=function(){return j.width}, this.getHeight=function(){return j.height}, this.resize=function(a,b,c){j.width=a, j.height=b, c?c(g):(g.style.width=parseInt(j.width)+"px", g.style.height=parseInt(j.height)+"px");var d=q.get(p.RESIZE)||[];d.forEach(function(c){c({obj:j,width:a,height:b});});}, this.getIsDeleted=function(){return j.isDeleted}, this.getDomElement=function(){return g}, this.handleSiblingObjectChange=function(a,b){}, this.getBoundingRectange=function(){var a=parseInt(j.x),b=parseInt(j.y),c=a+parseInt(j.width),d=b+parseInt(j.height);return new Rectangle(a,b,c,d)}, this.getBoundingPoints=function(){var a=new Point(j.getX(),j.getY()),b=new Point(j.getX()+j.getWidth(),j.getY()),c=new Point(j.getX(),j.getY()+j.getWidth()),d=new Point(j.getX()+j.getWidth(),j.getY()+j.getWidth());return[a,b,c,d]}, this.on=function(a,b){var c=q.get(a)||[];c.push(b), q.set(a,c);}, this.off=function(a,b){for(var c=eventHandlers.get(a)||[],d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}eventHandlers.set(a,c);}, this.suspendTranslateInteractions=function(){t();}, this.resumeTranslateInteractions=function(){u();};var r=function translateTouchStartHandler(a){n=a.target;var b=q.get(p.TRANSLATE_START)||[];b.forEach(function(b){b({obj:j,x:a.touches[0].pageX,y:a.touches[0].pageY,isTouch:!0});});},s=function translateMouseDownHandler(a){n=a.target;var b=q.get(p.TRANSLATE_START)||[];b.forEach(function(b){b({obj:j,x:a.pageX,y:a.pageY,isTouch:!1});});},t=function unbindTranslateHandleElements(){h.forEach(function(a){a.removeEventListener("touchstart",r), a.removeEventListener("mousedown",s);});},u=function bindTranslateHandleElements(){h.forEach(function(a){a.addEventListener("touchstart",r), a.addEventListener("mousedown",s);});},v=function resizeMouseDownHandler(a){if(a.which===k){o=a.target;var b=q.get(p.RESIZE_START)||[];b.forEach(function(b){b({obj:j,x:a.pageX,y:a.pageY,isTouch:!1});});}},w=function resizeTouchStartHandler(a){o=a.target;var b=q.get(p.RESIZE_START)||[];b.forEach(function(b){b({obj:j,x:a.touches[0].pageX,y:a.touches[0].pageY,isTouch:!0});});},x=function bindResizeHandleElements(){i.forEach(function(a){a.addEventListener("touchstart",w), a.addEventListener("mousedown",v);});};u(), x();}

function Cluster(a){var b=this,c=[];this.getId=function(){return a}, this.getObjectIndex=function(a){return b.getObjectIndexById(a.getId())}, this.getObjectIndexById=function(a){for(var b=0;b<c.length;b++)if(c[b].getId()===a)return b;return null}, this.addObject=function(a){return!(null!==b.getObjectIndex(a))&&(c.push(a), !0)}, this.getObjects=function(){return c}, this.getObjectIds=function(){var a=[];return c.forEach(function(b){a.push(b.getId());}), a}, this.removeObjectById=function(a){var d=b.getObjectIndexById(a);return null!==d&&(c.splice(d,1), !0)}, this.removeAllObjects=function(){c.length=0;};}

function BoxClusterDetector(a){var b=this,c=function getObjectIndexFromArray(a,b){for(var c=0;c<b.length;c++)if(b[c].getId()===a.getId())return c;return-1},d=function removeObjectsFromArray(a,b){for(var d,e=0;e<a.length;e++)d=c(a[e],b), -1!==d&&b.splice(d,1);return b},e=function getClusterWithMostObjectsFromClusterMap(a){var b=0,c=null;return a.forEach(function(a,d,e){a>b&&(b=a, c=d);}), c};this.areObjectsClose=function(b,c){var d=new Rectangle(b.x-a,b.y-a,b.x+b.width+a,b.y+b.height+a),e=new Rectangle(c.x-a,c.y-a,c.x+c.width+a,c.y+c.height+a);return d.checkIntersect(e)}, this.getAllObjectsCloseTo=function(a,c){for(var d=[],e=0;e<c.length;e++)a.getId()!==c[e].getId()&&b.areObjectsClose(a,c[e])&&d.push(c[e]);return d}, this.getClusterObjectsFromSeed=function(a,c,e){var f=b.getAllObjectsCloseTo(a,c);return 0===f.length?[]:void(d(f.concat([a]),c), f.forEach(function(a){e.push(a), b.getClusterObjectsFromSeed(a,c,e);}))}, this.findIntersectingClustersForObjects=function(a,b){var c=new Map;return b.forEach(function(b){for(var d=b.getObjects(),e=0;e<d.length;e++)for(var f=0;f<a.length;f++)if(d[e].getId()===a[f].getId())if(c.has(b)){var g=c.get(b);c.set(b,g+1);}else c.set(b,1);}), c}, this.removeObjectFromClusters=function(a,b){b.forEach(function(b){b.removeObjectById(a.getId());});}, this.computeClusters=function(a,c,f){for(var g=c.map(function(a){return a}),h=a.map(function(a){return a});0<h.length;){var i=h.pop(),j=[i];if(b.getClusterObjectsFromSeed(i,h,j), 1<j.length){var l=b.findIntersectingClustersForObjects(j,g);0===l.size?function(){var a=new Cluster(f());j.forEach(function(b){a.addObject(b);}), g.push(a);}():function(){var a=e(l);a.removeAllObjects(), j.forEach(function(c){b.removeObjectFromClusters(c,g), a.addObject(c);});}(), d(j,h);}else b.removeObjectFromClusters(i,g);}var k=g.filter(function(a){return!!(2<=a.getObjects().length)});return k};}

exports.MatrixMath = MatrixMath;
exports.SvgPathBuilder = SvgPathBuilder;
exports.Dimensions = Dimensions;
exports.Rectangle = Rectangle;
exports.Point = Point;
exports.LINE_INTERSECTION_TYPE = LINE_INTERSECTION_TYPE;
exports.LineIntersection = LineIntersection;
exports.Line = Line;
exports.CanvasObject = CanvasObject;
exports.Canvas = Canvas;
exports.Cluster = Cluster;
exports.BoxClusterDetector = BoxClusterDetector;
exports.Connector = Connector;
exports.ConnectorAnchor = ConnectorAnchor;
exports.PointVisibilityMap = PointVisibilityMap;
exports.GRID_STYLE = GRID_STYLE;
exports.Grid = Grid;

return exports;

}({}));
//# sourceMappingURL=graphpaper.min.js.map
