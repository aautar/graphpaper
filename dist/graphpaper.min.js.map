{"version":3,"file":"graphpaper.min.js","sources":["../src/MatrixMath.js","../src/Point.js","../src/LineIntersection.js","../src/Line.js","../src/SvgPathBuilder.js","../src/Dimensions.js","../src/Rectangle.js","../src/GroupTransformationContainerEvent.js","../src/EntityEvent.js","../src/PointSet.js","../src/AccessibleRoutingPointsFinder.js","../src/ConnectorAnchor.js","../src/ConnectorAnchorFinder/ClosestPairFinder.js","../src/ConnectorAnchorFinder/BestToConnectEntitiesFinder.js","../src/SheetEvent.js","../src/DebugMetricsPanel/DebugMetricsPanel.js","../src/DoubleTapDetector.js","../src/ConnectorEvent.js","../src/ConnectorRoutingAlgorithm.js","../src/Connector.js","../src/Grid.js","../src/Workers/ClusterDetectionWorker.string.js","../src/Workers/ConnectorRoutingWorker.string.js","../src/DescriptorCollection.js","../src/Cluster.js","../src/Originator.js","../src/Sheet.js","../src/Entity.js","../src/GroupTransformationContainer.js","../src/BoxClusterDetector.js","../src/PointVisibilityMapRouteOptimizer.js","../src/LineSet.js","../src/Vec2.js","../src/PointVisibilityMap.js"],"sourcesContent":["const MatrixMath = {\r\n\r\n    mat4Multiply: function(_a, _b) {\r\n\r\n        const result = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        for(let i=0; i<4; i++) {\r\n            for(let j=0; j<4; j++) {\r\n\r\n                var sum = 0;\r\n                for(let k=0; k<4; k++) {\r\n                    sum += _a[k + 4*i] * _b[j + 4*k];\r\n                }\r\n\r\n                result[j + 4*i] = sum;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    vecMat4Multiply: function(_v, _m) {\r\n        const result = [0, 0, 0, 0];\r\n        for(let vi=0; vi<4; vi++) {\r\n            result[vi] = \r\n                (_v[0] * _m[(vi*4) + 0]) + \r\n                (_v[1] * _m[(vi*4) + 1]) + \r\n                (_v[2] * _m[(vi*4) + 2]) + \r\n                (_v[3] * _m[(vi*4) + 3]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n};\r\n\r\nexport { MatrixMath };\r\n","/**\r\n * \r\n * @param {Number} _x\r\n * @param {Number} _y\r\n */\r\nfunction Point(_x, _y) {\r\n    this.__x = _x;\r\n    this.__y = _y;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getX = function() {\r\n    return this.__x;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getY = function() {\r\n    return this.__y;\r\n};\r\n\r\n/**\r\n * @param {Point} _otherPoint\r\n * @returns {Boolean}\r\n */\r\nPoint.prototype.isEqual = function(_otherPoint) {\r\n    if(this.__x === _otherPoint.getX() && this.__y === _otherPoint.getY()) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */\r\nPoint.prototype.getCartesianPoint = function(_sheetWidth, _sheetHeight) {\r\n    return new Point(\r\n        this.__x - (_sheetWidth * 0.5),\r\n        -this.__y + (_sheetHeight * 0.5)\r\n    );\r\n};\r\n\r\n/**\r\n * @returns {String}\r\n */\r\nPoint.prototype.toString = function() {\r\n    return this.__x + \" \" + this.__y;\r\n};\r\n\r\n/**\r\n * @returns {Number[]}\r\n */\r\nPoint.prototype.toArray = function() {\r\n    return [this.__x, this.__y];\r\n};\r\n\r\n/**\r\n * @param {Number[]} _arr\r\n * @returns {Point}\r\n */\r\nPoint.fromArray = function(_arr) {\r\n    return new Point(_arr[0], _arr[1]);\r\n};\r\n\r\nexport { Point };\r\n","import  {Point} from './Point';\r\n\r\nconst LINE_INTERSECTION_TYPE = Object.freeze({\r\n\tPARALLEL: \"parallel\",\t\t// no intersection, lines are parallel\r\n    COINCIDENT: \"coincident\",\t// no intersection, lines are coincident\r\n\tLINE: \"line\",\t\t\t\t// the lines intersect, but the intersection point is beyond the bounds of the line segments\r\n\tLINESEG: \"lineseg\",\t\t\t// the lines intersect, and the intersection point is within the bounds of the line segments\r\n});\r\n\r\n/**\r\n * \r\n * @param {LINE_INTERSECTION_TYPE} _type \r\n * @param {Point} _intersectionPoint \r\n */\r\nfunction LineIntersection(_type, _intersectionPoint) {\r\n    this.__type = _type;\r\n    this.__intersectionPoint = _intersectionPoint;\r\n};\r\n\r\n\r\n/**\r\n * @returns {LINE_INTERSECTION_TYPE}\r\n */\r\nLineIntersection.prototype.getType = function() {\r\n    return this.__type;\r\n};\r\n\r\n/**\r\n * @returns {Point|null}\r\n */\r\nLineIntersection.prototype.getIntersectionPoint = function() {\r\n    return this.__intersectionPoint;\r\n};\r\n\r\nexport {LINE_INTERSECTION_TYPE, LineIntersection};\r\n","import  {Point} from './Point';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {Point} _startPoint\r\n * @param {Point} _endPoint\r\n */\r\nfunction Line(_startPoint, _endPoint) {   \r\n\r\n    if(typeof _startPoint === 'undefined' || _startPoint === null) {\r\n        throw \"Line missing _startPoint\";\r\n    }\r\n\r\n    if(typeof _endPoint === 'undefined' || _endPoint === null) {\r\n        throw \"Line missing _endPoint\";\r\n    }\r\n\r\n    this.__startPoint = _startPoint;\r\n    this.__endPoint = _endPoint;\r\n};\r\n\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getStartPoint = function() {\r\n    return this.__startPoint;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getEndPoint = function() {\r\n    return this.__endPoint;\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {Boolean}\r\n */\r\nLine.prototype.isEqual = function(_otherLine) {\r\n    if(this.getStartPoint().isEqual(_otherLine.getStartPoint()) && this.getEndPoint().isEqual(_otherLine.getEndPoint())) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getLength = function() {\r\n    return Math.sqrt(\r\n        Math.pow(this.__endPoint.getX() - this.__startPoint.getX(), 2) + Math.pow(this.__endPoint.getY() - this.__startPoint.getY(), 2)\r\n    );\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getMinX = function() {\r\n    return Math.min(this.getStartPoint().getX(), this.getEndPoint().getX());\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getMaxX = function() {\r\n    return Math.max(this.getStartPoint().getX(), this.getEndPoint().getX());\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getMinY = function() {\r\n    return Math.min(this.getStartPoint().getY(), this.getEndPoint().getY());\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getMaxY = function() {\r\n    return Math.max(this.getStartPoint().getY(), this.getEndPoint().getY());\r\n};\r\n\r\n/**\r\n * Calculate unit length direction vector\r\n * \r\n * @returns {Point}\r\n */\r\nLine.prototype.getDirection = function() {\r\n    const dx = this.__endPoint.getX() - this.__startPoint.getX();\r\n    const dy = this.__endPoint.getY() - this.__startPoint.getY();\r\n\r\n    const len = Math.sqrt(dx*dx + dy*dy);\r\n\r\n    return new Point(       \r\n        dx / len,\r\n        dy / len\r\n    );    \r\n};\r\n\r\n/**\r\n * Create a Line shorted at the start and end by the specified amounts\r\n * \r\n * @returns {Line}\r\n */\r\nLine.prototype.createShortenedLine = function(startReduceByPx, endReduceByPx) {\r\n    const dx = this.__endPoint.getX() - this.__startPoint.getX();\r\n    const dy = this.__endPoint.getY() - this.__startPoint.getY();    \r\n    const dir = this.getDirection();\r\n\r\n    return new Line(\r\n        new Point(\r\n            this.__startPoint.getX() + (startReduceByPx * dir.getX()), \r\n            this.__startPoint.getY() + (startReduceByPx * dir.getY())\r\n        ),\r\n        new Point(\r\n            (this.__startPoint.getX() + dx) - (endReduceByPx * dir.getX()), \r\n            (this.__startPoint.getY() + dy) - (endReduceByPx * dir.getY())\r\n        )\r\n    );\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_TYPE}\r\n */\r\nLine.prototype.computeIntersectionType = function(_otherLine) {\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return LINE_INTERSECTION_TYPE.COINCIDENT;\r\n        else\r\n            return LINE_INTERSECTION_TYPE.PARALLEL;\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return LINE_INTERSECTION_TYPE.LINE;\r\n    } else {\r\n        return LINE_INTERSECTION_TYPE.LINESEG;\r\n    }\r\n};\r\n    \r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_RESULT}\r\n */\r\nLine.prototype.computeIntersection = function(_otherLine) {\r\n\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT, null);\r\n        else\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL, null);\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n\r\n    const xIntersect = this.__startPoint.getX() + paramA*(this.__endPoint.getX()-this.__startPoint.getX());\r\n    const yIntersect = this.__startPoint.getY() + paramA*(this.__endPoint.getY()-this.__startPoint.getY());\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINE, new Point(xIntersect, yIntersect));\r\n    } else {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG, new Point(xIntersect, yIntersect));\r\n    }\r\n};\r\n\r\nexport { Line };\r\n","import { Line } from \"./Line\";\r\n\r\nconst SvgPathBuilder = {\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _pt \r\n     * @returns {String}\r\n     */\r\n    pointToLineTo: function(_pt, _ptIndex) {\r\n        if(_ptIndex === 0) {\r\n            return \"M\" + _pt.getX() + \" \" + _pt.getY();\r\n        }\r\n\r\n        return \"L\" + _pt.getX() + \" \" + _pt.getY();\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _points \r\n     * @param {Number} _curvaturePx \r\n     * @returns {Point[]}\r\n     */\r\n    pointTripletToTesselatedCurvePoints(_points, _curvaturePx) {\r\n        if(_points.length !== 3) {\r\n            throw new Error(\"_points must be array of exactly 3 points\");\r\n        }\r\n\r\n        const controlPoint = _points[1];\r\n\r\n        const lineA = new Line(_points[0], _points[1]);\r\n        const lineB = new Line(_points[1], _points[2]);\r\n\r\n        const lineAShortened = lineA.createShortenedLine(0, _curvaturePx * 0.5);\r\n        const lineBShortened = lineB.createShortenedLine(_curvaturePx * 0.5, 0);\r\n\r\n        return [\r\n            lineAShortened.getStartPoint(),\r\n            lineAShortened.getEndPoint(),\r\n            lineBShortened.getStartPoint(),\r\n            lineBShortened.getEndPoint(),\r\n        ];\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _points\r\n     * @param {Number} _curvaturePx\r\n     * @returns {String}\r\n     */\r\n    pointsToPath: function(_points, _curvaturePx) {\r\n        _curvaturePx = _curvaturePx || 0.0;\r\n\r\n        const svgPathParts = [];\r\n        let ptIdx = 0; // minify bug if this is put within the if(_curvaturePx... block\r\n\r\n        if(_curvaturePx > 0.0) {\r\n            while(_points.length >= 3) {\r\n                const ptA = _points.shift();\r\n                const ptB = _points.shift();\r\n                const ptC = _points.shift();\r\n\r\n                const newPts = SvgPathBuilder.pointTripletToTesselatedCurvePoints(\r\n                    [\r\n                        ptA,\r\n                        ptB,\r\n                        ptC,\r\n                    ],\r\n                    _curvaturePx\r\n                );                \r\n\r\n                _points.unshift(newPts[3]);\r\n                _points.unshift(newPts[2]);\r\n\r\n                for(let j=0; j<newPts.length-2; j++) {\r\n                    svgPathParts.push(SvgPathBuilder.pointToLineTo(newPts[j], ptIdx++));\r\n                }\r\n            }\r\n\r\n            while(_points.length > 0) {\r\n                const pt = _points.shift();\r\n                svgPathParts.push(SvgPathBuilder.pointToLineTo(pt, ptIdx++));\r\n            }\r\n\r\n        } else {\r\n            for(let i=0; i<_points.length; i++) {\r\n                const p = _points[i];\r\n                svgPathParts.push(SvgPathBuilder.pointToLineTo(p, i));\r\n            }\r\n        }\r\n\r\n        return svgPathParts.join(\" \");        \r\n    },\r\n\r\n};\r\n\r\nexport { SvgPathBuilder };\r\n","/**\r\n * \r\n * @param {Number} _width\r\n * @param {Number} _height\r\n */\r\nfunction Dimensions(_width, _height) {\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */       \r\n    this.getWidth = function() {\r\n        return _width;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */       \r\n    this.getHeight = function() {\r\n        return _height;\r\n    };\r\n};\r\n\r\nexport { Dimensions };\r\n","import {Point} from './Point';\r\nimport {Line} from './Line';\r\n\r\n/**\r\n * \r\n * @param {Number} _left\r\n * @param {Number} _top\r\n * @param {Number} _right\r\n * @param {Number} _bottom\r\n */\r\nfunction Rectangle(_left, _top, _right, _bottom)  {\r\n    this.__left = _left;\r\n    this.__top = _top;\r\n    this.__right = _right;\r\n    this.__bottom = _bottom;    \r\n};\r\n\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nRectangle.prototype.getLeft = function() {\r\n    return this.__left;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nRectangle.prototype.getTop = function() {\r\n    return this.__top;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nRectangle.prototype.getRight = function() {\r\n    return this.__right;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nRectangle.prototype.getBottom = function() {\r\n    return this.__bottom;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */    \r\nRectangle.prototype.getWidth = function() {\r\n    return this.__right - this.__left;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */    \r\nRectangle.prototype.getHeight = function() {\r\n    return this.__bottom - this.__top;\r\n};\r\n\r\n/**\r\n * @returns {Point[]}\r\n */\r\nRectangle.prototype.getPoints = function() {\r\n    return [\r\n        new Point(this.__left, this.__top),\r\n        new Point(this.__right, this.__top),\r\n        new Point(this.__right, this.__bottom),\r\n        new Point(this.__left, this.__bottom)\r\n    ];\r\n};\r\n\r\n/**\r\n * @returns {Line[]}\r\n */\r\nRectangle.prototype.getLines = function() {\r\n    return [\r\n        new Line(new Point(this.__left, this.__top), new Point(this.__right, this.__top)),\r\n        new Line(new Point(this.__right, this.__top), new Point(this.__right, this.__bottom)),\r\n        new Line(new Point(this.__right, this.__bottom), new Point(this.__left, this.__bottom)),\r\n        new Line(new Point(this.__left, this.__bottom), new Point(this.__left, this.__top))\r\n    ];\r\n};\r\n\r\n/**\r\n * @param {Number} _resizeByPx\r\n * @returns {Rectangle}\r\n */\r\nRectangle.prototype.getUniformlyResizedCopy = function(_resizeByPx) {\r\n    return new Rectangle(\r\n        this.__left - _resizeByPx, \r\n        this.__top - _resizeByPx, \r\n        this.__right + _resizeByPx, \r\n        this.__bottom + _resizeByPx\r\n    );\r\n};\r\n\r\n/**\r\n * Scale the bounding box by _gridSize, and return the points comprising the box\r\n * \r\n * @param {Number} _gridSize\r\n * @returns {Point[]}\r\n */\r\nRectangle.prototype.getPointsScaledToGrid = function(_gridSize) {\r\n\r\n    const centroid = new Point(\r\n        this.__left + ((this.__right-this.__left)*0.5),\r\n        this.__top + ((this.__bottom-this.__top)*0.5)\r\n    );\r\n\r\n    const scaleDx = ((this.__right - centroid.getX()) + _gridSize) / (this.__right - centroid.getX());\r\n    const scaleDy = ((this.__bottom - centroid.getY()) + _gridSize) / (this.__bottom - centroid.getY());        \r\n\r\n    const scaledPoints = [\r\n        new Point(\r\n            ((this.__left - centroid.getX())*scaleDx) + centroid.getX(), \r\n            ((this.__top - centroid.getY())*scaleDy) + centroid.getY()\r\n        ),\r\n\r\n        new Point(\r\n            ((this.__right - centroid.getX())*scaleDx) + centroid.getX(), \r\n            ((this.__top - centroid.getY())*scaleDy) + centroid.getY()\r\n        ),\r\n\r\n        new Point(\r\n            ((this.__right - centroid.getX())*scaleDx) + centroid.getX(), \r\n            ((this.__bottom - centroid.getY())*scaleDy) + centroid.getY()\r\n        ),\r\n\r\n        new Point(\r\n            ((this.__left - centroid.getX())*scaleDx) + centroid.getX(), \r\n            ((this.__bottom - centroid.getY())*scaleDy) + centroid.getY()\r\n        )\r\n    ];\r\n\r\n    return scaledPoints;\r\n};    \r\n\r\n/**\r\n * \r\n * @param {Rectangle} _otherRectangle\r\n * @returns {Boolean}\r\n */\r\nRectangle.prototype.checkIntersect = function(_otherRectangle) {\r\n    if(this.__bottom < _otherRectangle.getTop()) {\r\n        return false;\r\n    }\r\n\r\n    if(this.__top > _otherRectangle.getBottom()) {\r\n        return false;\r\n    }\r\n\r\n    if(this.__right < _otherRectangle.getLeft()) {\r\n        return false;\r\n    }\r\n\r\n    if(this.__left > _otherRectangle.getRight()) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n\r\n/**\r\n * \r\n * @param {Point} _point \r\n */\r\nRectangle.prototype.checkIsPointWithin = function(_point) {\r\n    if(_point.getX() >= this.__left && _point.getX() <= this.__right && _point.getY() >= this.__top && _point.getY() <= this.__bottom) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * \r\n * @param {Rectangle} _otherRectangle\r\n * @returns {Boolean}\r\n */\r\nRectangle.prototype.checkIsWithin = function(_otherRectangle) {\r\n    if( this.__bottom <= _otherRectangle.getBottom() &&\r\n        this.__top >= _otherRectangle.getTop() &&\r\n        this.__right <= _otherRectangle.getRight() &&\r\n        this.__left >= _otherRectangle.getLeft()\r\n    ) {\r\n\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n\r\nexport { Rectangle }\r\n","const GroupTransformationContainerEvent = Object.freeze({\r\n    TRANSLATE_START: 'group-transformation-container-translate-start',\r\n    TRANSLATE: 'group-transformation-container-translate',\r\n});\r\n\r\nexport { GroupTransformationContainerEvent };\r\n","const EntityEvent = Object.freeze({\r\n    TRANSLATE_START: 'obj-translate-start',\r\n    TRANSLATE: 'obj-translate',\r\n    RESIZE_START: 'obj-resize-start',\r\n    RESIZE: 'obj-resize'\r\n});\r\n\r\n\r\nexport { EntityEvent };\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Point objects\r\n * \r\n * @param {Point[]|Float64Array|undefined} _pointsInput\r\n */\r\nfunction PointSet(_pointsInput) {\r\n\r\n    const self = this;\r\n\r\n    /**\r\n     * @type {Point[]}\r\n     */\r\n    const points = [];\r\n\r\n    /**\r\n     * @param {Point} _newPoint\r\n     */\r\n    this.push = function(_newPoint) {\r\n        for(let i=0; i<points.length; i++) {\r\n            if(_newPoint.isEqual(points[i])) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        points.push(_newPoint);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @param {PointSet} _ps\r\n     */\r\n    this.pushPointSet = function(_ps) {\r\n        const possibleNewPoints = _ps.toArray();\r\n        for(let i=0; i<possibleNewPoints.length; i++) {\r\n            self.push(possibleNewPoints[i]);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {Point}\r\n     */\r\n    this.findPointClosestTo = function(_point) {\r\n        var resultPoint = null;\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                resultPoint = _pt;\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return resultPoint;        \r\n    };\r\n\r\n    /**\r\n     * Find distance to a point in the set that is closes to the given point (_point)\r\n     * \r\n     * @todo Evaluate if this is actually needed. Seems like the distance can be computed and returned by findPointClosestTo()\r\n     * .. or distance can be easily computed with point returned by findPointClosestTo()\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {Number}\r\n     */\r\n    this.findDistanceToPointClosestTo = function(_point) {\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return currentMinLength;        \r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {PointSet}\r\n     */\r\n    this.findPointsCloseTo = function(_point, _radius) {\r\n        const resultSet = new PointSet();\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() <= _radius) {\r\n                resultSet.push(_pt);\r\n            }\r\n        });\r\n        \r\n        return resultSet;        \r\n    };    \r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.toArray = function() {\r\n        return points;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n\r\n        const result = new Float64Array(points.length * 2);\r\n        for(let i=0; i<points.length; i++) {\r\n            result[0 + (i*2)] = points[i].getX();\r\n            result[1 + (i*2)] = points[i].getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n    \r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        points.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=2) {\r\n            points.push(\r\n                new Point(_float64Array[i], _float64Array[i+1])\r\n            );\r\n        }\r\n    };    \r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return points.length;\r\n    };\r\n\r\n    if(_pointsInput && Array.isArray(_pointsInput)) {\r\n        _pointsInput.forEach(self.push);\r\n    } else if(_pointsInput && Object.prototype.toString.call(_pointsInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_pointsInput);\r\n    } else { }    \r\n\r\n};\r\n\r\nexport { PointSet };\r\n","import { PointSet } from \"./PointSet\";\r\nimport { Rectangle } from \"./Rectangle\";\r\n\r\nconst AccessibleRoutingPointsFinder = {\r\n\r\n    /**\r\n     * Find routing points that are not occluded by objects\r\n     * \r\n     * @param {Object[]} _subjectEntityDescriptors\r\n     * @param {Object[]} _occluderEntityDescriptors\r\n     * @param {Number} _gridSize\r\n     * @returns {Object}\r\n     */\r\n    find: function(_subjectEntityDescriptors, _occluderEntityDescriptors, _gridSize) {\r\n        const connectorAnchorToNumValidRoutingPoints = new Map();\r\n        const allRoutingPoints = [];\r\n        const filteredRoutingPoints = new PointSet();\r\n\r\n        _subjectEntityDescriptors.forEach((_entityDescriptor) => {\r\n            const anchors = _entityDescriptor.connectorAnchors;\r\n\r\n            anchors.forEach((_a) => {\r\n                let isAnchorOccluded = false;\r\n\r\n                // check if anchor is occluded\r\n                // @todo Commented out for now, need a decision on how to handle anchors where centroid is on the occluder bounding rect\r\n                /*for(let i=0; i<_occludableByObjects.length; i++) {\r\n                    const possibleOccluderBoundingRect = _occludableByObjects[i].getBoundingRectange();\r\n                    if(possibleOccluderBoundingRect.checkIsPointWithin(_a.getCentroid())) {\r\n                        connectorAnchorToNumValidRoutingPoints.set(_a.getId(), 0);\r\n                        isAnchorOccluded = true;\r\n                        break;\r\n                    }\r\n                }*/\r\n\r\n                if(!isAnchorOccluded) {\r\n                    const routingPoints = (new PointSet(_a.routingPointsFloat64Arr)).toArray();\r\n                    routingPoints.forEach((_rp) => {\r\n                        allRoutingPoints.push(\r\n                            {\r\n                                \"routingPoint\": _rp,\r\n                                \"parentAnchorId\": _a.id\r\n                            }\r\n                        );\r\n                    });\r\n\r\n                    connectorAnchorToNumValidRoutingPoints.set(_a.id, routingPoints.length);\r\n                }\r\n            });\r\n        });\r\n\r\n        allRoutingPoints.forEach((_rp) => {\r\n            let isPointWithinObj = false;\r\n\r\n            // check if routing point is occluded\r\n            for(let i=0; i<_occluderEntityDescriptors.length; i++) {\r\n                const occluder = _occluderEntityDescriptors[i];\r\n                const boundingRect = new Rectangle(occluder.x, occluder.y, occluder.x + occluder.width, occluder.y + occluder.height);\r\n                if(boundingRect.checkIsPointWithin(_rp.routingPoint)) {\r\n                    isPointWithinObj = true;\r\n                    const currentNumRoutingPoints = connectorAnchorToNumValidRoutingPoints.get(_rp.parentAnchorId) || 0;\r\n                    connectorAnchorToNumValidRoutingPoints.set(_rp.parentAnchorId, Math.max(0, currentNumRoutingPoints - 1));\r\n                }\r\n            }\r\n\r\n            if(!isPointWithinObj) {\r\n                filteredRoutingPoints.push(_rp.routingPoint);\r\n            }\r\n            \r\n        });\r\n\r\n        return {\r\n            \"connectorAnchorToNumValidRoutingPoints\": connectorAnchorToNumValidRoutingPoints,\r\n            \"accessibleRoutingPoints\": filteredRoutingPoints,\r\n        };\r\n    }\r\n};\r\n\r\nexport { AccessibleRoutingPointsFinder };\r\n","import  {Point} from './Point';\r\nimport  {Rectangle} from './Rectangle';\r\n\r\n/**\r\n * @param {String} _id\r\n * @param {Element} _domElement\r\n * @param {Sheet} _sheet\r\n * @param {Number} _routingPointOffsetX\r\n * @param {Number} _routingPointOffsetY\r\n */\r\nfunction ConnectorAnchor(_id, _domElement, _sheet, _routingPointOffsetX, _routingPointOffsetY) {\r\n    const self = this;\r\n    let routingPointDirections = [\"top\", \"left\", \"bottom\", \"right\"];\r\n\r\n    _routingPointOffsetX = _routingPointOffsetX || _sheet.getGridSize();\r\n    _routingPointOffsetY = _routingPointOffsetY || _sheet.getGridSize();\r\n\r\n    const getDimensions = function() {\r\n        const r = _sheet.transformDomRectToPageSpaceRect(_domElement.getBoundingClientRect());\r\n        return new Point(r.getWidth(), r.getHeight());\r\n    };\r\n\r\n    const routingPointDirectionToPoint = function(_direction, _centroid, _halfWidth, _halfHeight) {\r\n        if(_direction === 'top') {\r\n            return new Point(_centroid.getX(), _centroid.getY() - _halfHeight - _routingPointOffsetY);\r\n        }\r\n\r\n        if(_direction === 'bottom') {\r\n            return new Point(_centroid.getX(), _centroid.getY() + _halfHeight + _routingPointOffsetY);\r\n        }\r\n\r\n        if(_direction === 'left') {\r\n            return new Point(_centroid.getX() - _halfWidth - _routingPointOffsetX, _centroid.getY());\r\n        }\r\n\r\n        if(_direction === 'right') {\r\n            return new Point(_centroid.getX() + _halfWidth + _routingPointOffsetX, _centroid.getY());\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _directions \r\n     */\r\n    this.setPossibleRoutingPointDirections = function(_directions) {\r\n        routingPointDirections = _directions;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _id;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */     \r\n    this.getX = function() {\r\n        // Might want to return left edge coordinate instead\r\n        return self.getCentroid().getX();\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */     \r\n    this.getY = function() {\r\n        // Might want to return top edge coordinate instead\r\n        return self.getCentroid().getY();\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        const r = _sheet.transformDomRectToPageSpaceRect(_domElement.getBoundingClientRect());\r\n        return r.getWidth();\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        const r = _sheet.transformDomRectToPageSpaceRect(_domElement.getBoundingClientRect());\r\n        return r.getHeight();\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getCentroid = function() {\r\n        const sheetOffset = _sheet.getSheetOffset();\r\n        const pageSpaceRect = _sheet.transformDomRectToPageSpaceRect(_domElement.getBoundingClientRect());\r\n        const halfWidth = pageSpaceRect.getWidth() * 0.5;\r\n        const halfHeight = pageSpaceRect.getHeight() * 0.5;        \r\n        \r\n        return new Point(\r\n            (pageSpaceRect.getLeft() + halfWidth) - sheetOffset.getX(), \r\n            (pageSpaceRect.getTop() + halfHeight) - sheetOffset.getY()\r\n        );\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Point[]}\r\n     */\r\n    this.getRoutingPoints = function() {\r\n        const dimensions = getDimensions();\r\n        const centroid = self.getCentroid();\r\n        const halfWidth = dimensions.getX() * 0.5;\r\n        const halfHeight = dimensions.getY() * 0.5;\r\n\r\n        const result = [];\r\n        routingPointDirections.forEach((_dir) => {\r\n            result.push(routingPointDirectionToPoint(_dir, centroid, halfWidth, halfHeight));\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRectange = function() {\r\n        const dimensions = getDimensions();\r\n        const centroid = self.getCentroid();\r\n        const halfWidth = dimensions.getX() * 0.5;\r\n        const halfHeight = dimensions.getY() * 0.5;\r\n\r\n        return new Rectangle(\r\n            centroid.getX() - halfWidth, \r\n            centroid.getY() - halfHeight, \r\n            centroid.getX() + halfWidth, \r\n            centroid.getY() + halfHeight\r\n        );\r\n    };\r\n};\r\n\r\nexport { ConnectorAnchor };\r\n","import { Entity } from \"../Entity\";\r\nimport { ConnectorAnchor } from \"../ConnectorAnchor\";\r\n\r\nconst ClosestPairFinder = {   \r\n    /**\r\n     * \r\n     * @param {Entity} _objA \r\n     * @param {Entity} _objB\r\n     * @param {Map<ConnectorAnchor, Number>} _connectorAnchorToNumValidRoutingPoints\r\n     * @returns {Object}\r\n     */\r\n    findClosestPairBetweenObjects: function(_objA, _objB, _connectorAnchorToNumValidRoutingPoints) {\r\n        const objAConnectorAnchors = _objA.getConnectorAnchors();\r\n        const objBConnectorAnchors = _objB.getConnectorAnchors();\r\n\r\n        var startAnchorIdxWithMinDist = 0;\r\n        var endAnchorIdxWithMinDist = 0;\r\n        var minDist = Number.MAX_VALUE;\r\n        \r\n        // Find best anchor element to connect _objA and _objB            \r\n        // Find anchors that produce shortest straight line distance\r\n        for(let x=0; x<objAConnectorAnchors.length; x++) {\r\n            const aCentroid = objAConnectorAnchors[x].getCentroid();\r\n            const objANumValidRoutingPoints = _connectorAnchorToNumValidRoutingPoints.get(objAConnectorAnchors[x].getId()) || 0;\r\n            if(objANumValidRoutingPoints === 0) {\r\n                continue;\r\n            }\r\n\r\n            for(let y=0; y<objBConnectorAnchors.length; y++) {\r\n                const bCentroid = objBConnectorAnchors[y].getCentroid();\r\n                const d = Math.sqrt(Math.pow(bCentroid.getX()-aCentroid.getX(),2) + Math.pow(bCentroid.getY()-aCentroid.getY(),2));\r\n                const objBNumValidRoutingPoints = _connectorAnchorToNumValidRoutingPoints.get(objBConnectorAnchors[y].getId()) || 0;\r\n                \r\n                if(d < minDist && objBNumValidRoutingPoints > 0) {\r\n                    startAnchorIdxWithMinDist = x;\r\n                    endAnchorIdxWithMinDist = y;\r\n                    minDist = d;\r\n                }\r\n            }\r\n        }\r\n\r\n        // If we have an anchor without no routing points, we end up with this situation\r\n        if(minDist === Number.MAX_VALUE) {\r\n            // Find and return the 2 anchors closest to each other\r\n            for(let x=0; x<objAConnectorAnchors.length; x++) {\r\n                const aCentroid = objAConnectorAnchors[x].getCentroid();\r\n                for(let y=0; y<objBConnectorAnchors.length; y++) {\r\n                    const bCentroid = objBConnectorAnchors[y].getCentroid();\r\n                    const d = Math.sqrt(Math.pow(bCentroid.getX()-aCentroid.getX(),2) + Math.pow(bCentroid.getY()-aCentroid.getY(),2));\r\n\r\n                    if(d < minDist) {\r\n                        startAnchorIdxWithMinDist = x;\r\n                        endAnchorIdxWithMinDist = y;                        \r\n                        minDist = d;\r\n                    }\r\n                }\r\n            }                \r\n        }\r\n\r\n        return {\r\n            \"objectAAnchorIndex\": startAnchorIdxWithMinDist,\r\n            \"objectAAnchor\": objAConnectorAnchors[startAnchorIdxWithMinDist],\r\n            \"objectBAnchorIndex\": endAnchorIdxWithMinDist,\r\n            \"objectBAnchor\": objBConnectorAnchors[endAnchorIdxWithMinDist],\r\n        };\r\n    }\r\n};\r\n\r\nexport { ClosestPairFinder };\r\n","import { AccessibleRoutingPointsFinder } from \"../AccessibleRoutingPointsFinder\";\r\nimport { ClosestPairFinder as ConnectorAnchorClosestPairFinder } from \"../ConnectorAnchorFinder/ClosestPairFinder\";\r\n\r\nconst BestToConnectEntitiesFinder = function() {\r\n    this.findBestTimeout = null;\r\n    this.searchInputs = [];\r\n    this.currentSheetEntities = [];\r\n    this.currentGridSize = 11.0;\r\n    this.findBufferTime = 6.94;\r\n    this.metrics = {\r\n        batchSize: null,\r\n        searchFuncExecutionTime: null\r\n    };\r\n};\r\n\r\n/**\r\n * \r\n * @returns {Number}\r\n */\r\nBestToConnectEntitiesFinder.prototype.getSearchFuncExecutionTime = function() {\r\n    return this.metrics.searchFuncExecutionTime;\r\n};\r\n\r\n/**\r\n * \r\n * @returns {Number}\r\n */\r\n BestToConnectEntitiesFinder.prototype.getSearchFuncBatchSize = function() {\r\n    return this.metrics.batchSize;\r\n};\r\n\r\n/**\r\n * \r\n * @param {Entity} _a \r\n * @param {Entity} _b \r\n * @param {Function} _cb \r\n * @returns \r\n */\r\nBestToConnectEntitiesFinder.prototype.alreadyInSearchInputs = function(_a, _b, _cb) {\r\n    for(let i=0; i<this.searchInputs.length; i++) {\r\n        if(\r\n            this.searchInputs[i].entityA === _a && \r\n            this.searchInputs[i].entityB === _b &&\r\n            this.searchInputs[i].cb.toString() === _cb.toString()\r\n        ) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\nBestToConnectEntitiesFinder.prototype.clearSearchInputs = function() {\r\n    this.searchInputs.length = 0;\r\n};\r\n\r\nBestToConnectEntitiesFinder.prototype.search = function() {\r\n    const exTimeT1 = new Date();\r\n\r\n    const inputBatchSize = this.searchInputs.length;\r\n    const gridSize = this.currentGridSize;\r\n\r\n    const entityDescriptors = [];\r\n    this.currentSheetEntities.forEach(function(_e) {\r\n        entityDescriptors[_e.getId()] = _e.getDescriptor(gridSize);\r\n    });\r\n\r\n    // maybe update AccessibleRoutingPointsFinder.find to handle an object?\r\n    const entityDescriptorsArr = Object.values(entityDescriptors);\r\n\r\n    for(let i=0; i<this.searchInputs.length; i++) {\r\n        const accessibleRoutingPointsResult = AccessibleRoutingPointsFinder.find(\r\n            [\r\n                entityDescriptors[this.searchInputs[i].entityA.getId()], \r\n                entityDescriptors[this.searchInputs[i].entityB.getId()]\r\n            ],\r\n            entityDescriptorsArr,  // assuming all entities are possible occluders? maybe only consider those within extents\r\n            gridSize\r\n        );\r\n\r\n        const result = ConnectorAnchorClosestPairFinder.findClosestPairBetweenObjects(\r\n            this.searchInputs[i].entityA, \r\n            this.searchInputs[i].entityB, \r\n            accessibleRoutingPointsResult.connectorAnchorToNumValidRoutingPoints\r\n        );\r\n\r\n        this.searchInputs[i].cb(result);\r\n    }\r\n\r\n    this.metrics.batchSize = inputBatchSize;\r\n    this.metrics.searchFuncExecutionTime = (new Date()) - exTimeT1;\r\n};\r\n\r\n/**\r\n * \r\n * @param {Entity} _entityA \r\n * @param {Entity} _entityB \r\n * @param {Function} _onFound \r\n */\r\nBestToConnectEntitiesFinder.prototype.findBest = function(_entityA, _entityB, _onFound, _sheetEntities, _gridSize) {\r\n    this.currentSheetEntities = _sheetEntities;\r\n    this.currentGridSize = _gridSize;\r\n\r\n    if(!this.alreadyInSearchInputs(_entityA, _entityB, _onFound)) {\r\n        this.searchInputs.push(\r\n            {\r\n                \"entityA\": _entityA,\r\n                \"entityB\": _entityB,\r\n                \"cb\": _onFound\r\n            }\r\n        );\r\n    }\r\n\r\n    if(this.findBestTimeout) {\r\n        clearTimeout(this.findBestTimeout);\r\n        this.findBestTimeout = null;\r\n    }\r\n\r\n    const searchFunc = () => {\r\n        this.search(this.searchInputs);\r\n        this.findBestTimeout = null;\r\n        this.searchInputs = [];            \r\n    };\r\n\r\n    this.findBestTimeout = setTimeout(searchFunc, this.findBufferTime);\r\n};\r\n\r\nexport { BestToConnectEntitiesFinder };\r\n","const SheetEvent = Object.freeze({\r\n    DBLCLICK: \"dblclick\",\r\n    CLICK: \"click\",\r\n    CLUSTER_CREATED: \"cluster-created\",\r\n    CLUSTER_DELETED: \"cluster-deleted\",\r\n    CLUSTER_UPDATED: \"cluster-updated\",\r\n    CONNECTOR_UPDATED: \"connector-updated\",\r\n    ENTITY_ADDED: \"entity-added\",\r\n    ENTITY_REMOVED: \"entity-removed\",\r\n    ENTITY_RESIZED: \"entity-resized\",\r\n    ENTITY_TRANSLATED: \"entity-translated\",\r\n    ENTITY_OVERLAP_DETECTED: \"entity-overlap-detected\",\r\n    MULTIPLE_ENTITY_SELECTION_STARTED: \"multiple-object-selection-started\",\r\n    MULTIPLE_ENTITIES_SELECTED: \"multiple-objects-selected\",\r\n});\r\n\r\n\r\nexport { SheetEvent };\r\n","const DebugMetricsPanel = function(_window) {\r\n    var debugPanelElem = null;\r\n    var isVisible = false;\r\n\r\n    const objectHtmlDumpDepthFirst = function(_obj, _output, _parentName) {\r\n        if(typeof _parentName === 'undefined') {\r\n            _parentName = \"\";\r\n        }\r\n\r\n        if(_obj instanceof Object) {\r\n            Object.keys(_obj).forEach((_k) => {\r\n                if(_obj[_k] instanceof Object) {\r\n                    objectHtmlDumpDepthFirst(_obj[_k], _output, _k);\r\n                } else {\r\n                    let prefix = \"\";\r\n                    if(_parentName.length > 0) {\r\n                        prefix = _parentName + \".\";\r\n                    }\r\n\r\n                    const metricName = `${prefix}${_k}`;\r\n                    _output.push(`<p class=\"metric\">${metricName} = ${_obj[_k]}</p>`);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    this.init = function() {\r\n        debugPanelElem = _window.document.createElement(\"div\");\r\n        debugPanelElem.classList.add(\"graphpaper-debug-panel\");\r\n        debugPanelElem.style.display = \"none\";\r\n        debugPanelElem.style.position = \"fixed\";\r\n        debugPanelElem.style.right = \"0px\";\r\n        debugPanelElem.style.top = \"0px\";\r\n        debugPanelElem.style.width = \"500px\";\r\n        debugPanelElem.style.height = \"200px\";\r\n        debugPanelElem.style.color = \"#fff\";\r\n        debugPanelElem.style.padding = \"15px\";\r\n        debugPanelElem.style.backgroundColor = \"rgba(0,0,0,0.75)\";\r\n        debugPanelElem.style.zIndex = 9999;\r\n        _window.document.body.appendChild(debugPanelElem);\r\n    };\r\n\r\n    this.show = function() {\r\n        isVisible = true;\r\n        debugPanelElem.style.display = \"block\";\r\n    };\r\n\r\n    this.hide = function() {\r\n        isVisible = false;\r\n        debugPanelElem.style.display = \"none\";\r\n    };\r\n\r\n    this.refresh = function(_metrics) {\r\n        if(isVisible === false) {\r\n            return;\r\n        }\r\n\r\n        const htmlStringsArr = [];\r\n        objectHtmlDumpDepthFirst(_metrics, htmlStringsArr);\r\n        debugPanelElem.innerHTML = htmlStringsArr.join('');\r\n    };\r\n\r\n};\r\n\r\nexport { DebugMetricsPanel };\r\n","import { MatrixMath } from './MatrixMath';\r\n\r\n/**\r\n * \r\n * @param {Number} _dblTapSpeed \r\n * @param {Number} _dblTapRadius \r\n */\r\nfunction DoubleTapDetector(_dblTapSpeed, _dblTapRadius)\r\n{\r\n    const dblTapDetectVars = {\r\n        lastTouchX: null,\r\n        lastTouchY: null,\r\n        lastTouchTime: null\r\n    };\r\n    \r\n    let dblTapSpeed = _dblTapSpeed || 300.0;\r\n    let dblTapRadius = _dblTapRadius || 24.0;\r\n\r\n    /**\r\n     * \r\n     * @param {TouchEvent} _touchEndEvent \r\n     * @param {Point} _sheetPageOffset \r\n     * @param {Array} currentInvTransformationMatrix\r\n     * @returns {Object}\r\n     */\r\n    this.processTap = function(_touchEndEvent, _sheetPageOffset, _currentInvTransformationMatrix) {\r\n        if(_touchEndEvent.changedTouches.length === 0) {\r\n            // we have nothing to work with\r\n            return {\r\n                \"doubleTapDetected\": false,\r\n                \"touchX\": null,\r\n                \"touchY\": null\r\n            };\r\n        }\r\n\r\n        // Position of the touch\r\n\r\n        // THIS NEEDS TO BE UPDATED TO ACCOUNT FOR OFFSET OF SHEET RELATIVE TO PAGE\r\n\r\n        const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n            [_touchEndEvent.changedTouches[0].pageX - _sheetPageOffset.getX(), _touchEndEvent.changedTouches[0].pageY - _sheetPageOffset.getY(), 0, 1],\r\n            _currentInvTransformationMatrix\r\n        );            \r\n\r\n        let dblTapDetected = false;  // flag specifying if we detected a double-tap\r\n        const x = invTransformedPos[0];\r\n        const y = invTransformedPos[1];\r\n        const now = new Date().getTime();\r\n\r\n        // Check if we have stored data for a previous touch (indicating we should test for a double-tap)\r\n        if(dblTapDetectVars.lastTouchTime !== null) {\r\n            const lastTouchTime = dblTapDetectVars.lastTouchTime;\r\n\r\n            // Compute time since the previous touch\r\n            const timeSinceLastTouch = now - lastTouchTime;\r\n\r\n            // Get the position of the last touch on the element\r\n            const lastX = dblTapDetectVars.lastTouchX;\r\n            const lastY = dblTapDetectVars.lastTouchY;\r\n\r\n            // Compute the distance from the last touch on the element\r\n            const distFromLastTouch = Math.sqrt( Math.pow(x-lastX,2) + Math.pow(y-lastY,2) );\r\n\r\n            if(timeSinceLastTouch <= dblTapSpeed && distFromLastTouch <= dblTapRadius) {\r\n                // Remove last touch info from element\r\n                dblTapDetectVars.lastTouchTime = null;\r\n                dblTapDetectVars.lastTouchX = null;\r\n                dblTapDetectVars.lastTouchY = null;\r\n\r\n                // Flag that we detected a double tap\r\n                dblTapDetected = true;                \r\n            }\r\n        }\r\n\r\n        if(!dblTapDetected) {\r\n            dblTapDetectVars.lastTouchTime = now;\r\n            dblTapDetectVars.lastTouchX = x;\r\n            dblTapDetectVars.lastTouchY = y;\r\n        }\r\n\r\n        return {\r\n            \"doubleTapDetected\": dblTapDetected,\r\n            \"touchX\": x,\r\n            \"touchY\": y\r\n        }\r\n    };\r\n};\r\n\r\nexport { DoubleTapDetector };\r\n","const ConnectorEvent = Object.freeze({\r\n    CLICK: 'connector-click',\r\n    MOUSE_ENTER: 'connector-mouse-enter',\r\n    MOUSE_LEAVE: 'connector-mouse-leave'\r\n});\r\n\r\nexport { ConnectorEvent };\r\n","const ConnectorRoutingAlgorithm = Object.freeze({\r\n    STRAIGHT_LINE: 0,\r\n    STRAIGHT_LINE_BETWEEN_ANCHORS: 1,\r\n    STRAIGHT_LINE_BETWEEN_ANCHORS_AVOID_SELF_INTERSECTION: 2, // unsupported\r\n    ASTAR: 3,\r\n    ASTAR_WITH_ROUTE_OPTIMIZATION: 4,\r\n    ASTAR_THETA_WITH_ROUTE_OPTIMIZATION: 5,\r\n});\r\n\r\nexport { ConnectorRoutingAlgorithm };\r\n","import {ConnectorAnchor} from './ConnectorAnchor';\r\nimport {ConnectorEvent} from './ConnectorEvent';\r\nimport {ConnectorRoutingAlgorithm} from './ConnectorRoutingAlgorithm';\r\nimport {Line} from './Line';\r\nimport {Point} from './Point';\r\n\r\n/**\r\n * \r\n * @param {ConnectorAnchor} _anchorStart \r\n * @param {ConnectorAnchor} _anchorEnd\r\n * @param {Element} _containerDomElement\r\n * @param {Number} _curvaturePx\r\n * @param {ConnectorRoutingAlgorithm} _routingAlgorithm\r\n */\r\nfunction Connector(_anchorStart, _anchorEnd, _containerDomElement, _curvaturePx, _routingAlgorithm) {\r\n    const self = this;\r\n\r\n    const eventNameToHandlerFunc = new Map();\r\n    let markerStartSize = 0;\r\n    let markerEndSize = 0;\r\n    const defaultStrokeColor = '#000';\r\n    const defaultStrokeWidth = '2px';\r\n\r\n    if(typeof _curvaturePx === 'undefined') {\r\n        _curvaturePx = 0;\r\n    }\r\n\r\n    if(typeof _routingAlgorithm === 'undefined') {\r\n        _routingAlgorithm = ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION;\r\n    }\r\n\r\n    /**\r\n     * @type {Point[]|null}\r\n     */\r\n    let pathPoints = null;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    const pathElem = window.document.createElementNS(\"http://www.w3.org/2000/svg\", 'path');\r\n    pathElem.setAttribute(\"d\", 'M0 0 L0 0');\r\n    pathElem.style.stroke = defaultStrokeColor;\r\n    pathElem.style.strokeWidth = defaultStrokeWidth;\r\n\r\n    /**\r\n     * @type {Element}\r\n     * \r\n     * Transparent copy of pathElem, with a larger stroke, that is used for interaction (e.g. click, mousenter, etc.) events.\r\n     * This is to address the fact that it can be difficult to interact with pathElem when the stroke is small.\r\n     * \r\n     */\r\n    const interactionElem = window.document.createElementNS(\"http://www.w3.org/2000/svg\", 'path');\r\n    interactionElem.setAttribute(\"d\", 'M0 0 L0 0');\r\n    interactionElem.style.stroke = 'transparent';\r\n    interactionElem.style.strokeWidth = defaultStrokeWidth;\r\n\r\n    interactionElem.addEventListener(\"click\", function(e) {\r\n        self.dispatchEvent(ConnectorEvent.CLICK, {\"connector\":self, \"clickedAtX\": e.pageX, \"clickedAtY\": e.pageY});\r\n    });\r\n\r\n    interactionElem.addEventListener(\"mouseenter\", function(e) {\r\n        self.dispatchEvent(ConnectorEvent.MOUSE_ENTER, {\"connector\":self, \"pointerAtX\": e.pageX, \"pointerAtY\": e.pageY});\r\n    });\r\n\r\n    interactionElem.addEventListener(\"mouseleave\", function(e) {\r\n        self.dispatchEvent(ConnectorEvent.MOUSE_LEAVE, {\"connector\":self });\r\n    });        \r\n\r\n    this.appendPathToContainerDomElement = function() {\r\n        _containerDomElement.appendChild(pathElem);\r\n        _containerDomElement.appendChild(interactionElem);\r\n    };\r\n\r\n    /**\r\n     * @param {String} _url\r\n     * @param {Number} _size\r\n     */    \r\n    this.setMarkerStart = function(_url, _size) {\r\n        pathElem.setAttribute(`marker-start`, `url(${_url})`);\r\n        markerStartSize = _size;\r\n    };\r\n\r\n    this.unsetMarkerStart = function() {\r\n        pathElem.removeAttribute(`marker-start`);\r\n        markerStartSize = 0;\r\n    };\r\n\r\n    /**\r\n     * @param {String} _url\r\n     * @param {Number} _size\r\n     */\r\n    this.setMarkerEnd = function(_url, _size) {\r\n        pathElem.setAttribute(`marker-end`, `url(${_url})`);\r\n        markerEndSize = _size;\r\n    };\r\n\r\n    this.unsetMarkerEnd = function() {\r\n        pathElem.removeAttribute(`marker-end`);\r\n        markerEndSize = 0;\r\n    };    \r\n\r\n    /**\r\n     * @returns {Point[]|null}\r\n     */\r\n    this.getPathPoints = function() {\r\n        return pathPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.getPathLines = function() {\r\n        if(pathPoints === null || pathPoints.length < 2) {\r\n            return [];\r\n        }\r\n\r\n        const lines = [];\r\n        for(let i=0; i<pathPoints.length-1; i++) {\r\n            lines.push(new Line(pathPoints[i], pathPoints[i+1]));\r\n        }\r\n\r\n        return lines;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getLength = function() {\r\n        let totalLength = 0;\r\n\r\n        const pathLines = self.getPathLines();\r\n        for(let i=0; i<pathLines.length; i++) {\r\n            totalLength += pathLines[i].getLength();\r\n        }\r\n        \r\n        return totalLength;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getMidpoint = function() {\r\n        const totalLength = self.getLength();\r\n        const pathLines = self.getPathLines();\r\n\r\n        let lengthSoFar = 0;\r\n        let curPathLineWithMidpoint = null;\r\n\r\n        for(let i=0; i<pathLines.length; i++) {\r\n            curPathLineWithMidpoint = pathLines[i];\r\n            const pathLineLength = pathLines[i].getLength();\r\n            lengthSoFar += pathLineLength;\r\n\r\n            if(lengthSoFar >= totalLength/2.0) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        const lengthBeforeCur = (lengthSoFar - curPathLineWithMidpoint.getLength());\r\n        const midOnCurPath = (totalLength / 2.0) - lengthBeforeCur; // i.e. distance to midpoint\r\n\r\n        const p = midOnCurPath / curPathLineWithMidpoint.getLength();\r\n\r\n        return new Point(\r\n            curPathLineWithMidpoint.getStartPoint().getX() + (p * (curPathLineWithMidpoint.getEndPoint().getX() - curPathLineWithMidpoint.getStartPoint().getX())),\r\n            curPathLineWithMidpoint.getStartPoint().getY() + (p * (curPathLineWithMidpoint.getEndPoint().getY() - curPathLineWithMidpoint.getStartPoint().getY()))\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getMidpointDirection = function() {\r\n        const totalLength = self.getLength();\r\n        const pathLines = self.getPathLines();\r\n\r\n        let lengthSoFar = 0;\r\n        let curPathLineWithMidpoint = null;\r\n\r\n        for(let i=0; i<pathLines.length; i++) {\r\n            curPathLineWithMidpoint = pathLines[i];\r\n            const pathLineLength = pathLines[i].getLength();\r\n            lengthSoFar += pathLineLength;\r\n\r\n            if(lengthSoFar >= totalLength/2.0) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(curPathLineWithMidpoint === null) {\r\n            return pathLines[0].getDirection();\r\n        }\r\n\r\n        return curPathLineWithMidpoint.getDirection();\r\n    };\r\n\r\n\r\n    /**\r\n     * @param {String} _svgPath\r\n     */\r\n    this.refresh = function(_svgPath) {\r\n        pathElem.setAttribute(\"d\", _svgPath);\r\n        interactionElem.setAttribute(\"d\", _svgPath);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _pathPoints\r\n     */\r\n    this.updatePathPoints = function(_pathPoints) {\r\n        pathPoints = _pathPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        const anchorIds = [_anchorStart.getId(), _anchorEnd.getId()].sort();\r\n        return anchorIds.join(':');\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor}\r\n     */\r\n    this.getAnchorStart = function() {\r\n        return _anchorStart;\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.getAnchorEnd = function() {\r\n        return _anchorEnd;\r\n    };\r\n\r\n    this.removePathElement = function() {\r\n        pathElem.remove();\r\n        interactionElem.remove();\r\n    };\r\n\r\n    this.removeDefaultStyles = function() {\r\n        self.setInlineStyleOnPathElement('stroke', '');\r\n        self.setInlineStyleOnPathElement('strokeWidth', '');\r\n        self.setInlineStyleOnInteractionElement('stroke', '');\r\n        self.setInlineStyleOnInteractionElement('strokeWidth', '');        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _key \r\n     * @param {String} _value \r\n     */\r\n    this.setInlineStyleOnPathElement = function(_key, _value) {\r\n        pathElem.style[_key] = _value;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _cssClassesToAdd\r\n     */\r\n    this.addStyleClassesToPathElement = function(_cssClassesToAdd) {\r\n        _cssClassesToAdd.forEach((_cls) => {\r\n            pathElem.classList.add(_cls);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _cssClassesToRemove \r\n     */\r\n     this.removeStyleClassesFromPathElement = function(_cssClassesToRemove) {\r\n        _cssClassesToRemove.forEach((_cls) => {\r\n            pathElem.classList.remove(_cls);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _key \r\n     * @param {String} _value \r\n     */    \r\n    this.setInlineStyleOnInteractionElement = function(_key, _value) {\r\n        interactionElem.style[_key] = _value;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _cssClassesToAdd \r\n     */    \r\n    this.addStyleClassesToInteractionElement = function(_cssClassesToAdd) {\r\n        _cssClassesToAdd.forEach((_cls) => {\r\n            interactionElem.classList.add(_cls);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _cssClassesToRemove \r\n     */    \r\n    this.removeStyleClassesFromInteractionElement = function(_cssClassesToRemove) {\r\n        _cssClassesToRemove.forEach((_cls) => {\r\n            interactionElem.classList.remove(_cls);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @returns {Object}\r\n     */\r\n    this.getDescriptor = function() {\r\n        return {\r\n            \"id\": self.getId(),\r\n            \"anchor_start_centroid_arr\": _anchorStart.getCentroid().toArray(),\r\n            \"anchor_end_centroid_arr\": _anchorEnd.getCentroid().toArray(),\r\n            \"marker_start_size\": markerStartSize,\r\n            \"marker_end_size\": markerEndSize,\r\n            \"curvature_px\": _curvaturePx,\r\n            \"routing_algorithm\": _routingAlgorithm\r\n        };\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _handlerFunc \r\n     */\r\n    this.on = function(_eventName, _handlerFunc) {\r\n        const allHandlers = eventNameToHandlerFunc.get(_eventName) || [];\r\n        allHandlers.push(_handlerFunc);\r\n        eventNameToHandlerFunc.set(_eventName, allHandlers);        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventNameToHandlerFunc.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventNameToHandlerFunc.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    /**\r\n     * @param {String} _eventId\r\n     * @param {Object} _eventData\r\n     */\r\n    this.dispatchEvent = function(_eventId, _eventData) {\r\n        const observers = eventNameToHandlerFunc.get(_eventId) || [];\r\n        observers.forEach(function(handler) {\r\n            handler(_eventData);\r\n        });\r\n    };\r\n};\r\n\r\nexport { Connector };\r\n","const GRID_STYLE = {\r\n    LINE: 'line',\r\n    DOT: 'dot'\r\n};\r\n\r\n/**\r\n * \r\n * @param {Number} _size\r\n * @param {String} _color\r\n * @param {String} _style\r\n */\r\nfunction Grid(_size, _color, _style) {\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getSize = function() {\r\n        return _size;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getStyle = function() {\r\n        return _style;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getSvgImageTile = function() {\r\n        if(_style === GRID_STYLE.LINE) {\r\n            return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${_size}\" height=\"${_size}\"><rect width=\"${_size}\" height=\"1\" x=\"0\" y=\"${(_size-1.0)}\" style=\"fill:${_color}\" /><rect width=\"1\" height=\"${_size}\" x=\"${(_size-1.0)}\" y=\"0\" style=\"fill:${_color}\" /></svg>`;\r\n        } else {\r\n            return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${_size}\" height=\"${_size}\"><rect width=\"1\" height=\"1\" x=\"${(_size-1.0)}\" y=\"${(_size-1.0)}\" style=\"fill:${_color}\" /></svg>`;\r\n        }\r\n    };\r\n\r\n};\r\n    \r\nexport { GRID_STYLE, Grid };\r\n","const ClusterDetectionWorkerJsString = String.raw`(function () {\n    'use strict';\n\n    function Point(a,b){this.__x=a,this.__y=b;}Point.prototype.getX=function(){return this.__x},Point.prototype.getY=function(){return this.__y},Point.prototype.isEqual=function(a){return !(this.__x!==a.getX()||this.__y!==a.getY())},Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)},Point.prototype.toString=function(){return this.__x+\" \"+this.__y},Point.prototype.toArray=function(){return [this.__x,this.__y]},Point.fromArray=function(a){return new Point(a[0],a[1])};\n\n    var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:\"parallel\",COINCIDENT:\"coincident\",LINE:\"line\",LINESEG:\"lineseg\"});function LineIntersection(a,b){this.__type=a,this.__intersectionPoint=b;}LineIntersection.prototype.getType=function(){return this.__type},LineIntersection.prototype.getIntersectionPoint=function(){return this.__intersectionPoint};\n\n    function Line(a,b){if(\"undefined\"==typeof a||null===a)throw \"Line missing _startPoint\";if(\"undefined\"==typeof b||null===b)throw \"Line missing _endPoint\";this.__startPoint=a,this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint},Line.prototype.getEndPoint=function(){return this.__endPoint},Line.prototype.isEqual=function(a){return !!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))},Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},Line.prototype.getMinX=function(){return Math.min(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMaxX=function(){return Math.max(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMinY=function(){return Math.min(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getMaxY=function(){return Math.max(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getDirection=function(){var a=this.__endPoint.getX()-this.__startPoint.getX(),b=this.__endPoint.getY()-this.__startPoint.getY(),c=Math.sqrt(a*a+b*b);return new Point(a/c,b/c)},Line.prototype.createShortenedLine=function(a,b){var c=this.__endPoint.getX()-this.__startPoint.getX(),d=this.__endPoint.getY()-this.__startPoint.getY(),e=this.getDirection();return new Line(new Point(this.__startPoint.getX()+a*e.getX(),this.__startPoint.getY()+a*e.getY()),new Point(this.__startPoint.getX()+c-b*e.getX(),this.__startPoint.getY()+d-b*e.getY()))},Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG},Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};\n\n    function Rectangle(a,b,c,d){this.__left=a,this.__top=b,this.__right=c,this.__bottom=d;}Rectangle.prototype.getLeft=function(){return this.__left},Rectangle.prototype.getTop=function(){return this.__top},Rectangle.prototype.getRight=function(){return this.__right},Rectangle.prototype.getBottom=function(){return this.__bottom},Rectangle.prototype.getWidth=function(){return this.__right-this.__left},Rectangle.prototype.getHeight=function(){return this.__bottom-this.__top},Rectangle.prototype.getPoints=function(){return [new Point(this.__left,this.__top),new Point(this.__right,this.__top),new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)]},Rectangle.prototype.getLines=function(){return [new Line(new Point(this.__left,this.__top),new Point(this.__right,this.__top)),new Line(new Point(this.__right,this.__top),new Point(this.__right,this.__bottom)),new Line(new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)),new Line(new Point(this.__left,this.__bottom),new Point(this.__left,this.__top))]},Rectangle.prototype.getUniformlyResizedCopy=function(a){return new Rectangle(this.__left-a,this.__top-a,this.__right+a,this.__bottom+a)},Rectangle.prototype.getPointsScaledToGrid=function(a){var b=new Point(this.__left+.5*(this.__right-this.__left),this.__top+.5*(this.__bottom-this.__top)),c=(this.__right-b.getX()+a)/(this.__right-b.getX()),d=(this.__bottom-b.getY()+a)/(this.__bottom-b.getY()),e=[new Point((this.__left-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY()),new Point((this.__left-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY())];return e},Rectangle.prototype.checkIntersect=function(a){return !(this.__bottom<a.getTop())&&!(this.__top>a.getBottom())&&!(this.__right<a.getLeft())&&!(this.__left>a.getRight())},Rectangle.prototype.checkIsPointWithin=function(a){return !!(a.getX()>=this.__left&&a.getX()<=this.__right&&a.getY()>=this.__top&&a.getY()<=this.__bottom)},Rectangle.prototype.checkIsWithin=function(a){return !!(this.__bottom<=a.getBottom()&&this.__top>=a.getTop()&&this.__right<=a.getRight()&&this.__left>=a.getLeft())};\n\n    function DescriptorCollection(a){var b=this,c=[];this.getId=function(){return a},this.getDescriptorIndex=function(a){return b.getDescriptorIndexById(a.id)},this.getDescriptorIndexById=function(a){for(var b=0;b<c.length;b++)if(c[b].id===a)return b;return null},this.addDescriptor=function(a){return !(null!==b.getDescriptorIndex(a))&&(c.push(a),!0)},this.getDescriptors=function(){return c},this.getIds=function(){var a=[];return c.forEach(function(b){a.push(b.id);}),a},this.removeById=function(a){var d=b.getDescriptorIndexById(a);return null!==d&&(c.splice(d,1),!0)},this.removeAll=function(){c.length=0;};}\n\n    function Cluster(a){var b=new DescriptorCollection(a);this.getId=function(){return a},this.getEntityIndex=function(a){return b.getDescriptorIndex(a)},this.getEntityIndexById=function(a){return b.getDescriptorIndexById(a)},this.addEntity=function(a){return b.addDescriptor(a)},this.getEntities=function(){return b.getDescriptors()},this.getEntityIds=function(){return b.getIds()},this.removeEntityById=function(a){return b.removeById(a)},this.removeAllEntities=function(){return b.removeAll()},this.hasEntities=function(a){for(var c=!0,d=0;d<a.length;d++)if(null===b.getDescriptorIndexById(a[d])){c=!1;break}return c},this.toJSON=function(){return {id:a,entities:b.getDescriptors()}};}Cluster.fromJSON=function(a){var b=new Cluster(a.id);return a.entities.forEach(function(a){b.addEntity(a);}),b};\n\n    function BoxClusterDetector(a){var b=this,c=function getEntityIndexFromArray(a,b){for(var c=0;c<b.length;c++)if(b[c].id===a.id)return c;return -1},d=function removeEntitiesFromArray(a,b){for(var d,e=0;e<a.length;e++)d=c(a[e],b),-1!==d&&b.splice(d,1);return b},e=function getClusterWithMostEntitiesFromClusterMap(a){var b=0,c=null;return a.forEach(function(a,d,e){a>b&&(b=a,c=d);}),c},f=function computeDiffBetweenArrays(a,b){var c=[],d=[];return b.forEach(function(b){-1===a.indexOf(b)&&d.push(b);}),a.forEach(function(a){-1===b.indexOf(a)&&c.push(a);}),{onlyInA:c,onlyInB:d}};this.areEntitiesClose=function(b,c){var d=new Rectangle(b.x-a,b.y-a,b.x+b.width+a,b.y+b.height+a),e=new Rectangle(c.x-a,c.y-a,c.x+c.width+a,c.y+c.height+a);return d.checkIntersect(e)},this.getAllEntitiesCloseTo=function(a,c){for(var d=[],e=0;e<c.length;e++)a.id!==c[e].id&&b.areEntitiesClose(a,c[e])&&d.push(c[e]);return d},this.getClusterEntitiesFromSeed=function(a,c,e){var f=b.getAllEntitiesCloseTo(a,c);return 0===f.length?[]:void(d(f.concat([a]),c),f.forEach(function(a){e.push(a),b.getClusterEntitiesFromSeed(a,c,e);}))},this.findIntersectingClustersForEntities=function(a,b){var c=new Map;return b.forEach(function(b){for(var d=b.getEntities(),e=0;e<d.length;e++)for(var f=0;f<a.length;f++)if(d[e].id===a[f].id)if(c.has(b)){var g=c.get(b);c.set(b,g+1);}else c.set(b,1);}),c},this.removeEntityFromClusters=function(a,b){var c=[];return b.forEach(function(b){var d=b.removeEntityById(a.id);d&&c.push(b.getId());}),c},this.mapToClustersWithOldEntitiesRemoved=function(a,b){var c=b.map(function(b){for(var c=b.getEntityIds(),d=0;d<c.length;d++)-1===a.indexOf(c[d])&&b.removeEntityById(c[d]);return b});return c},this.computeClusters=function(a,c,g){for(var h=new Set,i=new Set,j=new Set,k=new Map,l=new Map,m=a.map(function(a){return a}),n=a.map(function(a){return a.id}),o=b.mapToClustersWithOldEntitiesRemoved(n,c),p=function _loop(){var a=m.pop(),c=[a];if(b.getClusterEntitiesFromSeed(a,m,c),1<c.length){var t=b.findIntersectingClustersForEntities(c,o);if(0===t.size){var j=g(),n=new Cluster(j);c.forEach(function(a){n.addEntity(a);}),o.push(n),h.add(j);}else {var p=e(t),q=p.getEntityIds();if(p.removeAllEntities(),c.forEach(function(a){var c=b.removeEntityFromClusters(a,o);c.forEach(function(a){i.add(a);}),p.addEntity(a);}),p.getEntityIds().length===q.length&&p.hasEntities(q));else {i.add(p.getId());var r=p.getEntityIds(),s=f(q,r);l.set(p.getId(),s.onlyInA),k.set(p.getId(),s.onlyInB);}}d(c,m);}else {var u=b.removeEntityFromClusters(a,o);u.forEach(function(b){i.add(b);var c=l.get(b);c?c.push(a.id):l.set(b,[a.id]),\"undefined\"==typeof k.get(b)&&k.set(b,[]);});}};0<m.length;)p();var q=o.filter(function(a){return !!(2>a.getEntities().length)});q.forEach(function(a){i.delete(a.getId()),k.delete(a.getId()),l.delete(a.getId()),j.add(a.getId());}),h.forEach(function(a){i.delete(a),k.delete(a),l.delete(a);});var r=o.filter(function(a){return !!(2<=a.getEntities().length)});return {clusters:r,newClusterIds:h,updatedClusterIds:i,deletedClusterIds:j,updatedClusterToRemovedEntitites:l,updatedClusterToAddedEntitites:k}};}\n\n    var UUID={v4:function v4(){return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c=\"x\"==a?b:8|3&b;return c.toString(16)})}};\n\n    function EntityOverlapFinder(){var b=function addOverlapMapEntries(a,b,c){if(a.has(b)){var d=a.get(b);d.push(c);}else a.set(b,[c]);if(a.has(c)){var e=a.get(c);e.push(b);}else a.set(c,[b]);};this.findOverlappingEntities=function(a){for(var c=new Map,d=0;d<a.length;d++)for(var e=a[d],f=new Rectangle(e.x,e.y,e.x+e.width,e.y+e.height),g=d+1;g<a.length;g++){var h=a[g],k=new Rectangle(h.x,h.y,h.x+h.width,h.y+h.height),l=f.checkIntersect(k);l&&b(c,e.id,h.id);}return c};}\n\n    var workerData={requestQueue:[],knownClusters:[]},clustersToTransferrableMap=function clustersToTransferrableMap(a){for(var b=new Map,c=0;c<a.length;c++)b.set(a[c].getId(),a[c].toJSON());return b},processRequestQueue=function processRequestQueue(){if(0!==workerData.requestQueue.length){var a={overallTime:null},b=workerData.requestQueue.pop();workerData.requestQueue.length=0;var c=b.entityDescriptors,d=new BoxClusterDetector(12);if(null!==b.knownClustersOverwrite){var h=function toClusterArray(a){var b=[];return a.forEach(function(a){b.push(Cluster.fromJSON(a));}),b};workerData.knownClusters=h(b.knownClustersOverwrite);}var e=new Date,f=d.computeClusters(c,workerData.knownClusters,UUID.v4);a.computeClustersTime=new Date-e;var g=new EntityOverlapFinder().findOverlappingEntities(c);postMessage({metrics:a,clusters:clustersToTransferrableMap(f.clusters),newClusterIds:f.newClusterIds,updatedClusterIds:f.updatedClusterIds,deletedClusterIds:f.deletedClusterIds,updatedClusterToRemovedEntitites:f.updatedClusterToRemovedEntitites,updatedClusterToAddedEntitites:f.updatedClusterToAddedEntitites,overlappingEntities:g}),workerData.knownClusters=f.clusters;}};setInterval(processRequestQueue,50),onmessage=function onmessage(a){workerData.requestQueue.push(a.data);};\n\n}());\n`; export { ClusterDetectionWorkerJsString }","const ConnectorRoutingWorkerJsString = String.raw`(function () {\n  'use strict';\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n  }\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n  }\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n  }\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n  function _iterableToArray(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n  }\n  function _iterableToArrayLimit(arr, i) {\n    var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n    if (_i == null) return;\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _s, _e;\n    try {\n      for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n    return arr2;\n  }\n  function _nonIterableSpread() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  function _nonIterableRest() {\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  function _createForOfIteratorHelper(o, allowArrayLike) {\n    var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n    if (!it) {\n      if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n        if (it) o = it;\n        var i = 0;\n        var F = function () {};\n        return {\n          s: F,\n          n: function () {\n            if (i >= o.length) return {\n              done: true\n            };\n            return {\n              done: false,\n              value: o[i++]\n            };\n          },\n          e: function (e) {\n            throw e;\n          },\n          f: F\n        };\n      }\n      throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n    var normalCompletion = true,\n      didErr = false,\n      err;\n    return {\n      s: function () {\n        it = it.call(o);\n      },\n      n: function () {\n        var step = it.next();\n        normalCompletion = step.done;\n        return step;\n      },\n      e: function (e) {\n        didErr = true;\n        err = e;\n      },\n      f: function () {\n        try {\n          if (!normalCompletion && it.return != null) it.return();\n        } finally {\n          if (didErr) throw err;\n        }\n      }\n    };\n  }\n\n  function Point(a,b){this.__x=a,this.__y=b;}Point.prototype.getX=function(){return this.__x},Point.prototype.getY=function(){return this.__y},Point.prototype.isEqual=function(a){return !(this.__x!==a.getX()||this.__y!==a.getY())},Point.prototype.getCartesianPoint=function(a,b){return new Point(this.__x-.5*a,-this.__y+.5*b)},Point.prototype.toString=function(){return this.__x+\" \"+this.__y},Point.prototype.toArray=function(){return [this.__x,this.__y]},Point.fromArray=function(a){return new Point(a[0],a[1])};\n\n  var LINE_INTERSECTION_TYPE=Object.freeze({PARALLEL:\"parallel\",COINCIDENT:\"coincident\",LINE:\"line\",LINESEG:\"lineseg\"});function LineIntersection(a,b){this.__type=a,this.__intersectionPoint=b;}LineIntersection.prototype.getType=function(){return this.__type},LineIntersection.prototype.getIntersectionPoint=function(){return this.__intersectionPoint};\n\n  function Line(a,b){if(\"undefined\"==typeof a||null===a)throw \"Line missing _startPoint\";if(\"undefined\"==typeof b||null===b)throw \"Line missing _endPoint\";this.__startPoint=a,this.__endPoint=b;}Line.prototype.getStartPoint=function(){return this.__startPoint},Line.prototype.getEndPoint=function(){return this.__endPoint},Line.prototype.isEqual=function(a){return !!(this.getStartPoint().isEqual(a.getStartPoint())&&this.getEndPoint().isEqual(a.getEndPoint()))},Line.prototype.getLength=function(){return Math.sqrt(Math.pow(this.__endPoint.getX()-this.__startPoint.getX(),2)+Math.pow(this.__endPoint.getY()-this.__startPoint.getY(),2))},Line.prototype.getMinX=function(){return Math.min(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMaxX=function(){return Math.max(this.getStartPoint().getX(),this.getEndPoint().getX())},Line.prototype.getMinY=function(){return Math.min(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getMaxY=function(){return Math.max(this.getStartPoint().getY(),this.getEndPoint().getY())},Line.prototype.getDirection=function(){var a=this.__endPoint.getX()-this.__startPoint.getX(),b=this.__endPoint.getY()-this.__startPoint.getY(),c=Math.sqrt(a*a+b*b);return new Point(a/c,b/c)},Line.prototype.createShortenedLine=function(a,b){var c=this.__endPoint.getX()-this.__startPoint.getX(),d=this.__endPoint.getY()-this.__startPoint.getY(),e=this.getDirection();return new Line(new Point(this.__startPoint.getX()+a*e.getX(),this.__startPoint.getY()+a*e.getY()),new Point(this.__startPoint.getX()+c-b*e.getX(),this.__startPoint.getY()+d-b*e.getY()))},Line.prototype.computeIntersectionType=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?LINE_INTERSECTION_TYPE.COINCIDENT:LINE_INTERSECTION_TYPE.PARALLEL;var m=k/j,n=l/j;return 1<m||0>m||1<n||0>n?LINE_INTERSECTION_TYPE.LINE:LINE_INTERSECTION_TYPE.LINESEG},Line.prototype.computeIntersection=function(a){var b=this.__startPoint.getX(),c=this.__startPoint.getY(),d=this.__endPoint.getX(),e=this.__endPoint.getY(),f=a.getStartPoint().getX(),g=a.getStartPoint().getY(),h=a.getEndPoint().getX(),i=a.getEndPoint().getY(),j=(i-g)*(d-b)-(h-f)*(e-c),k=(h-f)*(c-g)-(i-g)*(b-f),l=(d-b)*(c-g)-(e-c)*(b-f);if(0==j)return 0==j&&0==k&&0==l?new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT,null):new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL,null);var m=k/j,n=l/j,o=this.__startPoint.getX()+m*(this.__endPoint.getX()-this.__startPoint.getX()),p=this.__startPoint.getY()+m*(this.__endPoint.getY()-this.__startPoint.getY());return 1<m||0>m||1<n||0>n?new LineIntersection(LINE_INTERSECTION_TYPE.LINE,new Point(o,p)):new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG,new Point(o,p))};\n\n  function PointSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.pushPointSet=function(a){for(var c=a.toArray(),d=0;d<c.length;d++)b.push(c[d]);},this.findPointClosestTo=function(a){var b=null,d=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<d&&(b=c,d=e.getLength());}),b},this.findDistanceToPointClosestTo=function(a){var b=Number.MAX_SAFE_INTEGER;return c.forEach(function(c){var d=new Line(a,c);d.getLength()<b&&(b=d.getLength());}),b},this.findPointsCloseTo=function(a,b){var d=new PointSet;return c.forEach(function(c){var e=new Line(a,c);e.getLength()<=b&&d.push(c);}),d},this.toArray=function(){return c},this.toFloat64Array=function(){for(var a=new Float64Array(2*c.length),b=0;b<c.length;b++)a[0+2*b]=c[b].getX(),a[1+2*b]=c[b].getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=2)c.push(new Point(a[b],a[b+1]));};this.count=function(){return c.length},a&&Array.isArray(a)?a.forEach(b.push):a&&\"[object Float64Array]\"===Object.prototype.toString.call(a)&&d(a);}\n\n  function Rectangle(a,b,c,d){this.__left=a,this.__top=b,this.__right=c,this.__bottom=d;}Rectangle.prototype.getLeft=function(){return this.__left},Rectangle.prototype.getTop=function(){return this.__top},Rectangle.prototype.getRight=function(){return this.__right},Rectangle.prototype.getBottom=function(){return this.__bottom},Rectangle.prototype.getWidth=function(){return this.__right-this.__left},Rectangle.prototype.getHeight=function(){return this.__bottom-this.__top},Rectangle.prototype.getPoints=function(){return [new Point(this.__left,this.__top),new Point(this.__right,this.__top),new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)]},Rectangle.prototype.getLines=function(){return [new Line(new Point(this.__left,this.__top),new Point(this.__right,this.__top)),new Line(new Point(this.__right,this.__top),new Point(this.__right,this.__bottom)),new Line(new Point(this.__right,this.__bottom),new Point(this.__left,this.__bottom)),new Line(new Point(this.__left,this.__bottom),new Point(this.__left,this.__top))]},Rectangle.prototype.getUniformlyResizedCopy=function(a){return new Rectangle(this.__left-a,this.__top-a,this.__right+a,this.__bottom+a)},Rectangle.prototype.getPointsScaledToGrid=function(a){var b=new Point(this.__left+.5*(this.__right-this.__left),this.__top+.5*(this.__bottom-this.__top)),c=(this.__right-b.getX()+a)/(this.__right-b.getX()),d=(this.__bottom-b.getY()+a)/(this.__bottom-b.getY()),e=[new Point((this.__left-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__top-b.getY())*d+b.getY()),new Point((this.__right-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY()),new Point((this.__left-b.getX())*c+b.getX(),(this.__bottom-b.getY())*d+b.getY())];return e},Rectangle.prototype.checkIntersect=function(a){return !(this.__bottom<a.getTop())&&!(this.__top>a.getBottom())&&!(this.__right<a.getLeft())&&!(this.__left>a.getRight())},Rectangle.prototype.checkIsPointWithin=function(a){return !!(a.getX()>=this.__left&&a.getX()<=this.__right&&a.getY()>=this.__top&&a.getY()<=this.__bottom)},Rectangle.prototype.checkIsWithin=function(a){return !!(this.__bottom<=a.getBottom()&&this.__top>=a.getTop()&&this.__right<=a.getRight()&&this.__left>=a.getLeft())};\n\n  var AccessibleRoutingPointsFinder={find:function find(a,b,c){var d=new Map,e=[],f=new PointSet;return a.forEach(function(a){var b=a.connectorAnchors;b.forEach(function(a){{var c=new PointSet(a.routingPointsFloat64Arr).toArray();c.forEach(function(b){e.push({routingPoint:b,parentAnchorId:a.id});}),d.set(a.id,c.length);}});}),e.forEach(function(a){for(var c=!1,e=0;e<b.length;e++){var g=b[e],h=new Rectangle(g.x,g.y,g.x+g.width,g.y+g.height);if(h.checkIsPointWithin(a.routingPoint)){c=!0;var j=d.get(a.parentAnchorId)||0;d.set(a.parentAnchorId,Math.max(0,j-1));}}c||f.push(a.routingPoint);}),{connectorAnchorToNumValidRoutingPoints:d,accessibleRoutingPoints:f}}};\n\n  function LineSet(a){var b=this,c=[];this.push=function(a){for(var b=0;b<c.length;b++)if(a.isEqual(c[b]))return !1;return c.push(a),!0},this.toArray=function(){return c},this.count=function(){return c.length},this.toFloat64Array=function(){for(var a=new Float64Array(4*c.length),b=0;b<c.length;b++)a[0+4*b]=c[b].getStartPoint().getX(),a[1+4*b]=c[b].getStartPoint().getY(),a[2+4*b]=c[b].getEndPoint().getX(),a[3+4*b]=c[b].getEndPoint().getY();return a};var d=function fromFloat64Array(a){c.length=0;for(var b=0;b<a.length;b+=4)c.push(new Line(new Point(a[b],a[b+1]),new Point(a[b+2],a[b+3])));};a&&Array.isArray(a)?a.forEach(b.push):a&&\"[object Float64Array]\"===Object.prototype.toString.call(a)&&d(a);}\n\n  var PointVisibilityMapRouteOptimizer={optimize:function optimize(a,b){for(var c=0,d=a.length-1;!(1>=d-c&&(c++,d=a.length-1,c>=a.length-2));)b(a[c],a[d])?(a.splice(c+1,d-c-1),d=a.length-1):d--;}};\n\n  function Vec2(a,b){this.__x=a,this.__y=b;}Vec2.prototype=Object.create(Point.prototype,{}),Vec2.prototype.normalize=function(){var a=Math.sqrt(this.__x*this.__x+this.__y*this.__y);return 0===a?this:(this.__x/=a,this.__y/=a,this)},Vec2.prototype.dot=function(a){return this.__x*a.getX()+this.__y*a.getY()};\n\n  var ConnectorRoutingAlgorithm=Object.freeze({STRAIGHT_LINE:0,STRAIGHT_LINE_BETWEEN_ANCHORS:1,STRAIGHT_LINE_BETWEEN_ANCHORS_AVOID_SELF_INTERSECTION:2,ASTAR:3,ASTAR_WITH_ROUTE_OPTIMIZATION:4,ASTAR_THETA_WITH_ROUTE_OPTIMIZATION:5});\n\n  var PointInfo={point:null,visiblePoints:null};function PointVisibilityMap(){var a=this,b=new Map,c=new Map,d=new Map,e=0,f=0,g=function doesLineIntersectAnyBoundaryLines(a){var b,e=_createForOfIteratorHelper(c);try{for(e.s();!(b=e.n()).done;){var f=_slicedToArray(b.value,2),g=f[0],h=f[1],j=d.get(g);if(!(a.getMinX()>j.outerBoundingRect.maxX)&&!(a.getMaxX()<j.outerBoundingRect.minX)&&!(a.getMinY()>j.outerBoundingRect.maxY)&&!(a.getMaxY()<j.outerBoundingRect.minY))for(var k,l=h.toArray(),m=0;m<l.length;m++)if(k=l[m].computeIntersectionType(a),k===LINE_INTERSECTION_TYPE.LINESEG)return !0}}catch(a){e.e(a);}finally{e.f();}return !1},h=function computePointsVisibilityForPoint(a){a.visiblePoints.points.length=0;var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),h=f[0],i=f[1],j=_createForOfIteratorHelper(i);try{for(j.s();!(e=j.n()).done;){var k=_slicedToArray(e.value,2),l=k[0],m=k[1],n=new Line(a.point,l);0<n.getLength()&&!g(n)&&a.visiblePoints.points.push(l);}}catch(a){j.e(a);}finally{j.f();}}}catch(a){d.e(a);}finally{d.f();}a.visiblePoints.isValid=!0;},i=function arePointsVisibleToEachOther(a,b){for(var c=o(a),d=j(c),e=0;e<d.length;e++)if(d[e].isEqual(b))return !0;return !1},j=function getVisiblePointsRelativeTo(a){return a.visiblePoints.isValid||h(a),a.visiblePoints.points},k=function isPointInArray(a,b){for(var c=0;c<b.length;c++)if(a.isEqual(b[c]))return !0;return !1},l=function routeToEndpoint(a,b,c,d,e,f,g){for(var h,l=c.point,m=j(c),n=Number.MAX_SAFE_INTEGER,o=null,p=new Vec2(e.getX()-l.getX(),e.getY()-l.getY()).normalize(),q=0;q<m.length;q++)if(h=m[q],!k(h,b)){var r=new Line(l,h).getLength(),s=r+a,t=new Line(h,e).getLength(),u=0;if(g===ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION){var v=new Vec2(h.getX()-l.getX(),h.getY()-l.getY()).normalize();u=p.dot(v)*r,e.getX()>l.getX()&&h.getX()>e.getX()&&(u=0),e.getX()<l.getX()&&h.getX()<e.getX()&&(u=0),e.getY()>l.getY()&&h.getY()>e.getY()&&(u=0),e.getY()<l.getY()&&h.getY()<e.getY()&&(u=0);}s+t-u<n&&(n=s+t-u,o=h);}return n===Number.MAX_SAFE_INTEGER?null:{cost:n,point:o}},m=function getBoundaryLinesFromEntityDescriptor(a){var b=new LineSet,c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});var e=a.connectorAnchors;return e.forEach(function(a){var c=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),d=c.getLines();d.forEach(function(a){b.push(a);});}),b},n=function hasEntityMutated(a,b){return !(a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height)},o=function fetchPointInfoForPoint(a){var c,d=_createForOfIteratorHelper(b);try{for(d.s();!(c=d.n()).done;){var e,f=_slicedToArray(c.value,2),g=f[0],h=f[1],i=_createForOfIteratorHelper(h);try{for(i.s();!(e=i.n()).done;){var j=_slicedToArray(e.value,2),k=j[0],l=j[1];if(k===a)return p(k,l)}}catch(a){i.e(a);}finally{i.f();}}}catch(a){d.e(a);}finally{d.f();}return null},p=function buildPointInfo(a,b){var c=Object.create(PointInfo);return c.point=a,c.visiblePoints=b,c},q=function buildEmptyRoutingPointToVisibleSetMap(a,b,c,d){for(var e=new Rectangle(a.x,a.y,a.x+a.width,a.y+a.height),f=AccessibleRoutingPointsFinder.find([a],b,c),g=f.accessibleRoutingPoints.toArray(),h=new Map,i=0;i<g.length;i++)h.set(g[i],{isValid:!1,points:[]});var k=e.getPointsScaledToGrid(c*d);return k.forEach(function(a){h.set(a,{isValid:!1,points:[]});}),h},s=function doesRoutingAlgorithmRequireOptimization(a){return !(a!==ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION&&a!==ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION)};this.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors=function(a,g,h){\"undefined\"==typeof h&&(h=1),e=0,f=0;for(var j,k=[],l=[],o=[],p=0;p<a.length;p++){j=a[p].id,k.push(j);var r=c.get(j),s=d.get(j);if(r&&!n(s,a[p])){f+=r.count();continue}var A=m(a[p]);c.set(j,A),f+=A.count();}for(var B=0;B<a.length;B++){var t=a[B].id,u=d.get(t);!u||n(u,a[B]);var C=q(a[B],a,g,h);b.set(t,C),d.set(t,a[B]),l.push(t),e+=C.size;}var v,w=_createForOfIteratorHelper(d);try{for(w.s();!(v=w.n()).done;){var x=_slicedToArray(v.value,2),y=x[0],z=x[1];k.includes(y)||(l.push(y),o.push(y));}}catch(a){w.e(a);}finally{w.f();}return o.forEach(function(a){d.delete(a),c.delete(a),b.delete(a);}),l.length},this.getCurrentNumRoutingPoints=function(){return e},this.getCurrentNumBoundaryLines=function(){return f},this.findVisiblePointInfoClosestTo=function(a){var c,d=null,e=Number.MAX_SAFE_INTEGER,f=_createForOfIteratorHelper(b);try{for(f.s();!(c=f.n()).done;){var h,i=_slicedToArray(c.value,2),j=i[0],k=i[1],l=_createForOfIteratorHelper(k);try{for(l.s();!(h=l.n()).done;){var m=_slicedToArray(h.value,2),n=m[0],o=m[1],q=new Line(a,n),r=q.getLength();r<e&&!g(q)&&(d=p(n,o),e=r);;}}catch(a){l.e(a);}finally{l.f();}}}catch(a){f.e(a);}finally{f.f();}return d},this.computeRoute=function(b,c,d){if(null===b||null===c)return new PointSet;var e=a.findVisiblePointInfoClosestTo(b);if(null===e)return new PointSet;for(var f,h=new Vec2(c.getX()-b.getX(),c.getY()-b.getY()).normalize(),j=[e.point],k=0,m=e;!0;){if(f=l(k,j,m,b,c,h,d),null===f){var n=new Line(j[j.length-1],c);if(g(n))return new PointSet;break}if(k+=new Line(m.point,f.point).getLength(),j.push(f.point),m=o(f.point),1>new Line(m.point,c).getLength())break}return s(d)&&PointVisibilityMapRouteOptimizer.optimize(j,i),new PointSet(j)};}\n\n  var SvgPathBuilder={pointToLineTo:function pointToLineTo(a,b){return 0===b?\"M\"+a.getX()+\" \"+a.getY():\"L\"+a.getX()+\" \"+a.getY()},pointTripletToTesselatedCurvePoints:function pointTripletToTesselatedCurvePoints(a,b){if(3!==a.length)throw new Error(\"_points must be array of exactly 3 points\");var c=a[1],d=new Line(a[0],a[1]),e=new Line(a[1],a[2]),f=d.createShortenedLine(0,.5*b),g=e.createShortenedLine(.5*b,0);return [f.getStartPoint(),f.getEndPoint(),g.getStartPoint(),g.getEndPoint()]},pointsToPath:function pointsToPath(a,b){b=b||0;var c=[],d=0;if(0<b){for(;3<=a.length;){var e=a.shift(),f=a.shift(),g=a.shift(),h=SvgPathBuilder.pointTripletToTesselatedCurvePoints([e,f,g],b);a.unshift(h[3]),a.unshift(h[2]);for(var k=0;k<h.length-2;k++)c.push(SvgPathBuilder.pointToLineTo(h[k],d++));}for(;0<a.length;){var j=a.shift();c.push(SvgPathBuilder.pointToLineTo(j,d++));}}else for(var l,m=0;m<a.length;m++)l=a[m],c.push(SvgPathBuilder.pointToLineTo(l,m));return c.join(\" \")}};\n\n  var workerData={pointVisibilityMap:new PointVisibilityMap,requestQueue:[]},computeConnectorPath=function computeConnectorPath(a,b,c){var d=Point.fromArray(a.anchor_start_centroid_arr),e=Point.fromArray(a.anchor_end_centroid_arr),f=a.marker_start_size,g=a.marker_end_size,h=a.curvature_px,i=a.routing_algorithm,j=b.findDistanceToPointClosestTo(d),k=b.findDistanceToPointClosestTo(e),l=b.findPointsCloseTo(d,j).findPointClosestTo(e),m=b.findPointsCloseTo(e,k).findPointClosestTo(d),n=new PointSet;if(i==ConnectorRoutingAlgorithm.STRAIGHT_LINE_BETWEEN_ANCHORS)n=new PointSet([l,m]);else if(i===ConnectorRoutingAlgorithm.ASTAR||i===ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION||i===ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION)n=c.computeRoute(l,m,i);else throw \"Invalid routing algorithm\";var o=n.toArray(),p=d,q=e;if(0<f&&1<=o.length){var s=new Line(o[0],d).createShortenedLine(0,f);p=s.getEndPoint();}if(0<g&&1<=o.length){var t=new Line(o[o.length-1],e).createShortenedLine(0,g);q=t.getEndPoint();}var r=[p].concat(_toConsumableArray(o),[q]);return {svgPath:SvgPathBuilder.pointsToPath(r,h),pointsInPath:r}},getConnectorRoutingPointsAroundAnchor=function getConnectorRoutingPointsAroundAnchor(a,b){var c=AccessibleRoutingPointsFinder.find(a,a,b);return c.accessibleRoutingPoints},processRequestQueue=function processRequestQueue(){if(0!==workerData.requestQueue.length){var a=workerData.requestQueue.pop();workerData.requestQueue.length=0;var b={overallTime:null},c=new Date,d=a.gridSize,e=a.connectorDescriptors,f=a.entityDescriptors,g=a.boundingExtentRoutingPointScaleFactor,h=new Date,i=getConnectorRoutingPointsAroundAnchor(f,d);b.msgDecodeTime=new Date-h;var j=new Date;workerData.pointVisibilityMap.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors(f,d,g),b.pointVisibilityMapCreationTime=new Date-j;var k=new Date;e.forEach(function(a){var b=computeConnectorPath(a,i,workerData.pointVisibilityMap),c=new PointSet(b.pointsInPath);a.svgPath=b.svgPath,a.pointsInPath=c.toFloat64Array().buffer;}),b.allPathsComputationTime=new Date-k,b.numRoutingPoints=workerData.pointVisibilityMap.getCurrentNumRoutingPoints(),b.numBoundaryLines=workerData.pointVisibilityMap.getCurrentNumBoundaryLines(),b.overallTime=new Date-c,postMessage({connectorDescriptors:e,metrics:b});}};setInterval(processRequestQueue,6),onmessage=function onmessage(a){workerData.requestQueue.push(a.data);};\n\n}());\n`; export { ConnectorRoutingWorkerJsString }","/**\r\n * \r\n * @param {String} _collectionId\r\n */\r\n function DescriptorCollection(_collectionId) {\r\n    const self = this;\r\n\r\n    /**\r\n     * @type {Object[]}\r\n     */\r\n    const descriptors = [];\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _collectionId;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _descriptor\r\n     * @returns {Number|null}\r\n     */\r\n    this.getDescriptorIndex = function(_descriptor) {\r\n        return self.getDescriptorIndexById(_descriptor.id);\r\n    };\r\n\r\n    /**\r\n     * @param {String} _descriptorId\r\n     * @returns {Number|null}\r\n     */\r\n    this.getDescriptorIndexById = function(_descriptorId) {\r\n        for(let i=0; i<descriptors.length; i++) {\r\n            if(descriptors[i].id === _descriptorId) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _descriptor\r\n     * @returns {Boolean}\r\n     */\r\n    this.addDescriptor = function(_descriptor) {\r\n        if(self.getDescriptorIndex(_descriptor) !== null) {\r\n            return false;\r\n        }\r\n\r\n        descriptors.push(_descriptor);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @returns {Object[]}\r\n     */\r\n    this.getDescriptors = function() {\r\n        return descriptors;\r\n    };\r\n\r\n    /**\r\n     * @returns {String[]}\r\n     */\r\n    this.getIds = function() {\r\n        const ids = [];\r\n        descriptors.forEach(function(_d) {\r\n            ids.push(_d.id);\r\n        });\r\n\r\n        return ids;\r\n    };    \r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Boolean}\r\n     */\r\n    this.removeById = function(_id) {\r\n        const idx = self.getDescriptorIndexById(_id);\r\n        if(idx === null) {\r\n            return false;\r\n        }\r\n\r\n        descriptors.splice(idx, 1);\r\n        return true;\r\n    };\r\n\r\n    this.removeAll = function() {\r\n        descriptors.length = 0;\r\n    };\r\n};\r\n\r\nexport { DescriptorCollection };\r\n","import {DescriptorCollection} from './DescriptorCollection';\r\n\r\n/**\r\n * \r\n * @param {String} _clusterId\r\n */\r\nfunction Cluster(_clusterId) {\r\n    const entityDescriptorCollection = new DescriptorCollection(_clusterId);\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _clusterId;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _entity\r\n     * @returns {Number|null}\r\n     */\r\n    this.getEntityIndex = function(_entity) {\r\n        return entityDescriptorCollection.getDescriptorIndex(_entity);\r\n    };\r\n\r\n    /**\r\n     * @param {String} _entityId\r\n     * @returns {Number|null}\r\n     */\r\n    this.getEntityIndexById = function(_entityId) {\r\n        return entityDescriptorCollection.getDescriptorIndexById(_entityId);\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _entity\r\n     * @returns {Boolean}\r\n     */\r\n    this.addEntity = function(_entity) {\r\n        return entityDescriptorCollection.addDescriptor(_entity);\r\n    };\r\n\r\n    /**\r\n     * @returns {Object[]}\r\n     */\r\n    this.getEntities = function() {\r\n        return entityDescriptorCollection.getDescriptors();\r\n    };\r\n\r\n    /**\r\n     * @returns {String[]}\r\n     */\r\n    this.getEntityIds = function() {\r\n        return entityDescriptorCollection.getIds();\r\n    };    \r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Boolean}\r\n     */\r\n    this.removeEntityById = function(_id) {\r\n        return entityDescriptorCollection.removeById(_id);\r\n    };\r\n\r\n    this.removeAllEntities = function() {\r\n        return entityDescriptorCollection.removeAll();\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _entityIds \r\n     * @returns {Boolean}\r\n     */\r\n    this.hasEntities = function(_entityIds) {\r\n        let isEquivalent = true;\r\n        for(let i=0; i<_entityIds.length; i++) {\r\n            if(entityDescriptorCollection.getDescriptorIndexById(_entityIds[i]) === null) {\r\n                isEquivalent = false;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return isEquivalent;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Object}\r\n     */\r\n    this.toJSON = function() {\r\n        return {\r\n            \"id\": _clusterId,\r\n            \"entities\": entityDescriptorCollection.getDescriptors()\r\n        };\r\n    };\r\n};\r\n\r\nCluster.fromJSON = function(_clusterJSON) {\r\n    const result = new Cluster(_clusterJSON.id);\r\n    _clusterJSON.entities.forEach((_entityDescriptor) => {\r\n        result.addEntity(_entityDescriptor);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\nexport { Cluster };\r\n","/**\r\n * @readonly\r\n * @enum {Number}\r\n */\r\nconst Originator = Object.freeze({\r\n    PROGRAM: 0,\r\n    USER: 1,\r\n    PROGRAM_VIA_PARENT_ENTITY: 2,\r\n    USER_VIA_PARENT_ENTITY: 3,\r\n});\r\n\r\n\r\nexport { Originator };\r\n","import {MatrixMath} from './MatrixMath';\r\nimport {BestToConnectEntitiesFinder} from './ConnectorAnchorFinder/BestToConnectEntitiesFinder';\r\nimport {SheetEvent} from './SheetEvent';\r\nimport {Entity} from './Entity';\r\nimport {EntityEvent} from './EntityEvent';\r\nimport {DebugMetricsPanel} from './DebugMetricsPanel/DebugMetricsPanel';\r\nimport {DoubleTapDetector} from './DoubleTapDetector';\r\nimport {Rectangle} from './Rectangle';\r\nimport {Point} from './Point';\r\nimport {PointSet} from './PointSet';\r\nimport {GroupTransformationContainer} from './GroupTransformationContainer';\r\nimport {Connector} from './Connector';\r\nimport {GRID_STYLE, Grid} from './Grid';\r\nimport {GroupTransformationContainerEvent } from './GroupTransformationContainerEvent';\r\nimport {ClusterDetectionWorkerJsString} from './Workers/ClusterDetectionWorker.string';\r\nimport {ConnectorRoutingWorkerJsString} from './Workers/ConnectorRoutingWorker.string';\r\nimport {Cluster} from './Cluster';\r\nimport {Originator} from './Originator';\r\n\r\n/**\r\n * @callback HandleSheetInteractionCallback\r\n * @param {String} interactionType\r\n * @param {Object} interactionData\r\n */ \r\n\r\n/**\r\n * Sheet event callback\r\n * \r\n * @callback SheetEventCallback\r\n * @param {Object} eventData\r\n */\r\n\r\n /**\r\n * @param {Element} _sheetDomElement \r\n * @param {Window} _window\r\n */\r\nfunction Sheet(_sheetDomElement, _window) {\r\n    const self = this;\r\n\r\n    // Create container for SVG connectors\r\n    const svgElem = _window.document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    svgElem.style.width = \"100%\";\r\n    svgElem.style.height = \"100%\";\r\n    const connectorsContainerDomElement = _sheetDomElement.appendChild(svgElem);\r\n\r\n    // Selection box element\r\n    var selectionBoxElem = null;\r\n\r\n    /**\r\n     * @type {GroupTransformationContainer[]}\r\n     */\r\n    const groupTransformationContainers = [];\r\n\r\n    /**\r\n     * @type {GroupTransformationContainer}\r\n     */\r\n    var currentGroupTransformationContainerBeingDragged = null;\r\n  \r\n    /**\r\n     * @type {Grid}\r\n     */\r\n    var grid = null;\r\n\r\n    var transitionCss = \"transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out\";\r\n\r\n    var transformOriginX = 0;\r\n    var transformOriginY = 0;\r\n\r\n    var touchMoveLastX = 0.0;\r\n    var touchMoveLastY = 0.0;\r\n\r\n    var translateX = 0;\r\n    var translateY = 0;\r\n    var scaleFactor = 1.0;\r\n    var invScaleFactor = 1.0;\r\n\r\n    let boundingExtentRoutingPointScaleFactor = 1.0;\r\n\r\n    const invTransformationMatrixStack = [];\r\n    var currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n    var currentTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n\r\n    var connectorRefreshBufferTime = 6.94;\r\n    var useTranslate3d = false; // better performance w/o it\r\n    const sheetEntities = [];\r\n\r\n    /**\r\n     * @type {Connector[]}\r\n     */\r\n    const objectConnectors = [];\r\n\r\n    var objectIdBeingDragged = null;\r\n    var objectIdBeingResized = null;\r\n    var objectResizeCursor = \"default\";\r\n    \r\n    var objectDragX = 0.0;\r\n    var objectDragY = 0.0;\r\n    var objectDragStartX = 0.0;\r\n    var objectDragStartY = 0.0;\r\n\r\n    var doubleTapDetector = null;\r\n    const debugMetricsPanel = new DebugMetricsPanel(_window);\r\n\r\n    const metrics = {\r\n        connectorRoutingWorker: {\r\n            executionTime: null,\r\n            numRoutingPoints: null,\r\n            numBoundaryLines: null,\r\n            msgDecodeTime: null,\r\n            pointVisibilityMapCreationTime: null,\r\n            allPathsComputationTime: null\r\n        },\r\n        clusterDetectionWorker: {\r\n            computeClustersTime: null,\r\n        },\r\n        refreshAllConnectorsInternal: {\r\n            executionTime: null\r\n        },\r\n        findBestConnectorAnchorsToConnectEntities: {\r\n            batchSize: null,\r\n            searchFuncExecutionTime: null\r\n        },\r\n        connectorsRefreshTime: null\r\n    };\r\n\r\n    var touchHoldDelayTimeMs = 750.0;\r\n    var touchHoldStartInterval = null;\r\n\r\n    var multiObjectSelectionStartX = 0.0;\r\n    var multiObjectSelectionStartY = 0.0;\r\n    var multiObjectSelectionEndX = 0.0;\r\n    var multiObjectSelectionEndY = 0.0;\r\n    var multiObjectSelectionStarted = false;\r\n\r\n    const connectorAnchorsSelected = [];\r\n\r\n    // DOM attribute cache to prevent reflow\r\n    let isDomMetricsLockActive = false;\r\n    let sheetOffsetLeft = null;\r\n    let sheetOffsetTop = null;\r\n    let sheetPageScrollXOffset = null;\r\n    let sheetPageScrollYOffset = null;\r\n\r\n    /**\r\n     * Event name -> Callback map\r\n     * \r\n     * @type {Map<string, SheetEventCallback>}\r\n     */\r\n    const eventHandlers = new Map();\r\n\r\n    var connectorRefreshStartTime = null;\r\n    var connectorRefreshTimeout = null;\r\n    let pendingConnectorRedraw = false;\r\n\r\n\r\n    const bestConnectorAnchorsForEntityConnectionsFinder = new BestToConnectEntitiesFinder();\r\n\r\n    // Setup ClusterDetectionWorker\r\n\r\n    /**\r\n     * JSON representation of known clusters\r\n     * @type {Object[]|null}\r\n     */\r\n    let knownClustersOverwrite = null;\r\n\r\n    const clusterDetectionWorkerUrl = URL.createObjectURL(new Blob([ ClusterDetectionWorkerJsString ]));\r\n    let clusterDetectionWorker = null;\r\n\r\n    this.initClusterDetectionWorker = function() {\r\n        clusterDetectionWorker = new Worker(clusterDetectionWorkerUrl);\r\n        \r\n        clusterDetectionWorker.onmessage = function(_msg) {\r\n            const data = _msg.data;\r\n\r\n            data.newClusterIds.forEach((_cId) => {\r\n                emitEvent(SheetEvent.CLUSTER_CREATED, { 'cluster': Cluster.fromJSON(data.clusters.get(_cId)) });\r\n            });\r\n\r\n            data.updatedClusterIds.forEach((_cId) => {\r\n                const eventObj = { \r\n                    \"cluster\": Cluster.fromJSON(data.clusters.get(_cId)),\r\n                    \"entitiesAdded\": data.updatedClusterToAddedEntitites.get(_cId),\r\n                    \"entitiesRemoved\": data.updatedClusterToRemovedEntitites.get(_cId),\r\n                };\r\n\r\n                emitEvent(\r\n                    SheetEvent.CLUSTER_UPDATED, \r\n                    eventObj\r\n                );\r\n            });\r\n\r\n            data.deletedClusterIds.forEach((_cId) => {\r\n                emitEvent(SheetEvent.CLUSTER_DELETED, { 'clusterId': _cId });\r\n            });\r\n\r\n            for(let [entityId, overlappingEntityIds] of data.overlappingEntities) {\r\n                emitEvent(\r\n                    SheetEvent.ENTITY_OVERLAP_DETECTED, \r\n                    { \r\n                        \"entityId\": entityId,\r\n                        \"overlappingEntityIds\": overlappingEntityIds,\r\n                    }\r\n                );\r\n            }\r\n\r\n            metrics.clusterDetectionWorker.computeClustersTime = data.metrics.computeClustersTime;\r\n\r\n            knownClustersOverwrite = null;\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @param {Cluster[]} _clusters \r\n     */\r\n     this.overwriteClusterDetectorKnownClusters = function(_clusters) {\r\n        const _clusterJSON = [];\r\n        _clusters.forEach((_c) => {\r\n            _clusterJSON.push(_c.toJSON());\r\n        });\r\n\r\n        knownClustersOverwrite = _clusterJSON;\r\n    };\r\n\r\n    /**\r\n     * @param {Cluster} _cluster\r\n     */\r\n     this.updateClusterDetectorKnownCluster = function(_cluster) {\r\n        if(knownClustersOverwrite === null) {\r\n            knownClustersOverwrite = [];\r\n        }\r\n\r\n        let foundMatch = false;\r\n        for(let i=0; i<knownClustersOverwrite.length; i++) {\r\n            if(knownClustersOverwrite[i].id === _cluster.getId()) {\r\n                foundMatch = true;\r\n                knownClustersOverwrite[i] = _cluster.toJSON();\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(!foundMatch) {\r\n            knownClustersOverwrite.push(_cluster.toJSON());\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {Cluster} _cluster\r\n     * @returns {Boolean}\r\n     */\r\n     this.deleteClusterDetectorKnownCluster = function(_cluster) {\r\n        if(knownClustersOverwrite === null) {\r\n            return false;\r\n        }\r\n\r\n        let foundMatch = false;\r\n        for(let i=0; i<knownClustersOverwrite.length; i++) {\r\n            if(knownClustersOverwrite[i].id === _cluster.getId()) {\r\n                foundMatch = true;\r\n                knownClustersOverwrite.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        return foundMatch;\r\n    };\r\n\r\n    // Setup ConnectorRoutingWorker\r\n    const connectorRoutingWorkerUrl = URL.createObjectURL(new Blob([ ConnectorRoutingWorkerJsString ]));\r\n    let connectorRoutingWorker = null;\r\n\r\n    this.initConnectorRoutingWorker = function() {\r\n        connectorRoutingWorker = new Worker(connectorRoutingWorkerUrl);\r\n    \r\n        connectorRoutingWorker.onmessage = function(_msg) {\r\n            const connectorsRefreshTimeT1 = new Date();\r\n            const connectorDescriptors = _msg.data.connectorDescriptors;\r\n            const refreshCalls = [];\r\n\r\n            const getConnectorDescriptorById = function(_id) {\r\n                for(let i=0; i<connectorDescriptors.length; i++) {\r\n                    if(connectorDescriptors[i].id === _id) {\r\n                        return connectorDescriptors[i];\r\n                    }\r\n                }\r\n\r\n                return null;\r\n            };\r\n\r\n            const renderInternal = function() {\r\n                refreshCalls.forEach((_rc) => {\r\n                    _rc();\r\n                });\r\n                pendingConnectorRedraw = false;\r\n            };\r\n\r\n\r\n            objectConnectors.forEach(function(_c) {\r\n                const descriptor = getConnectorDescriptorById(_c.getId());\r\n                if(descriptor) {\r\n                    const ps = new PointSet(new Float64Array(descriptor.pointsInPath));\r\n                    _c.updatePathPoints(ps.toArray());\r\n\r\n                    refreshCalls.push(() => {\r\n                        _c.refresh(descriptor.svgPath);\r\n                    });\r\n\r\n                    // May want defer this, rendering affected if consumer has a long-running handler\r\n                    emitEvent(SheetEvent.CONNECTOR_UPDATED, { 'connector': _c });\r\n                }\r\n            });\r\n            \r\n            if(pendingConnectorRedraw) {\r\n                cancelAnimationFrame(renderInternal);\r\n            }\r\n\r\n            pendingConnectorRedraw = true;\r\n            requestAnimationFrame(renderInternal);\r\n\r\n            metrics.connectorsRefreshTime = (new Date()) - connectorsRefreshTimeT1;\r\n\r\n            metrics.connectorRoutingWorker.executionTime = _msg.data.metrics.overallTime;\r\n            metrics.connectorRoutingWorker.numBoundaryLines = _msg.data.metrics.numBoundaryLines;\r\n            metrics.connectorRoutingWorker.numRoutingPoints = _msg.data.metrics.numRoutingPoints;\r\n            metrics.connectorRoutingWorker.msgDecodeTime = _msg.data.metrics.msgDecodeTime;\r\n            metrics.connectorRoutingWorker.pointVisibilityMapCreationTime = _msg.data.metrics.pointVisibilityMapCreationTime;\r\n            metrics.connectorRoutingWorker.allPathsComputationTime = _msg.data.metrics.allPathsComputationTime;\r\n\r\n            debugMetricsPanel.refresh(metrics);\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @param {Grid} _grid\r\n     */\r\n    this.setGrid = function(_grid) {\r\n        grid = _grid;\r\n        _sheetDomElement.style.backgroundImage = \"url('data:image/svg+xml;base64,\" + _window.btoa(grid.getSvgImageTile()) + \"')\";\r\n        _sheetDomElement.style.backgroundRepeat = \"repeat\";\r\n        _sheetDomElement.style.backgroundColor = \"#fff\";\r\n    };\r\n\r\n    /**\r\n     * @returns {Grid}\r\n     */\r\n    this.getGrid = function() {\r\n        return grid;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getGridSize = function() {\r\n        return grid.getSize();\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _scaleFactor \r\n     */\r\n    this.setBoundingExtentRoutingPointScaleFactor = function(_scaleFactor) {\r\n        boundingExtentRoutingPointScaleFactor = _scaleFactor;\r\n    };\r\n\r\n    const lockDomMetrics = function() {\r\n        sheetOffsetLeft = _sheetDomElement.offsetLeft;\r\n        sheetOffsetTop = _sheetDomElement.offsetTop;\r\n        sheetPageScrollXOffset = _window.pageXOffset;\r\n        sheetPageScrollYOffset = _window.pageYOffset;\r\n\r\n        isDomMetricsLockActive = true;\r\n    };\r\n\r\n    const unlockDomMetrics = function() {\r\n        isDomMetricsLockActive = false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Boolean}\r\n     */\r\n    this.hasDomMetricsLock = function() {\r\n        return isDomMetricsLockActive;\r\n    };\r\n\r\n    const refreshAllClustersInternal = function() {\r\n        if(clusterDetectionWorker === null) {\r\n            return;\r\n        }\r\n\r\n        lockDomMetrics();\r\n\r\n        const gridSize = self.getGridSize();\r\n\r\n        const entityDescriptors = [];\r\n        sheetEntities.forEach(function(_e) {\r\n            entityDescriptors.push(_e.getDescriptor(gridSize));\r\n        });\r\n\r\n        const postData = {\r\n            \"gridSize\": gridSize,\r\n            \"entityDescriptors\": entityDescriptors,\r\n            \"knownClustersOverwrite\": knownClustersOverwrite\r\n        };\r\n\r\n        clusterDetectionWorker.postMessage(postData, []);\r\n        unlockDomMetrics();\r\n    };\r\n\r\n    const refreshAllConnectorsInternal = function() {\r\n        if(connectorRoutingWorker === null) {\r\n            return;\r\n        }\r\n\r\n        lockDomMetrics();\r\n\r\n        const executionTimeT1 = new Date();\r\n        const connectorDescriptors = [];\r\n        objectConnectors.forEach(function(_c) {\r\n            connectorDescriptors.push(_c.getDescriptor());\r\n        });\r\n\r\n        const entityDescriptors = [];\r\n        sheetEntities.forEach(function(_e) {\r\n            entityDescriptors.push(_e.getDescriptor(self.getGridSize()));\r\n        });\r\n\r\n        connectorRoutingWorker.postMessage(\r\n            {\r\n                \"gridSize\": self.getGridSize(),\r\n                \"connectorDescriptors\": connectorDescriptors,\r\n                \"entityDescriptors\": entityDescriptors,\r\n                \"boundingExtentRoutingPointScaleFactor\": boundingExtentRoutingPointScaleFactor\r\n            },\r\n            [\r\n\r\n            ]\r\n        );\r\n\r\n        metrics.refreshAllConnectorsInternal.executionTime = (new Date()) - executionTimeT1;\r\n        \r\n        unlockDomMetrics();\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _bufferTimeMs\r\n     */\r\n    this.setConnectorRefreshBufferTime = function(_bufferTimeMs) {\r\n        connectorRefreshBufferTime = _bufferTimeMs;\r\n    };\r\n\r\n    this.refreshAllConnectors = function() {\r\n        // We'll try to coalesce refresh calls within refreshBatchBufferTimeMs \r\n        // Default is 6.944ms, for continuous calls, this corresponds to 144Hz, but actual\r\n        // performance is less given web worker overhead, path computation cost, and browser minimum limit on setTimeout\r\n\r\n        if(connectorRefreshStartTime !== null) {\r\n            const tdelta = (new Date()) - connectorRefreshStartTime;\r\n            if(tdelta < connectorRefreshBufferTime) {\r\n                return; // already scheduled\r\n            }\r\n        }\r\n\r\n        connectorRefreshStartTime = new Date();        \r\n        connectorRefreshTimeout = setTimeout(function() {\r\n            connectorRefreshTimeout = null;\r\n            connectorRefreshStartTime = null;\r\n            refreshAllConnectorsInternal();\r\n        }, connectorRefreshBufferTime);\r\n    };\r\n\r\n    var makeNewConnector = function(_anchorStart, _anchorEnd, _containerDomElement) {\r\n        return new Connector(_anchorStart, _anchorEnd, _containerDomElement);\r\n    };\r\n\r\n    /**\r\n     * @callback ConnectorFactory\r\n     * @param {ConnectorAnchor} _anchorStart\r\n     * @param {ConnectorAnchor} _anchorEnd\r\n     * @param {Element} _containerDomElement\r\n     */\r\n\r\n    /**\r\n     * @param {ConnectorFactory} _connectorFactory\r\n     */\r\n    this.setConnectorFactory = function(_newConnectorFactory) {\r\n        makeNewConnector = _newConnectorFactory;\r\n    };    \r\n\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getTransitionCss = function() {\r\n        return transitionCss;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {String} _css \r\n     */\r\n    this.setTransitionCss = function(_css) {\r\n        transitionCss = _css;\r\n        _sheetDomElement.style.transition = transitionCss;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTransformOriginX = function() {\r\n        return transformOriginX;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTransformOriginY = function() {\r\n        return transformOriginY;\r\n    };    \r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getScaleFactor = function() {\r\n        return scaleFactor;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getTranslateX = function() {\r\n        return translateX;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTranslateY = function() {\r\n        return translateY;\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    this.setTransformOrigin = function(_x, _y) {\r\n        transformOriginX = _x;\r\n        transformOriginY = _y;\r\n        _sheetDomElement.style.transformOrigin = `${transformOriginX}px ${transformOriginY}px`;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _scaleFactor \r\n     * @param {Boolean} _adjustFactorToPreserveIntegerGrid \r\n     */\r\n    this.scale = function(_scaleFactor, _adjustFactorToPreserveIntegerGrid) {\r\n        _adjustFactorToPreserveIntegerGrid = _adjustFactorToPreserveIntegerGrid || false;\r\n\r\n        if(_adjustFactorToPreserveIntegerGrid) {\r\n            const newGridSize = self.getGridSize() * _scaleFactor;\r\n            const roundedGridSize = Math.round(newGridSize);\r\n            _scaleFactor = roundedGridSize / self.getGridSize();\r\n        }\r\n\r\n        scaleFactor = _scaleFactor;\r\n        invScaleFactor = 1.0 / scaleFactor;        \r\n\r\n        const scaleMat = \r\n            [\r\n                scaleFactor, 0, 0, 0, \r\n                0, scaleFactor, 0, 0, \r\n                0, 0, scaleFactor, 1, \r\n                0, 0, 0, 1\r\n            ];\r\n\r\n        currentTransformationMatrix = MatrixMath.mat4Multiply(\r\n            currentTransformationMatrix, \r\n            scaleMat\r\n        );\r\n\r\n        invTransformationMatrixStack.push(\r\n            [\r\n                invScaleFactor, 0, 0, 0, \r\n                0, invScaleFactor, 0, 0, \r\n                0, 0, invScaleFactor, 1, \r\n                0, 0, 0, 1\r\n            ]\r\n        );\r\n\r\n        return self;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    this.translate = function(_x, _y) {\r\n        translateX = _x;\r\n        translateY = _y;\r\n\r\n        const translateMatrix =             \r\n            [\r\n                1, 0, 0, 0, \r\n                0, 1, 0, 0, \r\n                0, 0, 1, 0, \r\n                translateX, translateY, 0, 1\r\n            ];\r\n\r\n        currentTransformationMatrix = MatrixMath.mat4Multiply(\r\n            currentTransformationMatrix, \r\n            translateMatrix\r\n        ); \r\n\r\n        invTransformationMatrixStack.push(\r\n            [\r\n                1, 0, 0, -translateX, \r\n                0, 1, 0, -translateY, \r\n                0, 0, 1, 0, \r\n                0, 0, 0, 1\r\n            ]\r\n        );\r\n\r\n        return self;\r\n    };\r\n\r\n    this.applyTransform = function() {\r\n        _sheetDomElement.style.transform = self.getTransformMatrixCss();\r\n        currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        for(let i=0; i<invTransformationMatrixStack.length; i++) {\r\n            currentInvTransformationMatrix = MatrixMath.mat4Multiply(currentInvTransformationMatrix, invTransformationMatrixStack[i]);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {Array}\r\n     */\r\n    this.getTransformMatrix = function() {\r\n        return currentTransformationMatrix;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */    \r\n    this.getTransformMatrixCss = function() {\r\n        const matElems = currentTransformationMatrix.join(\",\");\r\n        return `matrix3d(${matElems})`;\r\n    };\r\n\r\n    /**\r\n     * @param {DOMRect} _domRect\r\n     * @returns {Rectangle}\r\n     */\r\n    this.transformDomRectToPageSpaceRect = function(_domRect) {\r\n        const pageOffset = self.getPageOffset();\r\n        const sheetOffset = self.getSheetOffset();\r\n\r\n        const left = _domRect.left - sheetOffset.getX() + pageOffset.getX();\r\n        const top = _domRect.top - sheetOffset.getY() + pageOffset.getY();\r\n        const right = _domRect.right - sheetOffset.getX() + pageOffset.getX();\r\n        const bottom = _domRect.bottom - sheetOffset.getY() + pageOffset.getY();\r\n\r\n        // inv transform\r\n        const invTransformedPosLeftTop = MatrixMath.vecMat4Multiply(\r\n            [left, top, 0, 1],\r\n            currentInvTransformationMatrix\r\n        );\r\n\r\n        const invTransformedPosRightBottom = MatrixMath.vecMat4Multiply(\r\n            [right, bottom, 0, 1],\r\n            currentInvTransformationMatrix\r\n        );\r\n\r\n        // we have Sheet space coordinates, transform to Page space and return\r\n        return new Rectangle(\r\n            invTransformedPosLeftTop[0] + sheetOffset.getX(), \r\n            invTransformedPosLeftTop[1] + sheetOffset.getY(), \r\n            invTransformedPosRightBottom[0] + sheetOffset.getX(), \r\n            invTransformedPosRightBottom[1] + sheetOffset.getY()\r\n        );\r\n    };\r\n\r\n    this.resetTransform = function() {\r\n        scaleFactor = 1.0;\r\n        invScaleFactor = 1.0;\r\n        translateX = 0.0;\r\n        translateY = 0.0;\r\n        currentTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        invTransformationMatrixStack.length = 0;\r\n        _sheetDomElement.style.transform = \"none\";\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getPageOffset = function() {\r\n        if(self.hasDomMetricsLock()) {\r\n            return new Point(sheetPageScrollXOffset, sheetPageScrollYOffset);\r\n        }\r\n\r\n        return new Point(_window.pageXOffset, _window.pageYOffset);\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _p \r\n     * @returns {Number}\r\n     */\r\n    this.snapToGrid = function(_p) {\r\n        var ret = Math.round(_p/self.getGridSize()) * self.getGridSize();\r\n        return Math.max(0, ret - 1);\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getSheetOffset = function() {\r\n        if(self.hasDomMetricsLock()) {\r\n            return new Point(sheetOffsetLeft, sheetOffsetTop);\r\n        }\r\n        \r\n        return new Point(_sheetDomElement.offsetLeft, _sheetDomElement.offsetTop);\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getOffsetLeft = function() {\r\n        return _sheetDomElement.offsetLeft;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getOffsetTop = function() {\r\n        return _sheetDomElement.offsetTop;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        return _sheetDomElement.offsetWidth;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        return _sheetDomElement.offsetHeight;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _newWidth \r\n     * @param {Number} _newHeight \r\n     */\r\n    this.resize = function(_newWidth, _newHeight) {\r\n        _sheetDomElement.style.width = `${_newWidth}px`;\r\n        _sheetDomElement.style.height = `${_newHeight}px`;\r\n    };\r\n\r\n    /**\r\n     * @param {Entity[]} _objs \r\n     * @returns {Rectangle}\r\n     */\r\n    this.calcBoundingRectForEntities = function(_entities) {\r\n        var minTop = null;\r\n        var minLeft = null;\r\n        var maxBottom = null;\r\n        var maxRight = null;\r\n\r\n        _entities.forEach(function(_obj, index, array) {\r\n            const objRect = _obj.getBoundingRectange();\r\n            const left = objRect.getLeft();\r\n            const top = objRect.getTop();  \r\n            const right = objRect.getRight();\r\n            const bottom = objRect.getBottom();\r\n\r\n            if(minLeft === null || left < minLeft) {\r\n                minLeft = left;\r\n            }\r\n\r\n            if(minTop === null || top < minTop) {\r\n                minTop = top;\r\n            }\r\n\r\n            if(maxBottom === null || bottom > maxBottom) {\r\n                maxBottom = bottom;\r\n            }        \r\n\r\n            if(maxRight === null || right > maxRight) {\r\n                maxRight = right;\r\n            }\r\n        });\r\n\r\n        if(minTop === null || minLeft === null || maxBottom === null || maxRight === null) {\r\n            minTop = 0;\r\n            minLeft = 0;\r\n            maxBottom = 0;\r\n            maxRight = 0;            \r\n        }\r\n\r\n        return new Rectangle(minLeft, minTop, maxRight, maxBottom);\r\n    };\r\n\r\n    /**\r\n     * @returns {Rectangle}\r\n     */\r\n    this.calcBoundingBox = function() {\r\n        if(sheetEntities.length === 0) {    \r\n            return new Rectangle(0, 0, self.getWidth(), self.getHeight());     \r\n        }\r\n\r\n        return self.calcBoundingRectForEntities(sheetEntities);\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _x\r\n     * @param {Number} _y\r\n     * @param {Number} _radius\r\n     * @returns {Entity[]}\r\n     */\r\n    this.getEntitiesAroundPoint = function(_x, _y, _radius) {\r\n        _radius = _radius || 1.0;\r\n\r\n        const result = [];\r\n\r\n        const ptRect = new Rectangle(\r\n            _x - _radius, \r\n            _y - _radius, \r\n            _x + _radius, \r\n            _y + _radius\r\n        );\r\n\r\n        sheetEntities.forEach(function(_obj) {\r\n            if(ptRect.checkIntersect(_obj.getBoundingRectange())) {\r\n                result.push(_obj);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Rectangle} _rect\r\n     * @returns {Entity[]}\r\n     */\r\n    this.getEntitiesWithinRect = function(_rect) {\r\n        const result = [];\r\n\r\n        sheetEntities.forEach(function(_obj) {\r\n            if(_obj.getBoundingRectange().checkIsWithin(_rect)) {\r\n                result.push(_obj);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };    \r\n      \r\n    /**\r\n     * @returns {Entity[]}\r\n     */\r\n    this.getAllEntities = function() {    \r\n        return sheetEntities;\r\n    };\r\n\r\n    /**\r\n     * @deprecated\r\n     * Helper method to publish an object change to all objects\r\n     * \r\n     * @param {String} _eventName\r\n     * @param {*} _eventData\r\n     */\r\n    this.publishSiblingObjectChange = function(_eventName, _eventData) {\r\n        sheetEntities.forEach(function(_obj) {\r\n            _obj.handleSiblingObjectChange(_eventName, _eventData);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Entity|null}\r\n     */   \r\n    this.getEntityById = function(_id) {\r\n        var foundEntity = null;\r\n        sheetEntities.forEach(function(obj, index, array) {\r\n            if(foundEntity === null && obj.getId() === _id) {\r\n                foundEntity = obj;\r\n            }            \r\n        });\r\n        \r\n        return foundEntity;\r\n    };\r\n\r\n    /**\r\n     * @param {Entity} _obj\r\n     */\r\n    this.addEntity = function(_obj) {\r\n        _obj.on(EntityEvent.RESIZE_START, handleResizeStart);\r\n\r\n        _obj.on(EntityEvent.RESIZE, function(e) {\r\n            emitEvent(SheetEvent.ENTITY_RESIZED, \r\n                { \r\n                    \"entity\": e.obj,\r\n                    \"originator\": e.originator,\r\n                }\r\n            );\r\n            self.refreshAllConnectors();\r\n            refreshAllClustersInternal();\r\n        });\r\n\r\n        _obj.on(EntityEvent.TRANSLATE_START, handleMoveStart);\r\n\r\n        _obj.on(EntityEvent.TRANSLATE, function(e) {\r\n            emitEvent(\r\n                SheetEvent.ENTITY_TRANSLATED, \r\n                { \r\n                    \"object\": e.obj,\r\n                    \"withinGroupTransformation\": e.withinGroupTransformation,\r\n                    \"originator\": e.originator,\r\n                }\r\n            );\r\n\r\n            if(!e.withinGroupTransformation) { // don't refresh, we only want to refresh when the entire group has been translated\r\n                self.refreshAllConnectors();\r\n                refreshAllClustersInternal();\r\n            }\r\n        });\r\n\r\n        sheetEntities.push(_obj);\r\n        self.refreshAllConnectors();\r\n        refreshAllClustersInternal();\r\n\r\n        emitEvent(SheetEvent.ENTITY_ADDED, { \"object\":_obj });\r\n    };    \r\n\r\n    /**\r\n     * Remove object from the sheet\r\n     * Note: as caller is responsible for putting object into the DOM, caller is responsible for removing it from the DOM\r\n     * \r\n     * @param {String} _entityId\r\n     * @returns {Boolean} \r\n     */\r\n    this.removeEntity = function(_entityId) {\r\n        for(let i=0; i<sheetEntities.length; i++) {\r\n            if(sheetEntities[i].getId() === _entityId) {\r\n                sheetEntities.splice(i, 1);\r\n                self.refreshAllConnectors();\r\n                refreshAllClustersInternal();\r\n                emitEvent(SheetEvent.ENTITY_REMOVED, { \"object\":sheetEntities[i] });\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Connector|null}\r\n     */    \r\n    this.getConnector = function(_id) {\r\n        for(let c=0; c<objectConnectors.length; c++) {\r\n            if(objectConnectors[c].getId() === _id) {\r\n                return objectConnectors[c];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @returns {Connector[]}\r\n     */\r\n    this.getAllConnectors = function() {\r\n        return objectConnectors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Entity} _objA \r\n     * @param {Entity} _objB \r\n     * @returns {Connector[]}\r\n     */\r\n    this.getConnectorsBetweenEntities = function(_entityA, _entityB) {\r\n        const foundConnectors = [];\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            if(_entityA.hasConnectorAnchor(aS) && _entityB.hasConnectorAnchor(aE)) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n\r\n            if(_entityA.hasConnectorAnchor(aE) && _entityB.hasConnectorAnchor(aS)) {\r\n                foundConnectors.push(_conn);\r\n            }            \r\n        });\r\n\r\n        return foundConnectors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {ConnectorAnchor} _anchorA \r\n     * @param {ConnectorAnchor} _anchorB \r\n     * @returns {Connector[]}\r\n     */\r\n    this.getConnectorsBetweenAnchors = function(_anchorA, _anchorB) {\r\n        const foundConnectors = [];\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            if(aS === _anchorA && aE === _anchorB) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n\r\n            if(aS === _anchorB && aE === _anchorA) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n        });\r\n\r\n        return foundConnectors;\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Entity[]} _entitySet\r\n     * @returns {Connector[]}\r\n     */\r\n    this.getConnectorsInEntitySet = function(_entitySet) {\r\n        const foundConnectors = [];\r\n\r\n        for(let i=0; i<_entitySet.length; i++) {\r\n            for(let j=i+1; j<_entitySet.length; j++) {\r\n                const connectorsBetween = self.getConnectorsBetweenEntities(_entitySet[i], _entitySet[j]);\r\n                foundConnectors.push(...connectorsBetween);\r\n            }\r\n        }\r\n\r\n        return foundConnectors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _connectorId\r\n     * @returns {Entity[]} \r\n     */\r\n    this.getEntitiesConnectedViaConnector = function(_connectorId) {\r\n        const foundEntities = [];\r\n        const allEntities = self.getAllEntities();\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            if(_conn.getId() !== _connectorId) {\r\n                return;\r\n            }\r\n\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            allEntities.forEach((_o) => {\r\n                if(_o.hasConnectorAnchor(aS) || _o.hasConnectorAnchor(aE)) {\r\n                    foundEntities.push(_o);\r\n                }\r\n            });\r\n        });\r\n\r\n        return foundEntities;        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Entity} _obj\r\n     * @returns {Connector[]} \r\n     */\r\n    this.getConnectorsConnectedToEntity = function(_entity) {\r\n        const foundConnectors = [];\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            if(_entity.hasConnectorAnchor(aS) || _entity.hasConnectorAnchor(aE)) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n\r\n        });\r\n\r\n        return foundConnectors;        \r\n    };\r\n\r\n    /**\r\n     * @param {String} _connectorAnchorId\r\n     * @returns {Entity|null} \r\n     */\r\n    this.getEntityWithConnectorAnchor = function(_connectorAnchorId) {\r\n        const allEntities = self.getAllEntities();\r\n        for(let i=0; i<allEntities.length; i++) {                \r\n            const anchors = allEntities[i].getConnectorAnchors();\r\n            for(let j=0; j<anchors.length; j++) {\r\n                if(anchors[j].getId() === _connectorAnchorId) {\r\n                    return allEntities[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };    \r\n\r\n    this.removeAllConnectors = function() {\r\n        objectConnectors.forEach(function(_conn) {\r\n            _conn.removePathElement();\r\n        });\r\n\r\n        objectConnectors.splice(0, objectConnectors.length);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Connector} _connector\r\n     * @returns {Boolean}\r\n     */\r\n    this.removeConnector = function(_connector) {\r\n        for(let i=0; i<objectConnectors.length; i++) {\r\n            if(objectConnectors[i] === _connector) {\r\n                _connector.removePathElement();\r\n                objectConnectors.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {ConnectorAnchor} _anchorA \r\n     * @param {ConnectorAnchor} _anchorB \r\n     * @returns {Connector}\r\n     */\r\n    this.makeNewConnectorFromAnchors = function(_anchorA, _anchorB) {\r\n        const newConnector = makeNewConnector(_anchorA, _anchorB, connectorsContainerDomElement);\r\n        const foundConnector = self.getConnector(newConnector.getId());\r\n\r\n        if(foundConnector === null) {\r\n            objectConnectors.push(newConnector);\r\n            newConnector.appendPathToContainerDomElement();\r\n            self.refreshAllConnectors();\r\n            return newConnector;\r\n        }\r\n\r\n        return foundConnector;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Entity} _objA \r\n     * @param {Entity} _objB\r\n     */\r\n    this.findBestConnectorAnchorsToConnectEntities = function(_entityA, _entityB, _onFound) {\r\n        bestConnectorAnchorsForEntityConnectionsFinder.findBest(_entityA, _entityB, _onFound, sheetEntities, self.getGridSize());\r\n        metrics.findBestConnectorAnchorsToConnectEntities.batchSize = bestConnectorAnchorsForEntityConnectionsFinder.getSearchFuncBatchSize();\r\n        metrics.findBestConnectorAnchorsToConnectEntities.searchFuncExecutionTime = bestConnectorAnchorsForEntityConnectionsFinder.getSearchFuncExecutionTime();\r\n    };\r\n\r\n    /**\r\n     * @param {ConnectorAnchor} _anchor\r\n     */\r\n    this.addConnectionAnchorToSelectionStack = function(_anchor) {\r\n        connectorAnchorsSelected.push(_anchor);\r\n\r\n        if(connectorAnchorsSelected.length === 2) {\r\n            self.makeNewConnectorFromAnchors(connectorAnchorsSelected[0], connectorAnchorsSelected[1]);\r\n            connectorAnchorsSelected.length = 0;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _posX \r\n     * @param {Number} _posY \r\n     */\r\n    const dblClickTapHandler = function(_posX, _posY) {\r\n        const entitiesAroundPoint = self.getEntitiesAroundPoint(_posX, _posY);\r\n\r\n        const eventData = {\r\n            'targetPoint': new Point(_posX, _posY),\r\n            'objectsAroundPoint': entitiesAroundPoint, // deprecated\r\n            'entitiesAroundPoint': entitiesAroundPoint\r\n        };\r\n\r\n        emitEvent(SheetEvent.DBLCLICK, eventData);\r\n    };\r\n\r\n    this.initDebugMetricsPanel = function() {\r\n        debugMetricsPanel.init();\r\n        debugMetricsPanel.show();\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _dblTapSpeed\r\n     * @param {Number} _dblTapRadius\r\n     */\r\n    this.initInteractionHandlers = function(_dblTapSpeed, _dblTapRadius) {\r\n        doubleTapDetector = new DoubleTapDetector(_dblTapSpeed, _dblTapRadius);\r\n\r\n        // dblclick on empty area of the sheet\r\n        _sheetDomElement.addEventListener('dblclick', function (e) {\r\n\r\n            const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                [e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), 0, 1],\r\n                currentInvTransformationMatrix\r\n            );\r\n\r\n            dblClickTapHandler(invTransformedPos[0], invTransformedPos[1]);\r\n        });\r\n\r\n        // click anywhere on sheet\r\n        _sheetDomElement.addEventListener('click', function (e) {\r\n            let sheetEntityClicked = false;\r\n            if(e.target !== _sheetDomElement) {\r\n                sheetEntityClicked = true;\r\n            }\r\n\r\n            const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                [e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), 0, 1],\r\n                currentInvTransformationMatrix\r\n            );\r\n\r\n            const eventData = {\r\n                'targetPoint': new Point(invTransformedPos[0], invTransformedPos[1]),\r\n                'entityClicked': sheetEntityClicked,\r\n                'canvasObjectClicked': sheetEntityClicked // deprecated\r\n            };\r\n    \r\n            emitEvent(SheetEvent.CLICK, eventData);\r\n        });\r\n\r\n        // touchend on sheet, logic to see if there was a double-tap\r\n        _sheetDomElement.addEventListener('touchend', function(e) {\r\n            const detectResult = doubleTapDetector.processTap(\r\n                e,\r\n                new Point(self.getOffsetLeft(), self.getOffsetTop()),\r\n                currentInvTransformationMatrix,\r\n            );\r\n\r\n            if(detectResult.doubleTapDetected) {\r\n                dblClickTapHandler(detectResult.touchX, detectResult.touchY);\r\n            }\r\n        });\r\n    };\r\n\r\n    const setCurrentGroupTransformationContainerBeingDragged = function(e) {\r\n        currentGroupTransformationContainerBeingDragged = e.container;\r\n    };\r\n\r\n    /**\r\n     * @param {GroupTransformationContainer} _groupTransformationContainer\r\n     */\r\n    this.attachGroupTransformationContainer = function(_groupTransformationContainer) {\r\n        _sheetDomElement.appendChild(_groupTransformationContainer.getContainerDomElement());\r\n        groupTransformationContainers.push(_groupTransformationContainer);\r\n\r\n        _groupTransformationContainer.on(GroupTransformationContainerEvent.TRANSLATE_START, setCurrentGroupTransformationContainerBeingDragged);\r\n        _groupTransformationContainer.on(GroupTransformationContainerEvent.TRANSLATE, self.refreshAllConnectors);\r\n        _groupTransformationContainer.on(GroupTransformationContainerEvent.TRANSLATE, refreshAllClustersInternal);\r\n    };\r\n\r\n    /**\r\n     * @param {GroupTransformationContainer} _groupTransformationContainer\r\n     * @returns {Boolean}\r\n     */\r\n    this.detachGroupTransformationContainer = function(_groupTransformationContainer) {\r\n        for(let i=0; i<groupTransformationContainers.length; i++) {\r\n            if(groupTransformationContainers[i] === _groupTransformationContainer) {\r\n                _groupTransformationContainer.off(GroupTransformationContainerEvent.TRANSLATE_START, setCurrentGroupTransformationContainerBeingDragged);\r\n                _groupTransformationContainer.off(GroupTransformationContainerEvent.TRANSLATE, self.refreshAllConnectors);\r\n                _groupTransformationContainer.off(GroupTransformationContainerEvent.TRANSLATE, refreshAllClustersInternal);\r\n                _sheetDomElement.removeChild(_groupTransformationContainer.getContainerDomElement());\r\n                groupTransformationContainers.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _dx \r\n     * @param {Number} _dy \r\n     */\r\n    const handleGroupTransformationContainerMove = function(_dx, _dy) {\r\n        const gtc = currentGroupTransformationContainerBeingDragged;        \r\n        gtc.translateByOffset(_dx, _dy);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _e\r\n     */\r\n    const handleMoveStart = function(_e) {     \r\n        objectIdBeingDragged = _e.obj.getId();\r\n        objectDragX = _e.x;\r\n        objectDragY = _e.y;\r\n        objectDragStartX = _e.x;\r\n        objectDragStartY = _e.y;        \r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    const handleMove = function(_x, _y) {\r\n        const entity = self.getEntityById(objectIdBeingDragged);\r\n        const translateOffset = entity.getTranslateHandleOffset();\r\n        const mx = self.snapToGrid(_x + translateOffset.getX());\r\n        const my = self.snapToGrid(_y + translateOffset.getY());\r\n        \r\n        objectDragX = mx;\r\n        objectDragY = my;\t\t\r\n\r\n        entity.translate(mx, my, false, Originator.USER);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    const handleMoveEnd = function(_x, _y) {\r\n        const entity = self.getEntityById(objectIdBeingDragged);\r\n        const translateOffset = entity.getTranslateHandleOffset();\r\n        const mx = self.snapToGrid(_x + translateOffset.getX());\r\n        const my = self.snapToGrid(_y + translateOffset.getY());\r\n        entity.translate(mx, my, false, Originator.USER);       \r\n    };         \r\n\r\n    /**\r\n     * \r\n     * @param {Object} _e \r\n     */\r\n    const handleResizeStart = function(_e) {       \r\n        objectIdBeingResized = _e.obj.getId();\r\n        objectResizeCursor = _e.resizeCursor;\r\n\r\n        _sheetDomElement.style.cursor = objectResizeCursor;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */    \r\n    const handleResize = function(_x, _y) {\r\n        const entity = self.getEntityById(objectIdBeingResized);\r\n\r\n        const mx = self.snapToGrid(_x);\r\n        const my = self.snapToGrid(_y);\r\n\r\n        const top = entity.getY();\r\n        const left = entity.getX();\r\n        const newWidth = ((mx - left)+1);\r\n        const newHeight = ((my - top)+1);\r\n\r\n        entity.resize(newWidth, newHeight, Originator.USER);\r\n    };\r\n\r\n    const handleResizeEnd = function() {\r\n        objectIdBeingResized = null;\r\n        _sheetDomElement.style.cursor = \"\";\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     * @param {Element} _targetElem \r\n     * @returns {Boolean}\r\n     */\r\n    const handleMultiEntitySelectionStart = function(_x, _y, _targetElem) {\r\n        if(multiObjectSelectionStarted) {\r\n            return false; // already doing selection\r\n        }\r\n\r\n        if(_targetElem !== svgElem) { // hacky, but b/c of the SVG overlay, events propagate from the overlay\r\n            return false;\r\n        }\r\n\r\n        if(objectIdBeingDragged !== null) {\r\n            return false;\r\n        }\r\n\r\n        if(objectIdBeingResized !== null) {\r\n            return false;\r\n        }        \r\n\r\n        const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n            [_x, _y, 0, 1],\r\n            currentInvTransformationMatrix\r\n        );\r\n\r\n        multiObjectSelectionStartX = invTransformedPos[0];\r\n        multiObjectSelectionStartY = invTransformedPos[1];\r\n        multiObjectSelectionEndX = invTransformedPos[0];\r\n        multiObjectSelectionEndY = invTransformedPos[1];\r\n        multiObjectSelectionStarted = true;\r\n\r\n        selectionBoxElem.style.left = `${multiObjectSelectionStartX}px`;\r\n        selectionBoxElem.style.top = `${multiObjectSelectionStartY}px`;\r\n        selectionBoxElem.style.width = `0px`;\r\n        selectionBoxElem.style.height = `0px`;\r\n        selectionBoxElem.style.display = \"block\";\r\n\r\n        emitEvent(\r\n            SheetEvent.MULTIPLE_ENTITY_SELECTION_STARTED,\r\n            { \r\n                'x': invTransformedPos[0],\r\n                'y': invTransformedPos[1]\r\n            }\r\n        );\r\n\r\n        return true;\r\n    };\r\n\r\n    const handleMultiEntitySelectionEnd = function() {\r\n        multiObjectSelectionStarted = false;\r\n\r\n        const selectionRect = new Rectangle(\r\n            Math.min(multiObjectSelectionStartX, multiObjectSelectionEndX), \r\n            Math.min(multiObjectSelectionStartY, multiObjectSelectionEndY),\r\n            Math.max(multiObjectSelectionStartX, multiObjectSelectionEndX), \r\n            Math.max(multiObjectSelectionStartY, multiObjectSelectionEndY)\r\n        );\r\n\r\n        const selectedEntities = self.getEntitiesWithinRect(selectionRect);\r\n        const boundingRect = self.calcBoundingRectForEntities(selectedEntities);\r\n\r\n        selectionBoxElem.style.left = `${boundingRect.getLeft()}px`;\r\n        selectionBoxElem.style.top = `${boundingRect.getTop()}px`;\r\n        selectionBoxElem.style.width = `${boundingRect.getWidth()}px`;\r\n        selectionBoxElem.style.height = `${boundingRect.getHeight()}px`;\r\n        selectionBoxElem.style.display = \"none\";\r\n\r\n        emitEvent(\r\n            SheetEvent.MULTIPLE_ENTITIES_SELECTED, \r\n            { \r\n                'selectedObjects': selectedEntities, // deprecated\r\n                'selectedEntities': selectedEntities,\r\n                'boundingRect': boundingRect\r\n            }\r\n        );\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _endX \r\n     * @param {Number} _endY \r\n     */\r\n    const updateSelectionBoxEndPoint = function(_endX, _endY) {\r\n\r\n        const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n            [_endX, _endY, 0, 1],\r\n            currentInvTransformationMatrix\r\n        );\r\n\r\n        multiObjectSelectionEndX = invTransformedPos[0];\r\n        multiObjectSelectionEndY = invTransformedPos[1];\r\n        const width = multiObjectSelectionEndX - multiObjectSelectionStartX;\r\n        const height = multiObjectSelectionEndY - multiObjectSelectionStartY;\r\n\r\n        if(width >= 0) {\r\n            selectionBoxElem.style.width = `${width}px`;\r\n        } else {\r\n            selectionBoxElem.style.left = `${invTransformedPos[0]}px`;\r\n            selectionBoxElem.style.width = `${Math.abs(width)}px`;\r\n        }\r\n\r\n        if(height >= 0) {\r\n            selectionBoxElem.style.height = `${height}px`;\r\n        } else {\r\n            selectionBoxElem.style.top = `${invTransformedPos[1]}px`;\r\n            selectionBoxElem.style.height = `${Math.abs(height)}px`;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {String[]} _selectionRectStyleCssClasses\r\n     */\r\n    this.initMultiEntitySelectionHandler = function(_selectionRectStyleCssClasses) {\r\n        // Create selection box DOM element\r\n        const selBox = _window.document.createElement(\"div\");\r\n        selBox.classList.add(\"ia-selection-box\");\r\n        selBox.style.display = \"none\";\r\n        selBox.style.position = \"absolute\";\r\n        selBox.style.left = \"0px\";\r\n        selBox.style.top = \"0px\";\r\n\r\n        if(typeof _selectionRectStyleCssClasses === 'undefined' || _selectionRectStyleCssClasses.length === 0) {\r\n            selBox.style.border = \"1px solid rgb(158, 158, 158)\";\r\n            selBox.style.background = \"rgba(153, 153, 153, 0.5)\";            \r\n        } else {\r\n            // CSS classes will control styling for things GraphPaper doesn't care about\r\n            // (GraphPaper style concerns are handled via inline styles which will always take precedance)\r\n            _selectionRectStyleCssClasses.forEach(function(_class) {\r\n                selBox.classList.add(_class);\r\n            });\r\n        }\r\n\r\n        selectionBoxElem = _sheetDomElement.appendChild(selBox);\r\n\r\n        const handleTouchSelectionStart = function(e) {\r\n            const hasSelectionStarted = handleMultiEntitySelectionStart(e.touches[0].pageX - self.getOffsetLeft(), e.touches[0].pageY - self.getOffsetTop(), e.target);\r\n        };\r\n\r\n        _sheetDomElement.addEventListener('mousedown', function(e) {\r\n            if (e.which !== 1) {\r\n                return;\r\n            }\r\n\r\n            const hasSelectionStarted = handleMultiEntitySelectionStart(e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), e.target);\r\n            if(hasSelectionStarted) {\r\n                e.preventDefault(); // prevents text selection from triggering\r\n            }\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('touchstart', function(e) {\r\n            touchHoldStartInterval = setInterval(function() {\r\n                handleTouchSelectionStart(e);\r\n            }, touchHoldDelayTimeMs);\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('touchend', function(e) {\r\n            clearInterval(touchHoldStartInterval);\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('touchmove', function(e) {\r\n            clearInterval(touchHoldStartInterval);\r\n        });        \r\n    };\r\n\r\n    this.initTransformationHandlers = function() {\r\n        _sheetDomElement.addEventListener('touchstart', function(e) {\r\n            touchMoveLastX = e.touches[0].pageX - self.getOffsetLeft();\r\n            touchMoveLastY = e.touches[0].pageY - self.getOffsetTop();\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('touchmove', function (e) {\r\n            if (objectIdBeingDragged !== null) {\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.touches[0].pageX - self.getOffsetLeft(), e.touches[0].pageY - self.getOffsetTop(), 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleMove(invTransformedPos[0], invTransformedPos[1]);\r\n                // if we're transforming an object, make sure we don't scroll the sheet\r\n                e.preventDefault();\r\n            }\r\n\r\n            if(objectIdBeingResized !== null) {\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.touches[0].pageX - self.getOffsetLeft(), e.touches[0].pageY - self.getOffsetTop(), 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );     \r\n\r\n                handleResize(invTransformedPos[0], invTransformedPos[1]);\r\n                e.preventDefault();\r\n            }\r\n\r\n            if(currentGroupTransformationContainerBeingDragged !== null) {\r\n                const dx = (e.touches[0].pageX - self.getOffsetLeft()) - touchMoveLastX;\r\n                const dy = (e.touches[0].pageY - self.getOffsetTop()) - touchMoveLastY;\r\n\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [dx, dy, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleGroupTransformationContainerMove(invTransformedPos[0], invTransformedPos[1]);        \r\n                e.preventDefault();        \r\n            }\r\n\r\n            if(multiObjectSelectionStarted) {\r\n                updateSelectionBoxEndPoint(e.touches[0].pageX - self.getOffsetLeft(), e.touches[0].pageY - self.getOffsetTop());\r\n                e.preventDefault();\r\n            }\r\n\r\n            touchMoveLastX = e.touches[0].pageX - self.getOffsetLeft();\r\n            touchMoveLastY = e.touches[0].pageY - self.getOffsetTop();\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('mousemove', function (e) {\r\n            if (objectIdBeingDragged !== null) {\t\t\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleMove(invTransformedPos[0], invTransformedPos[1]);\r\n            }\r\n\r\n            if(objectIdBeingResized !== null) {\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );     \r\n\r\n                handleResize(invTransformedPos[0], invTransformedPos[1]);\r\n            }\r\n\r\n            if(currentGroupTransformationContainerBeingDragged !== null) {\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.movementX, e.movementY, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleGroupTransformationContainerMove(invTransformedPos[0], invTransformedPos[1]);                \r\n            }\r\n\r\n            if(multiObjectSelectionStarted) {\r\n                updateSelectionBoxEndPoint(e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop());\r\n            }\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('touchend', function (e) {\r\n\r\n            // e.touches is empty..\r\n            // Need to use e.changedTouches for final x,y ???\r\n\r\n            if(objectIdBeingDragged !== null) {\r\n                objectIdBeingDragged = null;\r\n            }           \r\n            \r\n            if(objectIdBeingResized !== null) {\r\n                handleResizeEnd();\r\n            }\r\n\r\n            if(currentGroupTransformationContainerBeingDragged !== null) {\r\n                currentGroupTransformationContainerBeingDragged.endTranslate();\r\n                currentGroupTransformationContainerBeingDragged = null;\r\n            }            \r\n\r\n            if(multiObjectSelectionStarted) {\r\n                handleMultiEntitySelectionEnd();\r\n            }\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('mouseup', function (e) {\r\n            if (e.which === 1) {\r\n                if(objectIdBeingDragged !== null) {\r\n\r\n                    const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                        [e.pageX - self.getOffsetLeft(), e.pageY - self.getOffsetTop(), 0, 1],\r\n                        currentInvTransformationMatrix\r\n                    );\r\n\r\n                    handleMoveEnd(invTransformedPos[0], invTransformedPos[1]);\r\n                }\r\n\r\n                if(objectIdBeingResized !== null) {\r\n                    handleResizeEnd();\r\n                }\r\n\r\n                if(currentGroupTransformationContainerBeingDragged !== null) {\r\n                    currentGroupTransformationContainerBeingDragged.endTranslate();\r\n                    currentGroupTransformationContainerBeingDragged = null;\r\n                }\r\n\r\n                if(multiObjectSelectionStarted) {\r\n                    handleMultiEntitySelectionEnd();\r\n                }\r\n\r\n                objectIdBeingDragged = null;\r\n                objectIdBeingResized = null;\r\n            }\r\n        });\r\n\r\n        _sheetDomElement.addEventListener('mousedown', function (e) {\r\n            // if we're dragging something, stop propagation\r\n            if(currentGroupTransformationContainerBeingDragged !== null || objectIdBeingDragged !== null || objectIdBeingResized !== null) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {String} _eventData \r\n     */\r\n    const emitEvent = function(_eventName, _eventData) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            const cbFunc = allCallbacks[i];\r\n            cbFunc(_eventData);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {SheetEventCallback} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {SheetEventCallback} _callback \r\n     */\r\n    this.on = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n        allCallbacks.push(_callback);\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    self.setGrid(new Grid(12.0, '#424242', GRID_STYLE.DOT));\r\n    self.resetTransform();\r\n    self.setTransformOrigin(0, 0);\r\n    self.setTransitionCss(transitionCss);\r\n};\r\n\r\nexport { Sheet };\r\n","import {EntityEvent} from './EntityEvent';\r\nimport {Point} from './Point';\r\nimport {Rectangle} from './Rectangle';\r\nimport {Sheet} from './Sheet';\r\nimport {ConnectorAnchor} from './ConnectorAnchor';\r\nimport {PointSet} from './PointSet';\r\nimport {Originator} from './Originator';\r\n\r\n/**\r\n * \r\n * @param {String} _id\r\n * @param {Number} _x\r\n * @param {Number} _y\r\n * @param {Number} _width\r\n * @param {Number} _height\r\n * @param {Sheet} _sheet\r\n * @param {Element} _domElement\r\n * @param {Element[]} _translateHandleDomElements\r\n * @param {Element[]} _resizeHandleDomElements\r\n */\r\nfunction Entity(_id, _x, _y, _width, _height, _sheet, _domElement, _translateHandleDomElements, _resizeHandleDomElements) {\r\n    const self = this;\r\n\r\n    const MOUSE_MIDDLE_BUTTON = 1;\r\n\r\n    /**\r\n     * @type {ConnectorAnchor[]}\r\n     */\r\n    const connectorAnchors = [];\r\n\r\n    /**\r\n     * @type {Number}\r\n     */\r\n    var nextConnectorAnchorIdSuffix = 1000;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    var currentTranslateHandleElementActivated = null;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    var currentResizeHandleElementActivated = null;\r\n\r\n    /**\r\n     * @type {Map<String, Function>}\r\n     */\r\n    const eventNameToHandlerFunc = new Map();\r\n\r\n    /**\r\n     * @type {Entity[]}\r\n     */\r\n    const subEntities = [];\r\n\r\n    /**\r\n     * @type {Number|null}\r\n     */\r\n    let x = null;\r\n\r\n    /**\r\n     * @type {Number|null}\r\n     */\r\n    let y = null;\r\n\r\n    /**\r\n     * @type {Number|null}\r\n     */\r\n    let width = null;\r\n\r\n\r\n    /**\r\n     * @type {Number|null}\r\n     */\r\n    let height = null;\r\n\r\n    /**\r\n     * @type {Boolean}\r\n     */\r\n    let hasPendingFrame = false;\r\n\r\n    /**\r\n     * @type {Object}\r\n     */\r\n    let overwrittenRenderStyles = {};\r\n\r\n    /**\r\n     * @param {Element} _connectorAnchorDomElement\r\n     * @param {Number} _routingPointOffsetX\r\n     * @param {Number} _routingPointOffsetY\r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.addNonInteractableConnectorAnchor = function(_connectorAnchorDomElement, _routingPointOffsetX, _routingPointOffsetY) {\r\n        const newAnchor = new ConnectorAnchor(_id + `-${nextConnectorAnchorIdSuffix}`, _connectorAnchorDomElement, _sheet, _routingPointOffsetX, _routingPointOffsetY);\r\n        connectorAnchors.push(newAnchor);\r\n        nextConnectorAnchorIdSuffix++;\r\n        return newAnchor;\r\n    };\r\n\r\n    /**\r\n     * @param {Element} _connectorAnchorDomElement\r\n     * @param {Number} _routingPointOffsetX\r\n     * @param {Number} _routingPointOffsetY \r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.addInteractableConnectorAnchor = function(_connectorAnchorDomElement, _routingPointOffsetX, _routingPointOffsetY) {     \r\n        const anchor = new ConnectorAnchor(_id + `-${nextConnectorAnchorIdSuffix}`, _connectorAnchorDomElement, _sheet, _routingPointOffsetX, _routingPointOffsetY);\r\n\r\n        _connectorAnchorDomElement.addEventListener('click', function(e) {\r\n            _sheet.addConnectionAnchorToSelectionStack(anchor);\r\n        });\r\n\r\n        connectorAnchors.push(anchor);\r\n        nextConnectorAnchorIdSuffix++;\r\n        return anchor;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Point[]}\r\n     */\r\n    this.getConnectorAnchorRoutingPoints = function() {\r\n        const allRoutingPoints = [];\r\n        connectorAnchors.forEach(function(_anchor) {\r\n            const anchorPoints = _anchor.getRoutingPoints();\r\n            anchorPoints.forEach(function(_pt) {\r\n                allRoutingPoints.push(_pt);\r\n            });\r\n        });\r\n\r\n        return allRoutingPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor[]}\r\n     */\r\n    this.getConnectorAnchors = function() {\r\n        return connectorAnchors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {ConnectorAnchor} _anchor \r\n     * @returns {Boolean}\r\n     */\r\n    this.hasConnectorAnchor = function(_anchor) {\r\n        const anchors = self.getConnectorAnchors();\r\n        for(let i=0; i<anchors.length; i++) {\r\n            if(anchors[i] === _anchor) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point|null}\r\n     */    \r\n    this.getTranslateHandleOffset = function() {\r\n        if(currentTranslateHandleElementActivated) {\r\n            return new Point(\r\n                -(currentTranslateHandleElementActivated.offsetLeft + currentTranslateHandleElementActivated.offsetWidth * 0.5),\r\n                -(currentTranslateHandleElementActivated.offsetTop  + currentTranslateHandleElementActivated.offsetHeight * 0.5)\r\n            );\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _id;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getX = function() {\r\n        return x;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getY = function() {\r\n        return y;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getPositionOnPage = function() {\r\n        const window = _domElement.ownerDocument.defaultView;\r\n        const boundingRect = _domElement.getBoundingClientRect();\r\n        return new Point(boundingRect.left + window.scrollX, boundingRect.top + window.scrollY);\r\n    };\r\n\r\n    this.renderImmediate = function() {\r\n        if(overwrittenRenderStyles.left) {\r\n            _domElement.style.left = overwrittenRenderStyles.left;\r\n        } else {\r\n            _domElement.style.left = x + 'px';\r\n        }\r\n\r\n        if(overwrittenRenderStyles.top) {\r\n            _domElement.style.top = overwrittenRenderStyles.top;\r\n        } else {\r\n            _domElement.style.top = y + 'px';\r\n        }\r\n\r\n        if(overwrittenRenderStyles.width) {\r\n            _domElement.style.width = overwrittenRenderStyles.width;\r\n        } else {\r\n            _domElement.style.width = width + 'px';\r\n        }\r\n\r\n        if(overwrittenRenderStyles.height) {\r\n            _domElement.style.height = overwrittenRenderStyles.height;\r\n        } else {\r\n            _domElement.style.height = height + 'px';\r\n        }\r\n        \r\n        hasPendingFrame = false;\r\n    };\r\n\r\n    this.render = function() {\r\n        if(hasPendingFrame) {\r\n            cancelAnimationFrame(self.renderImmediate);\r\n        }\r\n\r\n        hasPendingFrame = true;\r\n        requestAnimationFrame(self.renderImmediate);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _style \r\n     * @param {String} _value \r\n     */\r\n    this.overwriteRenderStyle = function(_style, _value) {\r\n        overwrittenRenderStyles[_style] = _value;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _x\r\n     * @param {Number} _y\r\n     * @param {Boolean} [_withinGroupTransformation=false]\r\n     * @param {Originator} [_originator=Originator.PROGRAM]\r\n     */\r\n    this.translate = function(_x, _y, _withinGroupTransformation, _originator) {\r\n        if(_x === x && _y === y) {\r\n            return;\r\n        }\r\n\r\n        const dx = _x - x;\r\n        const dy = _y - y;\r\n        const originator = _originator ? _originator : Originator.PROGRAM;\r\n\r\n        x = _x;\r\n        y = _y;\r\n\r\n        self.render();\r\n\r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.TRANSLATE) || [];\r\n        observers.forEach(function(handler) {\r\n            handler(\r\n                {\r\n                    \"obj\": self, \r\n                    \"x\": _x, \r\n                    \"y\": _y,\r\n                    \"withinGroupTransformation\": _withinGroupTransformation ? true : false,\r\n                    \"originator\": originator,\r\n                }\r\n            );\r\n        });\r\n\r\n        const originatorForSubEntities = (_originator === Originator.USER) ? Originator.USER_VIA_PARENT_ENTITY : Originator.PROGRAM_VIA_PARENT_ENTITY; \r\n        subEntities.forEach((_subEntity) => {\r\n            _subEntity.translate(\r\n                _subEntity.getX() + dx, \r\n                _subEntity.getY() + dy, \r\n                false, \r\n                originatorForSubEntities,\r\n            );\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        return width;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        return height;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _width\r\n     * @param {Number} _height\r\n     * @param {Originator} [_source=Originator.PROGRAM]\r\n     */\r\n    this.resize = function(_width, _height, _originator) {            \r\n        width = _width;\r\n        height = _height;\r\n\r\n        self.render();\r\n\r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.RESIZE) || [];\r\n        observers.forEach(function(handler) {\r\n            handler(\r\n                {\r\n                    \"obj\": self, \r\n                    \"width\": _width, \r\n                    \"height\": _height,\r\n                    \"originator\": _originator ? _originator : Originator.PROGRAM,\r\n                }\r\n            );\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @returns {Element}\r\n     */\r\n    this.getDomElement = function() {\r\n        return _domElement;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName\r\n     * @param {*} _eventData\r\n     */\r\n    this.handleSiblingObjectChange = function(_eventName, _eventData) { \r\n\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRectange = function() {\r\n        const left = x;\r\n        const top = y;\r\n        const right = left + width;\r\n        const bottom = top + height;\r\n\r\n        return new Rectangle(left, top, right, bottom);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRectangeInPageSpace = function() {\r\n        const pagePos = self.getPositionOnPage();\r\n        const left = pagePos.getX();\r\n        const top = pagePos.getY();\r\n        const right = left + width;\r\n        const bottom = top + height;\r\n        return new Rectangle(left, top, right, bottom);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Rectangle} _rectInPageSpace\r\n     * @returns {Rectangle}\r\n     */\r\n    this.computePageToEntitySpaceTransformedRectangle = function(_rectInPageSpace) {\r\n        const noteBoundingRect = self.getBoundingRectangeInPageSpace();\r\n        const rectRelativeToNote = new GraphPaper.Rectangle(\r\n            _rectInPageSpace.getLeft() - noteBoundingRect.getLeft(),\r\n            _rectInPageSpace.getTop() - noteBoundingRect.getTop(),\r\n            _rectInPageSpace.getRight() - noteBoundingRect.getRight(),\r\n            _rectInPageSpace.getBottom() - noteBoundingRect.getBottom()\r\n        );\r\n\r\n        return rectRelativeToNote;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.getBoundingPoints = function() {\r\n        const topLeft = new Point(self.getX(), self.getY());\r\n        const topRight = new Point(self.getX() + self.getWidth(), self.getY());\r\n        const bottomLeft = new Point(self.getX(), self.getY() + self.getWidth());\r\n        const bottomRight = new Point(self.getX() + self.getWidth(), self.getY() + self.getWidth());\r\n\r\n        return [\r\n            topLeft,\r\n            topRight,\r\n            bottomLeft,\r\n            bottomRight\r\n        ];\r\n    };\r\n\r\n    /**\r\n     * @returns {Object}\r\n     */\r\n    this.getDescriptor = function() {\r\n        let outerBoundMinX = self.getX();\r\n        let outerBoundMinY = self.getY();\r\n        let outerBoundMaxX = self.getX() + self.getWidth();\r\n        let outerBoundMaxY = self.getY() + self.getHeight();\r\n\r\n        const anchors = [];\r\n        for(let i=0; i<connectorAnchors.length; i++) {\r\n            const boundingRect = connectorAnchors[i].getBoundingRectange();\r\n            let routingPoints = new PointSet(connectorAnchors[i].getRoutingPoints());\r\n            anchors.push(\r\n                {\r\n                    \"id\": connectorAnchors[i].getId(),\r\n                    \"x\": boundingRect.getLeft(),\r\n                    \"y\": boundingRect.getTop(),\r\n                    \"width\": boundingRect.getWidth(),\r\n                    \"height\": boundingRect.getHeight(),\r\n                    \"routingPointsFloat64Arr\": routingPoints.toFloat64Array()\r\n                }\r\n            );\r\n\r\n            if(boundingRect.getLeft() < outerBoundMinX) {\r\n                outerBoundMinX = boundingRect.getLeft();\r\n            }\r\n\r\n            if(boundingRect.getTop() < outerBoundMinY) {\r\n                outerBoundMinY = boundingRect.getTop();\r\n            }\r\n\r\n            if((boundingRect.getLeft() + boundingRect.getWidth()) > outerBoundMaxX) {\r\n                outerBoundMaxX = (boundingRect.getLeft() + boundingRect.getWidth());\r\n            }\r\n\r\n            if((boundingRect.getTop() + boundingRect.getHeight()) > outerBoundMaxY) {\r\n                outerBoundMaxY = (boundingRect.getTop() + boundingRect.getHeight());\r\n            }\r\n        }\r\n\r\n        return {\r\n            \"id\": self.getId(),\r\n            \"x\": self.getX(),\r\n            \"y\": self.getY(),\r\n            \"width\": self.getWidth(),\r\n            \"height\": self.getHeight(),\r\n            \"connectorAnchors\": anchors,\r\n            \"outerBoundingRect\": {\r\n                \"minX\": outerBoundMinX,\r\n                \"minY\": outerBoundMinY,\r\n                \"maxX\": outerBoundMaxX,\r\n                \"maxY\": outerBoundMaxY\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Attach sub-entities which will translate relative to this entity, when a translate transform occurs\r\n     * \r\n     * @param {Entity[]} _subEntities \r\n     */\r\n    this.attachSubEntities = function(_subEntities) {\r\n        subEntities.push(..._subEntities);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Entity[]}\r\n     */\r\n    this.getAttachedSubEntities = function() {\r\n        return subEntities;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _handlerFunc \r\n     */\r\n    this.on = function(_eventName, _handlerFunc) {\r\n        const allHandlers = eventNameToHandlerFunc.get(_eventName) || [];\r\n        allHandlers.push(_handlerFunc);\r\n        eventNameToHandlerFunc.set(_eventName, allHandlers);    \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventNameToHandlerFunc.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventNameToHandlerFunc.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    this.suspendTranslateInteractions = function() {\r\n        unbindTranslateHandleElements();\r\n    };\r\n\r\n    this.resumeTranslateInteractions = function() {\r\n        bindTranslateHandleElements();\r\n    };\r\n\r\n    const translateTouchStartHandler = function(e) {\r\n        currentTranslateHandleElementActivated = e.target;\r\n\r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.touches[0].pageX, \r\n                \"y\": e.touches[0].pageY,\r\n                \"isTouch\": true,\r\n                \"originator\": Originator.USER,\r\n            });\r\n        });        \r\n\r\n    };\r\n\r\n    const translateMouseDownHandler = function(e) {\r\n        currentTranslateHandleElementActivated = e.target;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.pageX, \r\n                \"y\": e.pageY,\r\n                \"isTouch\": false,\r\n                \"originator\": Originator.USER,\r\n            });\r\n        });        \r\n        \r\n    };\r\n\r\n    const unbindTranslateHandleElements = function() {\r\n        _translateHandleDomElements.forEach((_el) => {\r\n            _el.removeEventListener('touchstart', translateTouchStartHandler);        \r\n            _el.removeEventListener('mousedown', translateMouseDownHandler);\r\n        });\r\n    };\r\n\r\n    const bindTranslateHandleElements = function() {\r\n        _translateHandleDomElements.forEach((_el) => {\r\n            _el.addEventListener('touchstart', translateTouchStartHandler);        \r\n            _el.addEventListener('mousedown', translateMouseDownHandler);\r\n        });\r\n    };\r\n\r\n    const resizeMouseDownHandler = function(_e, _triggeredByElement, _resizeCursor) {\r\n        if (_e.which !== MOUSE_MIDDLE_BUTTON) {\r\n            return;\r\n        }\r\n\r\n        currentResizeHandleElementActivated = _triggeredByElement;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.RESIZE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": _e.pageX, \r\n                \"y\": _e.pageY,\r\n                \"resizeCursor\": _resizeCursor,\r\n                \"isTouch\": false,\r\n                \"originator\": Originator.USER,\r\n            });\r\n        });    \r\n    };\r\n\r\n    const resizeTouchStartHandler = function(_e, _triggeredByElement, _resizeCursor) {\r\n        currentResizeHandleElementActivated =_triggeredByElement;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(EntityEvent.RESIZE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": _e.touches[0].pageX,  \r\n                \"y\": _e.touches[0].pageY,\r\n                \"resizeCursor\": _resizeCursor,\r\n                \"isTouch\": true,\r\n                \"originator\": Originator.USER,\r\n            });\r\n        });\r\n    };\r\n\r\n    const bindResizeHandleElements = function() {\r\n        _resizeHandleDomElements.forEach((_el) => {\r\n            const cursor = window.getComputedStyle(_el)['cursor'];\r\n\r\n            _el.addEventListener('touchstart', (e) => {\r\n                resizeTouchStartHandler(e, _el, cursor);\r\n            });\r\n\r\n            _el.addEventListener('mousedown', (e) => {\r\n                resizeMouseDownHandler(e, _el, cursor);\r\n            });  \r\n        });\r\n    };\r\n\r\n\r\n    bindTranslateHandleElements();\r\n    bindResizeHandleElements();\r\n    self.translate(_x, _y, false, Originator.PROGRAM);\r\n    self.resize(_width, _height, Originator.PROGRAM);\r\n};\r\n\r\nexport { Entity };\r\n","import {Entity} from './Entity';\r\nimport {Originator} from './Originator';\r\nimport {GroupTransformationContainerEvent} from './GroupTransformationContainerEvent';\r\nimport {Rectangle} from './Rectangle';\r\n\r\n/**\r\n * @param {Sheet} _sheet\r\n * @param {Entity[]} _entities\r\n * @param {String[]} _containerStyleCssClasses\r\n * @param {Number} _sizeAdjustmentPx\r\n */\r\nfunction GroupTransformationContainer(_sheet, _entities, _containerStyleCssClasses, _sizeAdjustmentPx)  {\r\n    const self = this;\r\n    const eventNameToHandlerFunc = new Map();\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    const calculateBoundingRect = function() {\r\n        var r = _sheet.calcBoundingRectForEntities(_entities);\r\n        if(_sizeAdjustmentPx) {\r\n            r = r.getUniformlyResizedCopy(_sizeAdjustmentPx);\r\n        }\r\n\r\n        return r;\r\n    };\r\n\r\n    var boundingRect = calculateBoundingRect();\r\n\r\n    var accTranslateX = 0.0;\r\n    var accTranslateY = 0.0;    \r\n\r\n    var currentLeft = boundingRect.getLeft();\r\n    var currentTop = boundingRect.getTop();\r\n\r\n    const entityPositionRelativeToBoundingRect = [];\r\n\r\n    _entities.forEach(function(_obj) {\r\n        const rp = {\r\n            \"x\": _obj.getX() - currentLeft,\r\n            \"y\": _obj.getY() - currentTop\r\n        };\r\n\r\n        entityPositionRelativeToBoundingRect.push(rp);\r\n    });\r\n\r\n    const selBox = window.document.createElement(\"div\");\r\n    selBox.classList.add('ia-group-transformation-container');\r\n    selBox.style.display = \"none\";\r\n    selBox.style.position = \"absolute\";\r\n    selBox.style.left = `${currentLeft}px`;\r\n    selBox.style.top = `${currentTop}px`;\r\n    selBox.style.width = `${boundingRect.getWidth()}px`;\r\n    selBox.style.height = `${boundingRect.getHeight()}px`;    \r\n\r\n    // only display the container if we have 1+ entity in the group\r\n    if(_entities.length > 0) {\r\n        selBox.style.display = \"block\";\r\n    }\r\n\r\n    if(typeof _containerStyleCssClasses === 'undefined' || _containerStyleCssClasses.length === 0) {\r\n        // default styling if no classes are provided\r\n        selBox.style.border = \"1px solid rgb(158, 158, 158)\";\r\n        selBox.style.backgroundColor = \"rgba(153, 153, 153, 0.5)\";       \r\n    } else {\r\n        // CSS classes will control styling for things GraphPaper doesn't care about\r\n        // (GraphPaper style concerns are handled via inline styles which will always take precedance)\r\n        _containerStyleCssClasses.forEach(function(_class) {\r\n            selBox.classList.add(_class);\r\n        });\r\n    }\r\n\r\n\r\n    this.getContainerDomElement = function() {\r\n        return selBox;\r\n    };\r\n    \r\n    /**\r\n     * @returns {Entity[]}\r\n     */\r\n    this.getEntities = function() {\r\n        return _entities;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRect = function() {\r\n        return boundingRect;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _dx\r\n     * @param {Number} _dy\r\n     */\r\n    this.translateByOffset = function(_dx, _dy) {\r\n        accTranslateX += _dx;\r\n        accTranslateY += _dy;\r\n\r\n        const newLeft = _sheet.snapToGrid(boundingRect.getLeft() + accTranslateX);\r\n        const newTop = _sheet.snapToGrid(boundingRect.getTop() + accTranslateY);\r\n\r\n        if(currentLeft === newLeft && currentTop === newTop) {\r\n            // no translation\r\n            return;\r\n        }\r\n\r\n        currentLeft = newLeft;\r\n        currentTop = newTop;\r\n\r\n        selBox.style.left = `${currentLeft}px`;\r\n        selBox.style.top = `${currentTop}px`;        \r\n\r\n        for(let i=0; i<_entities.length; i++) {\r\n            const rp = entityPositionRelativeToBoundingRect[i];\r\n            _entities[i].translate(\r\n                _sheet.snapToGrid(currentLeft + rp.x), \r\n                _sheet.snapToGrid(currentTop + rp.y),\r\n                true,\r\n                Originator.USER,\r\n            );\r\n        }\r\n\r\n        const observers = eventNameToHandlerFunc.get(GroupTransformationContainerEvent.TRANSLATE) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"container\": self,\r\n                \"x\": currentLeft, \r\n                \"y\": currentTop\r\n            });\r\n        });\r\n    };\r\n\r\n    this.endTranslate = function() {\r\n        accTranslateX = 0.0;\r\n        accTranslateY = 0.0;\r\n        boundingRect = calculateBoundingRect();\r\n    };\r\n\r\n    this.initTranslateInteractionHandler = function() {\r\n        selBox.addEventListener('touchstart', translateTouchStartHandler);        \r\n        selBox.addEventListener('mousedown', translateMouseDownHandler);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _handlerFunc \r\n     */\r\n    this.on = function(_eventName, _handlerFunc) {\r\n        const allHandlers = eventNameToHandlerFunc.get(_eventName) || [];\r\n        allHandlers.push(_handlerFunc);\r\n        eventNameToHandlerFunc.set(_eventName, allHandlers);        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventNameToHandlerFunc.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventNameToHandlerFunc.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    const translateTouchStartHandler = function(e) {\r\n        const observers = eventNameToHandlerFunc.get(GroupTransformationContainerEvent.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"container\": self,\r\n                \"x\": e.touches[0].pageX, \r\n                \"y\": e.touches[0].pageY,\r\n                \"isTouch\": true\r\n            });\r\n        });\r\n    };\r\n\r\n    const translateMouseDownHandler = function(e) {       \r\n        const observers = eventNameToHandlerFunc.get(GroupTransformationContainerEvent.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"container\": self,\r\n                \"x\": e.pageX, \r\n                \"y\": e.pageY,\r\n                \"isTouch\": false\r\n            });\r\n        });\r\n    };\r\n};\r\n\r\nexport {GroupTransformationContainer}\r\n","import {Rectangle} from './Rectangle';\r\nimport {Cluster} from './Cluster';\r\n\r\nfunction BoxClusterDetector(_boxExtentOffset) {\r\n    const self = this;\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _entityDescriptor \r\n     * @param {Object[]} _sheetEntityDescriptorsArray \r\n     * @returns {Number}\r\n     */\r\n    const getEntityIndexFromArray = function(_entityDescriptor, _sheetEntityDescriptorsArray) {\r\n        for(let i=0; i<_sheetEntityDescriptorsArray.length; i++) {\r\n            if(_sheetEntityDescriptorsArray[i].id === _entityDescriptor.id) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _entityDescriptor \r\n     * @param {Object[]} _sheetEntityDescriptorsArray\r\n     * @returns {Object[]}\r\n     */\r\n    const removeEntitiesFromArray = function(_entityDescriptor, _sheetEntityDescriptorsArray) {\r\n        for(let i=0; i<_entityDescriptor.length; i++) {\r\n            const idx = getEntityIndexFromArray(_entityDescriptor[i], _sheetEntityDescriptorsArray);\r\n            if(idx !== -1) {\r\n                _sheetEntityDescriptorsArray.splice(idx, 1);\r\n            }\r\n        }\r\n\r\n        return _sheetEntityDescriptorsArray;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Map<Cluster, Number>} _clusterToEntityCountMap \r\n     * @returns {Cluster}\r\n     */\r\n    const getClusterWithMostEntitiesFromClusterMap = function(_clusterToEntityCountMap) {\r\n        var curMaxObjs = 0;\r\n        var curClusterWithMax = null;\r\n\r\n        _clusterToEntityCountMap.forEach(function(_numObjs, _cluster, _map) {\r\n            if(_numObjs > curMaxObjs) {\r\n                curMaxObjs = _numObjs;\r\n                curClusterWithMax = _cluster;\r\n            }\r\n        });\r\n\r\n        return curClusterWithMax;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _arrA \r\n     * @param {String[]} _arrB \r\n     * @returns {Object}\r\n     */\r\n    const computeDiffBetweenArrays = function(_arrA, _arrB) {\r\n        const onlyInA = [];\r\n        const onlyInB = [];\r\n\r\n        _arrB.forEach((_postItem) => {\r\n            if(_arrA.indexOf(_postItem) === -1) {\r\n                onlyInB.push(_postItem);\r\n            }\r\n        });\r\n\r\n        _arrA.forEach((_preItem) => {\r\n            if(_arrB.indexOf(_preItem) === -1) {\r\n                onlyInA.push(_preItem);\r\n            }\r\n        });\r\n\r\n        return {\r\n            \"onlyInA\": onlyInA,\r\n            \"onlyInB\": onlyInB\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @param {Map<Cluster, Number>} _clusterToEntityCountMap \r\n     * @returns {Cluster[]}\r\n     */\r\n    const getClusterArrayFromClusterMap = function(_clusterToEntityCountMap) {\r\n        const resultSet = [];\r\n        _clusterToEntityCountMap.keys().forEach(function(_cluster) {\r\n            resultSet.push(_cluster);\r\n        });\r\n\r\n        return resultSet;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _entityA\r\n     * @param {Object} _entityB\r\n     * @returns {Boolean}\r\n     */\r\n    this.areEntitiesClose = function(_entityA, _entityB) {\r\n        const nA = new Rectangle(\r\n            _entityA.x - _boxExtentOffset, \r\n            _entityA.y - _boxExtentOffset, \r\n            _entityA.x + _entityA.width + _boxExtentOffset, \r\n            _entityA.y + _entityA.height + _boxExtentOffset\r\n        );\r\n\r\n        const nB = new Rectangle(\r\n            _entityB.x - _boxExtentOffset, \r\n            _entityB.y - _boxExtentOffset, \r\n            _entityB.x + _entityB.width + _boxExtentOffset, \r\n            _entityB.y + _entityB.height + _boxExtentOffset\r\n        );\r\n        \r\n        return nA.checkIntersect(nB);\r\n    };\r\n   \r\n    /**\r\n     * @param {Object} _entityDescriptor\r\n     * @param {Object[]} _entitiesUnderConsideration\r\n     * @returns {Object[]}\r\n     */\r\n    this.getAllEntitiesCloseTo = function(_entityDescriptor, _entitiesUnderConsideration) {\r\n        const resultSet = [];\r\n        for(let i=0; i<_entitiesUnderConsideration.length; i++) {\r\n            if(_entityDescriptor.id === _entitiesUnderConsideration[i].id) {\r\n                continue;\r\n            }\r\n\r\n            if(self.areEntitiesClose(_entityDescriptor, _entitiesUnderConsideration[i])) {\r\n                resultSet.push(_entitiesUnderConsideration[i]);\r\n            }\r\n        }\r\n\r\n        return resultSet;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _seedEntity\r\n     * @param {Object[]} _entitiesUnderConsideration\r\n     * @param {Object[]} _resultSet\r\n     */\r\n    this.getClusterEntitiesFromSeed = function(_seedEntity, _entitiesUnderConsideration, _resultSet) {\r\n        const closeByEntities = self.getAllEntitiesCloseTo(_seedEntity, _entitiesUnderConsideration);\r\n        if(closeByEntities.length === 0) {\r\n            return [];\r\n        } else {\r\n            removeEntitiesFromArray(closeByEntities.concat([_seedEntity]), _entitiesUnderConsideration);\r\n\r\n            closeByEntities.forEach(function(_entity) {\r\n                _resultSet.push(_entity);\r\n                self.getClusterEntitiesFromSeed(_entity, _entitiesUnderConsideration, _resultSet);\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {Object[]} _entityDescriptors\r\n     * @param {Cluster[]} _clusters\r\n     * @returns {Map<Cluster,Number>}\r\n     */\r\n    this.findIntersectingClustersForEntities = function(_entityDescriptors, _clusters) {\r\n        // Map of Cluster that is intersecting to number of entities in _objs that is intersecting the given Cluster\r\n        const intersectingClusterToNumEntitiesIntersecting = new Map();\r\n\r\n        _clusters.forEach(function(_cluster) {\r\n            const clusterEntities = _cluster.getEntities();\r\n\r\n            for(let i=0; i<clusterEntities.length; i++) {\r\n                for(let j=0; j<_entityDescriptors.length; j++) {\r\n\r\n                    if(clusterEntities[i].id !== _entityDescriptors[j].id) {\r\n                        continue;\r\n                    }\r\n\r\n                    if(intersectingClusterToNumEntitiesIntersecting.has(_cluster)) {\r\n                        const count = intersectingClusterToNumEntitiesIntersecting.get(_cluster);\r\n                        intersectingClusterToNumEntitiesIntersecting.set(_cluster, count+1);\r\n                    } else {\r\n                        intersectingClusterToNumEntitiesIntersecting.set(_cluster, 1);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return intersectingClusterToNumEntitiesIntersecting;\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _entityDescriptor\r\n     * @param {Cluster[]} _clusters\r\n     * @returns {String[]}\r\n     */\r\n    this.removeEntityFromClusters = function(_entityDescriptor, _clusters) {\r\n        const mutatedClusterIds = [];\r\n        _clusters.forEach(function(_c) {\r\n            const wasFoundAndRemoved = _c.removeEntityById(_entityDescriptor.id);\r\n            if(wasFoundAndRemoved) {\r\n                mutatedClusterIds.push(_c.getId());\r\n            }\r\n        });\r\n\r\n        return mutatedClusterIds;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String[]} _currentEntityIds \r\n     * @param {Cluster[]} _clusters\r\n     * @returns {Cluster[]}\r\n     */\r\n    this.mapToClustersWithOldEntitiesRemoved = function(_currentEntityIds, _clusters) {\r\n        const result = _clusters.map(function(_c) {\r\n            const clusterEntityIds = _c.getEntityIds();\r\n            for(let i=0; i<clusterEntityIds.length; i++) {\r\n                if(_currentEntityIds.indexOf(clusterEntityIds[i]) === -1) {\r\n                    _c.removeEntityById(clusterEntityIds[i]);\r\n                }\r\n            }\r\n\r\n            return _c;\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Object[]} _entityDescriptors\r\n     * @param {Cluster[]} _knownClusters\r\n     * @param {Function} _getNewIdFunc\r\n     */\r\n    this.computeClusters = function(_entityDescriptors, _knownClusters, _getNewIdFunc) {\r\n        const newClusterIds = new Set();\r\n        const updatedClusterIds = new Set();\r\n        const deletedClusterIds = new Set();\r\n        const updatedClusterToAddedEntitites = new Map();\r\n        const updatedClusterToRemovedEntitites = new Map();\r\n\r\n        const entitiesUnderConsideration = _entityDescriptors.map(function(_e) {\r\n            return _e;\r\n        });\r\n\r\n        const entitiesUnderConsiderationIds = _entityDescriptors.map(function(_e) {\r\n            return _e.id;\r\n        });        \r\n\r\n        const clusters = self.mapToClustersWithOldEntitiesRemoved(entitiesUnderConsiderationIds, _knownClusters);\r\n\r\n        while(entitiesUnderConsideration.length > 0) {\r\n            const entityDescriptor = entitiesUnderConsideration.pop();\r\n\r\n            const entitiesForCluster = [entityDescriptor];\r\n            self.getClusterEntitiesFromSeed(entityDescriptor, entitiesUnderConsideration, entitiesForCluster);\r\n\r\n            if(entitiesForCluster.length > 1) {\r\n                const intersectingClusterToNumEntitiesIntersecting = self.findIntersectingClustersForEntities(entitiesForCluster, clusters);\r\n\r\n                if(intersectingClusterToNumEntitiesIntersecting.size === 0) {\r\n                    const clusterId = _getNewIdFunc();\r\n                    const newCluster = new Cluster(clusterId);\r\n                    entitiesForCluster.forEach(function(_clusterEntity) {\r\n                        newCluster.addEntity(_clusterEntity);\r\n                    });    \r\n\r\n                    clusters.push(newCluster);\r\n                    newClusterIds.add(clusterId);\r\n                } else {\r\n                    const clusterToModify = getClusterWithMostEntitiesFromClusterMap(intersectingClusterToNumEntitiesIntersecting);\r\n                    const preEntityIds = clusterToModify.getEntityIds();\r\n\r\n                    // Clear out entities in cluster\r\n                    clusterToModify.removeAllEntities();\r\n\r\n                    // Remove entity from any cluster it's currently in, add it to clusterToModify\r\n                    entitiesForCluster.forEach(function(_clusterEntity) {\r\n                        const clustersMutated = self.removeEntityFromClusters(_clusterEntity, clusters);\r\n                        clustersMutated.forEach((_clusterId) => {\r\n                            updatedClusterIds.add(_clusterId);\r\n                        });\r\n\r\n                        clusterToModify.addEntity(_clusterEntity);\r\n                    });\r\n\r\n                    if(clusterToModify.getEntityIds().length === preEntityIds.length && clusterToModify.hasEntities(preEntityIds)) {\r\n                        // we ended up with the same cluster, no update\r\n                    } else {\r\n                        updatedClusterIds.add(clusterToModify.getId());\r\n\r\n                        const postUpdateEntityIds = clusterToModify.getEntityIds();\r\n                        const diffResult = computeDiffBetweenArrays(preEntityIds, postUpdateEntityIds);\r\n\r\n                        updatedClusterToRemovedEntitites.set(clusterToModify.getId(), diffResult.onlyInA);\r\n                        updatedClusterToAddedEntitites.set(clusterToModify.getId(), diffResult.onlyInB);\r\n                    }\r\n                }\r\n\r\n                removeEntitiesFromArray(entitiesForCluster, entitiesUnderConsideration);\r\n            } else {\r\n                const clustersMutated = self.removeEntityFromClusters(entityDescriptor, clusters);\r\n                clustersMutated.forEach((_clusterId) => {                    \r\n                    updatedClusterIds.add(_clusterId);\r\n\r\n                    const existingEntry = updatedClusterToRemovedEntitites.get(_clusterId);\r\n                    if(existingEntry) {\r\n                        existingEntry.push(entityDescriptor.id);\r\n                    } else {\r\n                        updatedClusterToRemovedEntitites.set(_clusterId, [entityDescriptor.id]);\r\n                    }\r\n\r\n                    // make sure updatedClusterToAddedEntitites entry is set\r\n                    if(typeof updatedClusterToAddedEntitites.get(_clusterId) === 'undefined') {\r\n                        updatedClusterToAddedEntitites.set(_clusterId, []);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        // Get IDs of empty and singleton clusters\r\n        const emptyAndSingletonClusters = \r\n            clusters\r\n                .filter(function(_c) {\r\n                    if(_c.getEntities().length < 2) {\r\n                        return true;\r\n                    }\r\n\r\n                    return false;\r\n                });\r\n\r\n        // Mark empty and single clusters as deleted clusters\r\n        emptyAndSingletonClusters.forEach((_c) => {\r\n            updatedClusterIds.delete(_c.getId());\r\n            updatedClusterToAddedEntitites.delete(_c.getId());\r\n            updatedClusterToRemovedEntitites.delete(_c.getId());\r\n\r\n            deletedClusterIds.add(_c.getId());\r\n        });\r\n\r\n        // Don't mark new clusters as also being updated clusters\r\n        newClusterIds.forEach((_cId) => {\r\n            updatedClusterIds.delete(_cId);\r\n            updatedClusterToAddedEntitites.delete(_cId);\r\n            updatedClusterToRemovedEntitites.delete(_cId);            \r\n        });\r\n\r\n        // Filter out clusters w/o any entities\r\n        const nonEmptyNonSingletonClusters = clusters.filter(function(_c) {\r\n            if(_c.getEntities().length >= 2) {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        });  \r\n\r\n        return {\r\n            \"clusters\": nonEmptyNonSingletonClusters,\r\n            \"newClusterIds\": newClusterIds,\r\n            \"updatedClusterIds\": updatedClusterIds,\r\n            \"deletedClusterIds\": deletedClusterIds,\r\n            \"updatedClusterToRemovedEntitites\": updatedClusterToRemovedEntitites,\r\n            \"updatedClusterToAddedEntitites\": updatedClusterToAddedEntitites,\r\n        };\r\n    };\r\n};\r\n\r\nexport { BoxClusterDetector };\r\n","import {Point} from './Point';\r\n\r\nconst PointVisibilityMapRouteOptimizer = {\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _pointsInRoute\r\n     * @param {Function} _arePointsVisibleToEachOther\r\n     */\r\n    optimize: function(_pointsInRoute, _arePointsVisibleToEachOther) {\r\n        let start = 0;\r\n        let end = _pointsInRoute.length - 1;\r\n\r\n        while(true) {\r\n            if((end-start) <= 1) {\r\n                start++;\r\n                end = _pointsInRoute.length - 1;\r\n\r\n                if(start >= _pointsInRoute.length-2) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if(_arePointsVisibleToEachOther(_pointsInRoute[start], _pointsInRoute[end])) {\r\n                _pointsInRoute.splice(start + 1, (end-start) - 1);\r\n                end = _pointsInRoute.length - 1;\r\n            } else {\r\n                end--;\r\n            }\r\n        }\r\n    }\r\n\r\n};\r\n\r\nexport { PointVisibilityMapRouteOptimizer }\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Line objects\r\n * \r\n * @param {Line[]|Float64Array|undefined} _linesInput\r\n */\r\nfunction LineSet(_linesInput) {\r\n\r\n    const self = this;\r\n    \r\n    /**\r\n     * @type {Line[]}\r\n     */\r\n    const lines = [];    \r\n\r\n    /**\r\n     * @param {Line} _newLine\r\n     * @returns {Boolean}\r\n     */\r\n    this.push = function(_newLine) {\r\n        for(let i=0; i<lines.length; i++) {\r\n            if(_newLine.isEqual(lines[i])) {\r\n                // line already in set\r\n                return false;\r\n            }\r\n        }\r\n\r\n        lines.push(_newLine);\r\n        return true;\r\n    };\r\n  \r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.toArray = function() {\r\n        return lines;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return lines.length;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n        const result = new Float64Array(lines.length * 4);\r\n        for(let i=0; i<lines.length; i++) {\r\n            result[0 + (i*4)] = lines[i].getStartPoint().getX();\r\n            result[1 + (i*4)] = lines[i].getStartPoint().getY();\r\n            result[2 + (i*4)] = lines[i].getEndPoint().getX();\r\n            result[3 + (i*4)] = lines[i].getEndPoint().getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        lines.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=4) {\r\n            lines.push(\r\n                new Line(\r\n                    new Point(_float64Array[i], _float64Array[i+1]),\r\n                    new Point(_float64Array[i+2], _float64Array[i+3])\r\n                )\r\n            );\r\n        }\r\n    };\r\n\r\n    if(_linesInput && Array.isArray(_linesInput)) {\r\n        _linesInput.forEach(self.push);\r\n    } else if(_linesInput && Object.prototype.toString.call(_linesInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_linesInput);\r\n    } else { }    \r\n};\r\n\r\nexport { LineSet };\r\n","import {Point} from './Point';\r\n\r\n/**\r\n * \r\n * @param {Number} _x\r\n * @param {Number} _y\r\n */\r\nfunction Vec2(_x, _y) {\r\n    this.__x = _x;\r\n    this.__y = _y;\r\n};\r\n\r\nVec2.prototype = Object.create(Point.prototype, {});\r\n\r\nVec2.prototype.normalize = function() {\r\n    const len = Math.sqrt((this.__x * this.__x) + (this.__y * this.__y));\r\n    if(len === 0) {\r\n        return this;\r\n    }\r\n\r\n    this.__x = this.__x / len;\r\n    this.__y = this.__y / len;\r\n    return this;\r\n};\r\n\r\nVec2.prototype.dot = function(_v) {\r\n    return ((this.__x * _v.getX()) + (this.__y * _v.getY()));\r\n};\r\n\r\nexport {Vec2}\r\n","import {AccessibleRoutingPointsFinder} from './AccessibleRoutingPointsFinder';\r\nimport {Point} from './Point';\r\nimport {Line} from './Line';\r\nimport {PointSet} from './PointSet';\r\nimport {PointVisibilityMapRouteOptimizer} from './PointVisibilityMapRouteOptimizer';\r\nimport {LineSet} from './LineSet';\r\nimport {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\nimport {Rectangle} from './Rectangle';\r\nimport {Vec2} from './Vec2';\r\nimport { ConnectorRoutingAlgorithm } from './ConnectorRoutingAlgorithm';\r\n\r\nconst VisiblePoints = {\r\n    isValid: false,\r\n    points: []\r\n};\r\n\r\nconst PointInfo = {\r\n    point: null,\r\n    visiblePoints: null\r\n};\r\n\r\nfunction PointVisibilityMap() {\r\n    const self = this;\r\n\r\n    const entityIdToPointVisibility = new Map();\r\n    const entityIdToBoundaryLineSet = new Map();\r\n    const entityIdToDescriptor = new Map();\r\n    let currentNumRoutingPoints = 0;\r\n    let currentNumOfBoundaryLines = 0;\r\n\r\n    /**\r\n     * @param {Line} _theLine\r\n     * @returns {Boolean}\r\n     */\r\n    const doesLineIntersectAnyBoundaryLines = function(_theLine) {\r\n        for (let [_eid, _boundaryLineSet] of entityIdToBoundaryLineSet) {\r\n            const descriptor = entityIdToDescriptor.get(_eid);\r\n\r\n            if(_theLine.getMinX() > descriptor.outerBoundingRect.maxX) {\r\n                continue;\r\n            }\r\n            \r\n            if(_theLine.getMaxX() < descriptor.outerBoundingRect.minX) {\r\n                continue;\r\n            }\r\n\r\n            if(_theLine.getMinY() > descriptor.outerBoundingRect.maxY) {\r\n                continue;\r\n            }\r\n\r\n            if(_theLine.getMaxY() < descriptor.outerBoundingRect.minY) {\r\n                continue;\r\n            }\r\n\r\n            const boundaryLinesArr = _boundaryLineSet.toArray();\r\n            for(let i=0; i<boundaryLinesArr.length; i++) {\r\n                const intersectionType = boundaryLinesArr[i].computeIntersectionType(_theLine);\r\n                if(intersectionType === LINE_INTERSECTION_TYPE.LINESEG) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    const computePointsVisibilityForPoint = function(_pointInfo) {\r\n        _pointInfo.visiblePoints.points.length = 0;\r\n\r\n        for (let [_eid, _pvMap] of entityIdToPointVisibility) {\r\n            for (let [_routingPoint, _visiblePoints] of _pvMap) {\r\n\r\n                const ijLine = new Line(_pointInfo.point, _routingPoint);\r\n                // Note: length check is to avoid adding point being tested to visiblePoints array\r\n                if(ijLine.getLength() > 0 && !doesLineIntersectAnyBoundaryLines(ijLine)) {\r\n                    _pointInfo.visiblePoints.points.push(_routingPoint);\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        _pointInfo.visiblePoints.isValid = true;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _ptA \r\n     * @param {Point} _ptB\r\n     * @returns {Boolean} \r\n     */\r\n    const arePointsVisibleToEachOther = function(_ptA, _ptB) {\r\n        const ptAInfo = fetchPointInfoForPoint(_ptA);\r\n        const visiblePts = getVisiblePointsRelativeTo(ptAInfo);\r\n\r\n        for(let i=0; i<visiblePts.length; i++) {\r\n            if(visiblePts[i].isEqual(_ptB)) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _pointInfo\r\n     * @returns {Point[]}\r\n     */\r\n    const getVisiblePointsRelativeTo = function(_pointInfo) {\r\n        if(!_pointInfo.visiblePoints.isValid) {\r\n            computePointsVisibilityForPoint(_pointInfo);\r\n        }\r\n        \r\n        return _pointInfo.visiblePoints.points;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _needle \r\n     * @param {Point[]} _haystack \r\n     */\r\n    const isPointInArray = function(_needle, _haystack) {\r\n        for(let i=0; i<_haystack.length; i++) {\r\n            if(_needle.isEqual(_haystack[i])) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _currentRouteLength \r\n     * @param {Point[]} _pointsInRoute \r\n     * @param {Object} _currentPointIndex \r\n     * @param {Point} _startPoint \r\n     * @param {Point} _endPoint \r\n     * @param {Vec2} _vecStartToEnd\r\n     * @param {Number|ConnectorRoutingAlgorithm} _routingAlgorithm\r\n     * @returns {Object|null}\r\n     */\r\n    const routeToEndpoint = function(_currentRouteLength, _pointsInRoute, _currentPointInfo, _startPoint, _endPoint, _vecStartToEnd, _routingAlgorithm) {\r\n        const currentPoint = _currentPointInfo.point;\r\n        const visiblePoints = getVisiblePointsRelativeTo(_currentPointInfo);\r\n        let curMinCost = Number.MAX_SAFE_INTEGER;\r\n        let visiblePointWithMinCost = null;\r\n\r\n        const vecToTargetIdeal = (new Vec2(_endPoint.getX() - currentPoint.getX(), _endPoint.getY() - currentPoint.getY())).normalize();\r\n\r\n        /*const dbgInterestAt = 1;\r\n        if(_pointsInRoute.length === dbgInterestAt) {\r\n            console.log('vecToTargetIdeal = ' + vecToTargetIdeal.toString());\r\n            console.log('currentPoint = ' + currentPoint.toString());\r\n        }*/\r\n\r\n        for(let i=0; i<visiblePoints.length; i++) {\r\n            const visiblePt = visiblePoints[i];\r\n\r\n            // ignore point if it's already in the route\r\n            if(isPointInArray(visiblePt, _pointsInRoute)) {\r\n                continue;\r\n            }\r\n\r\n            // g(n) = length/cost of _startPoint to _vp + _currentRouteLength\r\n            const currentToVisibleLength = (new Line(currentPoint, visiblePt)).getLength();\r\n            let gn = currentToVisibleLength + _currentRouteLength;\r\n\r\n            // h(n) = length/cost of _vp to _endPoint\r\n            let hn = (new Line(visiblePt, _endPoint)).getLength();\r\n\r\n            let tn = 0;\r\n            if(_routingAlgorithm === ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION) {\r\n                // t(n) = \r\n                // a. get the relationship between the 2 vectors (dot product)\r\n                // b. scale to give influence (scale by currentToVisibleLength)\r\n                //    .. using currentToVisibleLength as scaling factor is influence towards longer paths in good directions vs shorter paths in bad directions\r\n                const vecVisibleToEndpt = (new Vec2(visiblePt.getX() - currentPoint.getX(), visiblePt.getY() - currentPoint.getY())).normalize();\r\n                tn = vecToTargetIdeal.dot(vecVisibleToEndpt) * currentToVisibleLength;\r\n\r\n                if(_endPoint.getX() > currentPoint.getX() && visiblePt.getX() > _endPoint.getX()) {\r\n                    tn = 0;\r\n                }\r\n\r\n                if(_endPoint.getX() < currentPoint.getX() && visiblePt.getX() < _endPoint.getX()) {\r\n                    tn = 0;\r\n                }\r\n\r\n                if(_endPoint.getY() > currentPoint.getY() && visiblePt.getY() > _endPoint.getY()) {\r\n                    tn = 0;\r\n                }\r\n\r\n                if(_endPoint.getY() < currentPoint.getY() && visiblePt.getY() < _endPoint.getY()) {\r\n                    tn = 0;\r\n                }\r\n            }\r\n\r\n            // if we can go to the endpoint, let's do that\r\n            /*if(visiblePt.isEqual(_endPoint)) {\r\n                gn = 0;\r\n                hn = 0;\r\n            }*/\r\n\r\n            /*if(_pointsInRoute.length === dbgInterestAt) {\r\n                console.log('visiblePt = ' + visiblePt.toString());\r\n                console.log('vecVisibleToEndpt = ' + vecVisibleToEndpt.toString());\r\n                console.log(tn);\r\n            }*/        \r\n\r\n            // see if this is the new min\r\n            if((gn + hn - tn) < curMinCost) {\r\n                curMinCost = gn + hn - tn;\r\n                visiblePointWithMinCost = visiblePt;\r\n            }\r\n        }\r\n\r\n        /*if(_pointsInRoute.length === dbgInterestAt) {\r\n            console.log('winner = ' + visiblePointWithMinCost.toString());\r\n        }*/\r\n\r\n        if(curMinCost === Number.MAX_SAFE_INTEGER) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            \"cost\": curMinCost,\r\n            \"point\": visiblePointWithMinCost\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @param {Object} _ed\r\n     * @returns {LineSet}\r\n     */    \r\n    const getBoundaryLinesFromEntityDescriptor = function(_ed) {\r\n        const boundaryLines = new LineSet();\r\n\r\n        const entityBoundingRect = new Rectangle(_ed.x, _ed.y, _ed.x + _ed.width, _ed.y + _ed.height);\r\n        const lines = entityBoundingRect.getLines();\r\n        lines.forEach((_l) => {\r\n            boundaryLines.push(_l);\r\n        });\r\n\r\n        const anchors = _ed.connectorAnchors;\r\n        anchors.forEach(function(_anchor) {\r\n            const anchorBoundingRect = new Rectangle(_anchor.x, _anchor.y, _anchor.x + _anchor.width, _anchor.y + _anchor.height);\r\n            const lines = anchorBoundingRect.getLines();\r\n            lines.forEach((_l) => {\r\n                boundaryLines.push(_l);\r\n            });\r\n        });\r\n\r\n        return boundaryLines;\r\n    };    \r\n\r\n    const hasEntityMutated = function(_old, _new) {\r\n        if(_old.x !== _new.x || _old.y !== _new.y || _old.width !== _new.width || _old.height !== _new.height) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {PointInfo|null}\r\n     */\r\n    const fetchPointInfoForPoint = function(_point) {\r\n        for (let [_eid, _pvMap] of entityIdToPointVisibility) {\r\n            for (let [_routingPoint, _visiblePoints] of _pvMap) {\r\n                if(_routingPoint === _point) {\r\n                    return buildPointInfo(_routingPoint, _visiblePoints);\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _pt \r\n     * @param {VisiblePoints} _visiblePoints\r\n     * @returns {PointInfo}\r\n     */\r\n    const buildPointInfo = function(_pt, _visiblePoints) {\r\n        const result = Object.create(PointInfo);\r\n        result.point = _pt;\r\n        result.visiblePoints = _visiblePoints;\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object[]} _entityDescriptor \r\n     * @param {Object[]} _allSiblingDescriptors \r\n     * @param {Number} _gridSize \r\n     * @param {Number} _boundingExtentRoutingPointScaleFactor \r\n     */\r\n    const buildEmptyRoutingPointToVisibleSetMap = function(_entityDescriptor, _allSiblingDescriptors, _gridSize, _boundingExtentRoutingPointScaleFactor) {\r\n        const entityBoundingRect = new Rectangle(_entityDescriptor.x, _entityDescriptor.y, _entityDescriptor.x + _entityDescriptor.width, _entityDescriptor.y + _entityDescriptor.height);\r\n        const foundPoints = AccessibleRoutingPointsFinder.find([_entityDescriptor], _allSiblingDescriptors, _gridSize);\r\n        const routingPoints = foundPoints.accessibleRoutingPoints.toArray();\r\n        const routingPointToVisibleSet = new Map();\r\n\r\n        for(let j=0; j<routingPoints.length; j++) {\r\n            routingPointToVisibleSet.set(routingPoints[j], { isValid:false, points:[] });\r\n        }\r\n\r\n        // bounding extent routing points\r\n        const scaledPoints = entityBoundingRect.getPointsScaledToGrid(_gridSize * _boundingExtentRoutingPointScaleFactor);\r\n        scaledPoints.forEach((_sp) => {\r\n            routingPointToVisibleSet.set(_sp, { isValid:false, points:[] });\r\n        }); \r\n\r\n        return routingPointToVisibleSet;\r\n    };\r\n\r\n    const invalidateSiblingPointVisibilityForMutatedEntities = function(_mutatedEntityIds, _gridSize) {\r\n        const allEntityDescriptors = [];\r\n        for (const [_eid, _descriptor] of entityIdToDescriptor) {\r\n            allEntityDescriptors.push(_descriptor);\r\n        }\r\n\r\n        for(let m=0; m<_mutatedEntityIds.length; m++) {\r\n            const descriptor = entityIdToDescriptor.get(_mutatedEntityIds[m]);\r\n            const boundingRect = new Rectangle(descriptor.x, descriptor.y, descriptor.x + descriptor.width, descriptor.y + descriptor.height);\r\n\r\n            for(let i=0; i<allEntityDescriptors.length-1; i++) {\r\n                for(let j=i+1; j<allEntityDescriptors.length; j++) {\r\n                    const spanningRect = new Rectangle(\r\n                        Math.min(allEntityDescriptors[i].outerBoundingRect.minX, allEntityDescriptors[j].outerBoundingRect.minX),\r\n                        Math.min(allEntityDescriptors[i].outerBoundingRect.minY, allEntityDescriptors[j].outerBoundingRect.minY),\r\n                        Math.max(allEntityDescriptors[i].outerBoundingRect.maxX, allEntityDescriptors[j].outerBoundingRect.maxX),\r\n                        Math.max(allEntityDescriptors[i].outerBoundingRect.maxY, allEntityDescriptors[j].outerBoundingRect.maxY),\r\n                    );\r\n\r\n                    if(boundingRect.checkIntersect(spanningRect)) {\r\n                        entityIdToPointVisibility.set(allEntityDescriptors[i].id, buildEmptyRoutingPointToVisibleSetMap(allEntityDescriptors[i], allEntityDescriptors, _gridSize));\r\n                        entityIdToPointVisibility.set(allEntityDescriptors[j].id, buildEmptyRoutingPointToVisibleSetMap(allEntityDescriptors[j], allEntityDescriptors, _gridSize));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number|ConnectorRoutingAlgorithm} _routingAlgorithm\r\n     * @returns {Boolean}\r\n     */\r\n    const doesRoutingAlgorithmRequireOptimization = function(_routingAlgorithm) {\r\n        if(_routingAlgorithm === ConnectorRoutingAlgorithm.ASTAR_WITH_ROUTE_OPTIMIZATION || _routingAlgorithm === ConnectorRoutingAlgorithm.ASTAR_THETA_WITH_ROUTE_OPTIMIZATION) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object[]} _entityDescriptors \r\n     * @param {Number} _gridSize \r\n     * @param {Number} _boundingExtentRoutingPointScaleFactor \r\n     */\r\n    this.updateRoutingPointsAndBoundaryLinesFromEntityDescriptors = function(_entityDescriptors, _gridSize, _boundingExtentRoutingPointScaleFactor) {\r\n        if(typeof _boundingExtentRoutingPointScaleFactor === 'undefined') {\r\n            _boundingExtentRoutingPointScaleFactor = 1.0;\r\n        }\r\n\r\n        currentNumRoutingPoints = 0;\r\n        currentNumOfBoundaryLines = 0;\r\n\r\n        const aliveEntityIds = [];\r\n        const mutatedEntityIds = []; // a mutation is considered any addition, removal, or change\r\n        const deletedEntityIds = [];\r\n\r\n        // update boundary lines\r\n        for(let i=0; i<_entityDescriptors.length; i++) {\r\n            const entityId = _entityDescriptors[i].id;\r\n            aliveEntityIds.push(entityId);\r\n\r\n            const existingEntry = entityIdToBoundaryLineSet.get(entityId);\r\n            const existingDescriptor = entityIdToDescriptor.get(entityId);\r\n            if(existingEntry && !hasEntityMutated(existingDescriptor, _entityDescriptors[i])) {\r\n                currentNumOfBoundaryLines += existingEntry.count();\r\n                continue;\r\n            }\r\n\r\n            const boundaryLinesForEntity = getBoundaryLinesFromEntityDescriptor(_entityDescriptors[i]);\r\n            entityIdToBoundaryLineSet.set(entityId, boundaryLinesForEntity);\r\n\r\n            currentNumOfBoundaryLines += boundaryLinesForEntity.count();\r\n        }\r\n\r\n        // update routing points\r\n        for(let i=0; i<_entityDescriptors.length; i++) {\r\n            const entityId = _entityDescriptors[i].id;\r\n            const existingDescriptor = entityIdToDescriptor.get(entityId);\r\n            if(existingDescriptor && !hasEntityMutated(existingDescriptor, _entityDescriptors[i])) {\r\n                // This entity hasn't changed, but other mutated entities may have changed what's visible from this entity\r\n                //continue;\r\n            }\r\n\r\n            // Entity has been mutated, all routing points for the entity are invalid\r\n            // .. also the inverse relationship (sibling routing points that point to this entity) are also invalid\r\n            const routingPointToVisibleSet = buildEmptyRoutingPointToVisibleSetMap(_entityDescriptors[i], _entityDescriptors, _gridSize, _boundingExtentRoutingPointScaleFactor);\r\n            entityIdToPointVisibility.set(entityId, routingPointToVisibleSet);\r\n\r\n            entityIdToDescriptor.set(entityId, _entityDescriptors[i]); // take advantage of this loop to also, finally, update descriptors as we're done with mutation checks\r\n\r\n            mutatedEntityIds.push(entityId);\r\n            currentNumRoutingPoints += routingPointToVisibleSet.size;\r\n        }\r\n\r\n        // deal with dead entities\r\n        for (let [_eid, _descriptor] of entityIdToDescriptor) {\r\n            if(aliveEntityIds.includes(_eid)) {\r\n                continue;\r\n            }\r\n\r\n            // something has been remove, what gets invalidated?\r\n            // .. if visibility computations are alway nulled/reset, nothing else necessary\r\n            // .. else, need to figure out which computations are to be invalidated (overlapping rects tell if relationship between 2 entities is affected)\r\n            // .... this applies to additions and mutations as well\r\n\r\n            mutatedEntityIds.push(_eid);\r\n            deletedEntityIds.push(_eid);\r\n        }\r\n\r\n        // for future optimization..\r\n        //invalidateSiblingPointVisibilityForMutatedEntities(mutatedEntityIds, _gridSize);\r\n\r\n        deletedEntityIds.forEach((_eid) => {\r\n            entityIdToDescriptor.delete(_eid);\r\n            entityIdToBoundaryLineSet.delete(_eid);\r\n            entityIdToPointVisibility.delete(_eid);\r\n        });\r\n\r\n        return mutatedEntityIds.length;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getCurrentNumRoutingPoints = function() {\r\n        return currentNumRoutingPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getCurrentNumBoundaryLines = function() {\r\n        return currentNumOfBoundaryLines;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _point\r\n     * @returns {Point|null}\r\n     */\r\n    this.findVisiblePointInfoClosestTo = function(_point) {\r\n        var result = null;\r\n        var currentMaxLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        for (let [_eid, _pvMap] of entityIdToPointVisibility) {\r\n            for (let [_routingPoint, _visiblePoints] of _pvMap) {\r\n                const lineOfSight = new Line(_point, _routingPoint);\r\n                const lineOfSightLength = lineOfSight.getLength();\r\n    \r\n                if(lineOfSightLength < currentMaxLength && !doesLineIntersectAnyBoundaryLines(lineOfSight)) {\r\n                    result = buildPointInfo(_routingPoint, _visiblePoints);\r\n                    currentMaxLength = lineOfSightLength;\r\n                };\r\n            }\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _startPoint\r\n     * @param {Point} _endPoint\r\n     * @param {Number|ConnectorRoutingAlgorithm} _routingAlgorithm\r\n     * \r\n     * @return {PointSet}\r\n     */\r\n    this.computeRoute = function(_startPoint, _endPoint, _routingAlgorithm) {\r\n        // if no valid startpoint or endpoint, we can't route\r\n        if(_startPoint === null || _endPoint === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        // find closest visible point \r\n        const firstPointInfo = self.findVisiblePointInfoClosestTo(_startPoint);\r\n        if(firstPointInfo === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        const vecStartToEnd = (new Vec2(_endPoint.getX() - _startPoint.getX(), _endPoint.getY() - _startPoint.getY())).normalize();\r\n\r\n        const pointsInRoute = [firstPointInfo.point];\r\n        let currentRouteLen = 0;\r\n        let currentPointInfo = firstPointInfo;\r\n        while(true) {\r\n            const routeSegment = routeToEndpoint(currentRouteLen, pointsInRoute, currentPointInfo, _startPoint, _endPoint, vecStartToEnd, _routingAlgorithm);\r\n            if(routeSegment === null) {\r\n                // Is there unobstructed line to endpoint? \r\n                // If not, failed to find route\r\n                const lastSegmentToEndpoint = new Line(pointsInRoute[pointsInRoute.length-1], _endPoint);\r\n                if(doesLineIntersectAnyBoundaryLines(lastSegmentToEndpoint)) {\r\n                    return new PointSet();\r\n                }\r\n\r\n                break;\r\n            }\r\n\r\n            // update cur path length\r\n            currentRouteLen += (new Line(currentPointInfo.point, routeSegment.point)).getLength();\r\n\r\n            // add new point to path\r\n            pointsInRoute.push(routeSegment.point);\r\n\r\n            // update current point index\r\n            currentPointInfo = fetchPointInfoForPoint(routeSegment.point);\r\n\r\n            // check if we're done\r\n            if((new Line(currentPointInfo.point, _endPoint).getLength()) < 1.0) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(doesRoutingAlgorithmRequireOptimization(_routingAlgorithm)) {\r\n            PointVisibilityMapRouteOptimizer.optimize(pointsInRoute, arePointsVisibleToEachOther);\r\n        }\r\n\r\n        return new PointSet(pointsInRoute);\r\n    };\r\n};\r\n   \r\nexport { PointVisibilityMap };\r\n"],"names":["MatrixMath","mat4Multiply","_a","_b","result","i","sum","j","k","vecMat4Multiply","_v","_m","vi","Point","_x","_y","__x","__y","prototype","getX","getY","isEqual","_otherPoint","getCartesianPoint","_sheetWidth","_sheetHeight","toString","toArray","fromArray","_arr","LINE_INTERSECTION_TYPE","Object","freeze","PARALLEL","COINCIDENT","LINE","LINESEG","LineIntersection","_type","_intersectionPoint","__type","__intersectionPoint","getType","getIntersectionPoint","Line","_startPoint","_endPoint","__startPoint","__endPoint","getStartPoint","getEndPoint","_otherLine","getLength","Math","sqrt","pow","getMinX","min","getMaxX","max","getMinY","getMaxY","getDirection","dx","dy","len","createShortenedLine","startReduceByPx","endReduceByPx","dir","computeIntersectionType","thisLineStartPointX","thisLineStartPointY","thisLineEndPointX","thisLineEndPointY","otherLineStartPointX","otherLineStartPointY","otherLineEndPointX","otherLineEndPointY","paramDenom","paramANumer","paramBNumer","paramA","paramB","computeIntersection","xIntersect","yIntersect","SvgPathBuilder","pointToLineTo","_pt","_ptIndex","pointTripletToTesselatedCurvePoints","_points","_curvaturePx","length","Error","controlPoint","lineA","lineB","lineAShortened","lineBShortened","pointsToPath","svgPathParts","ptIdx","ptA","shift","ptB","ptC","newPts","unshift","push","pt","p","join","Dimensions","_width","_height","getWidth","getHeight","Rectangle","_left","_top","_right","_bottom","__left","__top","__right","__bottom","getLeft","getTop","getRight","getBottom","getPoints","getLines","getUniformlyResizedCopy","_resizeByPx","getPointsScaledToGrid","_gridSize","centroid","scaleDx","scaleDy","scaledPoints","checkIntersect","_otherRectangle","checkIsPointWithin","_point","checkIsWithin","GroupTransformationContainerEvent","TRANSLATE_START","TRANSLATE","EntityEvent","RESIZE_START","RESIZE","PointSet","_pointsInput","self","points","_newPoint","pushPointSet","_ps","possibleNewPoints","findPointClosestTo","resultPoint","currentMinLength","Number","MAX_SAFE_INTEGER","forEach","lineToPt","findDistanceToPointClosestTo","findPointsCloseTo","_radius","resultSet","toFloat64Array","Float64Array","fromFloat64Array","_float64Array","count","Array","isArray","call","AccessibleRoutingPointsFinder","find","_subjectEntityDescriptors","_occluderEntityDescriptors","connectorAnchorToNumValidRoutingPoints","Map","allRoutingPoints","filteredRoutingPoints","_entityDescriptor","anchors","connectorAnchors","routingPoints","routingPointsFloat64Arr","_rp","routingPoint","parentAnchorId","id","set","isPointWithinObj","occluder","boundingRect","x","y","width","height","currentNumRoutingPoints","get","accessibleRoutingPoints","ConnectorAnchor","_id","_domElement","_sheet","_routingPointOffsetX","_routingPointOffsetY","routingPointDirections","getGridSize","getDimensions","r","transformDomRectToPageSpaceRect","getBoundingClientRect","routingPointDirectionToPoint","_direction","_centroid","_halfWidth","_halfHeight","setPossibleRoutingPointDirections","_directions","getId","getCentroid","sheetOffset","getSheetOffset","pageSpaceRect","halfWidth","halfHeight","getRoutingPoints","dimensions","_dir","getBoundingRectange","ClosestPairFinder","findClosestPairBetweenObjects","_objA","_objB","_connectorAnchorToNumValidRoutingPoints","objAConnectorAnchors","getConnectorAnchors","objBConnectorAnchors","startAnchorIdxWithMinDist","endAnchorIdxWithMinDist","minDist","MAX_VALUE","aCentroid","objANumValidRoutingPoints","bCentroid","d","objBNumValidRoutingPoints","objectAAnchorIndex","objectAAnchor","objectBAnchorIndex","objectBAnchor","BestToConnectEntitiesFinder","findBestTimeout","searchInputs","currentSheetEntities","currentGridSize","findBufferTime","metrics","batchSize","searchFuncExecutionTime","getSearchFuncExecutionTime","getSearchFuncBatchSize","alreadyInSearchInputs","_cb","entityA","entityB","cb","clearSearchInputs","search","exTimeT1","Date","inputBatchSize","gridSize","entityDescriptors","_e","getDescriptor","entityDescriptorsArr","values","accessibleRoutingPointsResult","ConnectorAnchorClosestPairFinder","findBest","_entityA","_entityB","_onFound","_sheetEntities","f","clearTimeout","searchFunc","setTimeout","SheetEvent","DBLCLICK","CLICK","CLUSTER_CREATED","CLUSTER_DELETED","CLUSTER_UPDATED","CONNECTOR_UPDATED","ENTITY_ADDED","ENTITY_REMOVED","ENTITY_RESIZED","ENTITY_TRANSLATED","ENTITY_OVERLAP_DETECTED","MULTIPLE_ENTITY_SELECTION_STARTED","MULTIPLE_ENTITIES_SELECTED","DebugMetricsPanel","_window","debugPanelElem","isVisible","objectHtmlDumpDepthFirst","_obj","_output","_parentName","keys","_k","prefix","metricName","init","document","createElement","classList","add","style","display","position","right","top","color","padding","backgroundColor","zIndex","body","appendChild","show","hide","refresh","_metrics","htmlStringsArr","innerHTML","DoubleTapDetector","_dblTapSpeed","_dblTapRadius","dblTapDetectVars","lastTouchX","lastTouchY","lastTouchTime","dblTapSpeed","dblTapRadius","processTap","_touchEndEvent","_sheetPageOffset","_currentInvTransformationMatrix","changedTouches","doubleTapDetected","touchX","touchY","invTransformedPos","pageX","pageY","dblTapDetected","now","getTime","timeSinceLastTouch","lastX","lastY","distFromLastTouch","ConnectorEvent","MOUSE_ENTER","MOUSE_LEAVE","ConnectorRoutingAlgorithm","STRAIGHT_LINE","STRAIGHT_LINE_BETWEEN_ANCHORS","STRAIGHT_LINE_BETWEEN_ANCHORS_AVOID_SELF_INTERSECTION","ASTAR","ASTAR_WITH_ROUTE_OPTIMIZATION","ASTAR_THETA_WITH_ROUTE_OPTIMIZATION","Connector","_anchorStart","_anchorEnd","_containerDomElement","_routingAlgorithm","eventNameToHandlerFunc","markerStartSize","markerEndSize","defaultStrokeColor","defaultStrokeWidth","pathPoints","pathElem","window","createElementNS","setAttribute","stroke","strokeWidth","interactionElem","addEventListener","e","dispatchEvent","connector","clickedAtX","clickedAtY","pointerAtX","pointerAtY","appendPathToContainerDomElement","setMarkerStart","_url","_size","unsetMarkerStart","removeAttribute","setMarkerEnd","unsetMarkerEnd","getPathPoints","getPathLines","lines","totalLength","pathLines","getMidpoint","lengthSoFar","curPathLineWithMidpoint","pathLineLength","lengthBeforeCur","midOnCurPath","getMidpointDirection","_svgPath","updatePathPoints","_pathPoints","anchorIds","sort","getAnchorStart","getAnchorEnd","removePathElement","remove","removeDefaultStyles","setInlineStyleOnPathElement","setInlineStyleOnInteractionElement","_key","_value","addStyleClassesToPathElement","_cssClassesToAdd","_cls","removeStyleClassesFromPathElement","_cssClassesToRemove","addStyleClassesToInteractionElement","removeStyleClassesFromInteractionElement","anchor_start_centroid_arr","anchor_end_centroid_arr","marker_start_size","marker_end_size","curvature_px","routing_algorithm","on","_eventName","_handlerFunc","allHandlers","off","_callback","allCallbacks","splice","_eventId","_eventData","observers","handler","GRID_STYLE","DOT","Grid","_color","_style","getSize","getStyle","getSvgImageTile","ClusterDetectionWorkerJsString","ConnectorRoutingWorkerJsString","DescriptorCollection","_collectionId","descriptors","getDescriptorIndex","_descriptor","getDescriptorIndexById","_descriptorId","addDescriptor","getDescriptors","getIds","ids","_d","removeById","idx","removeAll","Cluster","_clusterId","entityDescriptorCollection","getEntityIndex","_entity","getEntityIndexById","_entityId","addEntity","getEntities","getEntityIds","removeEntityById","removeAllEntities","hasEntities","_entityIds","isEquivalent","toJSON","entities","fromJSON","_clusterJSON","Originator","PROGRAM","USER","PROGRAM_VIA_PARENT_ENTITY","USER_VIA_PARENT_ENTITY","Sheet","_sheetDomElement","svgElem","connectorsContainerDomElement","selectionBoxElem","groupTransformationContainers","currentGroupTransformationContainerBeingDragged","grid","transitionCss","transformOriginX","transformOriginY","touchMoveLastX","touchMoveLastY","translateX","translateY","scaleFactor","invScaleFactor","boundingExtentRoutingPointScaleFactor","invTransformationMatrixStack","currentInvTransformationMatrix","currentTransformationMatrix","connectorRefreshBufferTime","sheetEntities","objectConnectors","objectIdBeingDragged","objectIdBeingResized","objectResizeCursor","objectDragX","objectDragY","objectDragStartX","objectDragStartY","doubleTapDetector","debugMetricsPanel","connectorRoutingWorker","executionTime","numRoutingPoints","numBoundaryLines","msgDecodeTime","pointVisibilityMapCreationTime","allPathsComputationTime","clusterDetectionWorker","computeClustersTime","refreshAllConnectorsInternal","findBestConnectorAnchorsToConnectEntities","connectorsRefreshTime","touchHoldDelayTimeMs","touchHoldStartInterval","multiObjectSelectionStartX","multiObjectSelectionStartY","multiObjectSelectionEndX","multiObjectSelectionEndY","multiObjectSelectionStarted","connectorAnchorsSelected","isDomMetricsLockActive","sheetOffsetLeft","sheetOffsetTop","sheetPageScrollXOffset","sheetPageScrollYOffset","eventHandlers","connectorRefreshStartTime","connectorRefreshTimeout","pendingConnectorRedraw","bestConnectorAnchorsForEntityConnectionsFinder","knownClustersOverwrite","clusterDetectionWorkerUrl","URL","createObjectURL","Blob","initClusterDetectionWorker","Worker","onmessage","_msg","data","newClusterIds","_cId","emitEvent","cluster","clusters","updatedClusterIds","eventObj","entitiesAdded","updatedClusterToAddedEntitites","entitiesRemoved","updatedClusterToRemovedEntitites","deletedClusterIds","clusterId","c","_createForOfIteratorHelper","overlappingEntities","s","n","done","_slicedToArray","value","entityId","overlappingEntityIds","a","overwriteClusterDetectorKnownClusters","_clusters","_c","updateClusterDetectorKnownCluster","_cluster","foundMatch","deleteClusterDetectorKnownCluster","connectorRoutingWorkerUrl","initConnectorRoutingWorker","connectorsRefreshTimeT1","connectorDescriptors","refreshCalls","getConnectorDescriptorById","renderInternal","_rc","descriptor","ps","pointsInPath","svgPath","cancelAnimationFrame","requestAnimationFrame","overallTime","setGrid","_grid","backgroundImage","btoa","backgroundRepeat","getGrid","setBoundingExtentRoutingPointScaleFactor","_scaleFactor","lockDomMetrics","offsetLeft","offsetTop","pageXOffset","pageYOffset","unlockDomMetrics","hasDomMetricsLock","refreshAllClustersInternal","postData","postMessage","executionTimeT1","setConnectorRefreshBufferTime","_bufferTimeMs","refreshAllConnectors","tdelta","makeNewConnector","setConnectorFactory","_newConnectorFactory","getTransitionCss","setTransitionCss","_css","transition","getTransformOriginX","getTransformOriginY","getScaleFactor","getTranslateX","getTranslateY","setTransformOrigin","transformOrigin","scale","_adjustFactorToPreserveIntegerGrid","newGridSize","roundedGridSize","round","scaleMat","translate","translateMatrix","applyTransform","transform","getTransformMatrixCss","getTransformMatrix","matElems","_domRect","pageOffset","getPageOffset","left","bottom","invTransformedPosLeftTop","invTransformedPosRightBottom","resetTransform","snapToGrid","_p","ret","getOffsetLeft","getOffsetTop","offsetWidth","offsetHeight","resize","_newWidth","_newHeight","calcBoundingRectForEntities","_entities","minTop","minLeft","maxBottom","maxRight","index","array","objRect","calcBoundingBox","getEntitiesAroundPoint","ptRect","getEntitiesWithinRect","_rect","getAllEntities","publishSiblingObjectChange","handleSiblingObjectChange","getEntityById","foundEntity","obj","handleResizeStart","entity","originator","handleMoveStart","object","withinGroupTransformation","removeEntity","getConnector","getAllConnectors","getConnectorsBetweenEntities","foundConnectors","_conn","aS","aE","hasConnectorAnchor","getConnectorsBetweenAnchors","_anchorA","_anchorB","getConnectorsInEntitySet","_entitySet","connectorsBetween","apply","_toConsumableArray","getEntitiesConnectedViaConnector","_connectorId","foundEntities","allEntities","_o","getConnectorsConnectedToEntity","getEntityWithConnectorAnchor","_connectorAnchorId","removeAllConnectors","removeConnector","_connector","makeNewConnectorFromAnchors","newConnector","foundConnector","addConnectionAnchorToSelectionStack","_anchor","dblClickTapHandler","_posX","_posY","entitiesAroundPoint","eventData","targetPoint","objectsAroundPoint","initDebugMetricsPanel","initInteractionHandlers","sheetEntityClicked","target","entityClicked","canvasObjectClicked","detectResult","setCurrentGroupTransformationContainerBeingDragged","container","attachGroupTransformationContainer","_groupTransformationContainer","getContainerDomElement","detachGroupTransformationContainer","removeChild","handleGroupTransformationContainerMove","_dx","_dy","gtc","translateByOffset","handleMove","translateOffset","getTranslateHandleOffset","mx","my","handleMoveEnd","resizeCursor","cursor","handleResize","newWidth","newHeight","handleResizeEnd","handleMultiEntitySelectionStart","_targetElem","handleMultiEntitySelectionEnd","selectionRect","selectedEntities","selectedObjects","updateSelectionBoxEndPoint","_endX","_endY","abs","initMultiEntitySelectionHandler","_selectionRectStyleCssClasses","selBox","border","background","_class","handleTouchSelectionStart","hasSelectionStarted","touches","which","preventDefault","setInterval","clearInterval","initTransformationHandlers","movementX","movementY","endTranslate","stopPropagation","cbFunc","Entity","_translateHandleDomElements","_resizeHandleDomElements","MOUSE_MIDDLE_BUTTON","nextConnectorAnchorIdSuffix","currentTranslateHandleElementActivated","subEntities","hasPendingFrame","overwrittenRenderStyles","addNonInteractableConnectorAnchor","_connectorAnchorDomElement","newAnchor","addInteractableConnectorAnchor","anchor","getConnectorAnchorRoutingPoints","anchorPoints","getPositionOnPage","ownerDocument","defaultView","scrollX","scrollY","renderImmediate","render","overwriteRenderStyle","_withinGroupTransformation","_originator","originatorForSubEntities","_subEntity","getDomElement","getBoundingRectangeInPageSpace","pagePos","computePageToEntitySpaceTransformedRectangle","_rectInPageSpace","noteBoundingRect","rectRelativeToNote","GraphPaper","getBoundingPoints","topLeft","topRight","bottomLeft","bottomRight","outerBoundMinX","outerBoundMinY","outerBoundMaxX","outerBoundMaxY","outerBoundingRect","minX","minY","maxX","maxY","attachSubEntities","_subEntities","getAttachedSubEntities","suspendTranslateInteractions","unbindTranslateHandleElements","resumeTranslateInteractions","bindTranslateHandleElements","translateTouchStartHandler","isTouch","translateMouseDownHandler","_el","removeEventListener","resizeMouseDownHandler","_triggeredByElement","_resizeCursor","resizeTouchStartHandler","bindResizeHandleElements","getComputedStyle","GroupTransformationContainer","_containerStyleCssClasses","_sizeAdjustmentPx","calculateBoundingRect","accTranslateX","accTranslateY","currentLeft","currentTop","entityPositionRelativeToBoundingRect","rp","getBoundingRect","newLeft","newTop","initTranslateInteractionHandler","BoxClusterDetector","_boxExtentOffset","getEntityIndexFromArray","_sheetEntityDescriptorsArray","removeEntitiesFromArray","getClusterWithMostEntitiesFromClusterMap","_clusterToEntityCountMap","curMaxObjs","curClusterWithMax","_numObjs","_map","computeDiffBetweenArrays","_arrA","_arrB","onlyInA","onlyInB","_postItem","indexOf","_preItem","areEntitiesClose","nA","nB","getAllEntitiesCloseTo","_entitiesUnderConsideration","getClusterEntitiesFromSeed","_seedEntity","_resultSet","closeByEntities","concat","findIntersectingClustersForEntities","_entityDescriptors","intersectingClusterToNumEntitiesIntersecting","clusterEntities","has","removeEntityFromClusters","mutatedClusterIds","wasFoundAndRemoved","mapToClustersWithOldEntitiesRemoved","_currentEntityIds","map","clusterEntityIds","computeClusters","_knownClusters","_getNewIdFunc","Set","entitiesUnderConsideration","entitiesUnderConsiderationIds","_loop","entityDescriptor","pop","entitiesForCluster","size","newCluster","_clusterEntity","clusterToModify","preEntityIds","clustersMutated","postUpdateEntityIds","diffResult","existingEntry","emptyAndSingletonClusters","filter","delete","nonEmptyNonSingletonClusters","PointVisibilityMapRouteOptimizer","optimize","_pointsInRoute","_arePointsVisibleToEachOther","start","end","LineSet","_linesInput","_newLine","Vec2","create","normalize","dot","PointInfo","point","visiblePoints","PointVisibilityMap","entityIdToPointVisibility","entityIdToBoundaryLineSet","entityIdToDescriptor","currentNumOfBoundaryLines","doesLineIntersectAnyBoundaryLines","_theLine","b","_eid","_boundaryLineSet","intersectionType","boundaryLinesArr","computePointsVisibilityForPoint","_pointInfo","_pvMap","_routingPoint","_visiblePoints","ijLine","isValid","arePointsVisibleToEachOther","_ptA","_ptB","ptAInfo","fetchPointInfoForPoint","visiblePts","getVisiblePointsRelativeTo","isPointInArray","_needle","_haystack","routeToEndpoint","_currentRouteLength","_currentPointInfo","_vecStartToEnd","visiblePt","currentPoint","curMinCost","visiblePointWithMinCost","vecToTargetIdeal","currentToVisibleLength","gn","hn","tn","vecVisibleToEndpt","cost","getBoundaryLinesFromEntityDescriptor","_ed","boundaryLines","entityBoundingRect","_l","anchorBoundingRect","hasEntityMutated","_old","_new","buildPointInfo","buildEmptyRoutingPointToVisibleSetMap","_allSiblingDescriptors","_boundingExtentRoutingPointScaleFactor","foundPoints","routingPointToVisibleSet","_sp","doesRoutingAlgorithmRequireOptimization","updateRoutingPointsAndBoundaryLinesFromEntityDescriptors","aliveEntityIds","mutatedEntityIds","deletedEntityIds","existingDescriptor","boundaryLinesForEntity","v","w","includes","getCurrentNumRoutingPoints","getCurrentNumBoundaryLines","findVisiblePointInfoClosestTo","currentMaxLength","h","l","m","lineOfSight","lineOfSightLength","computeRoute","firstPointInfo","routeSegment","vecStartToEnd","pointsInRoute","currentRouteLen","currentPointInfo","lastSegmentToEndpoint"],"mappings":"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"}