{"version":3,"file":"graphpaper.min.js","sources":["../src/MatrixMath.js","../src/SvgPathBuilder.js","../src/Dimensions.js","../src/Point.js","../src/LineIntersection.js","../src/Line.js","../src/Rectangle.js","../src/PointSet.js","../src/LineSet.js","../src/ConnectorAnchor.js","../src/Connector.js","../src/PointVisibilityMap.js","../src/Grid.js","../src/Canvas.js","../src/CanvasObject.js","../src/Cluster.js","../src/BoxClusterDetector.js"],"sourcesContent":["const MatrixMath = {\r\n\r\n    mat4Multiply: function(_a, _b) {\r\n\r\n        const result = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        for(let i=0; i<4; i++) {\r\n            for(let j=0; j<4; j++) {\r\n\r\n                var sum = 0;\r\n                for(let k=0; k<4; k++) {\r\n                    sum += _a[k + 4*i] * _b[j + 4*k];\r\n                }\r\n\r\n                result[j + 4*i] = sum;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    vecMat4Multiply: function(_v, _m) {\r\n        const result = [0, 0, 0, 0];\r\n        for(let vi=0; vi<4; vi++) {\r\n            result[vi] = \r\n                (_v[0] * _m[(vi*4) + 0]) + \r\n                (_v[1] * _m[(vi*4) + 1]) + \r\n                (_v[2] * _m[(vi*4) + 2]) + \r\n                (_v[3] * _m[(vi*4) + 3]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n};\r\n\r\nexport { MatrixMath };\r\n","const SvgPathBuilder = {\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _pt \r\n     * @returns {String}\r\n     */\r\n    pointToLineTo: function(_pt) {\r\n        return \"L\" + _pt.getX() + \" \" + _pt.getY();\r\n    },\r\n\r\n    /**\r\n     * \r\n     * @param {Point[]} _points \r\n     * @returns {String}\r\n     */\r\n    pointsToPath: function(_points) {\r\n        const startPt = _points[0];\r\n\r\n        const lineToString = [];\r\n        for(let i=1; i<_points.length; i++) {\r\n            const p = _points[i];\r\n            lineToString.push(SvgPathBuilder.pointToLineTo(p));\r\n        }\r\n        \r\n        const startCoordString = startPt.getX() + \" \" + startPt.getY();\r\n        const pathString = 'M' + startCoordString + lineToString.join(\" \");\r\n\r\n        return pathString;\r\n    },\r\n\r\n};\r\n\r\nexport { SvgPathBuilder };\r\n","/**\r\n * \r\n * @param {Number} _width\r\n * @param {Number} _height\r\n */\r\nfunction Dimensions(_width, _height) {\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */       \r\n    this.getWidth = function() {\r\n        return _width;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */       \r\n    this.getHeight = function() {\r\n        return _height;\r\n    };\r\n};\r\n\r\nexport { Dimensions };\r\n","/**\r\n * \r\n * @param {Number} _x\r\n * @param {Number} _y\r\n */\r\nfunction Point(_x, _y) {\r\n\r\n    this.__x = _x;\r\n    this.__y = _y;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getX = function() {\r\n    return this.__x;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */     \r\nPoint.prototype.getY = function() {\r\n    return this.__y;\r\n};\r\n\r\n/**\r\n * @param {Point} _otherPoint\r\n * @returns {Boolean}\r\n */\r\nPoint.prototype.isEqual = function(_otherPoint) {\r\n    if(this.__x === _otherPoint.getX() && this.__y === _otherPoint.getY()) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */\r\nPoint.prototype.getCartesianPoint = function(_canvasWidth, _canvasHeight) {\r\n    return new Point(\r\n        this.__x - (_canvasWidth * 0.5),\r\n        -this.__y + (_canvasHeight * 0.5)\r\n    );\r\n};\r\n\r\n/**\r\n * @returns {String}\r\n */\r\nPoint.prototype.toString = function() {\r\n    return this.__x + \" \" + this.__y;\r\n};\r\n\r\nexport { Point };\r\n","import  {Point} from './Point';\r\n\r\nconst LINE_INTERSECTION_TYPE = Object.freeze({\r\n\tPARALLEL: \"parallel\",\t\t// no intersection, lines are parallel\r\n    COINCIDENT: \"coincident\",\t// no intersection, lines are coincident\r\n\tLINE: \"line\",\t\t\t\t// the lines intersect, but the intersection point is beyond the bounds of the line segments\r\n\tLINESEG: \"lineseg\",\t\t\t// the lines intersect, and the intersection point is within the bounds of the line segments\r\n});\r\n\r\n/**\r\n * \r\n * @param {LINE_INTERSECTION_TYPE} _type \r\n * @param {Point} _intersectionPoint \r\n */\r\nfunction LineIntersection(_type, _intersectionPoint) {\r\n\r\n    /**\r\n     * @returns {LINE_INTERSECTION_TYPE}\r\n     */\r\n    this.getType = function() {\r\n        return _type;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point|null}\r\n     */\r\n    this.getIntersectionPoint = function() {\r\n        return _intersectionPoint;\r\n    };\r\n};\r\n\r\nexport {LINE_INTERSECTION_TYPE, LineIntersection};\r\n","import  {Point} from './Point';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {Point} _startPoint\r\n * @param {Point} _endPoint\r\n */\r\nfunction Line(_startPoint, _endPoint) {   \r\n\r\n    if(typeof _startPoint === 'undefined' || _startPoint === null) {\r\n        throw \"Line missing _startPoint\";\r\n    }\r\n\r\n    if(typeof _endPoint === 'undefined' || _endPoint === null) {\r\n        throw \"Line missing _endPoint\";\r\n    }\r\n\r\n    this.__startPoint = _startPoint;\r\n    this.__endPoint = _endPoint;\r\n};\r\n\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getStartPoint = function() {\r\n    return this.__startPoint;\r\n};\r\n\r\n/**\r\n * @returns {Point}\r\n */       \r\nLine.prototype.getEndPoint = function() {\r\n    return this.__endPoint;\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {Boolean}\r\n */\r\nLine.prototype.isEqual = function(_otherLine) {\r\n    if(this.getStartPoint().isEqual(_otherLine.getStartPoint()) && this.getEndPoint().isEqual(_otherLine.getEndPoint())) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * @returns {Number}\r\n */\r\nLine.prototype.getLength = function() {\r\n    return Math.sqrt(\r\n        Math.pow(this.__endPoint.getX() - this.__startPoint.getX(), 2) + Math.pow(this.__endPoint.getY() - this.__startPoint.getY(), 2)\r\n    );\r\n};\r\n\r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_TYPE}\r\n */\r\nLine.prototype.computeIntersectionType = function(_otherLine) {\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return LINE_INTERSECTION_TYPE.COINCIDENT;\r\n        else\r\n            return LINE_INTERSECTION_TYPE.PARALLEL;\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return LINE_INTERSECTION_TYPE.LINE;\r\n    } else {\r\n        return LINE_INTERSECTION_TYPE.LINESEG;\r\n    }\r\n};\r\n    \r\n/**\r\n * @param {Line} _otherLine\r\n * @returns {LINE_INTERSECTION_RESULT}\r\n */\r\nLine.prototype.computeIntersection = function(_otherLine) {\r\n\r\n    const thisLineStartPointX = this.__startPoint.getX();\r\n    const thisLineStartPointY = this.__startPoint.getY();\r\n    const thisLineEndPointX = this.__endPoint.getX();\r\n    const thisLineEndPointY = this.__endPoint.getY();        \r\n    const otherLineStartPointX = _otherLine.getStartPoint().getX();\r\n    const otherLineStartPointY = _otherLine.getStartPoint().getY();\r\n    const otherLineEndPointX = _otherLine.getEndPoint().getX();\r\n    const otherLineEndPointY = _otherLine.getEndPoint().getY();\r\n\r\n    const paramDenom = (otherLineEndPointY-otherLineStartPointY)*(thisLineEndPointX-thisLineStartPointX) - (otherLineEndPointX-otherLineStartPointX)*(thisLineEndPointY-thisLineStartPointY);\r\n    const paramANumer = (otherLineEndPointX-otherLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (otherLineEndPointY - otherLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n    const paramBNumer = (thisLineEndPointX-thisLineStartPointX)*(thisLineStartPointY-otherLineStartPointY) - (thisLineEndPointY-thisLineStartPointY)*(thisLineStartPointX-otherLineStartPointX);\r\n\r\n    if(paramDenom == 0) {\r\n        if(paramDenom == 0 && paramANumer == 0 && paramBNumer==0)\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.COINCIDENT, null);\r\n        else\r\n            return new LineIntersection(LINE_INTERSECTION_TYPE.PARALLEL, null);\r\n    }\r\n\r\n    const paramA = paramANumer / paramDenom;\r\n    const paramB = paramBNumer / paramDenom;\r\n\r\n    const xIntersect = this.__startPoint.getX() + paramA*(this.__endPoint.getX()-this.__startPoint.getX());\r\n    const yIntersect = this.__startPoint.getY() + paramA*(this.__endPoint.getY()-this.__startPoint.getY());\r\n    \r\n    if(paramA > 1.0 || paramA < 0.0 || paramB > 1.0 || paramB < 0.0) {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINE, new Point(xIntersect, yIntersect));\r\n    } else {\r\n        return new LineIntersection(LINE_INTERSECTION_TYPE.LINESEG, new Point(xIntersect, yIntersect));\r\n    }\r\n};\r\n\r\nexport { Line };\r\n","import {Point} from './Point';\r\nimport {Line} from './Line';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {Number} _left\r\n * @param {Number} _top\r\n * @param {Number} _right\r\n * @param {Number} _bottom\r\n */\r\nfunction Rectangle(_left, _top, _right, _bottom)  {\r\n    \r\n    const self=this;\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getLeft = function() {\r\n        return _left;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getTop = function() {\r\n        return _top;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getRight = function() {\r\n        return _right;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getBottom = function() {\r\n        return _bottom;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.getPoints = function() {\r\n        return [\r\n            new Point(_left, _top),\r\n            new Point(_right, _top),\r\n            new Point(_right, _bottom),\r\n            new Point(_left, _bottom)\r\n        ];\r\n    };\r\n\r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.getLines = function() {\r\n        return [\r\n            new Line(new Point(_left, _top), new Point(_right, _top)),\r\n            new Line(new Point(_right, _top), new Point(_right, _bottom)),\r\n            new Line(new Point(_right, _bottom), new Point(_left, _bottom)),\r\n            new Line(new Point(_left, _bottom), new Point(_left, _top))\r\n        ];\r\n    };\r\n\r\n    /**\r\n     * Scale the bounding box by _gridSize, and return the points comprising the box\r\n     * \r\n     * @param {Number} _gridSize\r\n     * @returns {Point[]}\r\n     */\r\n    this.getPointsScaledToGrid = function(_gridSize) {\r\n\r\n        const centroid = new Point(\r\n            _left + ((_right-_left)*0.5),\r\n            _top + ((_bottom-_top)*0.5)\r\n        );\r\n\r\n        const scaleDx = ((_right - centroid.getX()) + _gridSize) / (_right - centroid.getX());\r\n        const scaleDy = ((_bottom - centroid.getY()) + _gridSize) / (_bottom - centroid.getY());        \r\n       \r\n        const scaledPoints = [\r\n            new Point(\r\n                ((_left - centroid.getX())*scaleDx) + centroid.getX(), \r\n                ((_top - centroid.getY())*scaleDy) + centroid.getY()\r\n            ),\r\n\r\n            new Point(\r\n                ((_right - centroid.getX())*scaleDx) + centroid.getX(), \r\n                ((_top - centroid.getY())*scaleDy) + centroid.getY()\r\n            ),\r\n\r\n            new Point(\r\n                ((_right - centroid.getX())*scaleDx) + centroid.getX(), \r\n                ((_bottom - centroid.getY())*scaleDy) + centroid.getY()\r\n            ),\r\n\r\n            new Point(\r\n                ((_left - centroid.getX())*scaleDx) + centroid.getX(), \r\n                ((_bottom - centroid.getY())*scaleDy) + centroid.getY()\r\n            )\r\n        ];\r\n\r\n        return scaledPoints;\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Rectangle} _otherRectangle\r\n     * @returns {Boolean}\r\n     */\r\n    this.checkIntersect = function(_otherRectangle) {\r\n        if(_bottom < _otherRectangle.getTop()) {\r\n            return false;\r\n        }\r\n\r\n        if(_top > _otherRectangle.getBottom()) {\r\n            return false;\r\n        }\r\n\r\n        if(_right < _otherRectangle.getLeft()) {\r\n            return false;\r\n        }\r\n\r\n        if(_left > _otherRectangle.getRight()) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     */\r\n    this.checkIsPointWithin = function(_point) {\r\n        if(_point.getX() >= _left && _point.getX() <= _right && _point.getY() >= _top && _point.getY() <= _bottom) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Rectangle} _otherRectangle\r\n     * @returns {Boolean}\r\n     */\r\n    this.checkIsWithin = function(_otherRectangle) {\r\n        if( _bottom <= _otherRectangle.getBottom() &&\r\n            _top >= _otherRectangle.getTop() &&\r\n            _right <= _otherRectangle.getRight() &&\r\n            _left >= _otherRectangle.getLeft()\r\n        ) {\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n};\r\n\r\nexport { Rectangle }\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Point objects\r\n * \r\n * @param {Point[]|Float64Array|undefined} _pointsInput\r\n */\r\nfunction PointSet(_pointsInput) {\r\n\r\n    const self = this;\r\n\r\n    /**\r\n     * @type {Point[]}\r\n     */\r\n    const points = [];\r\n\r\n    /**\r\n     * @param {Point} _newPoint\r\n     */\r\n    this.push = function(_newPoint) {\r\n        for(let i=0; i<points.length; i++) {\r\n            if(_newPoint.isEqual(points[i])) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        points.push(_newPoint);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @param {PointSet} _ps\r\n     */\r\n    this.pushPointSet = function(_ps) {\r\n        const possibleNewPoints = _ps.toArray();\r\n        for(let i=0; i<possibleNewPoints.length; i++) {\r\n            self.push(possibleNewPoints[i]);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {Point}\r\n     */\r\n    this.findPointClosestTo = function(_point) {\r\n        var resultPoint = null;\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                resultPoint = _pt;\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return resultPoint;        \r\n    };\r\n\r\n    this.findDistanceToPointClosestTo = function(_point) {\r\n        var currentMinLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() < currentMinLength) {\r\n                currentMinLength = lineToPt.getLength();\r\n            }\r\n        });\r\n        \r\n        return currentMinLength;        \r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Point} _point \r\n     * @returns {PointSet}\r\n     */\r\n    this.findPointsCloseTo = function(_point, _radius) {\r\n        const resultSet = new PointSet();\r\n\r\n        points.forEach(function(_pt) {\r\n            const lineToPt = new Line(_point, _pt);\r\n            if(lineToPt.getLength() <= _radius) {\r\n                resultSet.push(_pt);\r\n            }\r\n        });\r\n        \r\n        return resultSet;        \r\n    };    \r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.toArray = function() {\r\n        return points;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n\r\n        const result = new Float64Array(points.length * 2);\r\n        for(let i=0; i<points.length; i++) {\r\n            result[0 + (i*2)] = points[i].getX();\r\n            result[1 + (i*2)] = points[i].getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n    \r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        points.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=2) {\r\n            points.push(\r\n                new Point(_float64Array[i], _float64Array[i+1])\r\n            );\r\n        }\r\n    };    \r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return points.length;\r\n    };\r\n\r\n    if(_pointsInput && Array.isArray(_pointsInput)) {\r\n        _pointsInput.forEach(self.push);\r\n    } else if(_pointsInput && Object.prototype.toString.call(_pointsInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_pointsInput);\r\n    } else { }    \r\n\r\n};\r\n\r\nexport { PointSet };\r\n","import  {Point} from './Point';\r\nimport  {Line} from './Line';\r\n\r\n/**\r\n * Unique collection of Line objects\r\n * \r\n * @param {Line[]|Float64Array|undefined} _linesInput\r\n */\r\nfunction LineSet(_linesInput) {\r\n\r\n    const self = this;\r\n    \r\n    /**\r\n     * @type {Line[]}\r\n     */\r\n    const lines = [];    \r\n\r\n    /**\r\n     * @param {Line} _newLine\r\n     */\r\n    this.push = function(_newLine) {\r\n        var alreadyInLinesArray = false;\r\n        lines.forEach(function(_existingLine) {\r\n            if(_newLine.isEqual(_existingLine)) {\r\n                alreadyInLinesArray = true;\r\n            }\r\n        });        \r\n\r\n        if(alreadyInLinesArray) {\r\n            return false;\r\n        }\r\n\r\n        lines.push(_newLine);\r\n        return true;\r\n    };\r\n  \r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.toArray = function() {\r\n        return lines;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.count = function() {\r\n        return lines.length;\r\n    };\r\n\r\n    /**\r\n     * @returns {Float64Array}\r\n     */\r\n    this.toFloat64Array = function() {\r\n        const result = new Float64Array(lines.length * 4);\r\n        for(let i=0; i<lines.length; i++) {\r\n            result[0 + (i*4)] = lines[i].getStartPoint().getX();\r\n            result[1 + (i*4)] = lines[i].getStartPoint().getY();\r\n            result[2 + (i*4)] = lines[i].getEndPoint().getX();\r\n            result[3 + (i*4)] = lines[i].getEndPoint().getY();\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @param {Float64Array} _float64Array\r\n     */\r\n    const fromFloat64Array = function(_float64Array) {\r\n        lines.length = 0;\r\n        for(let i=0; i<_float64Array.length; i+=4) {\r\n            lines.push(\r\n                new Line(\r\n                    new Point(_float64Array[i], _float64Array[i+1]),\r\n                    new Point(_float64Array[i+2], _float64Array[i+3])\r\n                )\r\n            );\r\n        }\r\n    };\r\n\r\n    if(_linesInput && Array.isArray(_linesInput)) {\r\n        _linesInput.forEach(self.push);\r\n    } else if(_linesInput && Object.prototype.toString.call(_linesInput) === '[object Float64Array]') {\r\n        fromFloat64Array(_linesInput);\r\n    } else { }    \r\n};\r\n\r\nexport { LineSet };\r\n","import  {Point} from './Point';\r\nimport  {Rectangle} from './Rectangle';\r\n\r\n/**\r\n * @param {String} _id\r\n * @param {Element} _domElement\r\n * @param {Canvas} _canvas\r\n */\r\nfunction ConnectorAnchor(_id, _domElement, _canvas) {\r\n    \r\n    const self = this;\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _id;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */     \r\n    this.getX = function() {\r\n        return self.getCentroid().getX();\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */     \r\n    this.getY = function() {\r\n        return self.getCentroid().getY();\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        const r = _domElement.getBoundingClientRect();\r\n        return (r.right - r.left);\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        const r = _domElement.getBoundingClientRect();\r\n        return (r.bottom - r.top);\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getCentroid = function() {\r\n        const viewportRelativeRect = _domElement.getBoundingClientRect();\r\n        const pageOffset = _canvas.getPageOffset();        \r\n        return new Point(\r\n            viewportRelativeRect.left + pageOffset.getX() + (self.getWidth() * 0.5), \r\n            viewportRelativeRect.top + pageOffset.getY() + (self.getHeight() * 0.5)\r\n        );\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _gridSize \r\n     * @returns {Point[]}\r\n     */\r\n    this.getRoutingPoints = function(_gridSize) {\r\n\r\n        const centroid = self.getCentroid();\r\n        const halfWidth = self.getWidth() * 0.5;\r\n        const halfHeight = self.getHeight() * 0.5;\r\n\r\n        return [\r\n            new Point(centroid.getX() + halfWidth + _gridSize, centroid.getY()),\r\n            new Point(centroid.getX() - halfWidth - _gridSize, centroid.getY()),\r\n            new Point(centroid.getX(), centroid.getY() + halfHeight + _gridSize),\r\n            new Point(centroid.getX(), centroid.getY() - halfHeight - _gridSize),\r\n        ];\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRectange = function() {\r\n        const centroid = self.getCentroid();\r\n        const halfWidth = self.getWidth() * 0.5;\r\n        const halfHeight = self.getHeight() * 0.5;\r\n\r\n        return new Rectangle(\r\n            centroid.getX() - halfWidth, \r\n            centroid.getY() - halfHeight, \r\n            centroid.getX() + halfWidth, \r\n            centroid.getY() + halfHeight\r\n        );\r\n    };\r\n};\r\n\r\nexport { ConnectorAnchor };\r\n","import  {ConnectorAnchor} from './ConnectorAnchor';\r\nimport {Line} from './Line';\r\n\r\n/**\r\n * \r\n * @param {ConnectorAnchor} _anchorStart \r\n * @param {ConnectorAnchor} _anchorEnd\r\n * @param {Element} _containerDomElement\r\n * @param {String} _strokeColor\r\n * @param {String} _strokeWidth\r\n */\r\nfunction Connector(_anchorStart, _anchorEnd, _containerDomElement, _strokeColor, _strokeWidth) {\r\n    \r\n    const self = this;\r\n\r\n    const eventNameToHandlerFunc = new Map();\r\n\r\n    const Event = {\r\n        CLICK: 'connector-click'\r\n    };\r\n\r\n    if(typeof _strokeColor === 'undefined') {\r\n        _strokeColor = '#000';\r\n    }\r\n\r\n    if(typeof _strokeWidth === 'undefined') {\r\n        _strokeWidth = '2px';\r\n    }\r\n\r\n    /**\r\n     * @type {Point[]|null}\r\n     */\r\n    let pathPoints = null;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    const pathElem = window.document.createElementNS(\"http://www.w3.org/2000/svg\", 'path');\r\n    pathElem.setAttribute(\"d\", 'M0 0 L0 0');\r\n    pathElem.style.stroke = _strokeColor; \r\n    pathElem.style.strokeWidth = _strokeWidth;         \r\n\r\n    pathElem.addEventListener(\"click\", function(e) {\r\n        const observers = eventNameToHandlerFunc.get(Event.CLICK) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\"connector\":self, \"clickedAtX\": e.pageX, \"clickedAtY\": e.pageY});\r\n        });\r\n    });\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    var svgDomElem = null;\r\n\r\n    this.appendPathToContainerDomElement = function() {\r\n        svgDomElem = _containerDomElement.appendChild(pathElem);\r\n    };\r\n\r\n    /**\r\n     * @returns {Point[]|null}\r\n     */\r\n    this.getPathPoints = function() {\r\n        return pathPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {Line[]}\r\n     */\r\n    this.getPathLines = function() {\r\n        if(pathPoints === null || pathPoints.length < 2) {\r\n            return [];\r\n        }\r\n\r\n        const lines = [];\r\n        for(let i=0; i<pathPoints.length-1; i++) {\r\n            lines.push(new Line(pathPoints[i], pathPoints[i+1]));\r\n        }\r\n\r\n        return lines;\r\n    };\r\n\r\n    /**\r\n     * @param {String} _svgPath\r\n     * @param {Point[]} _pathPoints\r\n     */\r\n    this.refresh = function(_svgPath, _pathPoints) {\r\n        pathPoints = _pathPoints;\r\n        pathElem.setAttribute(\"d\", _svgPath);\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        const anchorIds = [_anchorStart.getId(), _anchorEnd.getId()].sort();\r\n        return anchorIds.join(':');\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor}\r\n     */\r\n    this.getAnchorStart = function() {\r\n        return _anchorStart;\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.getAnchorEnd = function() {\r\n        return _anchorEnd;\r\n    };\r\n\r\n    this.removePathElement = function() {\r\n        pathElem.remove();\r\n    };\r\n\r\n    /**\r\n     * @param {String} _cl\r\n     * @returns {undefined}\r\n     */\r\n    this.addClassToDomElement = function(_cl) {\r\n        pathElem.classList.add(_cl);\r\n    };\r\n\r\n    /**\r\n     * @param {String} _cl\r\n     * @returns {undefined}\r\n     */    \r\n    this.removeClassFromDomElement = function(_cl) {\r\n        pathElem.classList.remove(_cl);\r\n    };\r\n\r\n    /**\r\n     * @returns {Object}\r\n     */\r\n    this.getDescriptor = function() {\r\n        return {\r\n            \"id\": self.getId(),\r\n            \"anchor_start_centroid\": _anchorStart.getCentroid().toString(),\r\n            \"anchor_end_centroid\": _anchorEnd.getCentroid().toString(),\r\n        };\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _handlerFunc \r\n     */\r\n    this.on = function(_eventName, _handlerFunc) {\r\n        const allHandlers = eventNameToHandlerFunc.get(_eventName) || [];\r\n        allHandlers.push(_handlerFunc);\r\n        eventNameToHandlerFunc.set(_eventName, allHandlers);        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };    \r\n};\r\n\r\nexport { Connector };\r\n","import {Point} from './Point';\r\nimport {Line} from './Line';\r\nimport {PointSet} from './PointSet';\r\nimport {LineSet} from './LineSet';\r\nimport  {LINE_INTERSECTION_TYPE, LineIntersection} from './LineIntersection';\r\n\r\n/**\r\n * \r\n * @param {PointSet} _freePoints\r\n * @param {LineSet} _boundaryLines\r\n */\r\nfunction PointVisibilityMap(_freePoints, _boundaryLines) {\r\n\r\n    const self = this;\r\n\r\n    const boundaryLinesArr = _boundaryLines.toArray();\r\n    const freePointsArr = _freePoints.toArray();\r\n    const pointToVisibleSet = new Array(_freePoints.count()); // index represents entry in freePointsArr\r\n\r\n    /**\r\n     * @param {Line} _theLine\r\n     * @returns {Boolean}\r\n     */\r\n    const doesLineIntersectAnyBoundaryLines = function(_theLine) {\r\n\r\n        for(let b=0; b<boundaryLinesArr.length; b++) {\r\n            const intersectionType = boundaryLinesArr[b].computeIntersectionType(_theLine);\r\n            if(intersectionType === LINE_INTERSECTION_TYPE.LINESEG) {\r\n                return true;\r\n            }\r\n        };\r\n\r\n        return false;\r\n    };\r\n\r\n    const computePointsVisibility = function() {\r\n        for(let i=0; i<freePointsArr.length; i++) {\r\n            pointToVisibleSet[i] = [];   \r\n        }\r\n\r\n        for(let i=0; i<freePointsArr.length; i++) {            \r\n            for(let j=i+1; j<freePointsArr.length; j++) {\r\n\r\n                // line representing line-of-sight between the 2 points\r\n                const ijLine = new Line(freePointsArr[i], freePointsArr[j]);\r\n\r\n                if(!doesLineIntersectAnyBoundaryLines(ijLine)) {\r\n                    pointToVisibleSet[i].push(freePointsArr[j]);\r\n                    pointToVisibleSet[j].push(freePointsArr[i]);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const getVisiblePointsFrom = function(_currentPoint) {\r\n        for(let i=0; i<freePointsArr.length; i++) {\r\n\r\n            if(freePointsArr[i].isEqual(_currentPoint)) {\r\n                const visiblePoints = pointToVisibleSet[i];\r\n                return visiblePoints;\r\n            }            \r\n        }\r\n\r\n        return [];\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _currentRouteLength \r\n     * @param {Point[]} _pointsInRoute \r\n     * @param {Point} _currentPoint \r\n     * @param {Point} _endPoint \r\n     * @returns {Object|null}\r\n     */\r\n    const routeToEndpoint = function(_currentRouteLength, _pointsInRoute, _currentPoint, _endPoint) {\r\n\r\n        var visiblePoints = getVisiblePointsFrom(_currentPoint);       \r\n        var curMinCost = Number.MAX_SAFE_INTEGER;\r\n        var visiblePointWithMinCost = null;\r\n\r\n        visiblePoints.forEach(function(_vp) {\r\n            // ignore point if it's already in the route\r\n            for(let i=0; i<_pointsInRoute.length; i++) {\r\n                if(_vp.isEqual(_pointsInRoute[i])) {\r\n                    return; // point already in route, try another\r\n                }\r\n            }\r\n\r\n            // g(n) = length/cost of _startPoint to _vp + _currentRouteLength\r\n            const gn = (new Line(_currentPoint, _vp)).getLength() + _currentRouteLength;\r\n\r\n            // h(n) = length/cost of _vp to _endPoint\r\n            const hn = (new Line(_vp, _endPoint)).getLength();\r\n\r\n            // see if this is the new min\r\n            if((gn + hn) < curMinCost) {\r\n                curMinCost = gn + hn;\r\n                visiblePointWithMinCost = _vp;\r\n            }\r\n        });\r\n\r\n        if(curMinCost === Number.MAX_SAFE_INTEGER) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            \"cost\": curMinCost,\r\n            \"point\": visiblePointWithMinCost\r\n        };\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Array} _pointsInRoute \r\n     */\r\n    const optimizeRoute = function(_pointsInRoute) {\r\n\r\n        let ptrA = 0;\r\n\r\n        while(true) {\r\n\r\n            if(ptrA+2 >= _pointsInRoute.length) {\r\n                break;\r\n            }            \r\n\r\n            const ln = new Line(_pointsInRoute[ptrA], _pointsInRoute[ptrA + 2]);\r\n\r\n            if(!doesLineIntersectAnyBoundaryLines(ln)) {\r\n                _pointsInRoute.splice(ptrA + 1, 1);\r\n            } else {\r\n                ptrA++;\r\n            }\r\n\r\n        }\r\n\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _point\r\n     * @returns {Point|null}\r\n     */\r\n    this.findPointClosestTo = function(_point) {\r\n        var resultPoint = null;\r\n        var currentMaxLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        freePointsArr.forEach(function(_ptKey) {\r\n            const lineOfSight = new Line(_point, _ptKey);\r\n            if(lineOfSight.getLength() < currentMaxLength) {\r\n                resultPoint = _ptKey;\r\n                currentMaxLength = lineOfSight.getLength();\r\n            }\r\n        });\r\n        \r\n        return resultPoint;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _point\r\n     * @returns {Point|null}\r\n     */\r\n    this.findVisiblePointClosestTo = function(_point) {\r\n\r\n        var resultPoint = null;\r\n        var currentMaxLength = Number.MAX_SAFE_INTEGER;\r\n\r\n        freePointsArr.forEach(function(_freePt) {\r\n\r\n            const lineOfSight = new Line(_point, _freePt);\r\n            const lineOfSightLength = lineOfSight.getLength();\r\n\r\n            if(lineOfSightLength < currentMaxLength && !doesLineIntersectAnyBoundaryLines(lineOfSight)) {\r\n                resultPoint = _freePt;\r\n                currentMaxLength = lineOfSightLength;\r\n            };\r\n\r\n        });\r\n        \r\n        return resultPoint;\r\n    };\r\n\r\n    /**\r\n     * @param {Point} _startPoint\r\n     * @param {Point} _endPoint\r\n     * \r\n     * @return {PointSet}\r\n     */\r\n    this.computeRoute = function(_startPoint, _endPoint) {\r\n\r\n        // if no valid startpoint or endpoint, we can't route\r\n        if(_startPoint === null || _endPoint === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        // find closest visible point \r\n        const firstRoutingPoint = self.findVisiblePointClosestTo(_startPoint);\r\n        if(firstRoutingPoint === null) {\r\n            return new PointSet();\r\n        }\r\n\r\n        var currentRouteLen = 0;\r\n        const pointsInRoute = [firstRoutingPoint];\r\n        var currentPoint = firstRoutingPoint;\r\n        while(true) {\r\n            const routeSegment = routeToEndpoint(currentRouteLen, pointsInRoute, currentPoint, _endPoint);\r\n            if(routeSegment === null) {\r\n\r\n                // Is there unobstructed line to endpoint? \r\n                // If not, failed to find route\r\n                const lastSegmentToEndpoint = new Line(pointsInRoute[pointsInRoute.length-1], _endPoint);\r\n                if(doesLineIntersectAnyBoundaryLines(lastSegmentToEndpoint)) {\r\n                    return new PointSet();\r\n                }\r\n\r\n                break;\r\n            }\r\n\r\n            currentRouteLen += (new Line(currentPoint, routeSegment.point)).getLength();\r\n            pointsInRoute.push(routeSegment.point);\r\n            currentPoint = routeSegment.point;\r\n\r\n            if((new Line(currentPoint, _endPoint).getLength()) < 1.0) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        optimizeRoute(pointsInRoute);\r\n\r\n        return new PointSet(pointsInRoute);\r\n\r\n    };\r\n\r\n    computePointsVisibility();\r\n};\r\n    \r\nexport { PointVisibilityMap };\r\n","const GRID_STYLE = {\r\n    LINE: 'line',\r\n    DOT: 'dot'\r\n};\r\n\r\n/**\r\n * \r\n * @param {Number} _size\r\n * @param {String} _color\r\n * @param {String} _style\r\n */\r\nfunction Grid(_size, _color, _style) {\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getSize = function() {\r\n        return _size;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getStyle = function() {\r\n        return _style;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getSvgImageTile = function() {\r\n        if(_style === GRID_STYLE.LINE) {\r\n            return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' + _size + '\" height=\"' + _size + '\"><rect width=\"' + _size + '\" height=\"1\" x=\"0\" y=\"' + (_size-1.0) + '\" style=\"fill:' + _color + '\" /><rect width=\"1\" height=\"' + _size + '\" x=\"' + (_size-1.0) + '\" y=\"0\" style=\"fill:' + _color + '\" /></svg>';\r\n        } else {\r\n            return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' + _size + '\" height=\"' + _size + '\"><rect width=\"1\" height=\"1\" x=\"' + (_size-1.0) + '\" y=\"' + (_size-1.0) + '\" style=\"fill:' + _color + '\" /></svg>';\r\n        }\r\n    };\r\n\r\n};\r\n    \r\nexport { GRID_STYLE, Grid };\r\n","import {MatrixMath} from './MatrixMath';\r\nimport  {CanvasObject} from './CanvasObject';\r\nimport  {Rectangle} from './Rectangle';\r\nimport  {Point} from './Point';\r\nimport  {Line} from './Line';\r\nimport  {PointSet} from './PointSet';\r\nimport  {LineSet} from './LineSet';\r\nimport  {Connector} from './Connector';\r\nimport  {PointVisibilityMap} from './PointVisibilityMap';\r\nimport  {GRID_STYLE, Grid} from './Grid';\r\n\r\n/**\r\n * @callback HandleCanvasInteractionCallback\r\n * @param {String} interactionType\r\n * @param {Object} interactionData\r\n */ \r\n\r\n /**\r\n * @param {Element} _canvasDomElement \r\n * @param {Window} _window\r\n * @param {Worker} _connectorRoutingWorker\r\n */\r\nfunction Canvas(_canvasDomElement, _window, _connectorRoutingWorker) {\r\n\r\n    const self = this;\r\n\r\n    const Event = {\r\n        DBLCLICK: \"dblclick\",\r\n        CLICK: \"click\",\r\n        OBJECT_ADDED: \"object-added\",\r\n        OBJECT_REMOVED: \"object-removed\",\r\n        OBJECT_RESIZED: \"object-resized\",\r\n        OBJECT_TRANSLATED: \"object-translated\"\r\n    };\r\n\r\n    // Create container for SVG connectors\r\n    const svgElem = _window.document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    svgElem.style.width = \"100%\";\r\n    svgElem.style.height = \"100%\";\r\n    const connectorsContainerDomElement = _canvasDomElement.appendChild(svgElem);\r\n   \r\n    /**\r\n     * @type {Grid}\r\n     */\r\n    var grid = null;\r\n\r\n    var transitionCss = \"transform 0.55s ease-in-out, transform-origin 0.55s ease-in-out\";\r\n\r\n    var transformOriginX = 0;\r\n    var transformOriginY = 0;\r\n\r\n    var translateX = 0;\r\n    var translateY = 0;\r\n    var scaleFactor = 1.0;\r\n    var invScaleFactor = 1.0;    \r\n\r\n    const invTransformationMatrixStack = [];\r\n    var currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n    var currentTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n\r\n    var currentPointVisiblityMap = null;\r\n\r\n    var useTranslate3d = false; // better performance w/o it\r\n    const canvasObjects = [];\r\n\r\n    /**\r\n     * @type {Connector[]}\r\n     */\r\n    const objectConnectors = [];\r\n\r\n    var objectIdBeingDragged = null;\r\n    var objectIdBeingResized = null;\r\n    \r\n    var objectDragX = 0.0;\r\n    var objectDragY = 0.0;\r\n    var objectDragStartX = 0.0;\r\n    var objectDragStartY = 0.0;\r\n\r\n    var dblTapDetectVars = {\r\n        lastTouchX: null,\r\n        lastTouchY: null,\r\n        lastTouchTime: null\r\n    };\r\n\r\n    const connectorAnchorsSelected = [];\r\n\r\n    /**\r\n     * Event name -> Callback map\r\n     */\r\n    const eventHandlers = new Map();\r\n\r\n    /**\r\n     * ConnectorAnchor -> Number map\r\n     */\r\n    const connectorAnchorToNumValidRoutingPoints = new Map();\r\n\r\n    /**\r\n     * @returns {PointVisibilityMap}\r\n     */\r\n    this.getCurrentPointVisibilityMap = function() {\r\n        return currentPointVisiblityMap;\r\n    };\r\n\r\n    /**\r\n     * @param {Grid} _grid\r\n     */\r\n    this.setGrid = function(_grid) {\r\n        grid = _grid;\r\n        _canvasDomElement.style.backgroundImage = \"url('data:image/svg+xml;base64,\" + _window.btoa(grid.getSvgImageTile()) + \"')\";\r\n        _canvasDomElement.style.backgroundRepeat = \"repeat\";\r\n        _canvasDomElement.style.backgroundColor = \"#fff\";\r\n    };\r\n\r\n    /**\r\n     * @returns {Grid}\r\n     */\r\n    this.getGrid = function() {\r\n        return grid;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getGridSize = function() {\r\n        return grid.getSize();\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {CanvasObject[]} _objs \r\n     * @returns {Point[]}\r\n     */\r\n    const getAccessibleRoutingPointsFromObjectAnchors = function(_objs) {\r\n\r\n        connectorAnchorToNumValidRoutingPoints.clear();\r\n\r\n        const allRoutingPoints = [];\r\n        const filteredRoutingPoints = [];\r\n\r\n        _objs.forEach((_o) => {\r\n            const anchors = _o.getConnectorAnchors();\r\n\r\n            anchors.forEach((_a) => {\r\n                const routingPoints = _a.getRoutingPoints(self.getGridSize());\r\n                routingPoints.forEach((_rp) => {\r\n                    allRoutingPoints.push(\r\n                        {\r\n                            \"routingPoint\": _rp,\r\n                            \"parentAnchor\": _a\r\n                        }\r\n                    );\r\n                });      \r\n\r\n                connectorAnchorToNumValidRoutingPoints.set(_a.getId(), routingPoints.length);\r\n            });\r\n\r\n        });\r\n\r\n\r\n        allRoutingPoints.forEach((_rp) => {\r\n\r\n            let isPointWithinObj = false;\r\n\r\n            for(let i=0; i<_objs.length; i++) {\r\n                const obj = _objs[i];\r\n                const boundingRect = obj.getBoundingRectange();\r\n                if(boundingRect.checkIsPointWithin(_rp.routingPoint)) {\r\n                    isPointWithinObj = true;\r\n\r\n                    const currentNumRoutingPoints = connectorAnchorToNumValidRoutingPoints.get(_rp.parentAnchor.getId()) || 0;\r\n                    connectorAnchorToNumValidRoutingPoints.set(_rp.parentAnchor.getId(), currentNumRoutingPoints - 1);\r\n                }\r\n            }\r\n\r\n            if(!isPointWithinObj) {\r\n                filteredRoutingPoints.push(_rp.routingPoint);\r\n            }\r\n            \r\n        });\r\n\r\n        return filteredRoutingPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {PointSet}\r\n     */\r\n    const getObjectExtentRoutingPoints = function() {\r\n        const pointSet = new PointSet();\r\n        canvasObjects.forEach(function(_obj) {\r\n            const scaledPoints = _obj.getBoundingRectange().getPointsScaledToGrid(self.getGridSize());\r\n            scaledPoints.forEach((_sp) => {\r\n                pointSet.push(_sp);\r\n            });\r\n        });\r\n\r\n        return pointSet;\r\n    };\r\n\r\n    /**\r\n     * @returns {PointSet}\r\n     */    \r\n    const getConnectorRoutingPointsAroundAnchor = function() {\r\n        const pointSet = new PointSet();\r\n        \r\n        const routingPoints = getAccessibleRoutingPointsFromObjectAnchors(canvasObjects);\r\n        routingPoints.forEach((_rp) => {\r\n            pointSet.push(_rp);\r\n        });\r\n\r\n        return pointSet;\r\n    };\r\n\r\n    /**\r\n     * @returns {Line[]}\r\n     */    \r\n    const getConnectorBoundaryLines = function() {\r\n        const boundaryLines = [];\r\n        canvasObjects.forEach(function(_obj) {\r\n            const lines = _obj.getBoundingRectange().getLines();\r\n            lines.forEach((_l) => {\r\n                boundaryLines.push(_l);\r\n            });\r\n\r\n            const anchors = _obj.getConnectorAnchors();\r\n            anchors.forEach(function(_anchor) {\r\n                const lines = _anchor.getBoundingRectange().getLines();\r\n                lines.forEach((_l) => {\r\n                    boundaryLines.push(_l);\r\n                });                \r\n            });\r\n        });\r\n\r\n        return new LineSet(boundaryLines);\r\n    };    \r\n\r\n    const refreshAllConnectors = function() {\r\n        const connectorDescriptors = [];\r\n        objectConnectors.forEach(function(_c) {\r\n            connectorDescriptors.push(_c.getDescriptor());\r\n        });\r\n\r\n        const routingPointsAroundAnchor = getConnectorRoutingPointsAroundAnchor();\r\n        const objectExtentRoutingPoints = getObjectExtentRoutingPoints();\r\n\r\n        const allRoutingPoints = new PointSet();        \r\n        allRoutingPoints.pushPointSet(routingPointsAroundAnchor);\r\n        allRoutingPoints.pushPointSet(objectExtentRoutingPoints);\r\n\r\n        const routingPointsAroundAnchorFloat64Array = routingPointsAroundAnchor.toFloat64Array();\r\n        const routingPointsFloat64Array = allRoutingPoints.toFloat64Array();\r\n        const boundaryLinesFloat64Array = (getConnectorBoundaryLines()).toFloat64Array();\r\n        _connectorRoutingWorker.postMessage(\r\n            {\r\n                \"gridSize\": self.getGridSize(),\r\n                \"connectorDescriptors\": connectorDescriptors,\r\n                \"routingPoints\": routingPointsFloat64Array.buffer,\r\n                \"boundaryLines\": boundaryLinesFloat64Array.buffer,\r\n                \"routingPointsAroundAnchor\": routingPointsAroundAnchorFloat64Array.buffer\r\n            },\r\n            [\r\n                routingPointsFloat64Array.buffer,\r\n                boundaryLinesFloat64Array.buffer,\r\n                routingPointsAroundAnchorFloat64Array.buffer\r\n            ]\r\n        );\r\n    };\r\n\r\n    _connectorRoutingWorker.onmessage = function(_msg) {\r\n        const connectorDescriptors = _msg.data.connectorDescriptors;\r\n        const getConnectorDescriptorById = function(_id) {\r\n            for(let i=0; i<connectorDescriptors.length; i++) {\r\n                if(connectorDescriptors[i].id === _id) {\r\n                    return connectorDescriptors[i];\r\n                }\r\n            }\r\n\r\n            return null;\r\n        };\r\n\r\n        objectConnectors.forEach(function(_c) {\r\n            const descriptor = getConnectorDescriptorById(_c.getId());\r\n            if(descriptor) {\r\n                const ps = new PointSet(new Float64Array(descriptor.pointsInPath));\r\n                _c.refresh(descriptor.svgPath, ps.toArray());\r\n            }\r\n        });\r\n    };\r\n\r\n    var makeNewConnector = function(_anchorStart, _anchorEnd, _containerDomElement) {\r\n        return new Connector(_anchorStart, _anchorEnd, _containerDomElement);\r\n    };\r\n\r\n    /**\r\n     * @callback ConnectorFactory\r\n     * @param {ConnectorAnchor} _anchorStart\r\n     * @param {ConnectorAnchor} _anchorEnd\r\n     * @param {Element} _containerDomElement\r\n     */\r\n\r\n    /**\r\n     * @param {ConnectorFactory} _connectorFactory\r\n     */\r\n    this.setConnectorFactory = function(_newConnectorFactory) {\r\n        makeNewConnector = _newConnectorFactory;\r\n    };    \r\n\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getTransitionCss = function() {\r\n        return transitionCss;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {String} _css \r\n     */\r\n    this.setTransitionCss = function(_css) {\r\n        transitionCss = _css;\r\n        _canvasDomElement.style.transition = transitionCss;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTransformOriginX = function() {\r\n        return transformOriginX;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTransformOriginY = function() {\r\n        return transformOriginY;\r\n    };    \r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getScaleFactor = function() {\r\n        return scaleFactor;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getTranslateX = function() {\r\n        return translateX;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */    \r\n    this.getTranslateY = function() {\r\n        return translateY;\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    this.setTransformOrigin = function(_x, _y) {\r\n        transformOriginX = _x;\r\n        transformOriginY = _y;\r\n        _canvasDomElement.style.transformOrigin = `${transformOriginX}px ${transformOriginY}px`;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _scaleFactor \r\n     * @param {Boolean} _adjustFactorToPreserveIntegerGrid \r\n     */\r\n    this.scale = function(_scaleFactor, _adjustFactorToPreserveIntegerGrid) {\r\n        _adjustFactorToPreserveIntegerGrid = _adjustFactorToPreserveIntegerGrid || false;\r\n\r\n        if(_adjustFactorToPreserveIntegerGrid) {\r\n            const newGridSize = self.getGridSize() * _scaleFactor;\r\n            const roundedGridSize = Math.round(newGridSize);\r\n            _scaleFactor = roundedGridSize / self.getGridSize();\r\n        }\r\n\r\n        scaleFactor = _scaleFactor;\r\n        invScaleFactor = 1.0 / scaleFactor;        \r\n\r\n        const scaleMat = \r\n            [\r\n                scaleFactor, 0, 0, 0, \r\n                0, scaleFactor, 0, 0, \r\n                0, 0, scaleFactor, 1, \r\n                0, 0, 0, 1\r\n            ];\r\n\r\n        currentTransformationMatrix = MatrixMath.mat4Multiply(\r\n            currentTransformationMatrix, \r\n            scaleMat\r\n        );\r\n\r\n        invTransformationMatrixStack.push(\r\n            [\r\n                invScaleFactor, 0, 0, 0, \r\n                0, invScaleFactor, 0, 0, \r\n                0, 0, invScaleFactor, 1, \r\n                0, 0, 0, 1\r\n            ]\r\n        );\r\n\r\n        return self;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    this.translate = function(_x, _y) {\r\n        translateX = _x;\r\n        translateY = _y;\r\n\r\n        const translateMatrix =             \r\n            [\r\n                1, 0, 0, 0, \r\n                0, 1, 0, 0, \r\n                0, 0, 1, 0, \r\n                translateX, translateY, 0, 1\r\n            ];\r\n\r\n        currentTransformationMatrix = MatrixMath.mat4Multiply(\r\n            currentTransformationMatrix, \r\n            translateMatrix\r\n        ); \r\n\r\n        invTransformationMatrixStack.push(\r\n            [\r\n                1, 0, 0, -translateX, \r\n                0, 1, 0, -translateY, \r\n                0, 0, 1, 0, \r\n                0, 0, 0, 1\r\n            ]\r\n        );\r\n\r\n        return self;\r\n    };\r\n\r\n    this.applyTransform = function() {\r\n        const matElems = currentTransformationMatrix.join(\",\");\r\n        _canvasDomElement.style.transform = `matrix3d(${matElems})`;\r\n\r\n        currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        for(let i=0; i<invTransformationMatrixStack.length; i++) {\r\n            currentInvTransformationMatrix = MatrixMath.mat4Multiply(currentInvTransformationMatrix, invTransformationMatrixStack[i]);\r\n        }\r\n    };\r\n\r\n    this.resetTransform = function() {\r\n        scaleFactor = 1.0;\r\n        invScaleFactor = 1.0;\r\n        translateX = 0.0;\r\n        translateY = 0.0;\r\n        currentTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        currentInvTransformationMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n        invTransformationMatrixStack.length = 0;\r\n        _canvasDomElement.style.transform = \"none\";\r\n    };\r\n\r\n    /**\r\n     * @returns {Point}\r\n     */\r\n    this.getPageOffset = function() {\r\n        return new Point(window.pageXOffset, window.pageYOffset);\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _p \r\n     * @returns {Number}\r\n     */\r\n    this.snapToGrid = function(_p) {\r\n        var ret = Math.round(_p/self.getGridSize()) * self.getGridSize();\r\n        return Math.max(0, ret - 1);\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getOffsetLeft = function() {\r\n        return _canvasDomElement.offsetLeft;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getOffsetTop = function() {\r\n        return _canvasDomElement.offsetTop;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        return _canvasDomElement.offsetWidth;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        return _canvasDomElement.offsetHeight;\r\n    };    \r\n\r\n    /**\r\n     * @param {Number} _x\r\n     * @param {Number} _y\r\n     * @param {Number} _radius\r\n     * @returns {CanvasObject[]}\r\n     */\r\n    this.getObjectsAroundPoint = function(_x, _y, _radius) {\r\n\r\n        _radius = _radius || 1.0;\r\n\r\n        const result = [];\r\n\r\n        const ptRect = new Rectangle(\r\n            _x - _radius, \r\n            _y - _radius, \r\n            _x + _radius, \r\n            _y + _radius\r\n        );\r\n\r\n        canvasObjects.forEach(function(_obj) {\r\n            if(!_obj.getIsDeleted() && ptRect.checkIntersect(_obj.getBoundingRectange())) {\r\n                result.push(_obj);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n    \r\n    /**\r\n     * @returns {Rectangle}\r\n     */\r\n    this.calcBoundingBox = function() {\r\n\r\n        var minTop = null;\r\n        var minLeft = null;\r\n        var maxBottom = null;\r\n        var maxRight = null;\r\n\r\n        canvasObjects.forEach(function(element, index, array) {\r\n\r\n            var left = parseInt(element.getX());\r\n            var top = parseInt(element.getY());  \r\n            var right = left + parseInt(element.getWidth());\r\n            var bottom = top + parseInt(element.getHeight());  \r\n\r\n            if(minLeft === null || left < minLeft) {\r\n                minLeft = left;\r\n            }\r\n\r\n            if(minTop === null || top < minTop) {\r\n                minTop = top;\r\n            }\r\n\r\n            if(maxBottom === null || bottom > maxBottom) {\r\n                maxBottom = bottom;\r\n            }        \r\n\r\n            if(maxRight === null || right > maxRight) {\r\n                maxRight = right;\r\n            }              \r\n\r\n        }); \r\n\r\n        return new Rectangle(minLeft, minTop, maxRight, maxBottom);\r\n    };\r\n  \r\n    /**\r\n     * @returns {CanvasObject[]}\r\n     */\r\n    this.getAllObjects = function() {    \r\n        return canvasObjects;\r\n    };\r\n\r\n    /**\r\n     * Helper method to publish an object change to all objects\r\n     * \r\n     * @param {String} _eventName\r\n     * @param {*} _eventData\r\n     */\r\n    this.publishSiblingObjectChange = function(_eventName, _eventData) {\r\n        canvasObjects.forEach(function(_obj) {\r\n            _obj.handleSiblingObjectChange(_eventName, _eventData);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {CanvasObject|null}\r\n     */   \r\n    this.getObjectById = function(_id) {\r\n        var foundObject = null;\r\n        canvasObjects.forEach(function(obj, index, array) {\r\n            if(foundObject === null && obj.getId() === _id) {\r\n                foundObject = obj;\r\n            }            \r\n        });\r\n        \r\n        return foundObject;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _obj\r\n     */\r\n    this.addObject = function(_obj) {\r\n        _obj.on('obj-resize-start', handleResizeStart);\r\n        _obj.on('obj-resize', function(e) {\r\n            emitEvent(Event.OBJECT_RESIZED, { 'object': e.obj });\r\n            refreshAllConnectors();    \r\n        });\r\n\r\n        _obj.on('obj-translate-start', handleMoveStart);\r\n        _obj.on('obj-translate', function(e) {\r\n            emitEvent(Event.OBJECT_TRANSLATED, { 'object': e.obj });\r\n            refreshAllConnectors();    \r\n        });\r\n\r\n        canvasObjects.push(_obj);\r\n        refreshAllConnectors();       \r\n\r\n        emitEvent(Event.OBJECT_ADDED, { \"object\":_obj });\r\n    };\r\n\r\n    /**\r\n     * Remove object from the canvas\r\n     * Note: as caller is responsible for putting object into the DOM, caller is responsible for removing it from the DOM\r\n     * \r\n     * @param {String} _objId\r\n     * @returns {Boolean} \r\n     */\r\n    this.removeObject = function(_objId) {\r\n        for(let i=0; i<canvasObjects.length; i++) {\r\n            if(canvasObjects[i].getId() === _objId) {\r\n                canvasObjects.splice(i, 1);\r\n                refreshAllConnectors();\r\n                emitEvent(Event.OBJECT_REMOVED, { \"object\":canvasObjects[i] });\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Connector|null}\r\n     */    \r\n    this.getConnector = function(_id) {\r\n        for(let c=0; c<objectConnectors.length; c++) {\r\n            if(objectConnectors[c].getId() === _id) {\r\n                return objectConnectors[c];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @returns {Connector[]}\r\n     */\r\n    this.getAllConnectors = function() {\r\n        return objectConnectors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {CanvasObject} _objA \r\n     * @param {CanvasObject} _objB \r\n     * @returns {Connector[]}\r\n     */\r\n    this.getConnectorsBetweenObjects = function(_objA, _objB) {\r\n\r\n        const foundConnectors = [];\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            if(_objA.hasConnectorAnchor(aS) && _objB.hasConnectorAnchor(aE)) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n\r\n            if(_objA.hasConnectorAnchor(aE) && _objB.hasConnectorAnchor(aS)) {\r\n                foundConnectors.push(_conn);\r\n            }            \r\n        });\r\n\r\n        return foundConnectors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _connectorId\r\n     * @returns {Array} \r\n     */\r\n    this.getObjectsConnectedViaConnector = function(_connectorId) {\r\n        const foundObjects = [];\r\n\r\n        const allObjs = self.getAllObjects();\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n\r\n            if(_conn.getId() !== _connectorId) {\r\n                return;\r\n            }\r\n\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            allObjs.forEach((_o) => {\r\n                if(_o.hasConnectorAnchor(aS) || _o.hasConnectorAnchor(aE)) {\r\n                    foundObjects.push(_o);\r\n                }\r\n            });\r\n\r\n        });\r\n\r\n        return foundObjects;        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {CanvasObject} _obj\r\n     * @returns {Connector[]} \r\n     */\r\n    this.getConnectorsConnectedToObject = function(_obj) {\r\n        const foundConnectors = [];\r\n\r\n        objectConnectors.forEach((_conn) => {\r\n            const aS = _conn.getAnchorStart();\r\n            const aE = _conn.getAnchorEnd();\r\n\r\n            if(_obj.hasConnectorAnchor(aS) || _obj.hasConnectorAnchor(aE)) {\r\n                foundConnectors.push(_conn);\r\n            }\r\n\r\n        });\r\n\r\n        return foundConnectors;        \r\n    };\r\n\r\n    /**\r\n     * @param {String} _connectorAnchorId\r\n     * @returns {Object|null} \r\n     */\r\n    this.getObjectWithConnectorAnchor = function(_connectorAnchorId) {\r\n        const allObjects = self.getAllObjects();\r\n        for(let i=0; i<allObjects.length; i++) {                \r\n            const anchors = allObjects[i].getConnectorAnchors();\r\n            for(let j=0; j<anchors.length; j++) {\r\n                if(anchors[j].getId() === _connectorAnchorId) {\r\n                    return allObjects[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };    \r\n\r\n    this.removeAllConnectors = function() {\r\n        objectConnectors.forEach(function(_conn) {\r\n            _conn.removePathElement();\r\n        });\r\n\r\n        objectConnectors.splice(0, objectConnectors.length);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Connector} _connector\r\n     * @returns {Boolean}\r\n     */\r\n    this.removeConnector = function(_connector) {\r\n        for(let i=0; i<objectConnectors.length; i++) {\r\n            if(objectConnectors[i] === _connector) {\r\n                _connector.removePathElement();\r\n                objectConnectors.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {ConnectorAnchor} _anchorA \r\n     * @param {ConnectorAnchor} _anchorB \r\n     * @returns {Connector}\r\n     */\r\n    this.makeNewConnectorFromAnchors = function(_anchorA, _anchorB) {\r\n        const newConnector = makeNewConnector(_anchorA, _anchorB, connectorsContainerDomElement);\r\n        const foundConnector = self.getConnector(newConnector.getId());\r\n\r\n        if(foundConnector === null) {\r\n            objectConnectors.push(newConnector);\r\n            newConnector.appendPathToContainerDomElement();\r\n            refreshAllConnectors();\r\n            return newConnector;\r\n        }\r\n\r\n        return foundConnector;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _objA \r\n     * @param {Object} _objB\r\n     * @returns {Object} \r\n     */\r\n    this.findBestConnectorAnchorsToConnectObjects = function(_objA, _objB, _onFound) {\r\n\r\n        const searchFunc = (_searchData) => {\r\n            const objAConnectorAnchors = _searchData.objectA.getConnectorAnchors();\r\n            const objBConnectorAnchors = _searchData.objectB.getConnectorAnchors();\r\n    \r\n            var startAnchorIdxWithMinDist = 0;\r\n            var endAnchorIdxWithMinDist = 0;\r\n            var minDist = Number.MAX_VALUE;\r\n            \r\n            // Find best anchor element to connect startNote and endNote            \r\n            // Find anchors that produce shortest straight line distance\r\n            for(let x=0; x<objAConnectorAnchors.length; x++) {\r\n\r\n                const objANumValidRoutingPoints = connectorAnchorToNumValidRoutingPoints.get(objAConnectorAnchors[x].getId()) || 0;\r\n                if(objANumValidRoutingPoints === 0) {\r\n                    continue;\r\n                }\r\n\r\n                for(let y=0; y<objBConnectorAnchors.length; y++) {\r\n                    const aCentroid = objAConnectorAnchors[x].getCentroid();\r\n                    const bCentroid = objBConnectorAnchors[y].getCentroid();\r\n                    \r\n                    const d = Math.sqrt(Math.pow(bCentroid.getX()-aCentroid.getX(),2) + Math.pow(bCentroid.getY()-aCentroid.getY(),2));\r\n                    const objBNumValidRoutingPoints = connectorAnchorToNumValidRoutingPoints.get(objBConnectorAnchors[y].getId()) || 0;\r\n                    \r\n                    if(d < minDist && objBNumValidRoutingPoints > 0) {\r\n                        startAnchorIdxWithMinDist = x;\r\n                        endAnchorIdxWithMinDist = y;\r\n                        minDist = d;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            _searchData.cb(\r\n                {\r\n                    \"objectAAnchorIndex\": startAnchorIdxWithMinDist,\r\n                    \"objectAAnchor\": objAConnectorAnchors[startAnchorIdxWithMinDist],\r\n                    \"objectBAnchorIndex\": endAnchorIdxWithMinDist,\r\n                    \"objectBAnchor\": objBConnectorAnchors[endAnchorIdxWithMinDist],\r\n                }\r\n            );\r\n        };\r\n\r\n\r\n        setTimeout(function() {\r\n            searchFunc(\r\n                {\r\n                    \"objectA\": _objA,\r\n                    \"objectB\": _objB,\r\n                    \"cb\": _onFound\r\n                }\r\n            );\r\n        }, 10);\r\n    };\r\n\r\n    /**\r\n     * @param {ConnectorAnchor} _anchor\r\n     */\r\n    this.addConnectionAnchorToSelectionStack = function(_anchor) {\r\n        connectorAnchorsSelected.push(_anchor);\r\n\r\n        if(connectorAnchorsSelected.length === 2) {\r\n            self.makeNewConnectorFromAnchors(connectorAnchorsSelected[0], connectorAnchorsSelected[1]);\r\n            connectorAnchorsSelected.length = 0;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _posX \r\n     * @param {Number} _posY \r\n     */\r\n    const dblClickTapHandler = function(_posX, _posY) {\r\n        const objectsAroundPoint = self.getObjectsAroundPoint(_posX, _posY);\r\n\r\n        const eventData = {\r\n            'targetPoint': new Point(_posX, _posY),\r\n            'objectsAroundPoint': objectsAroundPoint\r\n        };\r\n\r\n        emitEvent(Event.DBLCLICK, eventData);\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _dblTapSpeed\r\n     * @param {Number} _dblTapRadius\r\n     */\r\n    this.initInteractionHandlers = function(_dblTapSpeed, _dblTapRadius) {\r\n\r\n        // dblclick on empty area of canvas\r\n        _canvasDomElement.addEventListener('dblclick', function (e) {\r\n\r\n            const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                [e.pageX, e.pageY, 0, 1],\r\n                currentInvTransformationMatrix\r\n            );\r\n\r\n            dblClickTapHandler(invTransformedPos[0], invTransformedPos[1]);\r\n        });\r\n\r\n        // click anywhere on canvas\r\n        _canvasDomElement.addEventListener('click', function (e) {\r\n            let canvasObjectClicked = false;\r\n            if(e.target !== _canvasDomElement) {\r\n                canvasObjectClicked = true;\r\n            }\r\n\r\n            const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                [e.pageX, e.pageY, 0, 1],\r\n                currentInvTransformationMatrix\r\n            );\r\n\r\n            const eventData = {\r\n                'targetPoint': new Point(invTransformedPos[0], invTransformedPos[1]),\r\n                'canvasObjectClicked': canvasObjectClicked\r\n            };\r\n    \r\n            emitEvent(Event.CLICK, eventData);\r\n        });\r\n\r\n        // touchend on canvas, logic to see if there was a double-tap\r\n        _canvasDomElement.addEventListener('touchend', function(e) {\r\n            if(e.changedTouches.length <= 0) {\r\n                return false; // we have nothing to work with\r\n            }\r\n\r\n            var dblTapDetected = false;  // flag specifying if we detected a double-tap\r\n\r\n            // Position of the touch\r\n            const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                [e.changedTouches[0].pageX, e.changedTouches[0].pageY, 0, 1],\r\n                currentInvTransformationMatrix\r\n            );            \r\n\r\n            var x = invTransformedPos[0];\r\n            var y = invTransformedPos[1];            \r\n\r\n            var now = new Date().getTime();\r\n\r\n            // Check if we have stored data for a previous touch (indicating we should test for a double-tap)\r\n            if(dblTapDetectVars.lastTouchTime !== null) {\r\n\r\n                var lastTouchTime = dblTapDetectVars.lastTouchTime;\r\n\r\n                // Compute time since the previous touch\r\n                var timeSinceLastTouch = now - lastTouchTime;\r\n\r\n                // Get the position of the last touch on the element\r\n                var lastX = dblTapDetectVars.lastTouchX;\r\n                var lastY = dblTapDetectVars.lastTouchY;\r\n\r\n                // Compute the distance from the last touch on the element\r\n                var distFromLastTouch = Math.sqrt( Math.pow(x-lastX,2) + Math.pow(y-lastY,2) );\r\n\r\n                if(timeSinceLastTouch <= _dblTapSpeed && distFromLastTouch <= _dblTapRadius) {\r\n                    // Flag that we detected a double tap\r\n                    dblTapDetected = true;\r\n\r\n                    // Call handler\r\n                    dblClickTapHandler(x, y);\r\n\r\n                    // Remove last touch info from element\r\n                    dblTapDetectVars.lastTouchTime = null;\r\n                    dblTapDetectVars.lastTouchX = null;\r\n                    dblTapDetectVars.lastTouchY = null;\r\n                }\r\n            }\r\n\r\n            if(!dblTapDetected) {\r\n                dblTapDetectVars.lastTouchTime = now;\r\n                dblTapDetectVars.lastTouchX = x;\r\n                dblTapDetectVars.lastTouchY = y;\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Object} _e \r\n     */\r\n    const handleResizeStart = function(_e) {       \r\n        objectIdBeingResized = _e.obj.getId();\r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Object} _e\r\n     */\r\n    const handleMoveStart = function(_e) {     \r\n        objectIdBeingDragged = _e.obj.getId();\r\n        objectDragX = _e.x;\r\n        objectDragY = _e.y;\r\n        objectDragStartX = _e.x;\r\n        objectDragStartY = _e.y;        \r\n    };    \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    const handleMove = function(_x, _y) {\r\n        const obj = self.getObjectById(objectIdBeingDragged);\r\n        const translateOffset = obj.getTranslateHandleOffset();\r\n        const mx = self.snapToGrid(_x + translateOffset.getX());\r\n        const my = self.snapToGrid(_y + translateOffset.getY());\r\n        \r\n        objectDragX = mx;\r\n        objectDragY = my;\t\t\r\n\r\n        obj.translate(mx, my);\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */\r\n    const handleMoveEnd = function(_x, _y) {\r\n        const obj = self.getObjectById(objectIdBeingDragged);\r\n        const translateOffset = obj.getTranslateHandleOffset();\r\n        const mx = self.snapToGrid(_x + translateOffset.getX());\r\n        const my = self.snapToGrid(_y + translateOffset.getY());\r\n\r\n        const mxStart = objectDragStartX;\r\n        const myStart = objectDragStartY;\r\n\r\n        if(mxStart == mx && myStart == my) {\r\n            // we didn't drag it anywhere\r\n        } else {\r\n            obj.translate(mx, my);       \r\n        }\r\n    };         \r\n\r\n    /**\r\n     * \r\n     * @param {Number} _x \r\n     * @param {Number} _y \r\n     */    \r\n    const handleResize = function(_x, _y) {\r\n        const obj = self.getObjectById(objectIdBeingResized);\r\n\r\n        const mx = self.snapToGrid(_x);\r\n        const my = self.snapToGrid(_y);\r\n\r\n        const top = obj.getY();\r\n        const left = obj.getX();\r\n        const newWidth = ((mx - left)+1);\r\n        const newHeight = ((my - top)+1);\r\n\r\n        obj.resize(newWidth, newHeight);\r\n    };\r\n\r\n    this.initTransformationHandlers = function() {\r\n        \r\n        _canvasDomElement.addEventListener('touchmove', function (e) {\r\n            if (objectIdBeingDragged !== null) {\r\n\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.touches[0].pageX, e.touches[0].pageY, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleMove(invTransformedPos[0], invTransformedPos[1]);       \r\n\r\n                // if we're transforming an object, make sure we don't scroll the canvas\r\n                e.preventDefault();\r\n            }\r\n\r\n\r\n            if(objectIdBeingResized !== null) {\r\n\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.touches[0].pageX, e.touches[0].pageY, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );     \r\n\r\n                handleResize(invTransformedPos[0], invTransformedPos[1]);\r\n\r\n                e.preventDefault();\r\n            }            \r\n\r\n        });\r\n\r\n        _canvasDomElement.addEventListener('mousemove', function (e) {\r\n            if (objectIdBeingDragged !== null) {\t\t\r\n                \r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.pageX, e.pageY, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );                    \r\n\r\n                handleMove(invTransformedPos[0], invTransformedPos[1]);\r\n            }\r\n\r\n            if(objectIdBeingResized !== null) {\r\n\r\n                const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                    [e.pageX, e.pageY, 0, 1],\r\n                    currentInvTransformationMatrix\r\n                );     \r\n\r\n                handleResize(invTransformedPos[0], invTransformedPos[1]);\r\n            }\r\n        });\r\n\r\n        _canvasDomElement.addEventListener('touchend', function (e) {\r\n\r\n            // e.touches is empty..\r\n            // Need to use e.changedTouches for final x,y ???\r\n\r\n            if(objectIdBeingDragged !== null) {\r\n                objectIdBeingDragged = null;\r\n            }           \r\n            \r\n            if(objectIdBeingResized !== null) {\r\n                objectIdBeingResized = null;  \r\n            }\r\n        });\r\n\r\n        _canvasDomElement.addEventListener('mouseup', function (e) {\r\n            if (e.which === 1) {\r\n                if(objectIdBeingDragged !== null) {\r\n\r\n                    const invTransformedPos = MatrixMath.vecMat4Multiply(\r\n                        [e.pageX, e.pageY, 0, 1],\r\n                        currentInvTransformationMatrix\r\n                    );                      \r\n\r\n                    handleMoveEnd(invTransformedPos[0], invTransformedPos[1]);\r\n                }            \r\n\r\n                if(objectIdBeingResized !== null) {\r\n                }\r\n\r\n                objectIdBeingDragged = null;\r\n                objectIdBeingResized = null;\r\n            }\r\n        });  \r\n\r\n        _canvasDomElement.addEventListener('mousedown', function (e) {\r\n            if(objectIdBeingDragged !== null || objectIdBeingResized !== null) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n        });\r\n    };\r\n\r\n    const emitEvent = function(_eventName, _eventData) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            const cbFunc = allCallbacks[i];\r\n            cbFunc(_eventData);\r\n        }\r\n    };\r\n\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    this.on = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n        allCallbacks.push(_callback);\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    self.setGrid(new Grid(12.0, '#424242', GRID_STYLE.DOT));\r\n    self.resetTransform();\r\n    self.setTransformOrigin(0, 0);\r\n    self.setTransitionCss(transitionCss);\r\n};\r\n\r\nexport { Canvas };\r\n","import {Point} from './Point';\r\nimport {Rectangle} from './Rectangle';\r\nimport {Canvas} from './Canvas';\r\nimport {ConnectorAnchor} from './ConnectorAnchor';\r\n\r\n/**\r\n * \r\n * @param {String} _id\r\n * @param {Number} _x\r\n * @param {Number} _y\r\n * @param {Number} _width\r\n * @param {Number} _height\r\n * @param {Canvas} _canvas\r\n * @param {Element} _domElement\r\n * @param {Element[]} _translateHandleDomElements\r\n * @param {Element[]} _resizeHandleDomElements\r\n */\r\nfunction CanvasObject(_id, _x, _y, _width, _height, _canvas, _domElement, _translateHandleDomElements, _resizeHandleDomElements) {\r\n\r\n    const self = this;\r\n\r\n    const MOUSE_MIDDLE_BUTTON = 1;\r\n\r\n    /**\r\n     * @type {ConnectorAnchor[]}\r\n     */\r\n    const connectorAnchors = [];\r\n\r\n    /**\r\n     * @type {Number}\r\n     */\r\n    var nextConnectorAnchorIdSuffix = 1000;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    var currentTranslateHandleElementActivated = null;\r\n\r\n    /**\r\n     * @type {Element}\r\n     */\r\n    var currentResizeHandleElementActivated = null;\r\n\r\n    const Event = {\r\n        TRANSLATE_START: 'obj-translate-start',\r\n        TRANSLATE: 'obj-translate',\r\n        RESIZE_START: 'obj-resize-start',\r\n        RESIZE: 'obj-resize'\r\n    };\r\n\r\n    const eventNameToHandlerFunc = new Map();\r\n\r\n    this.x = parseInt(_x);\r\n    this.y = parseInt(_y);\r\n    this.width = parseInt(_width);\r\n    this.height = parseInt(_height);\r\n\r\n    /**\r\n     * @deprecated this should no longer be used to indicate to a Canvas that the object is deleted\r\n     */\r\n    this.isDeleted = false;\r\n\r\n    /**\r\n     * @param {Element} _connectorAnchorDomElement\r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.addNonInteractableConnectorAnchor = function(_connectorAnchorDomElement) {\r\n        const newAnchor = new ConnectorAnchor(_id + `-${nextConnectorAnchorIdSuffix}`, _connectorAnchorDomElement, _canvas);\r\n        connectorAnchors.push(newAnchor);\r\n        nextConnectorAnchorIdSuffix++;\r\n        return newAnchor;\r\n    };\r\n\r\n    /**\r\n     * @param {Element} _connectorAnchorDomElement\r\n     * @returns {ConnectorAnchor}\r\n     */    \r\n    this.addInteractableConnectorAnchor = function(_connectorAnchorDomElement) {     \r\n        const anchor = new ConnectorAnchor(_id + `-${nextConnectorAnchorIdSuffix}`, _connectorAnchorDomElement, _canvas);\r\n\r\n        _connectorAnchorDomElement.addEventListener('click', function(e) {\r\n            _canvas.addConnectionAnchorToSelectionStack(anchor);\r\n        });\r\n\r\n        connectorAnchors.push(anchor);\r\n        nextConnectorAnchorIdSuffix++;\r\n        return anchor;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Number} _gridSize \r\n     * @returns {Point[]}\r\n     */\r\n    this.getConnectorAnchorRoutingPoints = function(_gridSize) {\r\n        const allRoutingPoints = [];\r\n        connectorAnchors.forEach(function(_anchor) {\r\n            const anchorPoints = _anchor.getRoutingPoints(_gridSize);\r\n            anchorPoints.forEach(function(_pt) {\r\n                allRoutingPoints.push(_pt);\r\n            });\r\n        });\r\n\r\n        return allRoutingPoints;\r\n    };\r\n\r\n    /**\r\n     * @returns {ConnectorAnchor[]}\r\n     */\r\n    this.getConnectorAnchors = function() {\r\n        return connectorAnchors;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {ConnectorAnchor} _anchor \r\n     * @returns {Boolean}\r\n     */\r\n    this.hasConnectorAnchor = function(_anchor) {\r\n        const anchors = self.getConnectorAnchors();\r\n        for(let i=0; i<anchors.length; i++) {\r\n            if(anchors[i] === _anchor) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {Point|null}\r\n     */    \r\n    this.getTranslateHandleOffset = function() {\r\n        if(currentTranslateHandleElementActivated) {\r\n            return new Point(\r\n                -(currentTranslateHandleElementActivated.offsetLeft + currentTranslateHandleElementActivated.offsetWidth * 0.5),\r\n                -(currentTranslateHandleElementActivated.offsetTop  + currentTranslateHandleElementActivated.offsetHeight * 0.5)\r\n            );\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _id;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getX = function() {\r\n        return self.x;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _x\r\n     */\r\n    this.setX = function(_x) {\r\n        self.x = _x;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getY = function() {\r\n        return self.y;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _y\r\n     */\r\n    this.setY = function(_y) {\r\n        self.y = _y;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _x\r\n     * @param {Number} _y\r\n     */\r\n    this.translate = function(_x, _y) {\r\n        self.x = _x;\r\n        self.y = _y;\r\n\r\n        _domElement.style.left = parseInt(self.x) + 'px';\r\n        _domElement.style.top = parseInt(self.y) + 'px';\r\n\r\n        const observers = eventNameToHandlerFunc.get(Event.TRANSLATE) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\"obj\":self, \"x\": _x, \"y\": _y});\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getWidth = function() {\r\n        return self.width;\r\n    };\r\n\r\n    /**\r\n     * @returns {Number}\r\n     */\r\n    this.getHeight = function() {\r\n        return self.height;\r\n    };\r\n\r\n    /**\r\n     * @param {Number} _width\r\n     * @param {Number} _height\r\n     * @param {Function} _domElementStyleUpdateOverrideFunc\r\n     */\r\n    this.resize = function(_width, _height, _domElementStyleUpdateOverrideFunc) {            \r\n        self.width = _width;\r\n        self.height = _height;\r\n\r\n        if(_domElementStyleUpdateOverrideFunc) {\r\n            _domElementStyleUpdateOverrideFunc(_domElement);\r\n        } else {\r\n            _domElement.style.width = parseInt(self.width) + 'px';\r\n            _domElement.style.height = parseInt(self.height) + 'px';\r\n        }\r\n\r\n        const observers = eventNameToHandlerFunc.get(Event.RESIZE) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\"obj\":self, \"width\": _width, \"height\": _height});\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @returns {Boolean}\r\n     */\r\n    this.getIsDeleted = function() {\r\n        return self.isDeleted;\r\n    };\r\n\r\n    /**\r\n     * @returns {Element}\r\n     */\r\n    this.getDomElement = function() {\r\n        return _domElement;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName\r\n     * @param {*} _eventData\r\n     */\r\n    this.handleSiblingObjectChange = function(_eventName, _eventData) { \r\n\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @returns {Rectangle}\r\n     */\r\n    this.getBoundingRectange = function() {\r\n        const left = parseInt(self.x);\r\n        const top = parseInt(self.y);\r\n        const right = left + parseInt(self.width);\r\n        const bottom = top + parseInt(self.height);\r\n\r\n        return new Rectangle(left, top, right, bottom);\r\n    };\r\n\r\n    /**\r\n     * @returns {Point[]}\r\n     */\r\n    this.getBoundingPoints = function() {\r\n        const topLeft = new Point(self.getX(), self.getY());\r\n        const topRight = new Point(self.getX() + self.getWidth(), self.getY());\r\n        const bottomLeft = new Point(self.getX(), self.getY() + self.getWidth());\r\n        const bottomRight = new Point(self.getX() + self.getWidth(), self.getY() + self.getWidth());\r\n\r\n        return [\r\n            topLeft,\r\n            topRight,\r\n            bottomLeft,\r\n            bottomRight\r\n        ];\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _handlerFunc \r\n     */\r\n    this.on = function(_eventName, _handlerFunc) {\r\n        const allHandlers = eventNameToHandlerFunc.get(_eventName) || [];\r\n        allHandlers.push(_handlerFunc);\r\n        eventNameToHandlerFunc.set(_eventName, allHandlers);        \r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {String} _eventName \r\n     * @param {*} _callback \r\n     */\r\n    this.off = function(_eventName, _callback) {\r\n        const allCallbacks = eventHandlers.get(_eventName) || [];\r\n\r\n        for(let i=0; i<allCallbacks.length; i++) {\r\n            if(allCallbacks[i] === _callback) {\r\n                allCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        eventHandlers.set(_eventName, allCallbacks);\r\n    };\r\n\r\n    this.suspendTranslateInteractions = function() {\r\n        unbindTranslateHandleElements();\r\n    };\r\n\r\n    this.resumeTranslateInteractions = function() {\r\n        bindTranslateHandleElements();\r\n    };\r\n\r\n    const translateTouchStartHandler = function(e) {\r\n        currentTranslateHandleElementActivated = e.target;\r\n\r\n        const observers = eventNameToHandlerFunc.get(Event.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.touches[0].pageX, \r\n                \"y\": e.touches[0].pageY,\r\n                \"isTouch\": true\r\n            });\r\n        });        \r\n\r\n    };\r\n\r\n    const translateMouseDownHandler = function(e) {\r\n        currentTranslateHandleElementActivated = e.target;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(Event.TRANSLATE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.pageX, \r\n                \"y\": e.pageY,\r\n                \"isTouch\": false\r\n            });\r\n        });        \r\n        \r\n    };\r\n\r\n    const unbindTranslateHandleElements = function() {\r\n        _translateHandleDomElements.forEach((_el) => {\r\n            _el.removeEventListener('touchstart', translateTouchStartHandler);        \r\n            _el.removeEventListener('mousedown', translateMouseDownHandler);\r\n        });\r\n    };\r\n\r\n    const bindTranslateHandleElements = function() {\r\n        _translateHandleDomElements.forEach((_el) => {\r\n            _el.addEventListener('touchstart', translateTouchStartHandler);        \r\n            _el.addEventListener('mousedown', translateMouseDownHandler);\r\n        });\r\n    };\r\n\r\n    const resizeMouseDownHandler = function(e) {\r\n        if (e.which !== MOUSE_MIDDLE_BUTTON) {\r\n            return;\r\n        }\r\n\r\n        currentResizeHandleElementActivated = e.target;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(Event.RESIZE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.pageX, \r\n                \"y\": e.pageY,\r\n                \"isTouch\": false\r\n            });\r\n        });    \r\n    };\r\n\r\n    const resizeTouchStartHandler = function(e) {\r\n        currentResizeHandleElementActivated = e.target;\r\n        \r\n        const observers = eventNameToHandlerFunc.get(Event.RESIZE_START) || [];\r\n        observers.forEach(function(handler) {\r\n            handler({\r\n                \"obj\": self,\r\n                \"x\": e.touches[0].pageX,  \r\n                \"y\": e.touches[0].pageY, \r\n                \"isTouch\": true\r\n            });\r\n        });    \r\n    };    \r\n\r\n    const bindResizeHandleElements = function() {\r\n        _resizeHandleDomElements.forEach((_el) => {\r\n            _el.addEventListener('touchstart', resizeTouchStartHandler);  \r\n            _el.addEventListener('mousedown', resizeMouseDownHandler);  \r\n        });\r\n    };\r\n\r\n\r\n    bindTranslateHandleElements();\r\n    bindResizeHandleElements();\r\n};\r\n\r\nexport { CanvasObject };\r\n","/**\r\n * \r\n * @param {String} _id \r\n */\r\nfunction Cluster(_id) {\r\n\r\n    const self = this;\r\n\r\n    /**\r\n     * @type {CanvasObjects[]}\r\n     */\r\n    const canvasObjects = [];\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.getId = function() {\r\n        return _id;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _obj\r\n     * @returns {Number|null}\r\n     */\r\n    this.getObjectIndex = function(_obj) {\r\n        return self.getObjectIndexById(_obj.getId());\r\n    };\r\n\r\n    /**\r\n     * @param {String} _objId\r\n     * @returns {Number|null}\r\n     */\r\n    this.getObjectIndexById = function(_objId) {\r\n        for(let i=0; i<canvasObjects.length; i++) {\r\n            if(canvasObjects[i].getId() === _objId) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _o\r\n     * @returns {Boolean}\r\n     */\r\n    this.addObject = function(_o) {\r\n\r\n        if(self.getObjectIndex(_o) !== null) {\r\n            return false;\r\n        }\r\n\r\n        canvasObjects.push(_o);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @returns {CanvasObjects[]}\r\n     */\r\n    this.getObjects = function() {\r\n        return canvasObjects;\r\n    };\r\n\r\n    /**\r\n     * @returns {String[]}\r\n     */\r\n    this.getObjectIds = function() {\r\n        const ids = [];\r\n        canvasObjects.forEach(function(_o) {\r\n            ids.push(_o.getId());\r\n        });\r\n\r\n        return ids;\r\n    };    \r\n\r\n    /**\r\n     * @param {String} _id\r\n     * @returns {Boolean}\r\n     */\r\n    this.removeObjectById = function(_id) {\r\n        const idx = self.getObjectIndexById(_id);\r\n        if(idx === null) {\r\n            return false;\r\n        }\r\n\r\n        canvasObjects.splice(idx, 1);\r\n        return true;\r\n    };\r\n\r\n    this.removeAllObjects = function() {\r\n        canvasObjects.length = 0;\r\n    };\r\n};\r\n\r\nexport { Cluster };\r\n","import {Rectangle} from './Rectangle';\r\nimport  {CanvasObject} from './CanvasObject';\r\nimport  {Cluster} from './Cluster';\r\n\r\nfunction BoxClusterDetector(_boxExtentOffset) {\r\n\r\n    const self = this;\r\n\r\n    /**\r\n     * \r\n     * @param {CanvasObject} _obj \r\n     * @param {CanvasObject[]} _canvasObjectsArray \r\n     * @returns {Number}\r\n     */\r\n    const getObjectIndexFromArray = function(_obj, _canvasObjectsArray) {\r\n        for(let i=0; i<_canvasObjectsArray.length; i++) {\r\n            if(_canvasObjectsArray[i].getId() === _obj.getId()) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {CanvasObject[]} _objects \r\n     * @param {CanvasObject[]} _canvasObjectsArray \r\n     * @returns {CanvasObject[]}\r\n     */\r\n    const removeObjectsFromArray = function(_objects, _canvasObjectsArray) {\r\n        for(let i=0; i<_objects.length; i++) {\r\n            const idx = getObjectIndexFromArray(_objects[i], _canvasObjectsArray);\r\n            if(idx !== -1) {\r\n                _canvasObjectsArray.splice(idx, 1);\r\n            }\r\n        }\r\n\r\n        return _canvasObjectsArray;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * @param {Map<Cluster, Number>} _clusterToObjectCountMap \r\n     * @returns {Cluster}\r\n     */\r\n    const getClusterWithMostObjectsFromClusterMap = function(_clusterToObjectCountMap)\r\n    {\r\n        var curMaxObjs = 0;\r\n        var curClusterWithMax = null;\r\n\r\n        _clusterToObjectCountMap.forEach(function(_numObjs, _cluster, _map) {\r\n            if(_numObjs > curMaxObjs) {\r\n                curMaxObjs = _numObjs;\r\n                curClusterWithMax = _cluster;\r\n            }\r\n        });\r\n\r\n        return curClusterWithMax;\r\n    };\r\n\r\n    /**\r\n     * @param {Map<Cluster, Number>} _clusterToObjectCountMap \r\n     * @returns {Cluster[]}\r\n     */\r\n    const getClusterArrayFromClusterMap = function(_clusterToObjectCountMap) {\r\n        const resultSet = [];\r\n        _clusterToObjectCountMap.keys().forEach(function(_cluster) {\r\n            resultSet.push(_cluster);\r\n        });\r\n\r\n        return resultSet;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _objA\r\n     * @param {CanvasObject} _objB\r\n     * @returns {Boolean}\r\n     */\r\n    this.areObjectsClose = function(_objA, _objB) {\r\n        const nA = new Rectangle(_objA.x-_boxExtentOffset, _objA.y-_boxExtentOffset, _objA.x + _objA.width + _boxExtentOffset, _objA.y + _objA.height + _boxExtentOffset);\r\n        const nB = new Rectangle(_objB.x-_boxExtentOffset, _objB.y-_boxExtentOffset, _objB.x + _objB.width + _boxExtentOffset, _objB.y + _objB.height + _boxExtentOffset);\r\n        return nA.checkIntersect(nB);\r\n    };\r\n   \r\n    /**\r\n     * @param {CanvasObject} _obj\r\n     * @param {CanvasObject[]} _objectsUnderConsideration\r\n     * @returns {CanvasObject[]}\r\n     */\r\n    this.getAllObjectsCloseTo = function(_obj, _objectsUnderConsideration) {\r\n        const resultSet = [];\r\n        for(let i=0; i<_objectsUnderConsideration.length; i++) {\r\n            if(_obj.getId() === _objectsUnderConsideration[i].getId()) {\r\n                continue;\r\n            }\r\n\r\n            if(self.areObjectsClose(_obj, _objectsUnderConsideration[i])) {\r\n                resultSet.push(_objectsUnderConsideration[i]);\r\n            }\r\n        }\r\n\r\n        return resultSet;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _seedObj\r\n     * @param {CanvasObject[]} _objectsUnderConsideration\r\n     * @param {CanvasObject[]} _resultSet\r\n     */\r\n    this.getClusterObjectsFromSeed = function(_seedObj, _objectsUnderConsideration, _resultSet) {\r\n        const closeByObjects = self.getAllObjectsCloseTo(_seedObj, _objectsUnderConsideration);\r\n        if(closeByObjects.length === 0) {\r\n            return [];\r\n        } else {\r\n            removeObjectsFromArray(closeByObjects.concat([_seedObj]), _objectsUnderConsideration);\r\n\r\n            closeByObjects.forEach(function(_o) {\r\n                _resultSet.push(_o);\r\n                self.getClusterObjectsFromSeed(_o, _objectsUnderConsideration, _resultSet);\r\n            });\r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * @param {CanvasObject[]} _objs\r\n     * @param {Cluster[]} _clusters\r\n     * @returns {Map<Cluster,Number>}\r\n     */\r\n    this.findIntersectingClustersForObjects = function(_objs, _clusters) {\r\n\r\n        // Map of Cluster that is intersecting to number of objects in _objs that is intersecting the given Cluster\r\n        const intersectingClusterToNumObjectsIntersecting = new Map();\r\n\r\n        _clusters.forEach(function(_cluster) {\r\n\r\n            const clusterObjs = _cluster.getObjects();\r\n\r\n            for(let i=0; i<clusterObjs.length; i++) {\r\n                for(let j=0; j<_objs.length; j++) {\r\n\r\n                    if(clusterObjs[i].getId() !== _objs[j].getId()) {\r\n                        continue;\r\n                    }\r\n\r\n                    if(intersectingClusterToNumObjectsIntersecting.has(_cluster)) {\r\n                        const count = intersectingClusterToNumObjectsIntersecting.get(_cluster);\r\n                        intersectingClusterToNumObjectsIntersecting.set(_cluster, count+1);\r\n                    } else {\r\n                        intersectingClusterToNumObjectsIntersecting.set(_cluster, 1);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return intersectingClusterToNumObjectsIntersecting;\r\n    };\r\n\r\n    /**\r\n     * @param {CanvasObject} _obj\r\n     * @param {Cluster[]} _clusters\r\n     */\r\n    this.removeObjectFromClusters = function(_obj, _clusters) {\r\n        _clusters.forEach(function(_c) {\r\n            _c.removeObjectById(_obj.getId());\r\n        });\r\n    };    \r\n\r\n    this.computeClusters = function(_objects, _knownClusters, _getNewIdFunc) {\r\n        const clusters = _knownClusters.map(function(_c) {\r\n            return _c;\r\n        });\r\n\r\n        const objectsUnderConsideration = _objects.map(function(_o) {\r\n            return _o;\r\n        });\r\n\r\n        while(objectsUnderConsideration.length > 0) {\r\n            const obj = objectsUnderConsideration.pop();\r\n\r\n            const objsForCluster = [obj];\r\n            self.getClusterObjectsFromSeed(obj, objectsUnderConsideration, objsForCluster);\r\n\r\n            if(objsForCluster.length > 1) {\r\n\r\n                const intersectingClusterToNumObjectsIntersecting = self.findIntersectingClustersForObjects(objsForCluster, clusters);\r\n\r\n                if(intersectingClusterToNumObjectsIntersecting.size === 0) {\r\n                    const newCluster = new Cluster(_getNewIdFunc());\r\n                    objsForCluster.forEach(function(_clusterObject) {\r\n                        newCluster.addObject(_clusterObject);\r\n                    });    \r\n\r\n                    clusters.push(newCluster);\r\n                } else {\r\n                    const clusterToModify = getClusterWithMostObjectsFromClusterMap(intersectingClusterToNumObjectsIntersecting);\r\n\r\n                    // Clear out objects in cluster\r\n                    clusterToModify.removeAllObjects();\r\n\r\n                    // Remove object from any cluster it's currently in, add it to clusterToModify\r\n                    objsForCluster.forEach(function(_clusterObject) {\r\n                        self.removeObjectFromClusters(_clusterObject, clusters);                    \r\n                        clusterToModify.addObject(_clusterObject);\r\n                    });\r\n\r\n                }\r\n\r\n                removeObjectsFromArray(objsForCluster, objectsUnderConsideration);\r\n\r\n            } else {\r\n                self.removeObjectFromClusters(obj, clusters);\r\n            }\r\n\r\n        }\r\n\r\n        // Filter out clusters w/o any objects\r\n        const nonEmptyClusters = clusters.filter(function(_c) {\r\n            if(_c.getObjects().length >= 2) {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        });\r\n\r\n        return nonEmptyClusters;\r\n    };\r\n    \r\n};\r\n\r\nexport { BoxClusterDetector };\r\n"],"names":["MatrixMath","mat4Multiply","_a","_b","result","i","sum","j","k","vecMat4Multiply","_v","_m","vi","SvgPathBuilder","pointToLineTo","_pt","getX","getY","pointsToPath","_points","p","startPt","lineToString","length","push","startCoordString","pathString","join","Dimensions","_width","_height","getWidth","getHeight","Point","_x","_y","__x","__y","prototype","isEqual","_otherPoint","getCartesianPoint","_canvasWidth","_canvasHeight","toString","LINE_INTERSECTION_TYPE","Object","freeze","PARALLEL","COINCIDENT","LINE","LINESEG","LineIntersection","_type","_intersectionPoint","getType","getIntersectionPoint","Line","_startPoint","_endPoint","__startPoint","__endPoint","getStartPoint","getEndPoint","_otherLine","getLength","Math","sqrt","pow","computeIntersectionType","thisLineStartPointX","thisLineStartPointY","thisLineEndPointX","thisLineEndPointY","otherLineStartPointX","otherLineStartPointY","otherLineEndPointX","otherLineEndPointY","paramDenom","paramANumer","paramBNumer","paramA","paramB","computeIntersection","xIntersect","yIntersect","Rectangle","_left","_top","_right","_bottom","getLeft","getTop","getRight","getBottom","getPoints","getLines","getPointsScaledToGrid","_gridSize","centroid","scaleDx","scaleDy","scaledPoints","checkIntersect","_otherRectangle","checkIsPointWithin","_point","checkIsWithin","PointSet","_pointsInput","self","points","_newPoint","pushPointSet","_ps","possibleNewPoints","toArray","findPointClosestTo","resultPoint","currentMinLength","Number","MAX_SAFE_INTEGER","forEach","lineToPt","findDistanceToPointClosestTo","findPointsCloseTo","_radius","resultSet","toFloat64Array","Float64Array","fromFloat64Array","_float64Array","count","Array","isArray","call","LineSet","_linesInput","lines","_newLine","alreadyInLinesArray","_existingLine","ConnectorAnchor","_id","_domElement","_canvas","getId","getCentroid","r","getBoundingClientRect","right","left","bottom","top","viewportRelativeRect","pageOffset","getPageOffset","getRoutingPoints","halfWidth","halfHeight","getBoundingRectange","Connector","_anchorStart","_anchorEnd","_containerDomElement","_strokeColor","_strokeWidth","eventNameToHandlerFunc","Map","Event","CLICK","pathPoints","pathElem","window","document","createElementNS","setAttribute","style","stroke","strokeWidth","addEventListener","e","observers","get","handler","pageX","pageY","svgDomElem","appendPathToContainerDomElement","appendChild","getPathPoints","getPathLines","refresh","_svgPath","_pathPoints","anchorIds","sort","getAnchorStart","getAnchorEnd","removePathElement","remove","addClassToDomElement","_cl","classList","add","removeClassFromDomElement","getDescriptor","on","_eventName","_handlerFunc","allHandlers","set","off","_callback","allCallbacks","eventHandlers","splice","PointVisibilityMap","_freePoints","_boundaryLines","boundaryLinesArr","freePointsArr","pointToVisibleSet","doesLineIntersectAnyBoundaryLines","_theLine","intersectionType","b","computePointsVisibility","ijLine","getVisiblePointsFrom","_currentPoint","visiblePoints","routeToEndpoint","_currentRouteLength","_pointsInRoute","curMinCost","visiblePointWithMinCost","_vp","gn","hn","optimizeRoute","ptrA","ln","currentMaxLength","_ptKey","lineOfSight","findVisiblePointClosestTo","_freePt","lineOfSightLength","computeRoute","firstRoutingPoint","routeSegment","currentRouteLen","pointsInRoute","currentPoint","lastSegmentToEndpoint","point","GRID_STYLE","DOT","Grid","_size","_color","_style","getSize","getStyle","getSvgImageTile","Canvas","_canvasDomElement","_window","_connectorRoutingWorker","DBLCLICK","OBJECT_ADDED","OBJECT_REMOVED","OBJECT_RESIZED","OBJECT_TRANSLATED","svgElem","width","height","connectorsContainerDomElement","grid","transitionCss","transformOriginX","transformOriginY","translateX","translateY","scaleFactor","invScaleFactor","invTransformationMatrixStack","currentInvTransformationMatrix","currentTransformationMatrix","currentPointVisiblityMap","useTranslate3d","canvasObjects","objectConnectors","objectIdBeingDragged","objectIdBeingResized","objectDragX","objectDragY","objectDragStartX","objectDragStartY","dblTapDetectVars","lastTouchX","lastTouchY","lastTouchTime","connectorAnchorsSelected","connectorAnchorToNumValidRoutingPoints","getCurrentPointVisibilityMap","setGrid","_grid","backgroundImage","btoa","backgroundRepeat","backgroundColor","getGrid","getGridSize","getAccessibleRoutingPointsFromObjectAnchors","_objs","clear","allRoutingPoints","filteredRoutingPoints","_o","anchors","getConnectorAnchors","routingPoints","_rp","isPointWithinObj","obj","boundingRect","routingPoint","currentNumRoutingPoints","parentAnchor","getObjectExtentRoutingPoints","pointSet","_obj","_sp","getConnectorRoutingPointsAroundAnchor","getConnectorBoundaryLines","boundaryLines","_l","_anchor","refreshAllConnectors","connectorDescriptors","_c","routingPointsAroundAnchor","objectExtentRoutingPoints","routingPointsAroundAnchorFloat64Array","routingPointsFloat64Array","boundaryLinesFloat64Array","postMessage","buffer","onmessage","_msg","data","getConnectorDescriptorById","id","descriptor","ps","pointsInPath","svgPath","makeNewConnector","setConnectorFactory","_newConnectorFactory","getTransitionCss","setTransitionCss","_css","transition","getTransformOriginX","getTransformOriginY","getScaleFactor","getTranslateX","getTranslateY","setTransformOrigin","transformOrigin","scale","_scaleFactor","_adjustFactorToPreserveIntegerGrid","newGridSize","roundedGridSize","round","scaleMat","translate","translateMatrix","applyTransform","matElems","transform","resetTransform","pageXOffset","pageYOffset","snapToGrid","_p","ret","max","getOffsetLeft","offsetLeft","getOffsetTop","offsetTop","offsetWidth","offsetHeight","getObjectsAroundPoint","ptRect","getIsDeleted","calcBoundingBox","minTop","minLeft","maxBottom","maxRight","element","index","array","parseInt","getAllObjects","publishSiblingObjectChange","_eventData","handleSiblingObjectChange","getObjectById","foundObject","addObject","handleResizeStart","emitEvent","handleMoveStart","removeObject","_objId","getConnector","c","getAllConnectors","getConnectorsBetweenObjects","_objA","_objB","foundConnectors","_conn","aS","aE","hasConnectorAnchor","getObjectsConnectedViaConnector","_connectorId","foundObjects","allObjs","getConnectorsConnectedToObject","getObjectWithConnectorAnchor","_connectorAnchorId","allObjects","removeAllConnectors","removeConnector","_connector","makeNewConnectorFromAnchors","_anchorA","_anchorB","newConnector","foundConnector","findBestConnectorAnchorsToConnectObjects","_onFound","searchFunc","_searchData","objANumValidRoutingPoints","objAConnectorAnchors","objectA","objBConnectorAnchors","objectB","startAnchorIdxWithMinDist","endAnchorIdxWithMinDist","minDist","MAX_VALUE","x","y","aCentroid","bCentroid","d","objBNumValidRoutingPoints","cb","setTimeout","addConnectionAnchorToSelectionStack","dblClickTapHandler","_posX","_posY","objectsAroundPoint","eventData","initInteractionHandlers","_dblTapSpeed","_dblTapRadius","invTransformedPos","canvasObjectClicked","target","changedTouches","dblTapDetected","now","Date","getTime","timeSinceLastTouch","lastX","lastY","distFromLastTouch","_e","handleMove","translateOffset","getTranslateHandleOffset","mx","my","handleMoveEnd","mxStart","myStart","handleResize","newWidth","newHeight","resize","initTransformationHandlers","touches","preventDefault","which","stopPropagation","cbFunc","CanvasObject","_translateHandleDomElements","_resizeHandleDomElements","MOUSE_MIDDLE_BUTTON","connectorAnchors","nextConnectorAnchorIdSuffix","currentTranslateHandleElementActivated","currentResizeHandleElementActivated","TRANSLATE_START","TRANSLATE","RESIZE_START","RESIZE","isDeleted","addNonInteractableConnectorAnchor","_connectorAnchorDomElement","newAnchor","addInteractableConnectorAnchor","anchor","getConnectorAnchorRoutingPoints","anchorPoints","setX","setY","_domElementStyleUpdateOverrideFunc","getDomElement","getBoundingPoints","topLeft","topRight","bottomLeft","bottomRight","suspendTranslateInteractions","unbindTranslateHandleElements","resumeTranslateInteractions","bindTranslateHandleElements","translateTouchStartHandler","translateMouseDownHandler","_el","removeEventListener","resizeMouseDownHandler","resizeTouchStartHandler","bindResizeHandleElements","Cluster","getObjectIndex","getObjectIndexById","getObjects","getObjectIds","ids","removeObjectById","idx","removeAllObjects","BoxClusterDetector","_boxExtentOffset","getObjectIndexFromArray","_canvasObjectsArray","removeObjectsFromArray","_objects","getClusterWithMostObjectsFromClusterMap","_clusterToObjectCountMap","curMaxObjs","curClusterWithMax","_numObjs","_cluster","_map","areObjectsClose","nA","nB","getAllObjectsCloseTo","_objectsUnderConsideration","getClusterObjectsFromSeed","_seedObj","_resultSet","closeByObjects","concat","findIntersectingClustersForObjects","_clusters","intersectingClusterToNumObjectsIntersecting","clusterObjs","has","removeObjectFromClusters","computeClusters","_knownClusters","_getNewIdFunc","clusters","map","objectsUnderConsideration","pop","objsForCluster","size","newCluster","_clusterObject","clusterToModify","nonEmptyClusters","filter"],"mappings":"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"}